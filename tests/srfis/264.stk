
(define-syntax test-ssre
  (syntax-rules ()
    ((test-ssre pat res)
     (test "srfi-264" (ssre->sre 'pat) 'res))))

(define-syntax test-sre
  (syntax-rules ()
    ((test-sre sre ssre)
     (test "srfi 264" (sre->ssre 'sre) 'ssre))))

; save default definitions
(define *ssre-definitions* (ssre-definitions))

; add some random definitions for the ssre tests
(ssre-definitions
  (ssre-bind 'Any 'cset 'any
  (ssre-bind 'Nd 'cset 'numeric
  (ssre-bind 'vowel 'cset '(or #\a #\e #\i #\o #\u #\y #\w)
  (ssre-bind 'Vowel 'cset '(or #\A #\E #\I #\O #\U #\Y #\W)
  (ssre-bind 'L 'cset 'alpha
  (ssre-bind 'Ll 'cset 'lower
  (ssre-bind 'Lu 'cset 'upper
  *ssre-definitions*))))))))

;; (test-begin "srfi-264")

; NOTE: translations on the right are not the only correct ones; there can be equivalent translations, which are also correct

(test-ssre "the quick brown fox" (: #\t #\h #\e #\space #\q #\u #\i #\c #\k #\space #\b #\r #\o #\w #\n #\space #\f #\o #\x))
(test-ssre "a*abc?xyz+pqr{3}ab{2,}xy{4,5}pq{0,6}AB{0,}zz" (: (* #\a) #\a #\b (? #\c) #\x #\y (+ #\z) #\p #\q (= 3 #\r) #\a (>= 2 #\b) #\x (** 4 5 #\y) #\p (** 0 6 #\q) #\A (>= 0 #\B) #\z #\z))
(test-ssre "^(abc){1,2}zz" (: bos (** 1 2 ($ (: #\a #\b #\c))) #\z #\z))
(test-ssre "^(b+?|a){1,2}?c" (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c))
(test-ssre "^(b+|a){1,2}c" (: bos (** 1 2 ($ (or (+ #\b) #\a))) #\c))
(test-ssre "^(ba|b*){1,2}?bc" (: bos (**? 1 2 ($ (or (: #\b #\a) (* #\b)))) #\b #\c))
(test-ssre "^[ab\\]cde]" (: bos (or #\a #\b #\] #\c #\d #\e)))
(test-ssre "^[]cde]" (: bos (or #\] #\c #\d #\e)))
(test-ssre "^[^ab\\]cde]" (: bos (~ (or #\a #\b #\] #\c #\d #\e))))
(test-ssre "^[^]cde]" (: bos (~ (or #\] #\c #\d #\e))))
(test-ssre "^@" (: bos #\@))
(test-ssre "^[0-9]+$" (: bos (+ (char-range #\0 #\9)) eos))
(test-ssre "^.*nter" (: bos (* nonl) #\n #\t #\e #\r))
(test-ssre "^xxx[0-9]+$" (: bos #\x #\x #\x (+ (char-range #\0 #\9)) eos))
(test-ssre "^.+[0-9][0-9][0-9]$" (: bos (+ nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos))
(test-ssre "^.+?[0-9][0-9][0-9]$" (: bos (**? 1 #f nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos))
(test-ssre "^([^!]+)!(.+)=apquxz\\.ixr\\.zzz\\.ac\\.uk$" (: bos ($ (+ (~ #\!))) #\! ($ (+ nonl)) #\= #\a #\p #\q #\u #\x #\z #\. #\i #\x #\r #\. #\z #\z #\z #\. #\a #\c #\. #\u #\k eos))
(test-ssre ":" #\:)
(test-ssre "([\\da-f:]+)$" (: ($ (+ (or numeric (char-range #\a #\f) #\:))) eos))
(test-ssre "^.*\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$" (: bos (* nonl) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) eos))
(test-ssre "^(\\d+)\\s+IN\\s+SOA\\s+(\\S+)\\s+(\\S+)\\s*\\(\\s*$" (: bos ($ (+ numeric)) (+ space) #\I #\N (+ space) #\S #\O #\A (+ space) ($ (+ (~ space))) (+ space) ($ (+ (~ space))) (* space) #\( (* space) eos))
(test-ssre "^[a-zA-Z\\d][a-zA-Z\\d\\-]*(\\.[a-zA-Z\\d][a-zA-Z\\d\\-]*)*\\.$" (: bos (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-)) (* ($ (: #\. (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-))))) #\. eos))
(test-ssre "^\\*\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?(\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?)*$" (: bos #\* #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric))))) (* ($ (: #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric)))))))) eos))
(test-ssre "^(?=ab(de))(abd)(e)" (: bos (look-ahead (: #\a #\b ($ (: #\d #\e)))) ($ (: #\a #\b #\d)) ($ #\e)))
(test-ssre "^(?!(ab)de|x)(abd)(f)" (: bos (neg-look-ahead (or (: ($ (: #\a #\b)) #\d #\e) #\x)) ($ (: #\a #\b #\d)) ($ #\f)))
(test-ssre "^(?=(ab(cd)))(ab)" (: bos (look-ahead ($ (: #\a #\b ($ (: #\c #\d))))) ($ (: #\a #\b))))
(test-ssre "^[\\da-f](\\.[\\da-f])*$" (: bos (or numeric (char-range #\a #\f)) (* ($ (: #\. (or numeric (char-range #\a #\f))))) eos))
(test-ssre "^\".*\"\\s*(;.*)?$" (: bos #\" (* nonl) #\" (* space) (? ($ (: #\; (* nonl)))) eos))
(test-ssre "^$" (: bos eos))
(test-ssre "(?x)^   a\\ b[c ]d       $" (: bos #\a #\space #\b (or #\c #\space) #\d eos))
(test-ssre "^(a(b(c)))(d(e(f)))(h(i(j)))(k(l(m)))$" (: bos ($ (: #\a ($ (: #\b ($ #\c))))) ($ (: #\d ($ (: #\e ($ #\f))))) ($ (: #\h ($ (: #\i ($ #\j))))) ($ (: #\k ($ (: #\l ($ #\m))))) eos))
(test-ssre "^(?:a(b(c)))(?:d(e(f)))(?:h(i(j)))(?:k(l(m)))$" (: bos (: #\a ($ (: #\b ($ #\c)))) (: #\d ($ (: #\e ($ #\f)))) (: #\h ($ (: #\i ($ #\j)))) (: #\k ($ (: #\l ($ #\m)))) eos))
(test-ssre "^[\\w][\\W][\\s][\\S][\\d][\\D]\\]" (: bos (or alnum #\_) (~ (or alnum #\_)) space (~ space) numeric (~ numeric) #\]))
(test-ssre "^[.^$|()*+?{,}]+" (: bos (+ (or #\. #\^ #\$ #\| #\( #\) #\* #\+ #\? #\{ #\, #\}))))
(test-ssre "^a*\\w" (: bos (* #\a) (or alnum #\_)))
(test-ssre "^a*?\\w" (: bos (*? #\a) (or alnum #\_)))
(test-ssre "^a+\\w" (: bos (+ #\a) (or alnum #\_)))
(test-ssre "^a+?\\w" (: bos (**? 1 #f #\a) (or alnum #\_)))
(test-ssre "^\\d{8}\\w{2,}" (: bos (= 8 numeric) (>= 2 (or alnum #\_))))
(test-ssre "^[aeiou\\d]{4,5}$" (: bos (** 4 5 (or #\a #\e #\i #\o #\u numeric)) eos))
(test-ssre "^[aeiou\\d]{4,5}?" (: bos (**? 4 5 (or #\a #\e #\i #\o #\u numeric))))
(test-ssre "^From +([^ ]+) +[a-zA-Z][a-zA-Z][a-zA-Z] +[a-zA-Z][a-zA-Z][a-zA-Z] +[0-9]?[0-9] +[0-9][0-9]:[0-9][0-9]" (: bos #\F #\r #\o #\m (+ #\space) ($ (+ (~ #\space))) (+ #\space) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (+ #\space) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (+ #\space) (? (char-range #\0 #\9)) (char-range #\0 #\9) (+ #\space) (char-range #\0 #\9) (char-range #\0 #\9) #\: (char-range #\0 #\9) (char-range #\0 #\9)))
(test-ssre "^From\\s+\\S+\\s+([a-zA-Z]{3}\\s+){2}\\d{1,2}\\s+\\d\\d:\\d\\d" (: bos #\F #\r #\o #\m (+ space) (+ (~ space)) (+ space) (= 2 ($ (: (= 3 (or (char-range #\a #\z) (char-range #\A #\Z))) (+ space)))) (** 1 2 numeric) (+ space) numeric numeric #\: numeric numeric))
(test-ssre "^12.34" (: bos #\1 #\2 nonl #\3 #\4))
(test-ssre "foo(?!bar)(.*)" (: #\f #\o #\o (neg-look-ahead (: #\b #\a #\r)) ($ (* nonl))))
(test-ssre "(?:(?!foo)...|^.{0,2})bar(.*)" (: (or (: (neg-look-ahead (: #\f #\o #\o)) nonl nonl nonl) (: bos (** 0 2 nonl))) #\b #\a #\r ($ (* nonl))))
(test-ssre "^(\\D*)(?=\\d)(?!123)" (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))))
(test-ssre "(?!^)abc" (: (neg-look-ahead bos) #\a #\b #\c))
(test-ssre "(?=^)abc" (: (look-ahead bos) #\a #\b #\c))
(test-ssre "^[ab]{1,3}(ab*|b)" (: bos (** 1 3 (or #\a #\b)) ($ (or (: #\a (* #\b)) #\b))))
(test-ssre "^[ab]{1,3}?(ab*|b)" (: bos (**? 1 3 (or #\a #\b)) ($ (or (: #\a (* #\b)) #\b))))
(test-ssre "^[ab]{1,3}?(ab*?|b)" (: bos (**? 1 3 (or #\a #\b)) ($ (or (: #\a (*? #\b)) #\b))))
(test-ssre "^[ab]{1,3}(ab*?|b)" (: bos (** 1 3 (or #\a #\b)) ($ (or (: #\a (*? #\b)) #\b))))
(test-ssre "ab{1,3}bc" (: #\a (** 1 3 #\b) #\b #\c))
(test-ssre "([^.]*)\\.([^:]*):[T ]+(.*)" (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* nonl))))
(test-ssre "^[W-c]+$" (: bos (+ (char-range #\W #\c)) eos))
(test-ssre "^[?-_]+$" (: bos (+ (char-range #\? #\_)) eos))
(test-ssre "^abc$" (: bos #\a #\b #\c eos))
(test-ssre "\\Aabc\\z" (: bos #\a #\b #\c eos))
(test-ssre "\\A(.)*\\z" (: bos (* ($ nonl)) eos))
(test-ssre "(?:b)|(?::+)" (or #\b (+ #\:)))
(test-ssre "[-az]+" (+ (or #\- #\a #\z)))
(test-ssre "[az-]+" (+ (or #\a #\z #\-)))
(test-ssre "[a\\-z]+" (+ (or #\a #\- #\z)))
(test-ssre "[a-z]+" (+ (char-range #\a #\z)))
(test-ssre "[\\d-]+" (+ (or numeric #\-)))
(test-ssre "\\\\" #\\)
(test-ssre "a{0}bc" (: (= 0 #\a) #\b #\c))
(test-ssre "(a|(bc)){0,0}?xyz" (: (**? 0 0 ($ (or #\a ($ (: #\b #\c))))) #\x #\y #\z))
(test-ssre "^([^a])([^b])([^c]*)([^d]{3,4})" (: bos ($ (~ #\a)) ($ (~ #\b)) ($ (* (~ #\c))) ($ (** 3 4 (~ #\d)))))
(test-ssre "[^a]" (~ #\a))
(test-ssre "[^a]+" (+ (~ #\a)))
(test-ssre "[^k]$" (: (~ #\k) eos))
(test-ssre "[^k]{2,3}$" (: (** 2 3 (~ #\k)) eos))
(test-ssre "^\\d{8,}@.+[^k]$" (: bos (>= 8 numeric) #\@ (+ nonl) (~ #\k) eos))
(test-ssre "[^a]" (~ #\a))
(test-ssre "[^az]" (~ (or #\a #\z)))
(test-ssre "P[^*]TAIRE[^*]{1,6}?LL" (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 6 (~ #\*)) #\L #\L))
(test-ssre "P[^*]TAIRE[^*]{1,}?LL" (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 #f (~ #\*)) #\L #\L))
(test-ssre "(\\.\\d\\d[1-9]?)\\d+" (: ($ (: #\. numeric numeric (? (char-range #\1 #\9)))) (+ numeric)))
(test-ssre "(\\.\\d\\d((?=0)|\\d(?=\\d)))" ($ (: #\. numeric numeric ($ (or (look-ahead #\0) (: numeric (look-ahead numeric)))))))
(test-ssre "\\b(foo)\\s+(\\w+)" (: (or bow eow) ($ (: #\f #\o #\o)) (+ space) ($ (+ (or alnum #\_)))))
(test-ssre "foo(.*)bar" (: #\f #\o #\o ($ (* nonl)) #\b #\a #\r))
(test-ssre "foo(.*?)bar" (: #\f #\o #\o ($ (*? nonl)) #\b #\a #\r))
(test-ssre "(.*)(\\d*)" (: ($ (* nonl)) ($ (* numeric))))
(test-ssre "(.*)(\\d+)" (: ($ (* nonl)) ($ (+ numeric))))
(test-ssre "(.*?)(\\d*)" (: ($ (*? nonl)) ($ (* numeric))))
(test-ssre "(.*?)(\\d+)" (: ($ (*? nonl)) ($ (+ numeric))))
(test-ssre "(.*)(\\d+)$" (: ($ (* nonl)) ($ (+ numeric)) eos))
(test-ssre "(.*?)(\\d+)$" (: ($ (*? nonl)) ($ (+ numeric)) eos))
(test-ssre "(.*)\\b(\\d+)$" (: ($ (* nonl)) (or bow eow) ($ (+ numeric)) eos))
(test-ssre "(.*\\D)(\\d+)$" (: ($ (: (* nonl) (~ numeric))) ($ (+ numeric)) eos))
(test-ssre "^\\D*(?!123)" (: bos (* (~ numeric)) (neg-look-ahead (: #\1 #\2 #\3))))
(test-ssre "^(\\D*)(?=\\d)(?!123)" (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))))
(test-ssre "^[W-]46\\]" (: bos (or #\W #\-) #\4 #\6 #\]))
(test-ssre "^[W-\\]46]" (: bos (or (char-range #\W #\]) #\4 #\6)))
(test-ssre "word (?:[a-zA-Z0-9]+ ){0,10}otherword" (: #\w #\o #\r #\d #\space (** 0 10 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d))
(test-ssre "word (?:[a-zA-Z0-9]+ ){0,300}otherword" (: #\w #\o #\r #\d #\space (** 0 300 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d))
(test-ssre "^(a){0,0}" (: bos (= 0 ($ #\a))))
(test-ssre "^(a){0,1}" (: bos (** 0 1 ($ #\a))))
(test-ssre "^(a){0,2}" (: bos (** 0 2 ($ #\a))))
(test-ssre "^(a){0,3}" (: bos (** 0 3 ($ #\a))))
(test-ssre "^(a){0,}" (: bos (>= 0 ($ #\a))))
(test-ssre "^(a){1,1}" (: bos (= 1 ($ #\a))))
(test-ssre "^(a){1,2}" (: bos (** 1 2 ($ #\a))))
(test-ssre "^(a){1,3}" (: bos (** 1 3 ($ #\a))))
(test-ssre "^(a){1,}" (: bos (>= 1 ($ #\a))))
(test-ssre ".*\\.gif" (: (* nonl) #\. #\g #\i #\f))
(test-ssre ".{0,}\\.gif" (: (>= 0 nonl) #\. #\g #\i #\f))
(test-ssre ".*\\.gif" (: (* nonl) #\. #\g #\i #\f))
(test-ssre ".*$" (: (* nonl) eos))
(test-ssre "(.*X|^B)" ($ (or (: (* nonl) #\X) (: bos #\B))))
(test-ssre "^.*B" (: bos (* nonl) #\B))
(test-ssre "(?m)^.*B" (: bol (* nonl) #\B))
(test-ssre "^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]" (: bos (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9)))
(test-ssre "^\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d" (: bos numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric))
(test-ssre "^[\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d]" (: bos numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric))
(test-ssre "^[abc]{12}" (: bos (= 12 (or #\a #\b #\c))))
(test-ssre "^[a-c]{12}" (: bos (= 12 (char-range #\a #\c))))
(test-ssre "^(a|b|c){12}" (: bos (= 12 ($ (or #\a #\b #\c)))))
(test-ssre "^[abcdefghijklmnopqrstuvwxy0123456789]" (: bos (or #\a #\b #\c #\d #\e #\f #\g #\h #\i #\j #\k #\l #\m #\n #\o #\p #\q #\r #\s #\t #\u #\v #\w #\x #\y #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9)))
(test-ssre "abcde{0,0}" (: #\a #\b #\c #\d (= 0 #\e)))
(test-ssre "ab[cd]{0,0}e" (: #\a #\b (= 0 (or #\c #\d)) #\e))
(test-ssre "ab(c){0,0}d" (: #\a #\b (= 0 ($ #\c)) #\d))
(test-ssre "a(b*)" (: #\a ($ (* #\b))))
(test-ssre "ab\\d{0}e" (: #\a #\b (= 0 numeric) #\e))
(test-ssre "\"([^\\\\\"]+|\\\\.)*\"" (: #\" (* ($ (or (+ (~ (or #\\ #\"))) (: #\\ nonl)))) #\"))
(test-ssre ".*?" (*? nonl))
(test-ssre "\\b" (or bow eow))
(test-ssre "a[^a]b" (: #\a (~ #\a) #\b))
(test-ssre "a.b" (: #\a nonl #\b))
(test-ssre "a[^a]b" (: #\a (~ #\a) #\b))
(test-ssre "a.b" (: #\a nonl #\b))
(test-ssre "^(b+?|a){1,2}?c" (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c))
(test-ssre "^(b+|a){1,2}?c" (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\c))
(test-ssre "(?!\\A)x" (: (neg-look-ahead bos) #\x))
(test-ssre "(A|B)*?CD" (: (*? ($ (or #\A #\B))) #\C #\D))
(test-ssre "(A|B)*CD" (: (* ($ (or #\A #\B))) #\C #\D))
(test-ssre "(?<!bar)foo" (: (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o))
(test-ssre "\\w{3}(?<!bar)foo" (: (= 3 (or alnum #\_)) (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o))
(test-ssre "(?<=(foo)a)bar" (: (look-behind (: ($ (: #\f #\o #\o)) #\a)) #\b #\a #\r))
(test-ssre "\\Aabc\\z" (: bos #\a #\b #\c eos))
(test-ssre "(\\d+)(\\w)" (: ($ (+ numeric)) ($ (or alnum #\_))))
(test-ssre "a(?i:b)c" (: #\a (w/nocase #\b) #\c))
(test-ssre "a(?i:b)*c" (: #\a (* (w/nocase #\b)) #\c))
(test-ssre "([a]*?)*" (* ($ (*? #\a))))
(test-ssre "([ab]*?)*" (* ($ (*? (or #\a #\b)))))
(test-ssre "([^a]*?)*" (* ($ (*? (~ #\a)))))
(test-ssre "([^ab]*?)*" (* ($ (*? (~ (or #\a #\b))))))
(test-ssre "(?<=foo\n)^bar" (: (look-behind (: #\f #\o #\o #\newline)) bos #\b #\a #\r))
(test-ssre "(?<=(?<!foo)bar)baz" (: (look-behind (: (neg-look-behind (: #\f #\o #\o)) #\b #\a #\r)) #\b #\a #\z))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "ab*c" (: #\a (* #\b) #\c))
(test-ssre "ab*bc" (: #\a (* #\b) #\b #\c))
(test-ssre ".{1}" (= 1 nonl))
(test-ssre ".{3,4}" (** 3 4 nonl))
(test-ssre "ab{0,}bc" (: #\a (>= 0 #\b) #\b #\c))
(test-ssre "ab+bc" (: #\a (+ #\b) #\b #\c))
(test-ssre "ab{1,}bc" (: #\a (>= 1 #\b) #\b #\c))
(test-ssre "ab+bc" (: #\a (+ #\b) #\b #\c))
(test-ssre "ab{1,}bc" (: #\a (>= 1 #\b) #\b #\c))
(test-ssre "ab{1,3}bc" (: #\a (** 1 3 #\b) #\b #\c))
(test-ssre "ab{3,4}bc" (: #\a (** 3 4 #\b) #\b #\c))
(test-ssre "ab{4,5}bc" (: #\a (** 4 5 #\b) #\b #\c))
(test-ssre "ab?bc" (: #\a (? #\b) #\b #\c))
(test-ssre "ab{0,1}bc" (: #\a (** 0 1 #\b) #\b #\c))
(test-ssre "ab?bc" (: #\a (? #\b) #\b #\c))
(test-ssre "ab?c" (: #\a (? #\b) #\c))
(test-ssre "ab{0,1}c" (: #\a (** 0 1 #\b) #\c))
(test-ssre "^abc$" (: bos #\a #\b #\c eos))
(test-ssre "^abc" (: bos #\a #\b #\c))
(test-ssre "^abc$" (: bos #\a #\b #\c eos))
(test-ssre "abc$" (: #\a #\b #\c eos))
(test-ssre "^" bos)
(test-ssre "$" eos)
(test-ssre "a.c" (: #\a nonl #\c))
(test-ssre "a.*c" (: #\a (* nonl) #\c))
(test-ssre "a[bc]d" (: #\a (or #\b #\c) #\d))
(test-ssre "a[b-d]e" (: #\a (char-range #\b #\d) #\e))
(test-ssre "a[b-d]" (: #\a (char-range #\b #\d)))
(test-ssre "a[-b]" (: #\a (or #\- #\b)))
(test-ssre "a[b-]" (: #\a (or #\b #\-)))
(test-ssre "a\\]" (: #\a #\]))
(test-ssre "a[]]b" (: #\a #\] #\b))
(test-ssre "a[^bc]d" (: #\a (~ (or #\b #\c)) #\d))
(test-ssre "a[^-b]c" (: #\a (~ (or #\- #\b)) #\c))
(test-ssre "a[^]b]c" (: #\a (~ (or #\] #\b)) #\c))
(test-ssre "\\ba\\b" (: (or bow eow) #\a (or bow eow)))
(test-ssre "\\by\\b" (: (or bow eow) #\y (or bow eow)))
(test-ssre "\\Ba\\B" (: nwb #\a nwb))
(test-ssre "\\By\\b" (: nwb #\y (or bow eow)))
(test-ssre "\\by\\B" (: (or bow eow) #\y nwb))
(test-ssre "\\By\\B" (: nwb #\y nwb))
(test-ssre "\\w" (or alnum #\_))
(test-ssre "\\W" (~ (or alnum #\_)))
(test-ssre "a\\sb" (: #\a space #\b))
(test-ssre "a\\Sb" (: #\a (~ space) #\b))
(test-ssre "\\d" numeric)
(test-ssre "\\D" (~ numeric))
(test-ssre "ab|cd" (or (: #\a #\b) (: #\c #\d)))
(test-ssre "()ef" (: ($ (:)) #\e #\f))
(test-ssre "$b" (: eos #\b))
(test-ssre "a\\(b" (: #\a #\( #\b))
(test-ssre "a\\(*b" (: #\a (* #\() #\b))
(test-ssre "a\\\\b" (: #\a #\\ #\b))
(test-ssre "((a))" ($ ($ #\a)))
(test-ssre "(a)b(c)" (: ($ #\a) #\b ($ #\c)))
(test-ssre "a+b+c" (: (+ #\a) (+ #\b) #\c))
(test-ssre "a{1,}b{1,}c" (: (>= 1 #\a) (>= 1 #\b) #\c))
(test-ssre "a.+?c" (: #\a (**? 1 #f nonl) #\c))
(test-ssre "(a+|b)*" (* ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b){0,}" (>= 0 ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b)+" (+ ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b){1,}" (>= 1 ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b)?" (? ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b){0,1}" (** 0 1 ($ (or (+ #\a) #\b))))
(test-ssre "[^ab]*" (* (~ (or #\a #\b))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "a*" (* #\a))
(test-ssre "([abc])*d" (: (* ($ (or #\a #\b #\c))) #\d))
(test-ssre "([abc])*bcd" (: (* ($ (or #\a #\b #\c))) #\b #\c #\d))
(test-ssre "a|b|c|d|e" (or #\a #\b #\c #\d #\e))
(test-ssre "(a|b|c|d|e)f" (: ($ (or #\a #\b #\c #\d #\e)) #\f))
(test-ssre "abcd*efg" (: #\a #\b #\c (* #\d) #\e #\f #\g))
(test-ssre "ab*" (: #\a (* #\b)))
(test-ssre "(ab|cd)e" (: ($ (or (: #\a #\b) (: #\c #\d))) #\e))
(test-ssre "[abhgefdc]ij" (: (or #\a #\b #\h #\g #\e #\f #\d #\c) #\i #\j))
(test-ssre "^(ab|cd)e" (: bos ($ (or (: #\a #\b) (: #\c #\d))) #\e))
(test-ssre "(abc|)ef" (: ($ (or (: #\a #\b #\c) (:))) #\e #\f))
(test-ssre "(a|b)c*d" (: ($ (or #\a #\b)) (* #\c) #\d))
(test-ssre "(ab|ab*)bc" (: ($ (or (: #\a #\b) (: #\a (* #\b)))) #\b #\c))
(test-ssre "a([bc]*)c*" (: #\a ($ (* (or #\b #\c))) (* #\c)))
(test-ssre "a([bc]*)(c*d)" (: #\a ($ (* (or #\b #\c))) ($ (: (* #\c) #\d))))
(test-ssre "a([bc]+)(c*d)" (: #\a ($ (+ (or #\b #\c))) ($ (: (* #\c) #\d))))
(test-ssre "a([bc]*)(c+d)" (: #\a ($ (* (or #\b #\c))) ($ (: (+ #\c) #\d))))
(test-ssre "a[bcd]*dcdcde" (: #\a (* (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e))
(test-ssre "a[bcd]+dcdcde" (: #\a (+ (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e))
(test-ssre "(ab|a)b*c" (: ($ (or (: #\a #\b) #\a)) (* #\b) #\c))
(test-ssre "((a)(b)c)(d)" (: ($ (: ($ #\a) ($ #\b) #\c)) ($ #\d)))
(test-ssre "[a-zA-Z_][a-zA-Z0-9_]*" (: (or (char-range #\a #\z) (char-range #\A #\Z) #\_) (* (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9) #\_))))
(test-ssre "^a(bc+|b[eh])g|.h$" (or (: bos #\a ($ (or (: #\b (+ #\c)) (: #\b (or #\e #\h)))) #\g) (: nonl #\h eos)))
(test-ssre "(bc+d$|ef*g.|h?i(j|k))" ($ (or (: #\b (+ #\c) #\d eos) (: #\e (* #\f) #\g nonl) (: (? #\h) #\i ($ (or #\j #\k))))))
(test-ssre "((((((((((a))))))))))" ($ ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a)))))))))))
(test-ssre "(((((((((a)))))))))" ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a))))))))))
(test-ssre "multiple words of text" (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s #\space #\o #\f #\space #\t #\e #\x #\t))
(test-ssre "multiple words" (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s))
(test-ssre "(.*)c(.*)" (: ($ (* nonl)) #\c ($ (* nonl))))
(test-ssre "\\((.*), (.*)\\)" (: #\( ($ (* nonl)) #\, #\space ($ (* nonl)) #\)))
(test-ssre "[k]" #\k)
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "a(bc)d" (: #\a ($ (: #\b #\c)) #\d))
(test-ssre "a[-]?c" (: #\a (? #\-) #\c))
(test-ssre "a(?!b)." (: #\a (neg-look-ahead #\b) nonl))
(test-ssre "a(?=d)." (: #\a (look-ahead #\d) nonl))
(test-ssre "a(?=c|d)." (: #\a (look-ahead (or #\c #\d)) nonl))
(test-ssre "a(?:b|c|d)(.)" (: #\a (or #\b #\c #\d) ($ nonl)))
(test-ssre "a(?:b|c|d)*(.)" (: #\a (* (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d)+?(.)" (: #\a (**? 1 #f (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d)+(.)" (: #\a (+ (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){2}(.)" (: #\a (= 2 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){4,5}(.)" (: #\a (** 4 5 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){4,5}?(.)" (: #\a (**? 4 5 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){6,7}(.)" (: #\a (** 6 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){6,7}?(.)" (: #\a (**? 6 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,6}(.)" (: #\a (** 5 6 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,6}?(.)" (: #\a (**? 5 6 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,7}(.)" (: #\a (** 5 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,7}?(.)" (: #\a (**? 5 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|(c|e){1,2}?|d)+?(.)" (: #\a (**? 1 #f (or #\b (**? 1 2 ($ (or #\c #\e))) #\d)) ($ nonl)))
(test-ssre "^(.+)?B" (: bos (? ($ (+ nonl))) #\B))
(test-ssre "^([^a-z])|(\\^)$" (or (: bos ($ (~ (char-range #\a #\z)))) (: ($ #\^) eos)))
(test-ssre "^[<>]&" (: bos (or #\< #\>) #\&))
(test-ssre "(?<=a)b" (: (look-behind #\a) #\b))
(test-ssre "(?<!c)b" (: (neg-look-behind #\c) #\b))
(test-ssre "(?:..)*a" (: (* (: nonl nonl)) #\a))
(test-ssre "(?:..)*?a" (: (*? (: nonl nonl)) #\a))
(test-ssre "^(){3,5}" (: bos (** 3 5 ($ (:)))))
(test-ssre "(a|x)*ab" (: (* ($ (or #\a #\x))) #\a #\b))
(test-ssre "(a)*ab" (: (* ($ #\a)) #\a #\b))
(test-ssre "(?i:a)b" (: (w/nocase #\a) #\b))
(test-ssre "((?i:a))b" (: ($ (w/nocase #\a)) #\b))
(test-ssre "(?:c|d)(?:)(?:a(?:)(?:b)(?:b(?:))(?:b(?:)(?:b)))" (: (or #\c #\d) (:) (: #\a (:) #\b (: #\b (:)) (: #\b (:) #\b))))
(test-ssre "(?:c|d)(?:)(?:aaaaaaaa(?:)(?:bbbbbbbb)(?:bbbbbbbb(?:))(?:bbbbbbbb(?:)(?:bbbbbbbb)))" (: (or #\c #\d) (:) (: #\a #\a #\a #\a #\a #\a #\a #\a (:) (: #\b #\b #\b #\b #\b #\b #\b #\b) (: #\b #\b #\b #\b #\b #\b #\b #\b (:)) (: #\b #\b #\b #\b #\b #\b #\b #\b (:) (: #\b #\b #\b #\b #\b #\b #\b #\b)))))
(test-ssre "foo\\w*\\d{4}baz" (: #\f #\o #\o (* (or alnum #\_)) (= 4 numeric) #\b #\a #\z))
(test-ssre "x(~~)*(?:(?:F)?)?" (: #\x (* ($ (: #\~ #\~))) (?? #\F)))
(test-ssre "(?<![cd])b" (: (neg-look-behind (or #\c #\d)) #\b))
(test-ssre "(?<![cd])[ab]" (: (neg-look-behind (or #\c #\d)) (or #\a #\b)))
(test-ssre "(?<!(c|d))b" (: (neg-look-behind ($ (or #\c #\d))) #\b))
(test-ssre "(?<!(c|d))[ab]" (: (neg-look-behind ($ (or #\c #\d))) (or #\a #\b)))
(test-ssre "(?<!cd)[ab]" (: (neg-look-behind (: #\c #\d)) (or #\a #\b)))
(test-ssre "(?m)^b" (: bol #\b))
(test-ssre "(?m)^(b)" (: bol ($ #\b)))
(test-ssre "^b" (: bos #\b))
(test-ssre "()^b" (: ($ (:)) bos #\b))
(test-ssre "(\\w+:)+" (+ ($ (: (+ (or alnum #\_)) #\:))))
(test-ssre "$(?<=^(a))" (: eos (look-behind (: bos ($ #\a)))))
(test-ssre "([\\w:]+::)?(\\w+)$" (: (? ($ (: (+ (or alnum #\_ #\:)) #\: #\:))) ($ (+ (or alnum #\_))) eos))
(test-ssre "^[^bcd]*(c+)" (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))))
(test-ssre "(a*)b+" (: ($ (* #\a)) (+ #\b)))
(test-ssre "^[^bcd]*(c+)" (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))))
(test-ssre "(>a+)ab" (: ($ (: #\> (+ #\a))) #\a #\b))
(test-ssre "b\\z" (: #\b eos))
(test-ssre "(?<=\\d{3}(?!999))foo" (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)))) #\f #\o #\o))
(test-ssre "(?<=(?!...999)\\d{3})foo" (: (look-behind (: (neg-look-ahead (: nonl nonl nonl #\9 #\9 #\9)) (= 3 numeric))) #\f #\o #\o))
(test-ssre "(?<=\\d{3}(?!999)...)foo" (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)) nonl nonl nonl)) #\f #\o #\o))
(test-ssre "(?<=\\d{3}...)(?<!999)foo" (: (look-behind (: (= 3 numeric) nonl nonl nonl)) (neg-look-behind (: #\9 #\9 #\9)) #\f #\o #\o))
(test-ssre "(Z()|A)*" (* ($ (or (: #\Z ($ (:))) #\A))))
(test-ssre "(Z(())|A)*" (* ($ (or (: #\Z ($ ($ (:)))) #\A))))
(test-ssre "a*" (* #\a))
(test-ssre "\\s+" (+ space))
(test-ssre "(?!\\A)x" (: (neg-look-ahead bos) #\x))
(test-ssre "(?!^)x" (: (neg-look-ahead bos) #\x))
(test-ssre "abc." (: #\a #\b #\c nonl))
(test-ssre "a(?x: b c )d" (: #\a (: #\b #\c) #\d))
(test-ssre "(?<=Z)X." (: (look-behind #\Z) #\X nonl))
(test-ssre "(?<![^f]oo)(bar)" (: (neg-look-behind (: (~ #\f) #\o #\o)) ($ (: #\b #\a #\r))))
(test-ssre "(?<![^f])X" (: (neg-look-behind (~ #\f)) #\X))
(test-ssre "(?<=[^f])X" (: (look-behind (~ #\f)) #\X))
(test-ssre "^" bos)
(test-ssre "(?x)(?-x: )" #\space)
(test-ssre "(?x)(?-x: \\s*#\\s*)" (: #\space (* space) #\# (* space)))
(test-ssre "a*b*\\w" (: (* #\a) (* #\b) (or alnum #\_)))
(test-ssre "a*b?\\w" (: (* #\a) (? #\b) (or alnum #\_)))
(test-ssre "a*b{0,4}\\w" (: (* #\a) (** 0 4 #\b) (or alnum #\_)))
(test-ssre "a*b{0,}\\w" (: (* #\a) (>= 0 #\b) (or alnum #\_)))
(test-ssre "a*\\d*\\w" (: (* #\a) (* numeric) (or alnum #\_)))
(test-ssre "(?x)a*b *\\w" (: (* #\a) (* #\b) (or alnum #\_)))
(test-ssre "(?x)a* b *\\w" (: (* #\a) (* #\b) (or alnum #\_)))
(test-ssre "\\z(?<!\n)" (: eos (neg-look-behind #\newline)))
(test-ssre ".*[op][xyz]" (: (* nonl) (or #\o #\p) (or #\x #\y #\z)))
(test-ssre "(a)b|(a)c" (or (: ($ #\a) #\b) (: ($ #\a) #\c)))
(test-ssre "(?:a+|ab)+c" (: (+ (or (+ #\a) (: #\a #\b))) #\c))
(test-ssre "^(?:a|ab)+c" (: bos (+ (or #\a (: #\a #\b))) #\c))
(test-ssre "(?=abc){3}abc" (: (= 3 (look-ahead (: #\a #\b #\c))) #\a #\b #\c))
(test-ssre "(?=abc){0}xyz" (: (= 0 (look-ahead (: #\a #\b #\c))) #\x #\y #\z))
(test-ssre "(?=abc){1}xyz" (: (= 1 (look-ahead (: #\a #\b #\c))) #\x #\y #\z))
(test-ssre "(?=(a))?." (: (? (look-ahead ($ #\a))) nonl))
(test-ssre "(?=(a))??." (: (?? (look-ahead ($ #\a))) nonl))
(test-ssre "^(?!a){0}\\w+" (: bos (= 0 (neg-look-ahead #\a)) (+ (or alnum #\_))))
(test-ssre "(?<=(abc))?xyz" (: (? (look-behind ($ (: #\a #\b #\c)))) #\x #\y #\z))
(test-ssre "^[:a[:digit:]]+" (: bos (+ (or #\: #\a numeric))))
(test-ssre "^[:a[:digit:]:b]+" (: bos (+ (or #\: #\a numeric #\: #\b))))
(test-ssre "[:a]xxx[b:]" (: (or #\: #\a) #\x #\x #\x (or #\b #\:)))
(test-ssre "(?<=[^a]{2})b" (: (look-behind (= 2 (~ #\a))) #\b))
(test-ssre "^(a{2,3}){2,}+a" (: bos (+ (>= 2 ($ (** 2 3 #\a)))) #\a))
(test-ssre "(?=C)" (look-ahead #\C))
(test-ssre "(?:a(?<quote> (?<apostrophe>')|(?<realquote>\")) |b(?<quote> (?<apostrophe>')|(?<realquote>\")) ) (\\k<quote>[a-z]+|[0-9]+)" (: (or (: #\a (-> quote (or (: #\space (-> apostrophe #\')) (-> realquote #\"))) #\space) (: #\b (-> quote (or (: #\space (-> apostrophe #\')) (-> realquote #\"))) #\space)) #\space ($ (or (: (backref quote) (+ (char-range #\a #\z))) (+ (char-range #\0 #\9))))))
(test-ssre "^(a){2,}+(\\w)" (: bos (+ (>= 2 ($ #\a))) ($ (or alnum #\_))))
(test-ssre "^(?:a){2,}+(\\w)" (: bos (+ (>= 2 #\a)) ($ (or alnum #\_))))
(test-ssre "\\A.*?(a|bc)" (: bos (*? nonl) ($ (or #\a (: #\b #\c)))))
(test-ssre "\\A.*?(?:a|bc|d)" (: bos (*? nonl) (or #\a (: #\b #\c) #\d)))
(test-ssre "(?:.*?a)(?<=ba)" (: (*? nonl) #\a (look-behind (: #\b #\a))))
(test-ssre "a(?=bc).|abd" (or (: #\a (look-ahead (: #\b #\c)) nonl) (: #\a #\b #\d)))
(test-ssre "\\A.*?(?:a|bc)" (: bos (*? nonl) (or #\a (: #\b #\c))))
(test-ssre "^\\d*\\w{4}" (: bos (* numeric) (= 4 (or alnum #\_))))
(test-ssre "^[^b]*\\w{4}" (: bos (* (~ #\b)) (= 4 (or alnum #\_))))
(test-ssre "^a*\\w{4}" (: bos (* #\a) (= 4 (or alnum #\_))))
(test-ssre "(?:(?<n>foo)|(?<n>bar))\\k<n>" (: (or (-> n (: #\f #\o #\o)) (-> n (: #\b #\a #\r))) (backref n)))
(test-ssre "(?<n>A)(?:(?<n>foo)|(?<n>bar))\\k<n>" (: (-> n #\A) (or (-> n (: #\f #\o #\o)) (-> n (: #\b #\a #\r))) (backref n)))
(test-ssre "^(\\d+)\\s+IN\\s+SOA\\s+(\\S+)\\s+(\\S+)\\s*\\(\\s*$" (: bos ($ (+ numeric)) (+ space) #\I #\N (+ space) #\S #\O #\A (+ space) ($ (+ (~ space))) (+ space) ($ (+ (~ space))) (* space) #\( (* space) eos))
(test-ssre "(?:x|(?:(xx|yy)+|x|x|x|x|x)|a|a|a)bc" (: (or #\x (or (+ ($ (or (: #\x #\x) (: #\y #\y)))) #\x #\x #\x #\x #\x) #\a #\a #\a) #\b #\c))
(test-ssre "\\sabc" (: space #\a #\b #\c))
(test-ssre "Z*(|d*){216}" (: (* #\Z) (= 216 ($ (or (:) (* #\d))))))
(test-ssre "(?<=a(B){0}c)X" (: (look-behind (: #\a (= 0 ($ #\B)) #\c)) #\X))
(test-ssre "a+(?:|b)a" (: (+ #\a) (or (:) #\b) #\a))
(test-ssre "X?(R||){3335}" (: (? #\X) (= 3335 ($ (or #\R (:) (:))))))
(test-ssre "(?!(b))c|b" (or (: (neg-look-ahead ($ #\b)) #\c) #\b))
(test-ssre "(?=(b))b|c" (or (: (look-ahead ($ #\b)) #\b) #\c))
(test-ssre "<(?x:[a b])>" (: #\< (or #\a #\space #\b) #\>))
(test-ssre "<(?:[a b])>" (: #\< (or #\a #\space #\b) #\>))
(test-ssre "<(?xxx:[a b])>" (: #\< (or #\a #\space #\b) #\>))
(test-ssre "<(?-x:[a b])>" (: #\< (or #\a #\space #\b) #\>))
(test-ssre "[[:digit:]-]+" (+ (or numeric #\-)))
(test-ssre "(?<=(?=.)?)" (look-behind (? (look-ahead nonl))))
(test-ssre "(?<=(?=.){4,5})" (look-behind (** 4 5 (look-ahead nonl))))
(test-ssre "(?<=(?=.){4,5}x)" (look-behind (: (** 4 5 (look-ahead nonl)) #\x)))
(test-ssre "   (?<word> \\w+ )*    \\.   " (: #\space #\space #\space (* (-> word (: #\space (+ (or alnum #\_)) #\space))) #\space #\space #\space #\space #\. #\space #\space #\space))
(test-ssre "(?<=(?=.(?<=x)))" (look-behind (look-ahead (: nonl (look-behind #\x)))))
(test-ssre "(?<=(?=(?<=a)))b" (: (look-behind (look-ahead (look-behind #\a))) #\b))
(test-ssre "(?<=ab?c)..." (: (look-behind (: #\a (? #\b) #\c)) nonl nonl nonl))
(test-ssre "(?<=PQR|ab?c)..." (: (look-behind (or (: #\P #\Q #\R) (: #\a (? #\b) #\c))) nonl nonl nonl))
(test-ssre "(?<=ab?c|PQR)..." (: (look-behind (or (: #\a (? #\b) #\c) (: #\P #\Q #\R))) nonl nonl nonl))
(test-ssre "(?<=PQ|ab?c)..." (: (look-behind (or (: #\P #\Q) (: #\a (? #\b) #\c))) nonl nonl nonl))
(test-ssre "(?<=ab?c|PQ)..." (: (look-behind (or (: #\a (? #\b) #\c) (: #\P #\Q))) nonl nonl nonl))
(test-ssre "(?<=a(b?c|d?e?e)f)X." (: (look-behind (: #\a ($ (or (: (? #\b) #\c) (: (? #\d) (? #\e) #\e))) #\f)) #\X nonl))
(test-ssre "(?<!a(b?c|d?e?e)f)X." (: (neg-look-behind (: #\a ($ (or (: (? #\b) #\c) (: (? #\d) (? #\e) #\e))) #\f)) #\X nonl))
(test-ssre "(?<=\\d{2,3}|ABC)." (: (look-behind (or (** 2 3 numeric) (: #\A #\B #\C))) nonl))
(test-ssre "(?<=(\\d{1,255}))X" (: (look-behind ($ (** 1 255 numeric))) #\X))
(test-ssre "(?<=a(b?c){3}d)X" (: (look-behind (: #\a (= 3 ($ (: (? #\b) #\c))) #\d)) #\X))
(test-ssre "(?<=a(b?c){0}d)X" (: (look-behind (: #\a (= 0 ($ (: (? #\b) #\c))) #\d)) #\X))
(test-ssre "(?<=a?(b?c){0}d)X." (: (look-behind (: (? #\a) (= 0 ($ (: (? #\b) #\c))) #\d)) #\X nonl))
(test-ssre "(?<!a?)" (neg-look-behind (? #\a)))
(test-ssre "(?<=PQ|Pc.b?)(.?)(b?)" (: (look-behind (or (: #\P #\Q) (: #\P #\c nonl (? #\b)))) ($ (? nonl)) ($ (? #\b))))
(test-ssre "(?=a)b?a" (: (look-ahead #\a) (? #\b) #\a))
(test-ssre "(?=a)b?a." (: (look-ahead #\a) (? #\b) #\a nonl))
(test-ssre "65 00 64" (: #\6 #\5 #\space #\0 #\0 #\space #\6 #\4))
(test-ssre "^.{4}" (: bos (= 4 nonl)))
(test-ssre "^(.{3,6}!)+$" (: bos (+ ($ (: (** 3 6 nonl) #\!))) eos))
(test-ssre "[a-z]{5,}b|x" (or (: (>= 5 (char-range #\a #\z)) #\b) #\x))
(test-ssre "[a-z]{1,6}?s|x" (or (: (**? 1 6 (char-range #\a #\z)) #\s) #\x))
(test-ssre "[@]" #\@)
(test-ssre "@" #\@)
(test-ssre "@@@xxx" (: #\@ #\@ #\@ #\x #\x #\x))
(test-ssre "badutf" (: #\b #\a #\d #\u #\t #\f))
(test-ssre "shortutf" (: #\s #\h #\o #\r #\t #\u #\t #\f))
(test-ssre "anything" (: #\a #\n #\y #\t #\h #\i #\n #\g))
(test-ssre "badutf" (: #\b #\a #\d #\u #\t #\f))
(test-ssre "(?<=x)badutf" (: (look-behind #\x) #\b #\a #\d #\u #\t #\f))
(test-ssre "(?<=xx)badutf" (: (look-behind (: #\x #\x)) #\b #\a #\d #\u #\t #\f))
(test-ssre "(?<=xxxx)badutf" (: (look-behind (: #\x #\x #\x #\x)) #\b #\a #\d #\u #\t #\f))
(test-ssre "X" #\X)
(test-ssre "a+" (+ #\a))
(test-ssre "A" #\A)
(test-ssre "x" #\x)
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "X" #\X)
(test-ssre "(?<=.)X" (: (look-behind nonl) #\X))
(test-ssre "a+" (+ #\a))
(test-ssre "a" #\a)
(test-ssre "." nonl)
(test-ssre "s" #\s)
(test-ssre "[^s]" (~ #\s))
(test-ssre "a(?:.)*?a" (: #\a (*? nonl) #\a))
(test-ssre "(?<=pqr)abc(?=xyz)" (: (look-behind (: #\p #\q #\r)) #\a #\b #\c (look-ahead (: #\x #\y #\z))))
(test-ssre "a\\b" (: #\a (or bow eow)))
(test-ssre "abc(?=abcde)(?=ab)" (: #\a #\b #\c (look-ahead (: #\a #\b #\c #\d #\e)) (look-ahead (: #\a #\b))))
(test-ssre "(?<=abc)123" (: (look-behind (: #\a #\b #\c)) #\1 #\2 #\3))
(test-ssre "\\babc\\b" (: (or bow eow) #\a #\b #\c (or bow eow)))
(test-ssre "(?<=abc)def" (: (look-behind (: #\a #\b #\c)) #\d #\e #\f))
(test-ssre "abc(?<=bc)def" (: #\a #\b #\c (look-behind (: #\b #\c)) #\d #\e #\f))
(test-ssre "(?<=ab)cdef" (: (look-behind (: #\a #\b)) #\c #\d #\e #\f))
(test-ssre "b(?<!ax)(?!cx)" (: #\b (neg-look-behind (: #\a #\x)) (neg-look-ahead (: #\c #\x))))
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "^12345678abcd" (: bos #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\a #\b #\c #\d))
(test-ssre "a(?:.)*?a" (: #\a (*? nonl) #\a))
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "[axm]{7}" (= 7 (or #\a #\x #\m)))
(test-ssre "(.|.)*?bx" (: (*? ($ (or nonl nonl))) #\b #\x))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "(...)-(...)" (: ($ (: nonl nonl nonl)) #\- ($ (: nonl nonl nonl))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "^abc|def" (or (: bos #\a #\b #\c) (: #\d #\e #\f)))
(test-ssre ".*((abc)$|(def))" (: (* nonl) ($ (or (: ($ (: #\a #\b #\c)) eos) ($ (: #\d #\e #\f))))))
(test-ssre "the quick brown fox" (: #\t #\h #\e #\space #\q #\u #\i #\c #\k #\space #\b #\r #\o #\w #\n #\space #\f #\o #\x))
(test-ssre "a*(b+)(z)(z)" (: (* #\a) ($ (+ #\b)) ($ #\z) ($ #\z)))
(test-ssre "ab.cd" (: #\a #\b nonl #\c #\d))
(test-ssre "a?|b?" (or (? #\a) (? #\b)))
(test-ssre "\\w+A" (: (+ (or alnum #\_)) #\A))
(test-ssre "^d(e)$" (: bos #\d ($ #\e) eos))
(test-ssre "((a)(b)?(c))" ($ (: ($ #\a) (? ($ #\b)) ($ #\c))))
(test-ssre "\\w" (or alnum #\_))
(test-ssre "x{5,4}" (** 5 4 #\x))
(test-ssre "z{65536}" (= 65536 #\z))
(test-ssre "abc(?<=a+)b" (: #\a #\b #\c (look-behind (+ #\a)) #\b))
(test-ssre "(?<=ab(c+)d)ef" (: (look-behind (: #\a #\b ($ (+ #\c)) #\d)) #\e #\f))
(test-ssre "(?<=ab(?<=c+)d)ef" (: (look-behind (: #\a #\b (look-behind (+ #\c)) #\d)) #\e #\f))
(test-ssre "The next three are in testinput2 because they have variable length branches" (: #\T #\h #\e #\space #\n #\e #\x #\t #\space #\t #\h #\r #\e #\e #\space #\a #\r #\e #\space #\i #\n #\space #\t #\e #\s #\t #\i #\n #\p #\u #\t #\2 #\space #\b #\e #\c #\a #\u #\s #\e #\space #\t #\h #\e #\y #\space #\h #\a #\v #\e #\space #\v #\a #\r #\i #\a #\b #\l #\e #\space #\l #\e #\n #\g #\t #\h #\space #\b #\r #\a #\n #\c #\h #\e #\s))
(test-ssre "(?<=x+)y" (: (look-behind (+ #\x)) #\y))
(test-ssre "a{37,17}" (** 37 17 #\a))
(test-ssre "a{1,3}b" (: (** 1 3 #\a) #\b))
(test-ssre ".+foo" (: (+ nonl) #\f #\o #\o))
(test-ssre "^X" (: bos #\X))
(test-ssre "(?<A>tom|bon)-\\k<A>" (: (-> A (or (: #\t #\o #\m) (: #\b #\o #\n))) #\- (backref A)))
(test-ssre "Xa{2,4}b" (: #\X (** 2 4 #\a) #\b))
(test-ssre "Xa{2,4}?b" (: #\X (**? 2 4 #\a) #\b))
(test-ssre "Xa{2,4}+b" (: #\X (+ (** 2 4 #\a)) #\b))
(test-ssre "X\\d{2,4}b" (: #\X (** 2 4 numeric) #\b))
(test-ssre "X\\d{2,4}?b" (: #\X (**? 2 4 numeric) #\b))
(test-ssre "X\\d{2,4}+b" (: #\X (+ (** 2 4 numeric)) #\b))
(test-ssre "X\\D{2,4}b" (: #\X (** 2 4 (~ numeric)) #\b))
(test-ssre "X\\D{2,4}?b" (: #\X (**? 2 4 (~ numeric)) #\b))
(test-ssre "X\\D{2,4}+b" (: #\X (+ (** 2 4 (~ numeric))) #\b))
(test-ssre "X[abc]{2,4}b" (: #\X (** 2 4 (or #\a #\b #\c)) #\b))
(test-ssre "X[abc]{2,4}?b" (: #\X (**? 2 4 (or #\a #\b #\c)) #\b))
(test-ssre "X[abc]{2,4}+b" (: #\X (+ (** 2 4 (or #\a #\b #\c))) #\b))
(test-ssre "X[^a]{2,4}b" (: #\X (** 2 4 (~ #\a)) #\b))
(test-ssre "X[^a]{2,4}?b" (: #\X (**? 2 4 (~ #\a)) #\b))
(test-ssre "X[^a]{2,4}+b" (: #\X (+ (** 2 4 (~ #\a))) #\b))
(test-ssre "Z(?!)" (: #\Z (neg-look-ahead (:))))
(test-ssre "dog(sbody)?" (: #\d #\o #\g (? ($ (: #\s #\b #\o #\d #\y)))))
(test-ssre "dog(sbody)??" (: #\d #\o #\g (?? ($ (: #\s #\b #\o #\d #\y)))))
(test-ssre "dog|dogsbody" (or (: #\d #\o #\g) (: #\d #\o #\g #\s #\b #\o #\d #\y)))
(test-ssre "dogsbody|dog" (or (: #\d #\o #\g #\s #\b #\o #\d #\y) (: #\d #\o #\g)))
(test-ssre "\\bthe cat\\b" (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "(?<=abc)123" (: (look-behind (: #\a #\b #\c)) #\1 #\2 #\3))
(test-ssre "\\babc\\b" (: (or bow eow) #\a #\b #\c (or bow eow)))
(test-ssre "a?b?" (: (? #\a) (? #\b)))
(test-ssre "^a?b?" (: bos (? #\a) (? #\b)))
(test-ssre "abcd*" (: #\a #\b #\c (* #\d)))
(test-ssre "abc\\d*" (: #\a #\b #\c (* numeric)))
(test-ssre "abc[de]*" (: #\a #\b #\c (* (or #\d #\e))))
(test-ssre "(?<=abc)def" (: (look-behind (: #\a #\b #\c)) #\d #\e #\f))
(test-ssre "abc$" (: #\a #\b #\c eos))
(test-ssre "abc\\z" (: #\a #\b #\c eos))
(test-ssre "abc\\b" (: #\a #\b #\c (or bow eow)))
(test-ssre "abc\\B" (: #\a #\b #\c nwb))
(test-ssre ".+" (+ nonl))
(test-ssre "(?<=(abc)+)X" (: (look-behind (+ ($ (: #\a #\b #\c)))) #\X))
(test-ssre "(a)b|ac" (or (: ($ #\a) #\b) (: #\a #\c)))
(test-ssre "(a)(b)x|abc" (or (: ($ #\a) ($ #\b) #\x) (: #\a #\b #\c)))
(test-ssre "(?:(foo)|(bar)|(baz))X" (: (or ($ (: #\f #\o #\o)) ($ (: #\b #\a #\r)) ($ (: #\b #\a #\z))) #\X))
(test-ssre "(ab)x|ab" (or (: ($ (: #\a #\b)) #\x) (: #\a #\b)))
(test-ssre "(((((a)))))" ($ ($ ($ ($ ($ #\a))))))
(test-ssre "a*?b*?" (: (*? #\a) (*? #\b)))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "a(b)c" (: #\a ($ #\b) #\c))
(test-ssre "(a)(b)|(c)" (or (: ($ #\a) ($ #\b)) ($ #\c)))
(test-ssre "(?<A>a)|(?<A>b)" (or (-> A #\a) (-> A #\b)))
(test-ssre "a(b)c(d)" (: #\a ($ #\b) #\c ($ #\d)))
(test-ssre "^abc" (: bos #\a #\b #\c))
(test-ssre ".*\\d" (: (* nonl) numeric))
(test-ssre "(abc)*" (* ($ (: #\a #\b #\c))))
(test-ssre "^" bos)
(test-ssre "(?:ab)?(?:ab)(?:ab)" (: (? (: #\a #\b)) (: #\a #\b) (: #\a #\b)))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "(abcd)" ($ (: #\a #\b #\c #\d)))
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "a(b)c" (: #\a ($ #\b) #\c))
(test-ssre "0b 28 3f 2d 78 29 3a" (: #\0 #\b #\space #\2 #\8 #\space #\3 #\f #\space #\2 #\d #\space #\7 #\8 #\space #\2 #\9 #\space #\3 #\a))
(test-ssre "a|(b)c" (or #\a (: ($ #\b) #\c)))
(test-ssre "efg" (: #\e #\f #\g))
(test-ssre "eff" (: #\e #\f #\f))
(test-ssre "effg" (: #\e #\f #\f #\g))
(test-ssre "aaa" (: #\a #\a #\a))
(test-ssre "(?<!|!(?<!))" (neg-look-behind (or (:) (: #\! (neg-look-behind (:))))))
(test-ssre "(?<!|!|!||||||(?<!)||(?<!)!|!||(?<!)!|!(?<!)!|!|!|!||||!!|<!)!|!||||!|" (or (: (neg-look-behind (or (:) #\! #\! (:) (:) (:) (:) (:) (neg-look-behind (:)) (:) (: (neg-look-behind (:)) #\!) #\! (:) (: (neg-look-behind (:)) #\!) (: #\! (neg-look-behind (:)) #\!) #\! #\! #\! (:) (:) (:) (: #\! #\!) (: #\< #\!))) #\!) #\! (:) (:) (:) #\! (:)))
(test-ssre "(R?){65}" (= 65 ($ (? #\R))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "abc|bcd" (or (: #\a #\b #\c) (: #\b #\c #\d)))
(test-ssre "^(b+|a){1,2}?bc" (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\b #\c))
(test-ssre "^(b*|ba){1,2}?bc" (: bos (**? 1 2 ($ (or (* #\b) (: #\b #\a)))) #\b #\c))
(test-ssre "[abc]" (or #\a #\b #\c))
(test-ssre "a(b)c|xyz" (or (: #\a ($ #\b) #\c) (: #\x #\y #\z)))
(test-ssre "foobar" (: #\f #\o #\o #\b #\a #\r))
(test-ssre "\\[()\\]{65535}(?<A>)" (: #\[ ($ (:)) (= 65535 #\]) (-> A (:))))
(test-ssre "(?<=(?=.(?<=x)))" (look-behind (look-ahead (: nonl (look-behind #\x)))))
(test-ssre "\\z" eos)
(test-ssre "\\Z" (: (? #\newline) eos))
(test-ssre "(?![ab]).*" (: (neg-look-ahead (or #\a #\b)) (* nonl)))
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "12345(?<=\\d{1,256})X" (: #\1 #\2 #\3 #\4 #\5 (look-behind (** 1 256 numeric)) #\X))
(test-ssre "(?<!( {65054}){9,44965})" (neg-look-behind (** 9 44965 ($ (= 65054 #\space)))))
(test-ssre "(?<=(()()()()()()()()()()()()()(()()()()(())()()()()(()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()(())()()()()(()()()()()()(()()()()()()()()()()()()()()()()()()()()()(())()()()()(()()()()()()()()()()()()()(()()()()()()()()()()()()()(()())))))))))" (look-behind ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ ($ (:))) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ ($ (:))) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ ($ (:))) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:))))))))))))))))))))
(test-ssre "((foo)|(bar))*" (* ($ (or ($ (: #\f #\o #\o)) ($ (: #\b #\a #\r))))))
(test-ssre "(?:(f)(o)(o)|(b)(a)(r))*" (* (or (: ($ #\f) ($ #\o) ($ #\o)) (: ($ #\b) ($ #\a) ($ #\r)))))
(test-ssre "((Z)+|A)*" (* ($ (or (+ ($ #\Z)) #\A))))
(test-ssre "A +" (: #\A (+ #\space)))
(test-ssre "a\\z" (: #\a eos))
(test-ssre "[a[]" (or #\a #\[))
(test-ssre "[[:digit:]   -Z]" (or numeric #\space #\space (char-range #\space #\Z)))
(test-ssre "[\\d   -Z]" (or numeric #\space #\space (char-range #\space #\Z)))
(test-ssre "(?<=abc)(|DEF)" (: (look-behind (: #\a #\b #\c)) ($ (or (:) (: #\D #\E #\F)))))
(test-ssre "a(bb)c" (: #\a ($ (: #\b #\b)) #\c))
(test-ssre "a()c" (: #\a ($ (:)) #\c))
(test-ssre "(?:(?<n>foo)|(?<n>bar))\\k<n>" (: (or (-> n (: #\f #\o #\o)) (-> n (: #\b #\a #\r))) (backref n)))
(test-ssre "a?b[]xy]*c" (: (? #\a) #\b (* (or #\] #\x #\y)) #\c))
(test-ssre "f*" (* #\f))
(test-ssre "foo\\*" (: #\f #\o #\o #\*))
(test-ssre "foo\\*bar" (: #\f #\o #\o #\* #\b #\a #\r))
(test-ssre "f\\\\oo" (: #\f #\\ #\o #\o))
(test-ssre "[ten]" (or #\t #\e #\n))
(test-ssre "t[a-g]n" (: #\t (char-range #\a #\g) #\n))
(test-ssre "a[]]b" (: #\a #\] #\b))
(test-ssre "a[]a-]b" (: #\a (or #\] #\a #\-) #\b))
(test-ssre "a[]-]b" (: #\a (or #\] #\-) #\b))
(test-ssre "a[]a-z]b" (: #\a (or #\] (char-range #\a #\z)) #\b))
(test-ssre "\\]" #\])
(test-ssre "t[!a-g]n" (: #\t (or #\! (char-range #\a #\g)) #\n))
(test-ssre "A[+-0]B" (: #\A (char-range #\+ #\0) #\B))
(test-ssre "a[--0]z" (: #\a (char-range #\- #\0) #\z))
(test-ssre "a[[:digit:].]z" (: #\a (or numeric #\.) #\z))
(test-ssre "A\\B\\\\C\\D" (: #\A nwb #\\ #\C (~ numeric)))
(test-ssre "a*b" (: (* #\a) #\b))
(test-ssre "<[]bc]>" (: #\< (or #\] #\b #\c) #\>))
(test-ssre "<[^]bc]>" (: #\< (~ (or #\] #\b #\c)) #\>))
(test-ssre "a*b+c\\+[def](ab)\\(cd\\)" (: (* #\a) (+ #\b) #\c #\+ (or #\d #\e #\f) ($ (: #\a #\b)) #\( #\c #\d #\)))
(test-ssre "how.to how\\.to" (: #\h #\o #\w nonl #\t #\o #\space #\h #\o #\w #\. #\t #\o))
(test-ssre "^how to \\^how to" (: bos #\h #\o #\w #\space #\t #\o #\space #\^ #\h #\o #\w #\space #\t #\o))
(test-ssre "^b\\(c^d\\)\\(^e^f\\)" (: bos #\b #\( #\c bos #\d #\) #\( bos #\e bos #\f #\)))
(test-ssre "\\[()\\]{65535}()" (: #\[ ($ (:)) (= 65535 #\]) ($ (:))))
(test-ssre "^A" (: bos #\A))
(test-ssre "^\\w+" (: bos (+ (or alnum #\_))))
(test-ssre "(.+)\\b(.+)" (: ($ (+ nonl)) (or bow eow) ($ (+ nonl))))
(test-ssre "\\W+" (+ (~ (or alnum #\_))))
(test-ssre "\\w+" (+ (or alnum #\_)))
(test-ssre "a.b" (: #\a nonl #\b))
(test-ssre "a(.{3})b" (: #\a ($ (= 3 nonl)) #\b))
(test-ssre "a(.*?)(.)" (: #\a ($ (*? nonl)) ($ nonl)))
(test-ssre "a(.*)(.)" (: #\a ($ (* nonl)) ($ nonl)))
(test-ssre "a(.)(.)" (: #\a ($ nonl) ($ nonl)))
(test-ssre "a(.?)(.)" (: #\a ($ (? nonl)) ($ nonl)))
(test-ssre "a(.??)(.)" (: #\a ($ (?? nonl)) ($ nonl)))
(test-ssre "a(.{3})b" (: #\a ($ (= 3 nonl)) #\b))
(test-ssre "a(.{3,})b" (: #\a ($ (>= 3 nonl)) #\b))
(test-ssre "a(.{3,}?)b" (: #\a ($ (**? 3 #f nonl)) #\b))
(test-ssre "a(.{3,5})b" (: #\a ($ (** 3 5 nonl)) #\b))
(test-ssre "a(.{3,5}?)b" (: #\a ($ (**? 3 5 nonl)) #\b))
(test-ssre "(?<=aXb)cd" (: (look-behind (: #\a #\X #\b)) #\c #\d))
(test-ssre "(?<=(.))X" (: (look-behind ($ nonl)) #\X))
(test-ssre "[^a]+" (+ (~ #\a)))
(test-ssre "^[^a]{2}" (: bos (= 2 (~ #\a))))
(test-ssre "^[^a]{2,}" (: bos (>= 2 (~ #\a))))
(test-ssre "^[^a]{2,}?" (: bos (**? 2 #f (~ #\a))))
(test-ssre "[^a]+" (+ (~ #\a)))
(test-ssre "^[^a]{2}" (: bos (= 2 (~ #\a))))
(test-ssre "^[^a]{2,}" (: bos (>= 2 (~ #\a))))
(test-ssre "^[^a]{2,}?" (: bos (**? 2 #f (~ #\a))))
(test-ssre "\\D*" (* (~ numeric)))
(test-ssre "\\D" (~ numeric))
(test-ssre ">\\S" (: #\> (~ space)))
(test-ssre "\\d" numeric)
(test-ssre "\\s" space)
(test-ssre "\\D+" (+ (~ numeric)))
(test-ssre "\\D{2,3}" (** 2 3 (~ numeric)))
(test-ssre "\\D{2,3}?" (**? 2 3 (~ numeric)))
(test-ssre "\\d+" (+ numeric))
(test-ssre "\\d{2,3}" (** 2 3 numeric))
(test-ssre "\\d{2,3}?" (**? 2 3 numeric))
(test-ssre "\\S+" (+ (~ space)))
(test-ssre "\\S{2,3}" (** 2 3 (~ space)))
(test-ssre "\\S{2,3}?" (**? 2 3 (~ space)))
(test-ssre ">\\s+<" (: #\> (+ space) #\<))
(test-ssre ">\\s{2,3}<" (: #\> (** 2 3 space) #\<))
(test-ssre ">\\s{2,3}?<" (: #\> (**? 2 3 space) #\<))
(test-ssre "\\w+" (+ (or alnum #\_)))
(test-ssre "\\w{2,3}" (** 2 3 (or alnum #\_)))
(test-ssre "\\w{2,3}?" (**? 2 3 (or alnum #\_)))
(test-ssre "\\W+" (+ (~ (or alnum #\_))))
(test-ssre "\\W{2,3}" (** 2 3 (~ (or alnum #\_))))
(test-ssre "\\W{2,3}?" (**? 2 3 (~ (or alnum #\_))))
(test-ssre "^[ac]*b" (: bos (* (or #\a #\c)) #\b))
(test-ssre "^[^x]*b" (: bos (* (~ #\x)) #\b))
(test-ssre "^\\d*b" (: bos (* numeric) #\b))
(test-ssre "(|a)" ($ (or (:) #\a)))
(test-ssre "\\S\\S" (: (~ space) (~ space)))
(test-ssre "\\S{2}" (= 2 (~ space)))
(test-ssre "\\W\\W" (: (~ (or alnum #\_)) (~ (or alnum #\_))))
(test-ssre "\\W{2}" (= 2 (~ (or alnum #\_))))
(test-ssre "\\S" (~ space))
(test-ssre "\\D" (~ numeric))
(test-ssre "\\W" (~ (or alnum #\_)))
(test-ssre ".[^\\S\n]." (: nonl (~ (or (~ space) #\newline)) nonl))
(test-ssre "^[^d]*?$" (: bos (*? (~ #\d)) eos))
(test-ssre "A*" (* #\A))
(test-ssre "." nonl)
(test-ssre "^\\d*\\w{4}" (: bos (* numeric) (= 4 (or alnum #\_))))
(test-ssre "^[^b]*\\w{4}" (: bos (* (~ #\b)) (= 4 (or alnum #\_))))
(test-ssre "^.\\B.\\B." (: bos nonl nwb nonl nwb nonl))
(test-ssre "\\D+" (+ (~ numeric)))
(test-ssre "^\\w+" (: bos (+ (or alnum #\_))))
(test-ssre "^\\d+" (: bos (+ numeric)))
(test-ssre "^>\\s+" (: bos #\> (+ space)))
(test-ssre "^A\\s+Z" (: bos #\A (+ space) #\Z))
(test-ssre "[RST]+" (+ (or #\R #\S #\T)))
(test-ssre "[R-T]+" (+ (char-range #\R #\T)))
(test-ssre "[q-u]+" (+ (char-range #\q #\u)))
(test-ssre "^s?c" (: bos (? #\s) #\c))
(test-ssre "[A-`]" (char-range #\A #\`))
(test-ssre "\\w+" (+ (or alnum #\_)))
(test-ssre "\\b.+?\\b" (: (or bow eow) (**? 1 #f nonl) (or bow eow)))
(test-ssre "caf\\B.+?\\B" (: #\c #\a #\f nwb (**? 1 #f nonl) nwb))
(test-ssre "c3 b1" (: #\c #\3 #\space #\b #\1))
(test-ssre "^A\\s+Z" (: bos #\A (+ space) #\Z))
(test-ssre "\\W" (~ (or alnum #\_)))
(test-ssre "\\w" (or alnum #\_))
(test-ssre "Xa{2,4}b" (: #\X (** 2 4 #\a) #\b))
(test-ssre "Xa{2,4}?b" (: #\X (**? 2 4 #\a) #\b))
(test-ssre "Xa{2,4}+b" (: #\X (+ (** 2 4 #\a)) #\b))
(test-ssre "X\\d{2,4}b" (: #\X (** 2 4 numeric) #\b))
(test-ssre "X\\d{2,4}?b" (: #\X (**? 2 4 numeric) #\b))
(test-ssre "X\\d{2,4}+b" (: #\X (+ (** 2 4 numeric)) #\b))
(test-ssre "X\\D{2,4}b" (: #\X (** 2 4 (~ numeric)) #\b))
(test-ssre "X\\D{2,4}?b" (: #\X (**? 2 4 (~ numeric)) #\b))
(test-ssre "X\\D{2,4}+b" (: #\X (+ (** 2 4 (~ numeric))) #\b))
(test-ssre "X\\D{2,4}b" (: #\X (** 2 4 (~ numeric)) #\b))
(test-ssre "X\\D{2,4}?b" (: #\X (**? 2 4 (~ numeric)) #\b))
(test-ssre "X\\D{2,4}+b" (: #\X (+ (** 2 4 (~ numeric))) #\b))
(test-ssre "X[abc]{2,4}b" (: #\X (** 2 4 (or #\a #\b #\c)) #\b))
(test-ssre "X[abc]{2,4}?b" (: #\X (**? 2 4 (or #\a #\b #\c)) #\b))
(test-ssre "X[abc]{2,4}+b" (: #\X (+ (** 2 4 (or #\a #\b #\c))) #\b))
(test-ssre "X[^a]{2,4}b" (: #\X (** 2 4 (~ #\a)) #\b))
(test-ssre "X[^a]{2,4}?b" (: #\X (**? 2 4 (~ #\a)) #\b))
(test-ssre "X[^a]{2,4}+b" (: #\X (+ (** 2 4 (~ #\a))) #\b))
(test-ssre "X[^a]{2,4}b" (: #\X (** 2 4 (~ #\a)) #\b))
(test-ssre "X[^a]{2,4}?b" (: #\X (**? 2 4 (~ #\a)) #\b))
(test-ssre "X[^a]{2,4}+b" (: #\X (+ (** 2 4 (~ #\a))) #\b))
(test-ssre "\\bthe cat\\b" (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)))
(test-ssre "abcd*" (: #\a #\b #\c (* #\d)))
(test-ssre "abc\\d*" (: #\a #\b #\c (* numeric)))
(test-ssre "abc[de]*" (: #\a #\b #\c (* (or #\d #\e))))
(test-ssre "X\\W{3}X" (: #\X (= 3 (~ (or alnum #\_))) #\X))
(test-ssre "f.*" (: #\f (* nonl)))
(test-ssre "(?<!^)ETA" (: (neg-look-behind bos) #\E #\T #\A))
(test-ssre "\\b...\\B" (: (or bow eow) nonl nonl nonl nwb))
(test-ssre "is+t" (: #\i (+ #\s) #\t))
(test-ssre "is+?t" (: #\i (**? 1 #f #\s) #\t))
(test-ssre "is?t" (: #\i (? #\s) #\t))
(test-ssre "is{2}t" (: #\i (= 2 #\s) #\t))
(test-ssre "a[[:punct:]b]" (: #\a (or punct #\b)))
(test-ssre "a[b[:punct:]]" (: #\a (or #\b punct)))
(test-ssre "[\\D\\P{Nd}]" (or (~ numeric) (~ numeric)))
(test-ssre "[^\\D\\P{Nd}]" (~ (or (~ numeric) (~ numeric))))
(test-ssre "(|@)7" (: ($ (or (:) #\@)) #\7))
(test-ssre "AskZ" (: #\A #\s #\k #\Z))
(test-ssre "[AskZ]+" (+ (or #\A #\s #\k #\Z)))
(test-ssre "[^s]+" (+ (~ #\s)))
(test-ssre "[^k]+" (+ (~ #\k)))
(test-ssre "[^sk]+" (+ (~ (or #\s #\k))))
(test-ssre "(?:(?<A>ss)|(?<A>kk)) \\k<A>" (: (or (-> A (: #\s #\s)) (-> A (: #\k #\k))) #\space (backref A)))
(test-ssre "(?:(?<A>s)|(?<A>k)) \\k<A>{3,}!" (: (or (-> A #\s) (-> A #\k)) #\space (>= 3 (backref A)) #\!))
(test-ssre "i" #\i)
(test-ssre "I" #\I)
(test-ssre "[i]" #\i)
(test-ssre "[^i]" (~ #\i))
(test-ssre "[zi]" (or #\z #\i))
(test-ssre "[iI]" (or #\i #\I))
(test-ssre "\\d+" (+ numeric))
(test-ssre ">\\s+<" (: #\> (+ space) #\<))
(test-ssre "\\w+" (+ (or alnum #\_)))
(test-ssre "\\bABC\\b" (: (or bow eow) #\A #\B #\C (or bow eow)))
(test-ssre "(?<!(|l ))" (neg-look-behind ($ (or (:) (: #\l #\space)))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "ab*c" (: #\a (* #\b) #\c))
(test-ssre "ab+c" (: #\a (+ #\b) #\c))
(test-ssre "(a|abcd|african)" ($ (or #\a (: #\a #\b #\c #\d) (: #\a #\f #\r #\i #\c #\a #\n))))
(test-ssre "^abc" (: bos #\a #\b #\c))
(test-ssre "\\Aabc" (: bos #\a #\b #\c))
(test-ssre "x\\dy\\Dz" (: #\x numeric #\y (~ numeric) #\z))
(test-ssre "x\\sy\\Sz" (: #\x space #\y (~ space) #\z))
(test-ssre "x\\wy\\Wz" (: #\x (or alnum #\_) #\y (~ (or alnum #\_)) #\z))
(test-ssre "x.y" (: #\x nonl #\y))
(test-ssre "a\\d\\z" (: #\a numeric eos))
(test-ssre "a\\d$" (: #\a numeric eos))
(test-ssre "[^a]" (~ #\a))
(test-ssre "ab?\\w" (: #\a (? #\b) (or alnum #\_)))
(test-ssre "x{0,3}yz" (: (** 0 3 #\x) #\y #\z))
(test-ssre "x{3}yz" (: (= 3 #\x) #\y #\z))
(test-ssre "x{2,3}yz" (: (** 2 3 #\x) #\y #\z))
(test-ssre "\\d*" (* numeric))
(test-ssre "\\D*" (* (~ numeric)))
(test-ssre "\\d+" (+ numeric))
(test-ssre "\\D+" (+ (~ numeric)))
(test-ssre "\\d?A" (: (? numeric) #\A))
(test-ssre "\\D?A" (: (? (~ numeric)) #\A))
(test-ssre "a+" (+ #\a))
(test-ssre "^.*xyz" (: bos (* nonl) #\x #\y #\z))
(test-ssre "^.+xyz" (: bos (+ nonl) #\x #\y #\z))
(test-ssre "^.?xyz" (: bos (? nonl) #\x #\y #\z))
(test-ssre "^\\d{2,3}X" (: bos (** 2 3 numeric) #\X))
(test-ssre "^[abcd]\\d" (: bos (or #\a #\b #\c #\d) numeric))
(test-ssre "^[abcd]*\\d" (: bos (* (or #\a #\b #\c #\d)) numeric))
(test-ssre "^[abcd]+\\d" (: bos (+ (or #\a #\b #\c #\d)) numeric))
(test-ssre "^a+X" (: bos (+ #\a) #\X))
(test-ssre "^[abcd]?\\d" (: bos (? (or #\a #\b #\c #\d)) numeric))
(test-ssre "^[abcd]{2,3}\\d" (: bos (** 2 3 (or #\a #\b #\c #\d)) numeric))
(test-ssre "^(abc)*\\d" (: bos (* ($ (: #\a #\b #\c))) numeric))
(test-ssre "^(abc)+\\d" (: bos (+ ($ (: #\a #\b #\c))) numeric))
(test-ssre "^(abc)?\\d" (: bos (? ($ (: #\a #\b #\c))) numeric))
(test-ssre "^(abc){2,3}\\d" (: bos (** 2 3 ($ (: #\a #\b #\c))) numeric))
(test-ssre "^(a*\\w|ab)=(a*\\w|ab)" (: bos ($ (or (: (* #\a) (or alnum #\_)) (: #\a #\b))) #\= ($ (or (: (* #\a) (or alnum #\_)) (: #\a #\b)))))
(test-ssre "^(?=abc)\\w{5}:$" (: bos (look-ahead (: #\a #\b #\c)) (= 5 (or alnum #\_)) #\: eos))
(test-ssre "^(?!abc)\\d\\d$" (: bos (neg-look-ahead (: #\a #\b #\c)) numeric numeric eos))
(test-ssre "(?<=abc|xy)123" (: (look-behind (or (: #\a #\b #\c) (: #\x #\y))) #\1 #\2 #\3))
(test-ssre "(?<!abc|xy)123" (: (neg-look-behind (or (: #\a #\b #\c) (: #\x #\y))) #\1 #\2 #\3))
(test-ssre "^abc" (: bos #\a #\b #\c))
(test-ssre "^(a*|xyz)" (: bos ($ (or (* #\a) (: #\x #\y #\z)))))
(test-ssre "xyz$" (: #\x #\y #\z eos))
(test-ssre "^abcdef" (: bos #\a #\b #\c #\d #\e #\f))
(test-ssre "^a{2,4}\\d+z" (: bos (** 2 4 #\a) (+ numeric) #\z))
(test-ssre "^abcdef" (: bos #\a #\b #\c #\d #\e #\f))
(test-ssre "(?<=foo)bar" (: (look-behind (: #\f #\o #\o)) #\b #\a #\r))
(test-ssre "(ab*(cd|ef))+X" (: (+ ($ (: #\a (* #\b) ($ (or (: #\c #\d) (: #\e #\f)))))) #\X))
(test-ssre "the quick brown fox" (: #\t #\h #\e #\space #\q #\u #\i #\c #\k #\space #\b #\r #\o #\w #\n #\space #\f #\o #\x))
(test-ssre "a*abc?xyz+pqr{3}ab{2,}xy{4,5}pq{0,6}AB{0,}zz" (: (* #\a) #\a #\b (? #\c) #\x #\y (+ #\z) #\p #\q (= 3 #\r) #\a (>= 2 #\b) #\x (** 4 5 #\y) #\p (** 0 6 #\q) #\A (>= 0 #\B) #\z #\z))
(test-ssre "^(abc){1,2}zz" (: bos (** 1 2 ($ (: #\a #\b #\c))) #\z #\z))
(test-ssre "^(b+?|a){1,2}?c" (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c))
(test-ssre "^(b+|a){1,2}c" (: bos (** 1 2 ($ (or (+ #\b) #\a))) #\c))
(test-ssre "^(b+|a){1,2}?bc" (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\b #\c))
(test-ssre "^(b*|ba){1,2}?bc" (: bos (**? 1 2 ($ (or (* #\b) (: #\b #\a)))) #\b #\c))
(test-ssre "^(ba|b*){1,2}?bc" (: bos (**? 1 2 ($ (or (: #\b #\a) (* #\b)))) #\b #\c))
(test-ssre "^[ab\\]cde]" (: bos (or #\a #\b #\] #\c #\d #\e)))
(test-ssre "^[]cde]" (: bos (or #\] #\c #\d #\e)))
(test-ssre "^[^ab\\]cde]" (: bos (~ (or #\a #\b #\] #\c #\d #\e))))
(test-ssre "^[^]cde]" (: bos (~ (or #\] #\c #\d #\e))))
(test-ssre "^@" (: bos #\@))
(test-ssre "^[0-9]+$" (: bos (+ (char-range #\0 #\9)) eos))
(test-ssre "^.*nter" (: bos (* nonl) #\n #\t #\e #\r))
(test-ssre "^xxx[0-9]+$" (: bos #\x #\x #\x (+ (char-range #\0 #\9)) eos))
(test-ssre "^.+[0-9][0-9][0-9]$" (: bos (+ nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos))
(test-ssre "^.+?[0-9][0-9][0-9]$" (: bos (**? 1 #f nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos))
(test-ssre "^([^!]+)!(.+)=apquxz\\.ixr\\.zzz\\.ac\\.uk$" (: bos ($ (+ (~ #\!))) #\! ($ (+ nonl)) #\= #\a #\p #\q #\u #\x #\z #\. #\i #\x #\r #\. #\z #\z #\z #\. #\a #\c #\. #\u #\k eos))
(test-ssre ":" #\:)
(test-ssre "^.*\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$" (: bos (* nonl) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) eos))
(test-ssre "^(\\d+)\\s+IN\\s+SOA\\s+(\\S+)\\s+(\\S+)\\s*\\(\\s*$" (: bos ($ (+ numeric)) (+ space) #\I #\N (+ space) #\S #\O #\A (+ space) ($ (+ (~ space))) (+ space) ($ (+ (~ space))) (* space) #\( (* space) eos))
(test-ssre "^[a-zA-Z\\d][a-zA-Z\\d\\-]*(\\.[a-zA-Z\\d][a-zA-Z\\d\\-]*)*\\.$" (: bos (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-)) (* ($ (: #\. (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-))))) #\. eos))
(test-ssre "^\\*\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?(\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?)*$" (: bos #\* #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric))))) (* ($ (: #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric)))))))) eos))
(test-ssre "^(?=ab(de))(abd)(e)" (: bos (look-ahead (: #\a #\b ($ (: #\d #\e)))) ($ (: #\a #\b #\d)) ($ #\e)))
(test-ssre "^(?!(ab)de|x)(abd)(f)" (: bos (neg-look-ahead (or (: ($ (: #\a #\b)) #\d #\e) #\x)) ($ (: #\a #\b #\d)) ($ #\f)))
(test-ssre "^(?=(ab(cd)))(ab)" (: bos (look-ahead ($ (: #\a #\b ($ (: #\c #\d))))) ($ (: #\a #\b))))
(test-ssre "^$" (: bos eos))
(test-ssre "(?x)^   a\\ b[c ]d       $" (: bos #\a #\space #\b (or #\c #\space) #\d eos))
(test-ssre "^(a(b(c)))(d(e(f)))(h(i(j)))(k(l(m)))$" (: bos ($ (: #\a ($ (: #\b ($ #\c))))) ($ (: #\d ($ (: #\e ($ #\f))))) ($ (: #\h ($ (: #\i ($ #\j))))) ($ (: #\k ($ (: #\l ($ #\m))))) eos))
(test-ssre "^(?:a(b(c)))(?:d(e(f)))(?:h(i(j)))(?:k(l(m)))$" (: bos (: #\a ($ (: #\b ($ #\c)))) (: #\d ($ (: #\e ($ #\f)))) (: #\h ($ (: #\i ($ #\j)))) (: #\k ($ (: #\l ($ #\m)))) eos))
(test-ssre "^[.^$|()*+?{,}]+" (: bos (+ (or #\. #\^ #\$ #\| #\( #\) #\* #\+ #\? #\{ #\, #\}))))
(test-ssre "^a*\\w" (: bos (* #\a) (or alnum #\_)))
(test-ssre "^a*?\\w" (: bos (*? #\a) (or alnum #\_)))
(test-ssre "^a+\\w" (: bos (+ #\a) (or alnum #\_)))
(test-ssre "^a+?\\w" (: bos (**? 1 #f #\a) (or alnum #\_)))
(test-ssre "^\\d{8}\\w{2,}" (: bos (= 8 numeric) (>= 2 (or alnum #\_))))
(test-ssre "^[aeiou\\d]{4,5}$" (: bos (** 4 5 (or #\a #\e #\i #\o #\u numeric)) eos))
(test-ssre "^[aeiou\\d]{4,5}?" (: bos (**? 4 5 (or #\a #\e #\i #\o #\u numeric))))
(test-ssre "^12.34" (: bos #\1 #\2 nonl #\3 #\4))
(test-ssre "foo(?!bar)(.*)" (: #\f #\o #\o (neg-look-ahead (: #\b #\a #\r)) ($ (* nonl))))
(test-ssre "(?:(?!foo)...|^.{0,2})bar(.*)" (: (or (: (neg-look-ahead (: #\f #\o #\o)) nonl nonl nonl) (: bos (** 0 2 nonl))) #\b #\a #\r ($ (* nonl))))
(test-ssre "^(\\D*)(?=\\d)(?!123)" (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))))
(test-ssre "(?!^)abc" (: (neg-look-ahead bos) #\a #\b #\c))
(test-ssre "(?=^)abc" (: (look-ahead bos) #\a #\b #\c))
(test-ssre "ab{1,3}bc" (: #\a (** 1 3 #\b) #\b #\c))
(test-ssre "([^.]*)\\.([^:]*):[T ]+(.*)" (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* nonl))))
(test-ssre "^[W-c]+$" (: bos (+ (char-range #\W #\c)) eos))
(test-ssre "^abc$" (: bos #\a #\b #\c eos))
(test-ssre "\\Aabc\\Z" (: bos #\a #\b #\c (: (? #\newline) eos)))
(test-ssre "\\A(.)*\\Z" (: bos (* ($ nonl)) (: (? #\newline) eos)))
(test-ssre "(?:b)|(?::+)" (or #\b (+ #\:)))
(test-ssre "[-az]+" (+ (or #\- #\a #\z)))
(test-ssre "[az-]+" (+ (or #\a #\z #\-)))
(test-ssre "[a\\-z]+" (+ (or #\a #\- #\z)))
(test-ssre "[a-z]+" (+ (char-range #\a #\z)))
(test-ssre "[\\d-]+" (+ (or numeric #\-)))
(test-ssre "abc$" (: #\a #\b #\c eos))
(test-ssre "a{0}bc" (: (= 0 #\a) #\b #\c))
(test-ssre "(a|(bc)){0,0}?xyz" (: (**? 0 0 ($ (or #\a ($ (: #\b #\c))))) #\x #\y #\z))
(test-ssre "[^a]" (~ #\a))
(test-ssre "[^a]+" (+ (~ #\a)))
(test-ssre "[^k]$" (: (~ #\k) eos))
(test-ssre "[^k]{2,3}$" (: (** 2 3 (~ #\k)) eos))
(test-ssre "^\\d{8,}@.+[^k]$" (: bos (>= 8 numeric) #\@ (+ nonl) (~ #\k) eos))
(test-ssre "[^a]" (~ #\a))
(test-ssre "[^az]" (~ (or #\a #\z)))
(test-ssre "P[^*]TAIRE[^*]{1,6}?LL" (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 6 (~ #\*)) #\L #\L))
(test-ssre "P[^*]TAIRE[^*]{1,}?LL" (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 #f (~ #\*)) #\L #\L))
(test-ssre "(\\.\\d\\d[1-9]?)\\d+" (: ($ (: #\. numeric numeric (? (char-range #\1 #\9)))) (+ numeric)))
(test-ssre "(\\.\\d\\d((?=0)|\\d(?=\\d)))" ($ (: #\. numeric numeric ($ (or (look-ahead #\0) (: numeric (look-ahead numeric)))))))
(test-ssre "foo(.*)bar" (: #\f #\o #\o ($ (* nonl)) #\b #\a #\r))
(test-ssre "foo(.*?)bar" (: #\f #\o #\o ($ (*? nonl)) #\b #\a #\r))
(test-ssre "(.*)(\\d+)" (: ($ (* nonl)) ($ (+ numeric))))
(test-ssre "(.*?)(\\d+)" (: ($ (*? nonl)) ($ (+ numeric))))
(test-ssre "(.*)(\\d+)$" (: ($ (* nonl)) ($ (+ numeric)) eos))
(test-ssre "(.*?)(\\d+)$" (: ($ (*? nonl)) ($ (+ numeric)) eos))
(test-ssre "(.*)\\b(\\d+)$" (: ($ (* nonl)) (or bow eow) ($ (+ numeric)) eos))
(test-ssre "(.*\\D)(\\d+)$" (: ($ (: (* nonl) (~ numeric))) ($ (+ numeric)) eos))
(test-ssre "^\\D*(?!123)" (: bos (* (~ numeric)) (neg-look-ahead (: #\1 #\2 #\3))))
(test-ssre "^(\\D*)(?=\\d)(?!123)" (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))))
(test-ssre "^[W-\\]46]" (: bos (or (char-range #\W #\]) #\4 #\6)))
(test-ssre "word (?:[a-zA-Z0-9]+ ){0,10}otherword" (: #\w #\o #\r #\d #\space (** 0 10 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d))
(test-ssre "word (?:[a-zA-Z0-9]+ ){0,300}otherword" (: #\w #\o #\r #\d #\space (** 0 300 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d))
(test-ssre "^(a){0,0}" (: bos (= 0 ($ #\a))))
(test-ssre "^(a){0,1}" (: bos (** 0 1 ($ #\a))))
(test-ssre "^(a){0,2}" (: bos (** 0 2 ($ #\a))))
(test-ssre "^(a){0,3}" (: bos (** 0 3 ($ #\a))))
(test-ssre "^(a){0,}" (: bos (>= 0 ($ #\a))))
(test-ssre "^(a){1,1}" (: bos (= 1 ($ #\a))))
(test-ssre "^(a){1,2}" (: bos (** 1 2 ($ #\a))))
(test-ssre "^(a){1,3}" (: bos (** 1 3 ($ #\a))))
(test-ssre "^(a){1,}" (: bos (>= 1 ($ #\a))))
(test-ssre ".*\\.gif" (: (* nonl) #\. #\g #\i #\f))
(test-ssre ".{0,}\\.gif" (: (>= 0 nonl) #\. #\g #\i #\f))
(test-ssre ".*\\.gif" (: (* nonl) #\. #\g #\i #\f))
(test-ssre ".*$" (: (* nonl) eos))
(test-ssre "(.*X|^B)" ($ (or (: (* nonl) #\X) (: bos #\B))))
(test-ssre "^.*B" (: bos (* nonl) #\B))
(test-ssre "(?m)^.*B" (: bol (* nonl) #\B))
(test-ssre "^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]" (: bos (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9)))
(test-ssre "^\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d" (: bos numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric))
(test-ssre "^[\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d][\\d]" (: bos numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric))
(test-ssre "^[abc]{12}" (: bos (= 12 (or #\a #\b #\c))))
(test-ssre "^[a-c]{12}" (: bos (= 12 (char-range #\a #\c))))
(test-ssre "^(a|b|c){12}" (: bos (= 12 ($ (or #\a #\b #\c)))))
(test-ssre "^[abcdefghijklmnopqrstuvwxy0123456789]" (: bos (or #\a #\b #\c #\d #\e #\f #\g #\h #\i #\j #\k #\l #\m #\n #\o #\p #\q #\r #\s #\t #\u #\v #\w #\x #\y #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9)))
(test-ssre "abcde{0,0}" (: #\a #\b #\c #\d (= 0 #\e)))
(test-ssre "ab[cd]{0,0}e" (: #\a #\b (= 0 (or #\c #\d)) #\e))
(test-ssre "ab(c){0,0}d" (: #\a #\b (= 0 ($ #\c)) #\d))
(test-ssre "a(b*)" (: #\a ($ (* #\b))))
(test-ssre "ab\\d{0}e" (: #\a #\b (= 0 numeric) #\e))
(test-ssre "\"([^\\\\\"]+|\\\\.)*\"" (: #\" (* ($ (or (+ (~ (or #\\ #\"))) (: #\\ nonl)))) #\"))
(test-ssre ".*?" (*? nonl))
(test-ssre "\\b" (or bow eow))
(test-ssre "a[^a]b" (: #\a (~ #\a) #\b))
(test-ssre "a.b" (: #\a nonl #\b))
(test-ssre "a[^a]b" (: #\a (~ #\a) #\b))
(test-ssre "a.b" (: #\a nonl #\b))
(test-ssre "^(b+?|a){1,2}?c" (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c))
(test-ssre "^(b+|a){1,2}?c" (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\c))
(test-ssre "(?!\\A)x" (: (neg-look-ahead bos) #\x))
(test-ssre "(A|B)*CD" (: (* ($ (or #\A #\B))) #\C #\D))
(test-ssre "(?<!bar)foo" (: (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o))
(test-ssre "\\w{3}(?<!bar)foo" (: (= 3 (or alnum #\_)) (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o))
(test-ssre "(?<=(foo)a)bar" (: (look-behind (: ($ (: #\f #\o #\o)) #\a)) #\b #\a #\r))
(test-ssre "\\Aabc\\z" (: bos #\a #\b #\c eos))
(test-ssre "(\\d+)(\\w)" (: ($ (+ numeric)) ($ (or alnum #\_))))
(test-ssre "(a+|b+|c+)*c" (: (* ($ (or (+ #\a) (+ #\b) (+ #\c)))) #\c))
(test-ssre "([a]*?)*" (* ($ (*? #\a))))
(test-ssre "([ab]*?)*" (* ($ (*? (or #\a #\b)))))
(test-ssre "([^a]*?)*" (* ($ (*? (~ #\a)))))
(test-ssre "([^ab]*?)*" (* ($ (*? (~ (or #\a #\b))))))
(test-ssre "(?<=(?<!foo)bar)baz" (: (look-behind (: (neg-look-behind (: #\f #\o #\o)) #\b #\a #\r)) #\b #\a #\z))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "ab*c" (: #\a (* #\b) #\c))
(test-ssre "ab*bc" (: #\a (* #\b) #\b #\c))
(test-ssre ".{1}" (= 1 nonl))
(test-ssre ".{3,4}" (** 3 4 nonl))
(test-ssre "ab{0,}bc" (: #\a (>= 0 #\b) #\b #\c))
(test-ssre "ab+bc" (: #\a (+ #\b) #\b #\c))
(test-ssre "ab{1,}bc" (: #\a (>= 1 #\b) #\b #\c))
(test-ssre "ab{1,3}bc" (: #\a (** 1 3 #\b) #\b #\c))
(test-ssre "ab{3,4}bc" (: #\a (** 3 4 #\b) #\b #\c))
(test-ssre "ab{4,5}bc" (: #\a (** 4 5 #\b) #\b #\c))
(test-ssre "ab?bc" (: #\a (? #\b) #\b #\c))
(test-ssre "ab{0,1}bc" (: #\a (** 0 1 #\b) #\b #\c))
(test-ssre "ab?bc" (: #\a (? #\b) #\b #\c))
(test-ssre "ab?c" (: #\a (? #\b) #\c))
(test-ssre "ab{0,1}c" (: #\a (** 0 1 #\b) #\c))
(test-ssre "^abc$" (: bos #\a #\b #\c eos))
(test-ssre "^abc" (: bos #\a #\b #\c))
(test-ssre "^abc$" (: bos #\a #\b #\c eos))
(test-ssre "abc$" (: #\a #\b #\c eos))
(test-ssre "^" bos)
(test-ssre "$" eos)
(test-ssre "a.c" (: #\a nonl #\c))
(test-ssre "a.*c" (: #\a (* nonl) #\c))
(test-ssre "a[bc]d" (: #\a (or #\b #\c) #\d))
(test-ssre "a[b-d]e" (: #\a (char-range #\b #\d) #\e))
(test-ssre "a[b-d]" (: #\a (char-range #\b #\d)))
(test-ssre "a[-b]" (: #\a (or #\- #\b)))
(test-ssre "a[b-]" (: #\a (or #\b #\-)))
(test-ssre "a[]]b" (: #\a #\] #\b))
(test-ssre "a[^bc]d" (: #\a (~ (or #\b #\c)) #\d))
(test-ssre "a[^-b]c" (: #\a (~ (or #\- #\b)) #\c))
(test-ssre "a[^]b]c" (: #\a (~ (or #\] #\b)) #\c))
(test-ssre "\\ba\\b" (: (or bow eow) #\a (or bow eow)))
(test-ssre "\\by\\b" (: (or bow eow) #\y (or bow eow)))
(test-ssre "\\Ba\\B" (: nwb #\a nwb))
(test-ssre "\\By\\b" (: nwb #\y (or bow eow)))
(test-ssre "\\by\\B" (: (or bow eow) #\y nwb))
(test-ssre "\\By\\B" (: nwb #\y nwb))
(test-ssre "\\w" (or alnum #\_))
(test-ssre "\\W" (~ (or alnum #\_)))
(test-ssre "a\\sb" (: #\a space #\b))
(test-ssre "a\\Sb" (: #\a (~ space) #\b))
(test-ssre "\\d" numeric)
(test-ssre "\\D" (~ numeric))
(test-ssre "ab|cd" (or (: #\a #\b) (: #\c #\d)))
(test-ssre "()ef" (: ($ (:)) #\e #\f))
(test-ssre "$b" (: eos #\b))
(test-ssre "a\\(b" (: #\a #\( #\b))
(test-ssre "a\\(*b" (: #\a (* #\() #\b))
(test-ssre "a\\\\b" (: #\a #\\ #\b))
(test-ssre "((a))" ($ ($ #\a)))
(test-ssre "(a)b(c)" (: ($ #\a) #\b ($ #\c)))
(test-ssre "a+b+c" (: (+ #\a) (+ #\b) #\c))
(test-ssre "a{1,}b{1,}c" (: (>= 1 #\a) (>= 1 #\b) #\c))
(test-ssre "a.+?c" (: #\a (**? 1 #f nonl) #\c))
(test-ssre "(a+|b)*" (* ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b){0,}" (>= 0 ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b)+" (+ ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b){1,}" (>= 1 ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b)?" (? ($ (or (+ #\a) #\b))))
(test-ssre "(a+|b){0,1}" (** 0 1 ($ (or (+ #\a) #\b))))
(test-ssre "[^ab]*" (* (~ (or #\a #\b))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "a*" (* #\a))
(test-ssre "([abc])*d" (: (* ($ (or #\a #\b #\c))) #\d))
(test-ssre "([abc])*bcd" (: (* ($ (or #\a #\b #\c))) #\b #\c #\d))
(test-ssre "a|b|c|d|e" (or #\a #\b #\c #\d #\e))
(test-ssre "(a|b|c|d|e)f" (: ($ (or #\a #\b #\c #\d #\e)) #\f))
(test-ssre "abcd*efg" (: #\a #\b #\c (* #\d) #\e #\f #\g))
(test-ssre "ab*" (: #\a (* #\b)))
(test-ssre "(ab|cd)e" (: ($ (or (: #\a #\b) (: #\c #\d))) #\e))
(test-ssre "[abhgefdc]ij" (: (or #\a #\b #\h #\g #\e #\f #\d #\c) #\i #\j))
(test-ssre "^(ab|cd)e" (: bos ($ (or (: #\a #\b) (: #\c #\d))) #\e))
(test-ssre "(abc|)ef" (: ($ (or (: #\a #\b #\c) (:))) #\e #\f))
(test-ssre "(a|b)c*d" (: ($ (or #\a #\b)) (* #\c) #\d))
(test-ssre "(ab|ab*)bc" (: ($ (or (: #\a #\b) (: #\a (* #\b)))) #\b #\c))
(test-ssre "a([bc]*)c*" (: #\a ($ (* (or #\b #\c))) (* #\c)))
(test-ssre "a([bc]*)(c*d)" (: #\a ($ (* (or #\b #\c))) ($ (: (* #\c) #\d))))
(test-ssre "a([bc]+)(c*d)" (: #\a ($ (+ (or #\b #\c))) ($ (: (* #\c) #\d))))
(test-ssre "a([bc]*)(c+d)" (: #\a ($ (* (or #\b #\c))) ($ (: (+ #\c) #\d))))
(test-ssre "a[bcd]*dcdcde" (: #\a (* (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e))
(test-ssre "a[bcd]+dcdcde" (: #\a (+ (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e))
(test-ssre "(ab|a)b*c" (: ($ (or (: #\a #\b) #\a)) (* #\b) #\c))
(test-ssre "((a)(b)c)(d)" (: ($ (: ($ #\a) ($ #\b) #\c)) ($ #\d)))
(test-ssre "[a-zA-Z_][a-zA-Z0-9_]*" (: (or (char-range #\a #\z) (char-range #\A #\Z) #\_) (* (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9) #\_))))
(test-ssre "^a(bc+|b[eh])g|.h$" (or (: bos #\a ($ (or (: #\b (+ #\c)) (: #\b (or #\e #\h)))) #\g) (: nonl #\h eos)))
(test-ssre "(bc+d$|ef*g.|h?i(j|k))" ($ (or (: #\b (+ #\c) #\d eos) (: #\e (* #\f) #\g nonl) (: (? #\h) #\i ($ (or #\j #\k))))))
(test-ssre "((((((((((a))))))))))" ($ ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a)))))))))))
(test-ssre "(((((((((a)))))))))" ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a))))))))))
(test-ssre "multiple words of text" (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s #\space #\o #\f #\space #\t #\e #\x #\t))
(test-ssre "multiple words" (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s))
(test-ssre "(.*)c(.*)" (: ($ (* nonl)) #\c ($ (* nonl))))
(test-ssre "\\((.*), (.*)\\)" (: #\( ($ (* nonl)) #\, #\space ($ (* nonl)) #\)))
(test-ssre "[k]" #\k)
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "a(bc)d" (: #\a ($ (: #\b #\c)) #\d))
(test-ssre "a[-]?c" (: #\a (? #\-) #\c))
(test-ssre "a(?!b)." (: #\a (neg-look-ahead #\b) nonl))
(test-ssre "a(?=d)." (: #\a (look-ahead #\d) nonl))
(test-ssre "a(?=c|d)." (: #\a (look-ahead (or #\c #\d)) nonl))
(test-ssre "a(?:b|c|d)(.)" (: #\a (or #\b #\c #\d) ($ nonl)))
(test-ssre "a(?:b|c|d)*(.)" (: #\a (* (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d)+?(.)" (: #\a (**? 1 #f (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d)+(.)" (: #\a (+ (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){2}(.)" (: #\a (= 2 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){4,5}(.)" (: #\a (** 4 5 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){4,5}?(.)" (: #\a (**? 4 5 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "((foo)|(bar))*" (* ($ (or ($ (: #\f #\o #\o)) ($ (: #\b #\a #\r))))))
(test-ssre "a(?:b|c|d){6,7}(.)" (: #\a (** 6 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){6,7}?(.)" (: #\a (**? 6 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,6}(.)" (: #\a (** 5 6 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,6}?(.)" (: #\a (**? 5 6 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,7}(.)" (: #\a (** 5 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|c|d){5,7}?(.)" (: #\a (**? 5 7 (or #\b #\c #\d)) ($ nonl)))
(test-ssre "a(?:b|(c|e){1,2}?|d)+?(.)" (: #\a (**? 1 #f (or #\b (**? 1 2 ($ (or #\c #\e))) #\d)) ($ nonl)))
(test-ssre "^(.+)?B" (: bos (? ($ (+ nonl))) #\B))
(test-ssre "^([^a-z])|(\\^)$" (or (: bos ($ (~ (char-range #\a #\z)))) (: ($ #\^) eos)))
(test-ssre "^[<>]&" (: bos (or #\< #\>) #\&))
(test-ssre "(?:(f)(o)(o)|(b)(a)(r))*" (* (or (: ($ #\f) ($ #\o) ($ #\o)) (: ($ #\b) ($ #\a) ($ #\r)))))
(test-ssre "(?<=a)b" (: (look-behind #\a) #\b))
(test-ssre "(?<!c)b" (: (neg-look-behind #\c) #\b))
(test-ssre "(?:..)*a" (: (* (: nonl nonl)) #\a))
(test-ssre "(?:..)*?a" (: (*? (: nonl nonl)) #\a))
(test-ssre "^(){3,5}" (: bos (** 3 5 ($ (:)))))
(test-ssre "(a|x)*ab" (: (* ($ (or #\a #\x))) #\a #\b))
(test-ssre "(a)*ab" (: (* ($ #\a)) #\a #\b))
(test-ssre "(?:c|d)(?:)(?:a(?:)(?:b)(?:b(?:))(?:b(?:)(?:b)))" (: (or #\c #\d) (:) (: #\a (:) #\b (: #\b (:)) (: #\b (:) #\b))))
(test-ssre "(?:c|d)(?:)(?:aaaaaaaa(?:)(?:bbbbbbbb)(?:bbbbbbbb(?:))(?:bbbbbbbb(?:)(?:bbbbbbbb)))" (: (or #\c #\d) (:) (: #\a #\a #\a #\a #\a #\a #\a #\a (:) (: #\b #\b #\b #\b #\b #\b #\b #\b) (: #\b #\b #\b #\b #\b #\b #\b #\b (:)) (: #\b #\b #\b #\b #\b #\b #\b #\b (:) (: #\b #\b #\b #\b #\b #\b #\b #\b)))))
(test-ssre "foo\\w*\\d{4}baz" (: #\f #\o #\o (* (or alnum #\_)) (= 4 numeric) #\b #\a #\z))
(test-ssre "x(~~)*(?:(?:F)?)?" (: #\x (* ($ (: #\~ #\~))) (?? #\F)))
(test-ssre "(?<![cd])b" (: (neg-look-behind (or #\c #\d)) #\b))
(test-ssre "(?<![cd])[ab]" (: (neg-look-behind (or #\c #\d)) (or #\a #\b)))
(test-ssre "(?<!(c|d))b" (: (neg-look-behind ($ (or #\c #\d))) #\b))
(test-ssre "(?<!(c|d))[ab]" (: (neg-look-behind ($ (or #\c #\d))) (or #\a #\b)))
(test-ssre "(?<!cd)[ab]" (: (neg-look-behind (: #\c #\d)) (or #\a #\b)))
(test-ssre "(?m)^b" (: bol #\b))
(test-ssre "(?m)^(b)" (: bol ($ #\b)))
(test-ssre "^b" (: bos #\b))
(test-ssre "()^b" (: ($ (:)) bos #\b))
(test-ssre "(\\w+:)+" (+ ($ (: (+ (or alnum #\_)) #\:))))
(test-ssre "$(?<=^(a))" (: eos (look-behind (: bos ($ #\a)))))
(test-ssre "^[^bcd]*(c+)" (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))))
(test-ssre "(a*)b+" (: ($ (* #\a)) (+ #\b)))
(test-ssre "([\\w:]+::)?(\\w+)$" (: (? ($ (: (+ (or alnum #\_ #\:)) #\: #\:))) ($ (+ (or alnum #\_))) eos))
(test-ssre "^[^bcd]*(c+)" (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))))
(test-ssre "(>a+)ab" (: ($ (: #\> (+ #\a))) #\a #\b))
(test-ssre "a\\z" (: #\a eos))
(test-ssre "(?<=\\d{3}(?!999))foo" (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)))) #\f #\o #\o))
(test-ssre "(?<=(?!...999)\\d{3})foo" (: (look-behind (: (neg-look-ahead (: nonl nonl nonl #\9 #\9 #\9)) (= 3 numeric))) #\f #\o #\o))
(test-ssre "(?<=\\d{3}(?!999)...)foo" (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)) nonl nonl nonl)) #\f #\o #\o))
(test-ssre "(?<=\\d{3}...)(?<!999)foo" (: (look-behind (: (= 3 numeric) nonl nonl nonl)) (neg-look-behind (: #\9 #\9 #\9)) #\f #\o #\o))
(test-ssre "((Z)+|A)*" (* ($ (or (+ ($ #\Z)) #\A))))
(test-ssre "(Z()|A)*" (* ($ (or (: #\Z ($ (:))) #\A))))
(test-ssre "(Z(())|A)*" (* ($ (or (: #\Z ($ ($ (:)))) #\A))))
(test-ssre "a*" (* #\a))
(test-ssre "\\s+" (+ space))
(test-ssre "(?!\\A)x" (: (neg-look-ahead bos) #\x))
(test-ssre "(?!^)x" (: (neg-look-ahead bos) #\x))
(test-ssre "abc." (: #\a #\b #\c nonl))
(test-ssre "a(?x: b c )d" (: #\a (: #\b #\c) #\d))
(test-ssre "(?<=Z)X." (: (look-behind #\Z) #\X nonl))
(test-ssre "(?<=a|bbbb)c" (: (look-behind (or #\a (: #\b #\b #\b #\b))) #\c))
(test-ssre "1234" (: #\1 #\2 #\3 #\4))
(test-ssre "^" bos)
(test-ssre "(?<=C\n)^" (: (look-behind (: #\C #\newline)) bos))
(test-ssre "(?m)A?B" (: (? #\A) #\B))
(test-ssre "(?m)A*B" (: (* #\A) #\B))
(test-ssre "\\w+(.)(.)?def" (: (+ (or alnum #\_)) ($ nonl) (? ($ nonl)) #\d #\e #\f))
(test-ssre ".+foo" (: (+ nonl) #\f #\o #\o))
(test-ssre "^X" (: bos #\X))
(test-ssre "a(?!)|\\wbc" (or (: #\a (neg-look-ahead (:))) (: (or alnum #\_) #\b #\c)))
(test-ssre "X$" (: #\X eos))
(test-ssre "\\d+X|9+Y" (or (: (+ numeric) #\X) (: (+ #\9) #\Y)))
(test-ssre "Z(?!)" (: #\Z (neg-look-ahead (:))))
(test-ssre "dog(sbody)?" (: #\d #\o #\g (? ($ (: #\s #\b #\o #\d #\y)))))
(test-ssre "dog(sbody)??" (: #\d #\o #\g (?? ($ (: #\s #\b #\o #\d #\y)))))
(test-ssre "dog|dogsbody" (or (: #\d #\o #\g) (: #\d #\o #\g #\s #\b #\o #\d #\y)))
(test-ssre "dogsbody|dog" (or (: #\d #\o #\g #\s #\b #\o #\d #\y) (: #\d #\o #\g)))
(test-ssre "\\bthe cat\\b" (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)))
(test-ssre "dog(sbody)?" (: #\d #\o #\g (? ($ (: #\s #\b #\o #\d #\y)))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "(?<=abc)123" (: (look-behind (: #\a #\b #\c)) #\1 #\2 #\3))
(test-ssre "\\babc\\b" (: (or bow eow) #\a #\b #\c (or bow eow)))
(test-ssre "(?=C)" (look-ahead #\C))
(test-ssre "abcd*" (: #\a #\b #\c (* #\d)))
(test-ssre "abc\\d*" (: #\a #\b #\c (* numeric)))
(test-ssre "abc[de]*" (: #\a #\b #\c (* (or #\d #\e))))
(test-ssre "(?<=abc)def" (: (look-behind (: #\a #\b #\c)) #\d #\e #\f))
(test-ssre "abc$" (: #\a #\b #\c eos))
(test-ssre "abc\\z" (: #\a #\b #\c eos))
(test-ssre "abc\\b" (: #\a #\b #\c (or bow eow)))
(test-ssre "abc\\B" (: #\a #\b #\c nwb))
(test-ssre ".+" (+ nonl))
(test-ssre "(?=abc){3}abc" (: (= 3 (look-ahead (: #\a #\b #\c))) #\a #\b #\c))
(test-ssre "(?=abc){0}xyz" (: (= 0 (look-ahead (: #\a #\b #\c))) #\x #\y #\z))
(test-ssre "(?=abc){1}xyz" (: (= 1 (look-ahead (: #\a #\b #\c))) #\x #\y #\z))
(test-ssre "(?=(a))?." (: (? (look-ahead ($ #\a))) nonl))
(test-ssre "(?=(a))??." (: (?? (look-ahead ($ #\a))) nonl))
(test-ssre "^(?!a){0}\\w+" (: bos (= 0 (neg-look-ahead #\a)) (+ (or alnum #\_))))
(test-ssre "(?<=(abc))?xyz" (: (? (look-behind ($ (: #\a #\b #\c)))) #\x #\y #\z))
(test-ssre "abcdef" (: #\a #\b #\c #\d #\e #\f))
(test-ssre "abcd" (: #\a #\b #\c #\d))
(test-ssre "[ab]*" (* (or #\a #\b)))
(test-ssre "[ab]*?" (*? (or #\a #\b)))
(test-ssre "[ab]?" (? (or #\a #\b)))
(test-ssre "[ab]??" (?? (or #\a #\b)))
(test-ssre "[ab]+" (+ (or #\a #\b)))
(test-ssre "[ab]+?" (**? 1 #f (or #\a #\b)))
(test-ssre "[ab]{2,3}" (** 2 3 (or #\a #\b)))
(test-ssre "[ab]{2,3}?" (**? 2 3 (or #\a #\b)))
(test-ssre "[ab]{2,}" (>= 2 (or #\a #\b)))
(test-ssre "[ab]{2,}?" (**? 2 #f (or #\a #\b)))
(test-ssre "abc(?=xyz)" (: #\a #\b #\c (look-ahead (: #\x #\y #\z))))
(test-ssre "(?<=pqr)abc(?=xyz)" (: (look-behind (: #\p #\q #\r)) #\a #\b #\c (look-ahead (: #\x #\y #\z))))
(test-ssre "a\\b" (: #\a (or bow eow)))
(test-ssre "abc(?=abcde)(?=ab)" (: #\a #\b #\c (look-ahead (: #\a #\b #\c #\d #\e)) (look-ahead (: #\a #\b))))
(test-ssre "a*?b*?" (: (*? #\a) (*? #\b)))
(test-ssre "(a)(b)|(c)" (or (: ($ #\a) ($ #\b)) ($ #\c)))
(test-ssre "(?<A>aa)" (-> A (: #\a #\a)))
(test-ssre "a(b)c(d)" (: #\a ($ #\b) #\c ($ #\d)))
(test-ssre "^" bos)
(test-ssre "(02-)?[0-9]{3}-[0-9]{3}" (: (? ($ (: #\0 #\2 #\-))) (= 3 (char-range #\0 #\9)) #\- (= 3 (char-range #\0 #\9))))
(test-ssre "abc" (: #\a #\b #\c))
(test-ssre "abc|bcd" (or (: #\a #\b #\c) (: #\b #\c #\d)))
(test-ssre "(?<=abc|)" (look-behind (or (: #\a #\b #\c) (:))))
(test-ssre "(?<=|abc)" (look-behind (or (:) (: #\a #\b #\c))))
(test-ssre "[abc]" (or #\a #\b #\c))
(test-ssre "foobar" (: #\f #\o #\o #\b #\a #\r))
(test-ssre "(?<=pqr)abc(?=xyz)" (: (look-behind (: #\p #\q #\r)) #\a #\b #\c (look-ahead (: #\x #\y #\z))))
(test-ssre "\\z" eos)
(test-ssre "\\Z" (: (? #\newline) eos))
(test-ssre "(?<=(?=.(?<=x)))" (look-behind (look-ahead (: nonl (look-behind #\x)))))
(test-ssre "(?![ab]).*" (: (neg-look-ahead (or #\a #\b)) (* nonl)))
(test-ssre "[a[]" (or #\a #\[))
(test-ssre "\\bX" (: (or bow eow) #\X))
(test-ssre "\\BX" (: nwb #\X))
(test-ssre "X\\b" (: #\X (or bow eow)))
(test-ssre "X\\B" (: #\X nwb))
(test-ssre "[^a]" (~ #\a))
(test-ssre "a.b" (: #\a nonl #\b))
(test-ssre "a(.{3})b" (: #\a ($ (= 3 nonl)) #\b))
(test-ssre "a(.*?)(.)" (: #\a ($ (*? nonl)) ($ nonl)))
(test-ssre "a(.*)(.)" (: #\a ($ (* nonl)) ($ nonl)))
(test-ssre "a(.)(.)" (: #\a ($ nonl) ($ nonl)))
(test-ssre "a(.?)(.)" (: #\a ($ (? nonl)) ($ nonl)))
(test-ssre "a(.??)(.)" (: #\a ($ (?? nonl)) ($ nonl)))
(test-ssre "a(.{3})b" (: #\a ($ (= 3 nonl)) #\b))
(test-ssre "a(.{3,})b" (: #\a ($ (>= 3 nonl)) #\b))
(test-ssre "a(.{3,}?)b" (: #\a ($ (**? 3 #f nonl)) #\b))
(test-ssre "a(.{3,5})b" (: #\a ($ (** 3 5 nonl)) #\b))
(test-ssre "a(.{3,5}?)b" (: #\a ($ (**? 3 5 nonl)) #\b))
(test-ssre "(?<=aXb)cd" (: (look-behind (: #\a #\X #\b)) #\c #\d))
(test-ssre "(?<=(.))X" (: (look-behind ($ nonl)) #\X))
(test-ssre "[^a]+" (+ (~ #\a)))
(test-ssre "^[^a]{2}" (: bos (= 2 (~ #\a))))
(test-ssre "^[^a]{2,}" (: bos (>= 2 (~ #\a))))
(test-ssre "^[^a]{2,}?" (: bos (**? 2 #f (~ #\a))))
(test-ssre "[^a]+" (+ (~ #\a)))
(test-ssre "^[^a]{2}" (: bos (= 2 (~ #\a))))
(test-ssre "^[^a]{2,}" (: bos (>= 2 (~ #\a))))
(test-ssre "^[^a]{2,}?" (: bos (**? 2 #f (~ #\a))))
(test-ssre "\\D" (~ numeric))
(test-ssre ">\\S" (: #\> (~ space)))
(test-ssre "\\d" numeric)
(test-ssre "\\s" space)
(test-ssre "\\D+" (+ (~ numeric)))
(test-ssre "\\D{2,3}" (** 2 3 (~ numeric)))
(test-ssre "\\D{2,3}?" (**? 2 3 (~ numeric)))
(test-ssre "\\d+" (+ numeric))
(test-ssre "\\d{2,3}" (** 2 3 numeric))
(test-ssre "\\d{2,3}?" (**? 2 3 numeric))
(test-ssre "\\S+" (+ (~ space)))
(test-ssre "\\S{2,3}" (** 2 3 (~ space)))
(test-ssre "\\S{2,3}?" (**? 2 3 (~ space)))
(test-ssre ">\\s+<" (: #\> (+ space) #\<))
(test-ssre ">\\s{2,3}<" (: #\> (** 2 3 space) #\<))
(test-ssre ">\\s{2,3}?<" (: #\> (**? 2 3 space) #\<))
(test-ssre "\\w+" (+ (or alnum #\_)))
(test-ssre "\\w{2,3}" (** 2 3 (or alnum #\_)))
(test-ssre "\\w{2,3}?" (**? 2 3 (or alnum #\_)))
(test-ssre "\\W+" (+ (~ (or alnum #\_))))
(test-ssre "\\W{2,3}" (** 2 3 (~ (or alnum #\_))))
(test-ssre "\\W{2,3}?" (**? 2 3 (~ (or alnum #\_))))
(test-ssre "^[ac]*b" (: bos (* (or #\a #\c)) #\b))
(test-ssre "^[^x]*b" (: bos (* (~ #\x)) #\b))
(test-ssre "^\\d*b" (: bos (* numeric) #\b))
(test-ssre "(|a)" ($ (or (:) #\a)))
(test-ssre "abcd*" (: #\a #\b #\c (* #\d)))
(test-ssre "abc\\d*" (: #\a #\b #\c (* numeric)))
(test-ssre "abc[de]*" (: #\a #\b #\c (* (or #\d #\e))))
(test-ssre "\\bthe cat\\b" (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)))
(test-ssre "[\\p{Nd}]" numeric)
(test-ssre "[\\p{Nd}+-]+" (+ (or numeric #\+ #\-)))
(test-ssre "[\\P{Nd}]+" (+ (~ numeric)))
(test-ssre "^[\\p{Vowel}]" (: bos (or #\A #\E #\I #\O #\U #\Y #\W)))
(test-ssre "^[\\p{Any}]X" (: bos any #\X))
(test-ssre "^[\\P{Any}]X" (: bos (~ any) #\X))
(test-ssre "^[\\p{Any}]?X" (: bos (? any) #\X))
(test-ssre "[.\\p{Lu}][.\\p{Ll}][.\\P{Lu}][.\\P{Ll}]" (: (or #\. upper) (or #\. lower) (or #\. (~ upper)) (or #\. (~ lower))))
(test-ssre "[\\p{L}]" alpha)
(test-ssre "[\\P{L}]" (~ alpha))
(test-ssre "[\\pLu]" (or alpha #\u))
(test-ssre "[\\PLu]" (or (~ alpha) #\u))
(test-ssre "\\p{Nd}" numeric)
(test-ssre "\\p{Nd}+" (+ numeric))
(test-ssre "\\P{Nd}+" (+ (~ numeric)))
(test-ssre "^\\p{Vowel}" (: bos (or #\A #\E #\I #\O #\U #\Y #\W)))
(test-ssre "^\\p{Any}X" (: bos any #\X))
(test-ssre "^\\P{Any}X" (: bos (~ any) #\X))
(test-ssre "^\\p{Any}?X" (: bos (? any) #\X))
(test-ssre "\\p{L}" alpha)
(test-ssre "\\P{L}" (~ alpha))
(test-ssre "\\pLu" (: alpha #\u))
(test-ssre "\\PLu" (: (~ alpha) #\u))
(test-ssre "\\b...\\B" (: (or bow eow) nonl nonl nonl nwb))
(test-ssre "ist" (: #\i #\s #\t))
(test-ssre "is+t" (: #\i (+ #\s) #\t))
(test-ssre "is+?t" (: #\i (**? 1 #f #\s) #\t))
(test-ssre "is?t" (: #\i (? #\s) #\t))
(test-ssre "is{2}t" (: #\i (= 2 #\s) #\t))
(test-ssre "^A\\s+Z" (: bos #\A (+ space) #\Z))
(test-ssre "AskZ" (: #\A #\s #\k #\Z))
(test-ssre "[AskZ]+" (+ (or #\A #\s #\k #\Z)))
(test-ssre "[^s]+" (+ (~ #\s)))
(test-ssre "[^k]+" (+ (~ #\k)))
(test-ssre "[^sk]+" (+ (~ (or #\s #\k))))
(test-ssre "i" #\i)
(test-ssre "I" #\I)
(test-ssre "[i]" #\i)
(test-ssre "[zi]" (or #\z #\i))
(test-ssre "[iI]" (or #\i #\I))
(test-ssre "\\d+" (+ numeric))
(test-ssre ">\\s+<" (: #\> (+ space) #\<))
(test-ssre "\\w+" (+ (or alnum #\_)))
(test-ssre "\\b.+?\\b" (: (or bow eow) (**? 1 #f nonl) (or bow eow)))
(test-ssre "caf\\B.+?\\B" (: #\c #\a #\f nwb (**? 1 #f nonl) nwb))
(test-ssre "x{1,3}+" (+ (** 1 3 #\x)))
(test-ssre "[a]" #\a)
(test-ssre "[^a]" (~ #\a))
(test-ssre "(?<=C\n)^" (: (look-behind (: #\C #\newline)) bos))
(test-ssre "\\w+(?=\t)" (: (+ (or alnum #\_)) (look-ahead #\tab)))

; new set notation tests

(test-ssre "{Nd}" numeric)
(test-ssre "{Nd|[+]|[-]}+" (+ (or numeric #\+ #\-)))
(test-ssre "{~Nd}+" (+ (~ numeric)))
(test-ssre "^{Vowel}" (: bos (or #\A #\E #\I #\O #\U #\Y #\W)))
(test-ssre "^{Any}X" (: bos any #\X))
(test-ssre "^{~Any}X" (: bos (~ any) #\X))
(test-ssre "^{Any}?X" (: bos (? any) #\X))
(test-ssre "{[.]|Lu}{[.]|Ll}{[.]|~Lu}{[.]|~Ll}" (: (or #\. upper) (or #\. lower) (or #\. (~ upper)) (or #\. (~ lower))))
(test-ssre "{L}" alpha)
(test-ssre "{~L}" (~ alpha))
(test-ssre "{L}u" (: alpha #\u))
(test-ssre "{~L}u" (: (~ alpha) #\u))
(test-ssre "{L-Vowel}u" (: (- alpha (or #\A #\E #\I #\O #\U #\Y #\W)) #\u))
(test-ssre "{Nd}" numeric)
(test-ssre "{Nd}+" (+ numeric))
(test-ssre "{~Nd}+" (+ (~ numeric)))
(test-ssre "^{Vowel}" (: bos (or #\A #\E #\I #\O #\U #\Y #\W)))
(test-ssre "^{Any}X" (: bos any #\X))
(test-ssre "^{~Any}X" (: bos (~ any) #\X))
(test-ssre "^{Any}?X" (: bos (? any) #\X))
(test-ssre "{u}{l|d}*" (: upper (* (or lower numeric))))
(test-ssre "{~d}{an|[']}*" (: (~ numeric) (* (or alnum #\'))))
(test-ssre "{<}{u&~Vowel|d}{!b}{an-d}*{>}" (: bow (or (- upper (or #\A #\E #\I #\O #\U #\Y #\W)) numeric) nwb (* (- alnum numeric)) eow))
(test-ssre "{<g>}\\X*" (: grapheme (* grapheme)))
; selected corner cases
(test-ssre "a{}b" (: #\a (or) #\b))
(test-ssre "a{{}}b" (: #\a (or) #\b))
(test-ssre "a{{}|{}|{}}b" (: #\a (or) #\b))
(test-ssre "a{{}&{}}b" (: #\a (or) #\b))
(test-ssre "a{{}&{{}-{}-{}}}b" (: #\a (or) #\b))
(test-ssre "{?i-u:?u:an&{l|d}}" (w/nocase (w/ascii (w/unicode (and alnum (or lower numeric))))))
(test-ssre "(?x){ ?i-u: ?u: an & { l | d } }" (w/nocase (w/ascii (w/unicode (and alnum (or lower numeric))))))
(test-ssre "{?x: an & { ?i-u: l | d } }" (and alnum (w/nocase (w/ascii (or lower numeric)))))
(test-ssre "{an&{?i:{?-u:l|d}}}" (and alnum (w/nocase (w/ascii (or lower numeric)))))
(test-ssre "(?i)(?-u){l|d}" (w/nocase (w/ascii (or lower numeric))))

; options tests

(test-ssre "(?i)A string" (w/nocase (: #\A #\space #\s #\t #\r #\i #\n #\g)))
(test-ssre "(?i)([^.]*)\\.([^:]*):[T ]+(.*)" (w/nocase (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* nonl)))))
(test-ssre "(?i)^[W-c]+$" (w/nocase (: bos (+ (char-range #\W #\c)) eos)))
(test-ssre "(?s)\\A(.)*\\z" (: bos (* ($ any)) eos))
(test-ssre "(?i)[^a]" (w/nocase (~ #\a)))
(test-ssre "(?i:saturday|sunday)" (w/nocase (or (: #\s #\a #\t #\u #\r #\d #\a #\y) (: #\s #\u #\n #\d #\a #\y))))
(test-ssre "(?i)(?i:a)b" (w/nocase (: #\a #\b)))
(test-ssre "(?i)((?i:a))b" (w/nocase (: ($ #\a) #\b)))
(test-ssre "(?i)(?-i:a)b" (w/nocase (: (w/case #\a) #\b)))
(test-ssre "(?i)((?-i:a))b" (w/nocase (: ($ (w/case #\a)) #\b)))
(test-ssre "(?i)(?-i:a)b" (w/nocase (: (w/case #\a) #\b)))
(test-ssre "((?-i:a))b" (: ($ #\a) #\b))
(test-ssre "(?-i:a)b" (: #\a #\b))
(test-ssre "((?-i:a))b" (: ($ #\a) #\b))
(test-ssre "(?is)((?-i:a.))b" (w/nocase (: ($ (w/case (: #\a any))) #\b)))
;(test-ssre "^a(?#xxx){3}c" (: bos "a" "{3}c")) -- (?#comments) not supported
(test-ssre "(?m)^b$" (: bol #\b eol))
(test-ssre "(?ms)^b." (: bol #\b any))
(test-ssre "(?i)([\\w:]+::)?(\\w+)$" (w/nocase (: (? ($ (: (+ (or alnum #\_ #\:)) #\: #\:))) ($ (+ (or alnum #\_))) eos)))
(test-ssre "(?x)x y z | a b c" (or (: #\x #\y #\z) (: #\a #\b #\c)))
(test-ssre "(?i)AB(?-i:C)" (w/nocase (: #\A #\B (w/case #\C))))
(test-ssre "(?i)reg(?:ul(?:[a@]|ae)r|ex)" (w/nocase (: #\r #\e #\g (or (: #\u #\l (or #\a #\@ (: #\a #\e)) #\r) (: #\e #\x)))))
(test-ssre "ab cd (?x: de fg)" (: #\a #\b #\space #\c #\d #\space (: #\d #\e #\f #\g)))
(test-ssre "ab cd(?x: de fg) h" (: #\a #\b #\space #\c #\d (: #\d #\e #\f #\g) #\space #\h))
(test-ssre "(?s)^\\w+=.*(\\\\\n.*)*" (: bos (+ (or alnum #\_)) #\= (* any) (* ($ (: #\\ #\newline (* any))))))
(test-ssre "(?i)[^a]*" (w/nocase (* (~ #\a))))
(test-ssre "(?i)[^a]*?X" (w/nocase (: (*? (~ #\a)) #\X)))
(test-ssre "(?i)[^a]+?X" (w/nocase (: (**? 1 #f (~ #\a)) #\X)))
(test-ssre "(?i)[^a]?X" (w/nocase (: (? (~ #\a)) #\X)))
(test-ssre "(?i)[^a]??X" (w/nocase (: (?? (~ #\a)) #\X)))
(test-ssre "(?i)[^a]{2,3}" (w/nocase (** 2 3 (~ #\a))))
(test-ssre "(?i)[^a]{2,3}?" (w/nocase (**? 2 3 (~ #\a))))
(test-ssre "(?i)(?<=a{2})b" (w/nocase (: (look-behind (= 2 #\a)) #\b)))
(test-ssre "(?i)(?<!a{2})b" (w/nocase (: (neg-look-behind (= 2 #\a)) #\b)))
(test-ssre "(?i)(?<=[^a]{2})b" (w/nocase (: (look-behind (= 2 (~ #\a))) #\b)))
(test-ssre "(?i)^[^b]*\\w{4}" (w/nocase (: bos (* (~ #\b)) (= 4 (or alnum #\_)))))
(test-ssre "(?i)^a*\\w{4}" (w/nocase (: bos (* #\a) (= 4 (or alnum #\_)))))
(test-ssre "(?i)s" (w/nocase #\s))
(test-ssre "(?i)[^s]" (w/nocase (~ #\s)))
(test-ssre "(?i)the end" (w/nocase (: #\t #\h #\e #\space #\e #\n #\d)))
(test-ssre "(?i)abcd*" (w/nocase (: #\a #\b #\c (* #\d))))
(test-ssre "(?i)abc\\Z" (w/nocase (: #\a #\b #\c (: (? #\newline) eos))))
(test-ssre "(?i)^[^d]*?$" (w/nocase (: bos (*? (~ #\d)) eos)))
(test-ssre "(?i)^[^d]*?(?m:$)" (w/nocase (: bos (*? (~ #\d)) eol)))
(test-ssre "(?:[\\PLa*]*){8,}" (>= 8 (* (or (~ alpha) #\a #\*))))
(test-ssre "(?i)abc" (w/nocase (: #\a #\b #\c)))
(test-ssre "(?i)(?-i)the end" (w/nocase (w/case (: #\t #\h #\e #\space #\e #\n #\d)))) ; optimise?
(test-ssre "(?i)([\\da-f:]+)$" (w/nocase (: ($ (+ (or numeric (char-range #\a #\f) #\:))) eos)))
(test-ssre "(?i)^[\\da-f](\\.[\\da-f])*$" (w/nocase (: bos (or numeric (char-range #\a #\f)) (* ($ (: #\. (or numeric (char-range #\a #\f))))) eos)))
(test-ssre "(?is)([^.]*)\\.([^:]*):[T ]+(.*)" (w/nocase (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* any)))))
(test-ssre "(?isn)([^.]*)\\.([^:]*):[T ]+(.*)" (w/nocase (: (* (~ #\.)) #\. (* (~ #\:)) #\: (+ (or #\T #\space)) (* any))))
(test-ssre "(?i)^[W-c]+$" (w/nocase (: bos (+ (char-range #\W #\c)) eos)))
(test-ssre "(?i)^[\x3f;-\x5F;]+$" (w/nocase (: bos (+ (char-range #\? #\_)) eos)))
(test-ssre "(?i)[^a]" (w/nocase (~ #\a)))
(test-ssre "(?i)[^a]+" (w/nocase (+ (~ #\a))))
(test-ssre "(?i)[^az]" (w/nocase (~ (or #\a #\z))))
(test-ssre "(?i)\\b(foo)\\s+(\\w+)" (w/nocase (: (or bow eow) ($ (: #\f #\o #\o)) (+ space) ($ (+ (or alnum #\_))))))
(test-ssre "a(?i:b)c" (: #\a (w/nocase #\b) #\c))
(test-ssre "a(?i:b)*c" (: #\a (* (w/nocase #\b)) #\c))
(test-ssre "(?im)^(?-u:\\w\\s*\\w)$" (w/nocase (: bol (w/ascii (: (or alnum #\_) (* space) (or alnum #\_))) eol)))
(test-ssre "(?i)abc\\X*" (w/nocase (: #\a #\b #\c (* grapheme))))
(test-ssre "(?n)((((((((((a))))))))))" #\a)
(test-ssre "(?n)((((((((?-n:(a)))))))))" ($ #\a))
(test-ssre "(?n)((((((((?-n:(a)|(a)))))))))" (or ($ #\a) ($ #\a)))

; restore default definitions for sre tests
(ssre-definitions *ssre-definitions*)

; NOTE: reverse translations on the right are not the only correct ones; there can be equivalent translations, which are also correct

(test-sre (: #\t #\h #\e #\space #\q #\u #\i #\c #\k #\space #\b #\r #\o #\w #\n #\space #\f #\o #\x) "the quick brown fox")
(test-sre (: (* #\a) #\a #\b (? #\c) #\x #\y (+ #\z) #\p #\q (= 3 #\r) #\a (>= 2 #\b) #\x (** 4 5 #\y) #\p (** 0 6 #\q) #\A (>= 0 #\B) #\z #\z) "a*abc?xyz+pqr{3}ab{2,}xy{4,5}pq{0,6}AB*zz")
(test-sre (: bos (** 1 2 ($ (: #\a #\b #\c))) #\z #\z) "^(abc){1,2}zz")
(test-sre (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c) "^(b+?|a){1,2}?c")
(test-sre (: bos (** 1 2 ($ (or (+ #\b) #\a))) #\c) "^(b+|a){1,2}c")
(test-sre (: bos (**? 1 2 ($ (or (: #\b #\a) (* #\b)))) #\b #\c) "^(ba|b*){1,2}?bc")
(test-sre (: bos (or #\a #\b #\] #\c #\d #\e)) "^[ab\\]cde]")
(test-sre (: bos (or #\] #\c #\d #\e)) "^[\\]cde]")
(test-sre (: bos (~ (or #\a #\b #\] #\c #\d #\e))) "^[^ab\\]cde]")
(test-sre (: bos (~ (or #\] #\c #\d #\e))) "^[^\\]cde]")
(test-sre (: bos #\@) "^@")
(test-sre (: bos (+ (char-range #\0 #\9)) eos) "^[0-9]+$")
(test-sre (: bos (* nonl) #\n #\t #\e #\r) "^.*nter")
(test-sre (: bos #\x #\x #\x (+ (char-range #\0 #\9)) eos) "^xxx[0-9]+$")
(test-sre (: bos (+ nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos) "^.+[0-9][0-9][0-9]$")
(test-sre (: bos (**? 1 #f nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos) "^.+?[0-9][0-9][0-9]$")
(test-sre (: bos ($ (+ (~ #\!))) #\! ($ (+ nonl)) #\= #\a #\p #\q #\u #\x #\z #\. #\i #\x #\r #\. #\z #\z #\z #\. #\a #\c #\. #\u #\k eos) "^([^!]+)!(.+)=apquxz\\.ixr\\.zzz\\.ac\\.uk$")
(test-sre #\: ":")
(test-sre (: ($ (+ (or numeric (char-range #\a #\f) #\:))) eos) "([\\da-f:]+)$")
(test-sre (: bos (* nonl) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) eos) "^.*\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$")
(test-sre (: bos ($ (+ numeric)) (+ space) #\I #\N (+ space) #\S #\O #\A (+ space) ($ (+ (~ space))) (+ space) ($ (+ (~ space))) (* space) #\( (* space) eos) "^(\\d+)\\s+IN\\s+SOA\\s+(\\S+)\\s+(\\S+)\\s*\\(\\s*$")
(test-sre (: bos (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-)) (* ($ (: #\. (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-))))) #\. eos) "^[a-zA-Z\\d][a-zA-Z\\d\\-]*(\\.[a-zA-Z\\d][a-zA-Z\\d\\-]*)*\\.$")
(test-sre (: bos #\* #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric))))) (* ($ (: #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric)))))))) eos) "^\\*\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?(\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?)*$")
(test-sre (: bos (look-ahead (: #\a #\b ($ (: #\d #\e)))) ($ (: #\a #\b #\d)) ($ #\e)) "^(?=ab(de))(abd)(e)")
(test-sre (: bos (neg-look-ahead (or (: ($ (: #\a #\b)) #\d #\e) #\x)) ($ (: #\a #\b #\d)) ($ #\f)) "^(?!(ab)de|x)(abd)(f)")
(test-sre (: bos (look-ahead ($ (: #\a #\b ($ (: #\c #\d))))) ($ (: #\a #\b))) "^(?=(ab(cd)))(ab)")
(test-sre (: bos (or numeric (char-range #\a #\f)) (* ($ (: #\. (or numeric (char-range #\a #\f))))) eos) "^[\\da-f](\\.[\\da-f])*$")
(test-sre (: bos #\" (* nonl) #\" (* space) (? ($ (: #\; (* nonl)))) eos) "^\".*\"\\s*(;.*)?$")
(test-sre (: bos eos) "^$")
(test-sre (: bos #\a #\space #\b (or #\c #\space) #\d eos) "^a b[c ]d$")
(test-sre (: bos ($ (: #\a ($ (: #\b ($ #\c))))) ($ (: #\d ($ (: #\e ($ #\f))))) ($ (: #\h ($ (: #\i ($ #\j))))) ($ (: #\k ($ (: #\l ($ #\m))))) eos) "^(a(b(c)))(d(e(f)))(h(i(j)))(k(l(m)))$")
(test-sre (: bos (: #\a ($ (: #\b ($ #\c)))) (: #\d ($ (: #\e ($ #\f)))) (: #\h ($ (: #\i ($ #\j)))) (: #\k ($ (: #\l ($ #\m)))) eos) "^a(b(c))d(e(f))h(i(j))k(l(m))$")
(test-sre (: bos (or alnum #\_) (~ (or alnum #\_)) space (~ space) numeric (~ numeric) #\]) "^\\w\\W\\s\\S\\d\\D\\]")
(test-sre (: bos (+ (or #\. #\^ #\$ #\| #\( #\) #\* #\+ #\? #\{ #\, #\}))) "^[.\\^$|()*+?{,}]+")
(test-sre (: bos (* #\a) (or alnum #\_)) "^a*\\w")
(test-sre (: bos (*? #\a) (or alnum #\_)) "^a*?\\w")
(test-sre (: bos (+ #\a) (or alnum #\_)) "^a+\\w")
(test-sre (: bos (**? 1 #f #\a) (or alnum #\_)) "^a+?\\w")
(test-sre (: bos (= 8 numeric) (>= 2 (or alnum #\_))) "^\\d{8}\\w{2,}")
(test-sre (: bos (** 4 5 (or #\a #\e #\i #\o #\u numeric)) eos) "^[aeiou\\d]{4,5}$")
(test-sre (: bos (**? 4 5 (or #\a #\e #\i #\o #\u numeric))) "^[aeiou\\d]{4,5}?")
(test-sre (: bos #\F #\r #\o #\m (+ #\space) ($ (+ (~ #\space))) (+ #\space) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (+ #\space) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (or (char-range #\a #\z) (char-range #\A #\Z)) (+ #\space) (? (char-range #\0 #\9)) (char-range #\0 #\9) (+ #\space) (char-range #\0 #\9) (char-range #\0 #\9) #\: (char-range #\0 #\9) (char-range #\0 #\9)) "^From +([^ ]+) +[a-zA-Z][a-zA-Z][a-zA-Z] +[a-zA-Z][a-zA-Z][a-zA-Z] +[0-9]?[0-9] +[0-9][0-9]:[0-9][0-9]")
(test-sre (: bos #\F #\r #\o #\m (+ space) (+ (~ space)) (+ space) (= 2 ($ (: (= 3 (or (char-range #\a #\z) (char-range #\A #\Z))) (+ space)))) (** 1 2 numeric) (+ space) numeric numeric #\: numeric numeric) "^From\\s+\\S+\\s+([a-zA-Z]{3}\\s+){2}\\d{1,2}\\s+\\d\\d:\\d\\d")
(test-sre (: bos #\1 #\2 nonl #\3 #\4) "^12.34")
(test-sre (: #\f #\o #\o (neg-look-ahead (: #\b #\a #\r)) ($ (* nonl))) "foo(?!bar)(.*)")
(test-sre (: (or (: (neg-look-ahead (: #\f #\o #\o)) nonl nonl nonl) (: bos (** 0 2 nonl))) #\b #\a #\r ($ (* nonl))) "(?:(?!foo)...|^.{0,2})bar(.*)")
(test-sre (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))) "^(\\D*)(?=\\d)(?!123)")
(test-sre (: (neg-look-ahead bos) #\a #\b #\c) "{!<s}abc")
(test-sre (: (look-ahead bos) #\a #\b #\c) "(?=^)abc")
(test-sre (: bos (** 1 3 (or #\a #\b)) ($ (or (: #\a (* #\b)) #\b))) "^[ab]{1,3}(ab*|b)")
(test-sre (: bos (**? 1 3 (or #\a #\b)) ($ (or (: #\a (* #\b)) #\b))) "^[ab]{1,3}?(ab*|b)")
(test-sre (: bos (**? 1 3 (or #\a #\b)) ($ (or (: #\a (*? #\b)) #\b))) "^[ab]{1,3}?(ab*?|b)")
(test-sre (: bos (** 1 3 (or #\a #\b)) ($ (or (: #\a (*? #\b)) #\b))) "^[ab]{1,3}(ab*?|b)")
(test-sre (: #\a (** 1 3 #\b) #\b #\c) "ab{1,3}bc")
(test-sre (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* nonl))) "([^.]*)\\.([^:]*):[T ]+(.*)")
(test-sre (: bos (+ (char-range #\W #\c)) eos) "^[W-c]+$")
(test-sre (: bos (+ (char-range #\? #\_)) eos) "^[?-_]+$")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: bos (* ($ nonl)) eos) "^(.)*$")
(test-sre (or #\b (+ #\:)) "b|:+")
(test-sre (+ (or #\- #\a #\z)) "[\\-az]+")
(test-sre (+ (or #\a #\z #\-)) "[az\\-]+")
(test-sre (+ (or #\a #\- #\z)) "[a\\-z]+")
(test-sre (+ (char-range #\a #\z)) "[a-z]+")
(test-sre (+ (or numeric #\-)) "[\\d\\-]+")
(test-sre #\\ "\\\\")
(test-sre (: (= 0 #\a) #\b #\c) "a{0}bc")
(test-sre (: (**? 0 0 ($ (or #\a ($ (: #\b #\c))))) #\x #\y #\z) "(a|(bc)){0}?xyz")
(test-sre (: bos ($ (~ #\a)) ($ (~ #\b)) ($ (* (~ #\c))) ($ (** 3 4 (~ #\d)))) "^([^a])([^b])([^c]*)([^d]{3,4})")
(test-sre (~ #\a) "[^a]")
(test-sre (+ (~ #\a)) "[^a]+")
(test-sre (: (~ #\k) eos) "[^k]$")
(test-sre (: (** 2 3 (~ #\k)) eos) "[^k]{2,3}$")
(test-sre (: bos (>= 8 numeric) #\@ (+ nonl) (~ #\k) eos) "^\\d{8,}@.+[^k]$")
(test-sre (~ #\a) "[^a]")
(test-sre (~ (or #\a #\z)) "[^az]")
(test-sre (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 6 (~ #\*)) #\L #\L) "P[^*]TAIRE[^*]{1,6}?LL")
(test-sre (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 #f (~ #\*)) #\L #\L) "P[^*]TAIRE[^*]+?LL")
(test-sre (: ($ (: #\. numeric numeric (? (char-range #\1 #\9)))) (+ numeric)) "(\\.\\d\\d[1-9]?)\\d+")
(test-sre ($ (: #\. numeric numeric ($ (or (look-ahead #\0) (: numeric (look-ahead numeric)))))) "(\\.\\d\\d((?=0)|\\d(?=\\d)))")
(test-sre (: (or bow eow) ($ (: #\f #\o #\o)) (+ space) ($ (+ (or alnum #\_)))) "\\b(foo)\\s+(\\w+)")
(test-sre (: #\f #\o #\o ($ (* nonl)) #\b #\a #\r) "foo(.*)bar")
(test-sre (: #\f #\o #\o ($ (*? nonl)) #\b #\a #\r) "foo(.*?)bar")
(test-sre (: ($ (* nonl)) ($ (* numeric))) "(.*)(\\d*)")
(test-sre (: ($ (* nonl)) ($ (+ numeric))) "(.*)(\\d+)")
(test-sre (: ($ (*? nonl)) ($ (* numeric))) "(.*?)(\\d*)")
(test-sre (: ($ (*? nonl)) ($ (+ numeric))) "(.*?)(\\d+)")
(test-sre (: ($ (* nonl)) ($ (+ numeric)) eos) "(.*)(\\d+)$")
(test-sre (: ($ (*? nonl)) ($ (+ numeric)) eos) "(.*?)(\\d+)$")
(test-sre (: ($ (* nonl)) (or bow eow) ($ (+ numeric)) eos) "(.*)\\b(\\d+)$")
(test-sre (: ($ (: (* nonl) (~ numeric))) ($ (+ numeric)) eos) "(.*\\D)(\\d+)$")
(test-sre (: bos (* (~ numeric)) (neg-look-ahead (: #\1 #\2 #\3))) "^\\D*(?!123)")
(test-sre (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))) "^(\\D*)(?=\\d)(?!123)")
(test-sre (: bos (or #\W #\-) #\4 #\6 #\]) "^[W\\-]46\\]")
(test-sre (: bos (or (char-range #\W #\]) #\4 #\6)) "^[W-\\]46]")
(test-sre (: #\w #\o #\r #\d #\space (** 0 10 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d) "word (?:[a-zA-Z0-9]+ ){0,10}otherword")
(test-sre (: #\w #\o #\r #\d #\space (** 0 300 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d) "word (?:[a-zA-Z0-9]+ ){0,300}otherword")
(test-sre (: bos (= 0 ($ #\a))) "^(a){0}")
(test-sre (: bos (** 0 1 ($ #\a))) "^(a)?")
(test-sre (: bos (** 0 2 ($ #\a))) "^(a){0,2}")
(test-sre (: bos (** 0 3 ($ #\a))) "^(a){0,3}")
(test-sre (: bos (>= 0 ($ #\a))) "^(a)*")
(test-sre (: bos (= 1 ($ #\a))) "^(a)")
(test-sre (: bos (** 1 2 ($ #\a))) "^(a){1,2}")
(test-sre (: bos (** 1 3 ($ #\a))) "^(a){1,3}")
(test-sre (: bos (>= 1 ($ #\a))) "^(a)+")
(test-sre (: (* nonl) #\. #\g #\i #\f) ".*\\.gif")
(test-sre (: (>= 0 nonl) #\. #\g #\i #\f) ".*\\.gif")
(test-sre (: (* nonl) eos) ".*$")
(test-sre ($ (or (: (* nonl) #\X) (: bos #\B))) "(.*X|^B)")
(test-sre (: bos (* nonl) #\B) "^.*B")
(test-sre (: bos (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9)) "^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]")
(test-sre (: bos numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric) "^\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d")
(test-sre (: bos (= 12 (or #\a #\b #\c))) "^[abc]{12}")
(test-sre (: bos (= 12 (char-range #\a #\c))) "^[a-c]{12}")
(test-sre (: bos (= 12 ($ (or #\a #\b #\c)))) "^([abc]){12}")
(test-sre (: bos (or #\a #\b #\c #\d #\e #\f #\g #\h #\i #\j #\k #\l #\m #\n #\o #\p #\q #\r #\s #\t #\u #\v #\w #\x #\y #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9)) "^[abcdefghijklmnopqrstuvwxy0123456789]")
(test-sre (: #\a #\b #\c #\d (= 0 #\e)) "abcde{0}")
(test-sre (: #\a #\b (= 0 (or #\c #\d)) #\e) "ab[cd]{0}e")
(test-sre (: #\a #\b (= 0 ($ #\c)) #\d) "ab(c){0}d")
(test-sre (: #\a ($ (* #\b))) "a(b*)")
(test-sre (: #\a #\b (= 0 numeric) #\e) "ab\\d{0}e")
(test-sre (: #\" (* ($ (or (+ (~ (or #\\ #\"))) (: #\\ nonl)))) #\") "\"([^\\\\\"]+|\\\\.)*\"")
(test-sre (*? nonl) ".*?")
(test-sre (or bow eow) "\\b")
(test-sre (: #\a (~ #\a) #\b) "a[^a]b")
(test-sre (: #\a nonl #\b) "a.b")
(test-sre (: #\a (~ #\a) #\b) "a[^a]b")
(test-sre (: #\a nonl #\b) "a.b")
(test-sre (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c) "^(b+?|a){1,2}?c")
(test-sre (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\c) "^(b+|a){1,2}?c")
(test-sre (: (neg-look-ahead bos) #\x) "{!<s}x")
(test-sre (: (*? ($ (or #\A #\B))) #\C #\D) "([AB])*?CD")
(test-sre (: (* ($ (or #\A #\B))) #\C #\D) "([AB])*CD")
(test-sre (: (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o) "(?<!bar)foo")
(test-sre (: (= 3 (or alnum #\_)) (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o) "\\w{3}(?<!bar)foo")
(test-sre (: (look-behind (: ($ (: #\f #\o #\o)) #\a)) #\b #\a #\r) "(?<=(foo)a)bar")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: ($ (+ numeric)) ($ (or alnum #\_))) "(\\d+)(\\w)")
(test-sre (: #\a (w/nocase #\b) #\c) "a(?i:b)c")
(test-sre (: #\a (* (w/nocase #\b)) #\c) "a(?i:b)*c")
(test-sre (* ($ (*? #\a))) "(a*?)*")
(test-sre (* ($ (*? (or #\a #\b)))) "([ab]*?)*")
(test-sre (* ($ (*? (~ #\a)))) "([^a]*?)*")
(test-sre (* ($ (*? (~ (or #\a #\b))))) "([^ab]*?)*")
(test-sre (: (look-behind (: #\f #\o #\o #\newline)) bos #\b #\a #\r) "(?<=foo\n)^bar")
(test-sre (: (look-behind (: (neg-look-behind (: #\f #\o #\o)) #\b #\a #\r)) #\b #\a #\z) "(?<=(?<!foo)bar)baz")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: #\a (* #\b) #\c) "ab*c")
(test-sre (: #\a (* #\b) #\b #\c) "ab*bc")
(test-sre (= 1 nonl) ".")
(test-sre (** 3 4 nonl) ".{3,4}")
(test-sre (: #\a (>= 0 #\b) #\b #\c) "ab*bc")
(test-sre (: #\a (+ #\b) #\b #\c) "ab+bc")
(test-sre (: #\a (>= 1 #\b) #\b #\c) "ab+bc")
(test-sre (: #\a (+ #\b) #\b #\c) "ab+bc")
(test-sre (: #\a (>= 1 #\b) #\b #\c) "ab+bc")
(test-sre (: #\a (** 1 3 #\b) #\b #\c) "ab{1,3}bc")
(test-sre (: #\a (** 3 4 #\b) #\b #\c) "ab{3,4}bc")
(test-sre (: #\a (** 4 5 #\b) #\b #\c) "ab{4,5}bc")
(test-sre (: #\a (? #\b) #\b #\c) "ab?bc")
(test-sre (: #\a (** 0 1 #\b) #\b #\c) "ab?bc")
(test-sre (: #\a (? #\b) #\b #\c) "ab?bc")
(test-sre (: #\a (? #\b) #\c) "ab?c")
(test-sre (: #\a (** 0 1 #\b) #\c) "ab?c")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: bos #\a #\b #\c) "^abc")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: #\a #\b #\c eos) "abc$")
(test-sre bos "^")
(test-sre eos "$")
(test-sre (: #\a nonl #\c) "a.c")
(test-sre (: #\a (* nonl) #\c) "a.*c")
(test-sre (: #\a (or #\b #\c) #\d) "a[bc]d")
(test-sre (: #\a (char-range #\b #\d) #\e) "a[b-d]e")
(test-sre (: #\a (char-range #\b #\d)) "a[b-d]")
(test-sre (: #\a (or #\- #\b)) "a[\\-b]")
(test-sre (: #\a (or #\b #\-)) "a[b\\-]")
(test-sre (: #\a #\]) "a\\]")
(test-sre (: #\a #\] #\b) "a\\]b")
(test-sre (: #\a (~ (or #\b #\c)) #\d) "a[^bc]d")
(test-sre (: #\a (~ (or #\- #\b)) #\c) "a[^\\-b]c")
(test-sre (: #\a (~ (or #\] #\b)) #\c) "a[^\\]b]c")
(test-sre (: (or bow eow) #\a (or bow eow)) "\\ba\\b")
(test-sre (: (or bow eow) #\y (or bow eow)) "\\by\\b")
(test-sre (: nwb #\a nwb) "\\Ba\\B")
(test-sre (: nwb #\y (or bow eow)) "\\By\\b")
(test-sre (: (or bow eow) #\y nwb) "\\by\\B")
(test-sre (: nwb #\y nwb) "\\By\\B")
(test-sre (or alnum #\_) "\\w")
(test-sre (~ (or alnum #\_)) "\\W")
(test-sre (: #\a space #\b) "a\\sb")
(test-sre (: #\a (~ space) #\b) "a\\Sb")
(test-sre numeric "\\d")
(test-sre (~ numeric) "\\D")
(test-sre (or (: #\a #\b) (: #\c #\d)) "ab|cd")
(test-sre (: ($ (:)) #\e #\f) "()ef")
(test-sre (: eos #\b) "$b")
(test-sre (: #\a #\( #\b) "a\\(b")
(test-sre (: #\a (* #\() #\b) "a\\(*b")
(test-sre (: #\a #\\ #\b) "a\\\\b")
(test-sre ($ ($ #\a)) "((a))")
(test-sre (: ($ #\a) #\b ($ #\c)) "(a)b(c)")
(test-sre (: (+ #\a) (+ #\b) #\c) "a+b+c")
(test-sre (: (>= 1 #\a) (>= 1 #\b) #\c) "a+b+c")
(test-sre (: #\a (**? 1 #f nonl) #\c) "a.+?c")
(test-sre (* ($ (or (+ #\a) #\b))) "(a+|b)*")
(test-sre (>= 0 ($ (or (+ #\a) #\b))) "(a+|b)*")
(test-sre (+ ($ (or (+ #\a) #\b))) "(a+|b)+")
(test-sre (>= 1 ($ (or (+ #\a) #\b))) "(a+|b)+")
(test-sre (? ($ (or (+ #\a) #\b))) "(a+|b)?")
(test-sre (** 0 1 ($ (or (+ #\a) #\b))) "(a+|b)?")
(test-sre (* (~ (or #\a #\b))) "[^ab]*")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (* #\a) "a*")
(test-sre (: (* ($ (or #\a #\b #\c))) #\d) "([abc])*d")
(test-sre (: (* ($ (or #\a #\b #\c))) #\b #\c #\d) "([abc])*bcd")
(test-sre (or #\a #\b #\c #\d #\e) "[abcde]")
(test-sre (: ($ (or #\a #\b #\c #\d #\e)) #\f) "([abcde])f")
(test-sre (: #\a #\b #\c (* #\d) #\e #\f #\g) "abcd*efg")
(test-sre (: #\a (* #\b)) "ab*")
(test-sre (: ($ (or (: #\a #\b) (: #\c #\d))) #\e) "(ab|cd)e")
(test-sre (: (or #\a #\b #\h #\g #\e #\f #\d #\c) #\i #\j) "[abhgefdc]ij")
(test-sre (: bos ($ (or (: #\a #\b) (: #\c #\d))) #\e) "^(ab|cd)e")
(test-sre (: ($ (or (: #\a #\b #\c) (:))) #\e #\f) "(abc|)ef")
(test-sre (: ($ (or #\a #\b)) (* #\c) #\d) "([ab])c*d")
(test-sre (: ($ (or (: #\a #\b) (: #\a (* #\b)))) #\b #\c) "(ab|ab*)bc")
(test-sre (: #\a ($ (* (or #\b #\c))) (* #\c)) "a([bc]*)c*")
(test-sre (: #\a ($ (* (or #\b #\c))) ($ (: (* #\c) #\d))) "a([bc]*)(c*d)")
(test-sre (: #\a ($ (+ (or #\b #\c))) ($ (: (* #\c) #\d))) "a([bc]+)(c*d)")
(test-sre (: #\a ($ (* (or #\b #\c))) ($ (: (+ #\c) #\d))) "a([bc]*)(c+d)")
(test-sre (: #\a (* (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e) "a[bcd]*dcdcde")
(test-sre (: #\a (+ (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e) "a[bcd]+dcdcde")
(test-sre (: ($ (or (: #\a #\b) #\a)) (* #\b) #\c) "(ab|a)b*c")
(test-sre (: ($ (: ($ #\a) ($ #\b) #\c)) ($ #\d)) "((a)(b)c)(d)")
(test-sre (: (or (char-range #\a #\z) (char-range #\A #\Z) #\_) (* (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9) #\_))) "[a-zA-Z_][a-zA-Z0-9_]*")
(test-sre (or (: bos #\a ($ (or (: #\b (+ #\c)) (: #\b (or #\e #\h)))) #\g) (: nonl #\h eos)) "^a(bc+|b[eh])g|.h$")
(test-sre ($ (or (: #\b (+ #\c) #\d eos) (: #\e (* #\f) #\g nonl) (: (? #\h) #\i ($ (or #\j #\k))))) "(bc+d$|ef*g.|h?i([jk]))")
(test-sre ($ ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a)))))))))) "((((((((((a))))))))))")
(test-sre ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a))))))))) "(((((((((a)))))))))")
(test-sre (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s #\space #\o #\f #\space #\t #\e #\x #\t) "multiple words of text")
(test-sre (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s) "multiple words")
(test-sre (: ($ (* nonl)) #\c ($ (* nonl))) "(.*)c(.*)")
(test-sre (: #\( ($ (* nonl)) #\, #\space ($ (* nonl)) #\)) "\\((.*), (.*)\\)")
(test-sre #\k "k")
(test-sre (: #\a #\b #\c #\d) "abcd")
(test-sre (: #\a ($ (: #\b #\c)) #\d) "a(bc)d")
(test-sre (: #\a (? #\-) #\c) "a-?c")
(test-sre (: #\a (neg-look-ahead #\b) nonl) "a(?!b).")
(test-sre (: #\a (look-ahead #\d) nonl) "a(?=d).")
(test-sre (: #\a (look-ahead (or #\c #\d)) nonl) "a(?=[cd]).")
(test-sre (: #\a (or #\b #\c #\d) ($ nonl)) "a[bcd](.)")
(test-sre (: #\a (* (or #\b #\c #\d)) ($ nonl)) "a[bcd]*(.)")
(test-sre (: #\a (**? 1 #f (or #\b #\c #\d)) ($ nonl)) "a[bcd]+?(.)")
(test-sre (: #\a (+ (or #\b #\c #\d)) ($ nonl)) "a[bcd]+(.)")
(test-sre (: #\a (= 2 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{2}(.)")
(test-sre (: #\a (** 4 5 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{4,5}(.)")
(test-sre (: #\a (**? 4 5 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{4,5}?(.)")
(test-sre (: #\a (** 6 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{6,7}(.)")
(test-sre (: #\a (**? 6 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{6,7}?(.)")
(test-sre (: #\a (** 5 6 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,6}(.)")
(test-sre (: #\a (**? 5 6 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,6}?(.)")
(test-sre (: #\a (** 5 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,7}(.)")
(test-sre (: #\a (**? 5 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,7}?(.)")
(test-sre (: #\a (**? 1 #f (or #\b (**? 1 2 ($ (or #\c #\e))) #\d)) ($ nonl)) "a(?:b|([ce]){1,2}?|d)+?(.)")
(test-sre (: bos (? ($ (+ nonl))) #\B) "^(.+)?B")
(test-sre (or (: bos ($ (~ (char-range #\a #\z)))) (: ($ #\^) eos)) "^([^a-z])|(\\^)$")
(test-sre (: bos (or #\< #\>) #\&) "^[<>]&")
(test-sre (: (look-behind #\a) #\b) "(?<=a)b")
(test-sre (: (neg-look-behind #\c) #\b) "(?<!c)b")
(test-sre (: (* (: nonl nonl)) #\a) "(?:..)*a")
(test-sre (: (*? (: nonl nonl)) #\a) "(?:..)*?a")
(test-sre (: bos (** 3 5 ($ (:)))) "^(){3,5}")
(test-sre (: (* ($ (or #\a #\x))) #\a #\b) "([ax])*ab")
(test-sre (: (* ($ #\a)) #\a #\b) "(a)*ab")
(test-sre (: (w/nocase #\a) #\b) "(?i:a)b")
(test-sre (: ($ (w/nocase #\a)) #\b) "((?i:a))b")
(test-sre (: (or #\c #\d) (:) (: #\a (:) #\b (: #\b (:)) (: #\b (:) #\b))) "[cd]abbbb")
(test-sre (: (or #\c #\d) (:) (: #\a #\a #\a #\a #\a #\a #\a #\a (:) (: #\b #\b #\b #\b #\b #\b #\b #\b) (: #\b #\b #\b #\b #\b #\b #\b #\b (:)) (: #\b #\b #\b #\b #\b #\b #\b #\b (:) (: #\b #\b #\b #\b #\b #\b #\b #\b)))) "[cd]aaaaaaaabbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb")
(test-sre (: #\f #\o #\o (* (or alnum #\_)) (= 4 numeric) #\b #\a #\z) "foo\\w*\\d{4}baz")
(test-sre (: #\x (* ($ (: #\~ #\~))) (? (? #\F))) "x(~~)*(?:F?)?")
(test-sre (: #\x (* ($ (: #\~ #\~))) (?? #\F)) "x(~~)*F??")
(test-sre (: (neg-look-behind (or #\c #\d)) #\b) "(?<![cd])b")
(test-sre (: (neg-look-behind (or #\c #\d)) (or #\a #\b)) "(?<![cd])[ab]")
(test-sre (: (neg-look-behind ($ (or #\c #\d))) #\b) "(?<!([cd]))b")
(test-sre (: (neg-look-behind ($ (or #\c #\d))) (or #\a #\b)) "(?<!([cd]))[ab]")
(test-sre (: (neg-look-behind (: #\c #\d)) (or #\a #\b)) "(?<!cd)[ab]")
(test-sre (: bol #\b) "{<l}b")
(test-sre (: bol ($ #\b)) "{<l}(b)")
(test-sre (: bos #\b) "^b")
(test-sre (: ($ (:)) bos #\b) "()^b")
(test-sre (+ ($ (: (+ (or alnum #\_)) #\:))) "(\\w+:)+")
(test-sre (: eos (look-behind (: bos ($ #\a)))) "$(?<=^(a))")
(test-sre (: (? ($ (: (+ (or (or alnum #\_) #\:)) #\: #\:))) ($ (+ (or alnum #\_))) eos) "([\\w:]+::)?(\\w+)$")
(test-sre (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))) "^[^bcd]*(c+)")
(test-sre (: ($ (* #\a)) (+ #\b)) "(a*)b+")
(test-sre (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))) "^[^bcd]*(c+)")
(test-sre (: ($ (: #\> (+ #\a))) #\a #\b) "(>a+)ab")
(test-sre (: #\b eos) "b$")
(test-sre (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)))) #\f #\o #\o) "(?<=\\d{3}(?!999))foo")
(test-sre (: (look-behind (: (neg-look-ahead (: nonl nonl nonl #\9 #\9 #\9)) (= 3 numeric))) #\f #\o #\o) "(?<=(?!...999)\\d{3})foo")
(test-sre (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)) nonl nonl nonl)) #\f #\o #\o) "(?<=\\d{3}(?!999)...)foo")
(test-sre (: (look-behind (: (= 3 numeric) nonl nonl nonl)) (neg-look-behind (: #\9 #\9 #\9)) #\f #\o #\o) "(?<=\\d{3}...)(?<!999)foo")
(test-sre (* ($ (or (: #\Z ($ (:))) #\A))) "(Z()|A)*")
(test-sre (* ($ (or (: #\Z ($ ($ (:)))) #\A))) "(Z(())|A)*")
(test-sre (* #\a) "a*")
(test-sre (+ space) "\\s+")
(test-sre (: (neg-look-ahead bos) #\x) "{!<s}x")
(test-sre (: #\a #\b #\c nonl) "abc.")
(test-sre (: #\a (: #\b #\c) #\d) "abcd")
(test-sre (: (look-behind #\Z) #\X nonl) "(?<=Z)X.")
(test-sre (: (neg-look-behind (: (~ #\f) #\o #\o)) ($ (: #\b #\a #\r))) "(?<![^f]oo)(bar)")
(test-sre (: (neg-look-behind (~ #\f)) #\X) "(?<![^f])X")
(test-sre (: (look-behind (~ #\f)) #\X) "(?<=[^f])X")
(test-sre bos "^")
(test-sre #\space " ")
(test-sre (: #\space (* space) #\# (* space)) " \\s*#\\s*")
(test-sre (: (* #\a) (* #\b) (or alnum #\_)) "a*b*\\w")
(test-sre (: (* #\a) (? #\b) (or alnum #\_)) "a*b?\\w")
(test-sre (: (* #\a) (** 0 4 #\b) (or alnum #\_)) "a*b{0,4}\\w")
(test-sre (: (* #\a) (>= 0 #\b) (or alnum #\_)) "a*b*\\w")
(test-sre (: (* #\a) (* numeric) (or alnum #\_)) "a*\\d*\\w")
(test-sre (: (* #\a) (* #\b) (or alnum #\_)) "a*b*\\w")
(test-sre (: eos (neg-look-behind #\newline)) "$(?<!\n)")
(test-sre (: (* nonl) (or #\o #\p) (or #\x #\y #\z)) ".*[op][xyz]")
(test-sre (or (: ($ #\a) #\b) (: ($ #\a) #\c)) "(a)b|(a)c")
(test-sre (: (+ (or (+ #\a) (: #\a #\b))) #\c) "(?:a+|ab)+c")
(test-sre (: bos (+ (or #\a (: #\a #\b))) #\c) "^(?:a|ab)+c")
(test-sre (: (= 3 (look-ahead (: #\a #\b #\c))) #\a #\b #\c) "(?=abc){3}abc")
(test-sre (: (= 0 (look-ahead (: #\a #\b #\c))) #\x #\y #\z) "(?=abc){0}xyz")
(test-sre (: (= 1 (look-ahead (: #\a #\b #\c))) #\x #\y #\z) "(?=abc)xyz")
(test-sre (: (? (look-ahead ($ #\a))) nonl) "(?=(a))?.")
(test-sre (: (?? (look-ahead ($ #\a))) nonl) "(?=(a))??.")
(test-sre (: bos (= 0 (neg-look-ahead #\a)) (+ (or alnum #\_))) "^(?!a){0}\\w+")
(test-sre (: (? (look-behind ($ (: #\a #\b #\c)))) #\x #\y #\z) "(?<=(abc))?xyz")
(test-sre (: bos (+ (or #\: #\a numeric))) "^[:a\\d]+")
(test-sre (: bos (+ (or #\: #\a numeric #\: #\b))) "^[:a\\d:b]+")
(test-sre (: (or #\: #\a) #\x #\x #\x (or #\b #\:)) "[:a]xxx[b:]")
(test-sre (: (look-behind (= 2 (~ #\a))) #\b) "(?<=[^a]{2})b")
(test-sre (: bos (+ (>= 2 ($ (** 2 3 #\a)))) #\a) "^(?:(a{2,3}){2,})+a")
(test-sre (look-ahead #\C) "(?=C)")
(test-sre (: (or (: #\a (-> quote (or (: #\space (-> apostrophe #\')) (-> realquote #\"))) #\space) (: #\b (-> quote (or (: #\space (-> apostrophe #\')) (-> realquote #\"))) #\space)) #\space ($ (or (: (backref quote) (+ (char-range #\a #\z))) (+ (char-range #\0 #\9))))) "(?:a(?<quote> (?<apostrophe>')|(?<realquote>\")) |b(?<quote> (?<apostrophe>')|(?<realquote>\")) ) (\\k<quote>[a-z]+|[0-9]+)")
(test-sre (: bos (+ (>= 2 ($ #\a))) ($ (or alnum #\_))) "^(?:(a){2,})+(\\w)")
(test-sre (: bos (+ (>= 2 #\a)) ($ (or alnum #\_))) "^(?:a{2,})+(\\w)")
(test-sre (: bos (*? nonl) ($ (or #\a (: #\b #\c)))) "^.*?(a|bc)")
(test-sre (: bos (*? nonl) (or #\a (: #\b #\c) #\d)) "^.*?(?:a|bc|d)")
(test-sre (: (*? nonl) #\a (look-behind (: #\b #\a))) ".*?a(?<=ba)")
(test-sre (or (: #\a (look-ahead (: #\b #\c)) nonl) (: #\a #\b #\d)) "a(?=bc).|abd")
(test-sre (: bos (*? nonl) (or #\a (: #\b #\c))) "^.*?(?:a|bc)")
(test-sre (: bos (* numeric) (= 4 (or alnum #\_))) "^\\d*\\w{4}")
(test-sre (: bos (* (~ #\b)) (= 4 (or alnum #\_))) "^[^b]*\\w{4}")
(test-sre (: bos (* #\a) (= 4 (or alnum #\_))) "^a*\\w{4}")
(test-sre (: (or (-> n (: #\f #\o #\o)) (-> n (: #\b #\a #\r))) (backref n)) "(?:(?<n>foo)|(?<n>bar))\\k<n>")
(test-sre (: (-> n #\A) (or (-> n (: #\f #\o #\o)) (-> n (: #\b #\a #\r))) (backref n)) "(?<n>A)(?:(?<n>foo)|(?<n>bar))\\k<n>")
(test-sre (: bos ($ (+ numeric)) (+ space) #\I #\N (+ space) #\S #\O #\A (+ space) ($ (+ (~ space))) (+ space) ($ (+ (~ space))) (* space) #\( (* space) eos) "^(\\d+)\\s+IN\\s+SOA\\s+(\\S+)\\s+(\\S+)\\s*\\(\\s*$")
(test-sre (: (or #\x (or (+ ($ (or (: #\x #\x) (: #\y #\y)))) #\x #\x #\x #\x #\x) #\a #\a #\a) #\b #\c) "(?:x|(xx|yy)+|[xxxxxaaa])bc")
(test-sre (: space #\a #\b #\c) "\\sabc")
(test-sre (: (* #\Z) (= 216 ($ (or (:) (* #\d))))) "Z*(|d*){216}")
(test-sre (: (look-behind (: #\a (= 0 ($ #\B)) #\c)) #\X) "(?<=a(B){0}c)X")
(test-sre (: (+ #\a) (or (:) #\b) #\a) "a+(?:|b)a")
(test-sre (: (? #\X) (= 3335 ($ (or #\R (:) (:))))) "X?(R||){3335}")
(test-sre (or (: (neg-look-ahead ($ #\b)) #\c) #\b) "(?!(b))c|b")
(test-sre (or (: (look-ahead ($ #\b)) #\b) #\c) "(?=(b))b|c")
(test-sre (: #\< (or #\a #\space #\b) #\>) "<[a b]>")
(test-sre (+ (or numeric #\-)) "[\\d\\-]+")
(test-sre (look-behind (? (look-ahead nonl))) "(?<=(?=.)?)")
(test-sre (look-behind (** 4 5 (look-ahead nonl))) "(?<=(?=.){4,5})")
(test-sre (look-behind (: (** 4 5 (look-ahead nonl)) #\x)) "(?<=(?=.){4,5}x)")
(test-sre (: #\space #\space #\space (* (-> word (: #\space (+ (or alnum #\_)) #\space))) #\space #\space #\space #\space #\. #\space #\space #\space) "   (?<word> \\w+ )*    \\.   ")
(test-sre (look-behind (look-ahead (: nonl (look-behind #\x)))) "(?<=(?=.(?<=x)))")
(test-sre (: (look-behind (look-ahead (look-behind #\a))) #\b) "(?<=(?=(?<=a)))b")
(test-sre (: (look-behind (: #\a (? #\b) #\c)) nonl nonl nonl) "(?<=ab?c)...")
(test-sre (: (look-behind (or (: #\P #\Q #\R) (: #\a (? #\b) #\c))) nonl nonl nonl) "(?<=PQR|ab?c)...")
(test-sre (: (look-behind (or (: #\a (? #\b) #\c) (: #\P #\Q #\R))) nonl nonl nonl) "(?<=ab?c|PQR)...")
(test-sre (: (look-behind (or (: #\P #\Q) (: #\a (? #\b) #\c))) nonl nonl nonl) "(?<=PQ|ab?c)...")
(test-sre (: (look-behind (or (: #\a (? #\b) #\c) (: #\P #\Q))) nonl nonl nonl) "(?<=ab?c|PQ)...")
(test-sre (: (look-behind (: #\a ($ (or (: (? #\b) #\c) (: (? #\d) (? #\e) #\e))) #\f)) #\X nonl) "(?<=a(b?c|d?e?e)f)X.")
(test-sre (: (neg-look-behind (: #\a ($ (or (: (? #\b) #\c) (: (? #\d) (? #\e) #\e))) #\f)) #\X nonl) "(?<!a(b?c|d?e?e)f)X.")
(test-sre (: (look-behind (or (** 2 3 numeric) (: #\A #\B #\C))) nonl) "(?<=\\d{2,3}|ABC).")
(test-sre (: (look-behind ($ (** 1 255 numeric))) #\X) "(?<=(\\d{1,255}))X")
(test-sre (: (look-behind (: #\a (= 3 ($ (: (? #\b) #\c))) #\d)) #\X) "(?<=a(b?c){3}d)X")
(test-sre (: (look-behind (: #\a (= 0 ($ (: (? #\b) #\c))) #\d)) #\X) "(?<=a(b?c){0}d)X")
(test-sre (: (look-behind (: (? #\a) (= 0 ($ (: (? #\b) #\c))) #\d)) #\X nonl) "(?<=a?(b?c){0}d)X.")
(test-sre (neg-look-behind (? #\a)) "(?<!a?)")
(test-sre (: (look-behind (or (: #\P #\Q) (: #\P #\c nonl (? #\b)))) ($ (? nonl)) ($ (? #\b))) "(?<=PQ|Pc.b?)(.?)(b?)")
(test-sre (: (look-ahead #\a) (? #\b) #\a) "(?=a)b?a")
(test-sre (: (look-ahead #\a) (? #\b) #\a nonl) "(?=a)b?a.")
(test-sre (: #\6 #\5 #\space #\0 #\0 #\space #\6 #\4) "65 00 64")
(test-sre (: bos (= 4 nonl)) "^.{4}")
(test-sre (: bos (+ ($ (: (** 3 6 nonl) #\!))) eos) "^(.{3,6}!)+$")
(test-sre (or (: (>= 5 (char-range #\a #\z)) #\b) #\x) "[a-z]{5,}b|x")
(test-sre (or (: (**? 1 6 (char-range #\a #\z)) #\s) #\x) "[a-z]{1,6}?s|x")
(test-sre #\@ "@")
(test-sre (: #\@ #\@ #\@ #\x #\x #\x) "@@@xxx")
(test-sre (: (look-behind #\x) #\b #\a #\d #\u #\t #\f) "(?<=x)badutf")
(test-sre (: (look-behind (: #\x #\x)) #\b #\a #\d #\u #\t #\f) "(?<=xx)badutf")
(test-sre (: (look-behind (: #\x #\x #\x #\x)) #\b #\a #\d #\u #\t #\f) "(?<=xxxx)badutf")
(test-sre #\X "X")
(test-sre (+ #\a) "a+")
(test-sre #\A "A")
(test-sre #\x "x")
(test-sre (: #\a #\b #\c) "abc")
(test-sre #\X "X")
(test-sre (: (look-behind nonl) #\X) "(?<=.)X")
(test-sre (+ #\a) "a+")
(test-sre #\a "a")
(test-sre nonl ".")
(test-sre #\s "s")
(test-sre (~ #\s) "[^s]")
(test-sre (: #\a (*? nonl) #\a) "a.*?a")
(test-sre (: (look-behind (: #\p #\q #\r)) #\a #\b #\c (look-ahead (: #\x #\y #\z))) "(?<=pqr)abc(?=xyz)")
(test-sre (: #\a (or bow eow)) "a\\b")
(test-sre (: #\a #\b #\c (look-ahead (: #\a #\b #\c #\d #\e)) (look-ahead (: #\a #\b))) "abc(?=abcde)(?=ab)")
(test-sre (: (look-behind (: #\a #\b #\c)) #\1 #\2 #\3) "(?<=abc)123")
(test-sre (: (or bow eow) #\a #\b #\c (or bow eow)) "\\babc\\b")
(test-sre (: (look-behind (: #\a #\b #\c)) #\d #\e #\f) "(?<=abc)def")
(test-sre (: #\a #\b #\c (look-behind (: #\b #\c)) #\d #\e #\f) "abc(?<=bc)def")
(test-sre (: (look-behind (: #\a #\b)) #\c #\d #\e #\f) "(?<=ab)cdef")
(test-sre (: #\b (neg-look-behind (: #\a #\x)) (neg-look-ahead (: #\c #\x))) "b(?<!ax)(?!cx)")
(test-sre (: #\a #\b #\c #\d) "abcd")
(test-sre (: bos #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\a #\b #\c #\d) "^12345678abcd")
(test-sre (= 7 (or #\a #\x #\m)) "[axm]{7}")
(test-sre (: (*? ($ (or nonl nonl))) #\b #\x) "({nonl|nonl})*?bx")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: ($ (: nonl nonl nonl)) #\- ($ (: nonl nonl nonl))) "(...)-(...)")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (or (: bos #\a #\b #\c) (: #\d #\e #\f)) "^abc|def")
(test-sre (: (* nonl) ($ (or (: ($ (: #\a #\b #\c)) eos) ($ (: #\d #\e #\f))))) ".*((abc)$|(def))")
(test-sre (: #\t #\h #\e #\space #\q #\u #\i #\c #\k #\space #\b #\r #\o #\w #\n #\space #\f #\o #\x) "the quick brown fox")
(test-sre (: (* #\a) ($ (+ #\b)) ($ #\z) ($ #\z)) "a*(b+)(z)(z)")
(test-sre (: #\a #\b nonl #\c #\d) "ab.cd")
(test-sre (or (? #\a) (? #\b)) "a?|b?")
(test-sre (: (+ (or alnum #\_)) #\A) "\\w+A")
(test-sre (: bos #\d ($ #\e) eos) "^d(e)$")
(test-sre ($ (: ($ #\a) (? ($ #\b)) ($ #\c))) "((a)(b)?(c))")
(test-sre (or alnum #\_) "\\w")
(test-sre (** 5 4 #\x) "x{5,4}")
(test-sre (= 65536 #\z) "z{65536}")
(test-sre (: #\a #\b #\c (look-behind (+ #\a)) #\b) "abc(?<=a+)b")
(test-sre (: (look-behind (: #\a #\b ($ (+ #\c)) #\d)) #\e #\f) "(?<=ab(c+)d)ef")
(test-sre (: (look-behind (: #\a #\b (look-behind (+ #\c)) #\d)) #\e #\f) "(?<=ab(?<=c+)d)ef")
(test-sre (: #\T #\h #\e #\space #\n #\e #\x #\t #\space #\t #\h #\r #\e #\e #\space #\a #\r #\e #\space #\i #\n #\space #\t #\e #\s #\t #\i #\n #\p #\u #\t #\2 #\space #\b #\e #\c #\a #\u #\s #\e #\space #\t #\h #\e #\y #\space #\h #\a #\v #\e #\space #\v #\a #\r #\i #\a #\b #\l #\e #\space #\l #\e #\n #\g #\t #\h #\space #\b #\r #\a #\n #\c #\h #\e #\s) "The next three are in testinput2 because they have variable length branches")
(test-sre (: (look-behind (+ #\x)) #\y) "(?<=x+)y")
(test-sre (** 37 17 #\a) "a{37,17}")
(test-sre (: (** 1 3 #\a) #\b) "a{1,3}b")
(test-sre (: (+ nonl) #\f #\o #\o) ".+foo")
(test-sre (: bos #\X) "^X")
(test-sre (: (-> A (or (: #\t #\o #\m) (: #\b #\o #\n))) #\- (backref A)) "(?<A>tom|bon)-\\k<A>")
(test-sre (: #\X (** 2 4 #\a) #\b) "Xa{2,4}b")
(test-sre (: #\X (**? 2 4 #\a) #\b) "Xa{2,4}?b")
(test-sre (: #\X (+ (** 2 4 #\a)) #\b) "X(?:a{2,4})+b")
(test-sre (: #\X (** 2 4 numeric) #\b) "X\\d{2,4}b")
(test-sre (: #\X (**? 2 4 numeric) #\b) "X\\d{2,4}?b")
(test-sre (: #\X (+ (** 2 4 numeric)) #\b) "X(?:\\d{2,4})+b")
(test-sre (: #\X (** 2 4 (~ numeric)) #\b) "X\\D{2,4}b")
(test-sre (: #\X (**? 2 4 (~ numeric)) #\b) "X\\D{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (~ numeric))) #\b) "X(?:\\D{2,4})+b")
(test-sre (: #\X (** 2 4 (or #\a #\b #\c)) #\b) "X[abc]{2,4}b")
(test-sre (: #\X (**? 2 4 (or #\a #\b #\c)) #\b) "X[abc]{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (or #\a #\b #\c))) #\b) "X(?:[abc]{2,4})+b")
(test-sre (: #\X (** 2 4 (~ #\a)) #\b) "X[^a]{2,4}b")
(test-sre (: #\X (**? 2 4 (~ #\a)) #\b) "X[^a]{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (~ #\a))) #\b) "X(?:[^a]{2,4})+b")
(test-sre (: #\Z (neg-look-ahead (:))) "Z(?!)")
(test-sre (: #\d #\o #\g (? ($ (: #\s #\b #\o #\d #\y)))) "dog(sbody)?")
(test-sre (: #\d #\o #\g (?? ($ (: #\s #\b #\o #\d #\y)))) "dog(sbody)??")
(test-sre (or (: #\d #\o #\g) (: #\d #\o #\g #\s #\b #\o #\d #\y)) "dog|dogsbody")
(test-sre (or (: #\d #\o #\g #\s #\b #\o #\d #\y) (: #\d #\o #\g)) "dogsbody|dog")
(test-sre (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)) "\\bthe cat\\b")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: (look-behind (: #\a #\b #\c)) #\1 #\2 #\3) "(?<=abc)123")
(test-sre (: (or bow eow) #\a #\b #\c (or bow eow)) "\\babc\\b")
(test-sre (: (? #\a) (? #\b)) "a?b?")
(test-sre (: bos (? #\a) (? #\b)) "^a?b?")
(test-sre (: #\a #\b #\c (* #\d)) "abcd*")
(test-sre (: #\a #\b #\c (* numeric)) "abc\\d*")
(test-sre (: #\a #\b #\c (* (or #\d #\e))) "abc[de]*")
(test-sre (: (look-behind (: #\a #\b #\c)) #\d #\e #\f) "(?<=abc)def")
(test-sre (: #\a #\b #\c eos) "abc$")
(test-sre (: #\a #\b #\c (or bow eow)) "abc\\b")
(test-sre (: #\a #\b #\c nwb) "abc\\B")
(test-sre (+ nonl) ".+")
(test-sre (: (look-behind (+ ($ (: #\a #\b #\c)))) #\X) "(?<=(abc)+)X")
(test-sre (or (: ($ #\a) #\b) (: #\a #\c)) "(a)b|ac")
(test-sre (or (: ($ #\a) ($ #\b) #\x) (: #\a #\b #\c)) "(a)(b)x|abc")
(test-sre (: (or ($ (: #\f #\o #\o)) ($ (: #\b #\a #\r)) ($ (: #\b #\a #\z))) #\X) "(?:(foo)|(bar)|(baz))X")
(test-sre (or (: ($ (: #\a #\b)) #\x) (: #\a #\b)) "(ab)x|ab")
(test-sre ($ ($ ($ ($ ($ #\a))))) "(((((a)))))")
(test-sre (: (*? #\a) (*? #\b)) "a*?b*?")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: #\a ($ #\b) #\c) "a(b)c")
(test-sre (or (: ($ #\a) ($ #\b)) ($ #\c)) "(a)(b)|(c)")
(test-sre (or (-> A #\a) (-> A #\b)) "(?<A>a)|(?<A>b)")
(test-sre (: #\a ($ #\b) #\c ($ #\d)) "a(b)c(d)")
(test-sre (: bos #\a #\b #\c) "^abc")
(test-sre (: (* nonl) numeric) ".*\\d")
(test-sre (* ($ (: #\a #\b #\c))) "(abc)*")
(test-sre bos "^")
(test-sre (: (? (: #\a #\b)) (: #\a #\b) (: #\a #\b)) "(?:ab)?abab")
(test-sre (: #\a #\b #\c) "abc")
(test-sre ($ (: #\a #\b #\c #\d)) "(abcd)")
(test-sre (: #\a #\b #\c #\d) "abcd")
(test-sre (: #\a ($ #\b) #\c) "a(b)c")
(test-sre (: #\a (or punct #\b)) "a{p|[b]}")
(test-sre (: #\a (or #\b punct)) "a{[b]|p}")
(test-sre (: #\0 #\b #\space #\2 #\8 #\space #\3 #\f #\space #\2 #\d #\space #\7 #\8 #\space #\2 #\9 #\space #\3 #\a) "0b 28 3f 2d 78 29 3a")
(test-sre (or #\a (: ($ #\b) #\c)) "a|(b)c")
(test-sre (: #\e #\f #\g) "efg")
(test-sre (: #\e #\f #\f) "eff")
(test-sre (: #\e #\f #\f #\g) "effg")
(test-sre (: #\a #\a #\a) "aaa")
(test-sre (neg-look-behind (or (:) (: #\! (neg-look-behind (:))))) "(?<!|!(?<!))")
(test-sre (or (: (neg-look-behind (or (:) #\! #\! (:) (:) (:) (:) (:) (neg-look-behind (:)) (:) (: (neg-look-behind (:)) #\!) #\! (:) (: (neg-look-behind (:)) #\!) (: #\! (neg-look-behind (:)) #\!) #\! #\! #\! (:) (:) (:) (: #\! #\!) (: #\< #\!))) #\!) #\! (:) (:) (:) #\! (:)) "(?<!|[!!]||||||(?<!)||(?<!)!|!||(?<!)!|!(?<!)!|[!!!]||||!!|<!)!|!||||!|")
(test-sre (= 65 ($ (? #\R))) "(R?){65}")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (or (: #\a #\b #\c) (: #\b #\c #\d)) "abc|bcd")
(test-sre (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\b #\c) "^(b+|a){1,2}?bc")
(test-sre (: bos (**? 1 2 ($ (or (* #\b) (: #\b #\a)))) #\b #\c) "^(b*|ba){1,2}?bc")
(test-sre (or #\a #\b #\c) "[abc]")
(test-sre (or (: #\a ($ #\b) #\c) (: #\x #\y #\z)) "a(b)c|xyz")
(test-sre (: #\f #\o #\o #\b #\a #\r) "foobar")
(test-sre (: #\[ ($ (:)) (= 65535 #\]) (-> A (:))) "\\[()\\]{65535}(?<A>)")
(test-sre (look-behind (look-ahead (: nonl (look-behind #\x)))) "(?<=(?=.(?<=x)))")
(test-sre eos "$")
(test-sre (: (? #\newline) eos) "\\Z")
(test-sre (: (neg-look-ahead (or #\a #\b)) (* nonl)) "(?![ab]).*")
(test-sre (: #\a #\b #\c #\d) "abcd")
(test-sre (: #\1 #\2 #\3 #\4 #\5 (look-behind (** 1 256 numeric)) #\X) "12345(?<=\\d{1,256})X")
(test-sre (neg-look-behind (** 9 44965 ($ (= 65054 #\space)))) "(?<!( {65054}){9,44965})")
(test-sre (look-behind ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ ($ (:))) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ ($ (:))) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ ($ (:))) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (:)) ($ (: ($ (:)) ($ (:))))))))))))))))))) "(?<=(()()()()()()()()()()()()()(()()()()(())()()()()(()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()(())()()()()(()()()()()()(()()()()()()()()()()()()()()()()()()()()()(())()()()()(()()()()()()()()()()()()()(()()()()()()()()()()()()()(()())))))))))")
(test-sre (* ($ (or ($ (: #\f #\o #\o)) ($ (: #\b #\a #\r))))) "((foo)|(bar))*")
(test-sre (* (or (: ($ #\f) ($ #\o) ($ #\o)) (: ($ #\b) ($ #\a) ($ #\r)))) "(?:(f)(o)(o)|(b)(a)(r))*")
(test-sre (* ($ (or (+ ($ #\Z)) #\A))) "((Z)+|A)*")
(test-sre (: #\A (+ #\space)) "A +")
(test-sre (: #\a eos) "a$")
(test-sre (or #\a #\[) "[a\\[]")
(test-sre (or numeric #\space #\space (char-range #\space #\Z)) "[\\d   -Z]")
(test-sre (: (look-behind (: #\a #\b #\c)) ($ (or (:) (: #\D #\E #\F)))) "(?<=abc)(|DEF)")
(test-sre (: #\a ($ (: #\b #\b)) #\c) "a(bb)c")
(test-sre (: #\a ($ (:)) #\c) "a()c")
(test-sre (: (or (-> n (: #\f #\o #\o)) (-> n (: #\b #\a #\r))) (backref n)) "(?:(?<n>foo)|(?<n>bar))\\k<n>")
(test-sre (: (? #\a) #\b (* (or #\] #\x #\y)) #\c) "a?b[\\]xy]*c")
(test-sre (* #\f) "f*")
(test-sre (: #\f #\o #\o #\*) "foo\\*")
(test-sre (: #\f #\o #\o #\* #\b #\a #\r) "foo\\*bar")
(test-sre (: #\f #\\ #\o #\o) "f\\\\oo")
(test-sre (or #\t #\e #\n) "[ten]")
(test-sre (: #\t (char-range #\a #\g) #\n) "t[a-g]n")
(test-sre (: #\a #\] #\b) "a\\]b")
(test-sre (: #\a (or #\] #\a #\-) #\b) "a[\\]a\\-]b")
(test-sre (: #\a (or #\] #\-) #\b) "a[\\]\\-]b")
(test-sre (: #\a (or #\] (char-range #\a #\z)) #\b) "a[\\]a-z]b")
(test-sre #\] "\\]")
(test-sre (: #\t (or #\! (char-range #\a #\g)) #\n) "t[!a-g]n")
(test-sre (: #\A (char-range #\+ #\0) #\B) "A[+-0]B")
(test-sre (: #\a (char-range #\- #\0) #\z) "a[\\--0]z")
(test-sre (: #\a (or numeric #\.) #\z) "a[\\d.]z")
(test-sre (: #\A nwb #\\ #\C (~ numeric)) "A\\B\\\\C\\D")
(test-sre (: (* #\a) #\b) "a*b")
(test-sre (: #\< (or #\] #\b #\c) #\>) "<[\\]bc]>")
(test-sre (: #\< (~ (or #\] #\b #\c)) #\>) "<[^\\]bc]>")
(test-sre (: (* #\a) (+ #\b) #\c #\+ (or #\d #\e #\f) ($ (: #\a #\b)) #\( #\c #\d #\)) "a*b+c\\+[def](ab)\\(cd\\)")
(test-sre (: #\h #\o #\w nonl #\t #\o #\space #\h #\o #\w #\. #\t #\o) "how.to how\\.to")
(test-sre (: bos #\h #\o #\w #\space #\t #\o #\space #\^ #\h #\o #\w #\space #\t #\o) "^how to \\^how to")
(test-sre (: bos #\b #\( #\c bos #\d #\) #\( bos #\e bos #\f #\)) "^b\\(c^d\\)\\(^e^f\\)")
(test-sre (: #\[ ($ (:)) (= 65535 #\]) ($ (:))) "\\[()\\]{65535}()")
(test-sre (: bos #\A) "^A")
(test-sre (: bos (+ (or alnum #\_))) "^\\w+")
(test-sre (: ($ (+ nonl)) (or bow eow) ($ (+ nonl))) "(.+)\\b(.+)")
(test-sre (+ (~ (or alnum #\_))) "\\W+")
(test-sre (+ (or alnum #\_)) "\\w+")
(test-sre (: #\a nonl #\b) "a.b")
(test-sre (: #\a ($ (= 3 nonl)) #\b) "a(.{3})b")
(test-sre (: #\a ($ (*? nonl)) ($ nonl)) "a(.*?)(.)")
(test-sre (: #\a ($ (* nonl)) ($ nonl)) "a(.*)(.)")
(test-sre (: #\a ($ nonl) ($ nonl)) "a(.)(.)")
(test-sre (: #\a ($ (? nonl)) ($ nonl)) "a(.?)(.)")
(test-sre (: #\a ($ (?? nonl)) ($ nonl)) "a(.??)(.)")
(test-sre (: #\a ($ (= 3 nonl)) #\b) "a(.{3})b")
(test-sre (: #\a ($ (>= 3 nonl)) #\b) "a(.{3,})b")
(test-sre (: #\a ($ (**? 3 #f nonl)) #\b) "a(.{3,}?)b")
(test-sre (: #\a ($ (** 3 5 nonl)) #\b) "a(.{3,5})b")
(test-sre (: #\a ($ (**? 3 5 nonl)) #\b) "a(.{3,5}?)b")
(test-sre (: (look-behind (: #\a #\X #\b)) #\c #\d) "(?<=aXb)cd")
(test-sre (: (look-behind ($ nonl)) #\X) "(?<=(.))X")
(test-sre (+ (~ #\a)) "[^a]+")
(test-sre (: bos (= 2 (~ #\a))) "^[^a]{2}")
(test-sre (: bos (>= 2 (~ #\a))) "^[^a]{2,}")
(test-sre (: bos (**? 2 #f (~ #\a))) "^[^a]{2,}?")
(test-sre (+ (~ #\a)) "[^a]+")
(test-sre (: bos (= 2 (~ #\a))) "^[^a]{2}")
(test-sre (: bos (>= 2 (~ #\a))) "^[^a]{2,}")
(test-sre (: bos (**? 2 #f (~ #\a))) "^[^a]{2,}?")
(test-sre (* (~ numeric)) "\\D*")
(test-sre (~ numeric) "\\D")
(test-sre (: #\> (~ space)) ">\\S")
(test-sre numeric "\\d")
(test-sre space "\\s")
(test-sre (+ (~ numeric)) "\\D+")
(test-sre (** 2 3 (~ numeric)) "\\D{2,3}")
(test-sre (**? 2 3 (~ numeric)) "\\D{2,3}?")
(test-sre (+ numeric) "\\d+")
(test-sre (** 2 3 numeric) "\\d{2,3}")
(test-sre (**? 2 3 numeric) "\\d{2,3}?")
(test-sre (+ (~ space)) "\\S+")
(test-sre (** 2 3 (~ space)) "\\S{2,3}")
(test-sre (**? 2 3 (~ space)) "\\S{2,3}?")
(test-sre (: #\> (+ space) #\<) ">\\s+<")
(test-sre (: #\> (** 2 3 space) #\<) ">\\s{2,3}<")
(test-sre (: #\> (**? 2 3 space) #\<) ">\\s{2,3}?<")
(test-sre (+ (or alnum #\_)) "\\w+")
(test-sre (** 2 3 (or alnum #\_)) "\\w{2,3}")
(test-sre (**? 2 3 (or alnum #\_)) "\\w{2,3}?")
(test-sre (+ (~ (or alnum #\_))) "\\W+")
(test-sre (** 2 3 (~ (or alnum #\_))) "\\W{2,3}")
(test-sre (**? 2 3 (~ (or alnum #\_))) "\\W{2,3}?")
(test-sre (: bos (* (or #\a #\c)) #\b) "^[ac]*b")
(test-sre (: bos (* (~ #\x)) #\b) "^[^x]*b")
(test-sre (: bos (* numeric) #\b) "^\\d*b")
(test-sre ($ (or (:) #\a)) "(|a)")
(test-sre (: (~ space) (~ space)) "\\S\\S")
(test-sre (= 2 (~ space)) "\\S{2}")
(test-sre (: (~ (or alnum #\_)) (~ (or alnum #\_))) "\\W\\W")
(test-sre (= 2 (~ (or alnum #\_))) "\\W{2}")
(test-sre (~ space) "\\S")
(test-sre (~ numeric) "\\D")
(test-sre (~ (or alnum #\_)) "\\W")
(test-sre (: nonl (~ (or (~ space) #\newline)) nonl) ".[^\\S\n].")
(test-sre (: bos (*? (~ #\d)) eos) "^[^d]*?$")
(test-sre (* #\A) "A*")
(test-sre nonl ".")
(test-sre (: bos (* numeric) (= 4 (or alnum #\_))) "^\\d*\\w{4}")
(test-sre (: bos (* (~ #\b)) (= 4 (or alnum #\_))) "^[^b]*\\w{4}")
(test-sre (: bos nonl nwb nonl nwb nonl) "^.\\B.\\B.")
(test-sre (+ (~ numeric)) "\\D+")
(test-sre (: bos (+ (or alnum #\_))) "^\\w+")
(test-sre (: bos (+ numeric)) "^\\d+")
(test-sre (: bos #\> (+ space)) "^>\\s+")
(test-sre (: bos #\A (+ space) #\Z) "^A\\s+Z")
(test-sre (+ (or #\R #\S #\T)) "[RST]+")
(test-sre (+ (char-range #\R #\T)) "[R-T]+")
(test-sre (+ (char-range #\q #\u)) "[q-u]+")
(test-sre (: bos (? #\s) #\c) "^s?c")
(test-sre (char-range #\A #\`) "[A-`]")
(test-sre (+ (or alnum #\_)) "\\w+")
(test-sre (: (or bow eow) (**? 1 #f nonl) (or bow eow)) "\\b.+?\\b")
(test-sre (: #\c #\a #\f nwb (**? 1 #f nonl) nwb) "caf\\B.+?\\B")
(test-sre (: #\c #\3 #\space #\b #\1) "c3 b1")
(test-sre (: bos #\A (+ space) #\Z) "^A\\s+Z")
(test-sre (~ (or alnum #\_)) "\\W")
(test-sre (or alnum #\_) "\\w")
(test-sre (: #\X (** 2 4 #\a) #\b) "Xa{2,4}b")
(test-sre (: #\X (**? 2 4 #\a) #\b) "Xa{2,4}?b")
(test-sre (: #\X (+ (** 2 4 #\a)) #\b) "X(?:a{2,4})+b")
(test-sre (: #\X (** 2 4 numeric) #\b) "X\\d{2,4}b")
(test-sre (: #\X (**? 2 4 numeric) #\b) "X\\d{2,4}?b")
(test-sre (: #\X (+ (** 2 4 numeric)) #\b) "X(?:\\d{2,4})+b")
(test-sre (: #\X (** 2 4 (~ numeric)) #\b) "X\\D{2,4}b")
(test-sre (: #\X (**? 2 4 (~ numeric)) #\b) "X\\D{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (~ numeric))) #\b) "X(?:\\D{2,4})+b")
(test-sre (: #\X (** 2 4 (~ numeric)) #\b) "X\\D{2,4}b")
(test-sre (: #\X (**? 2 4 (~ numeric)) #\b) "X\\D{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (~ numeric))) #\b) "X(?:\\D{2,4})+b")
(test-sre (: #\X (** 2 4 (or #\a #\b #\c)) #\b) "X[abc]{2,4}b")
(test-sre (: #\X (**? 2 4 (or #\a #\b #\c)) #\b) "X[abc]{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (or #\a #\b #\c))) #\b) "X(?:[abc]{2,4})+b")
(test-sre (: #\X (** 2 4 (~ #\a)) #\b) "X[^a]{2,4}b")
(test-sre (: #\X (**? 2 4 (~ #\a)) #\b) "X[^a]{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (~ #\a))) #\b) "X(?:[^a]{2,4})+b")
(test-sre (: #\X (** 2 4 (~ #\a)) #\b) "X[^a]{2,4}b")
(test-sre (: #\X (**? 2 4 (~ #\a)) #\b) "X[^a]{2,4}?b")
(test-sre (: #\X (+ (** 2 4 (~ #\a))) #\b) "X(?:[^a]{2,4})+b")
(test-sre (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)) "\\bthe cat\\b")
(test-sre (: #\a #\b #\c (* #\d)) "abcd*")
(test-sre (: #\a #\b #\c (* numeric)) "abc\\d*")
(test-sre (: #\a #\b #\c (* (or #\d #\e))) "abc[de]*")
(test-sre (: #\X (= 3 (~ (or alnum #\_))) #\X) "X\\W{3}X")
(test-sre (: #\f (* nonl)) "f.*")
(test-sre (: (neg-look-behind bos) #\E #\T #\A) "(?<!^)ETA")
(test-sre (: (or bow eow) nonl nonl nonl nwb) "\\b...\\B")
(test-sre (: #\i (+ #\s) #\t) "is+t")
(test-sre (: #\i (**? 1 #f #\s) #\t) "is+?t")
(test-sre (: #\i (? #\s) #\t) "is?t")
(test-sre (: #\i (= 2 #\s) #\t) "is{2}t")
(test-sre (or (~ numeric) (~ numeric)) "[\\D\\D]")
(test-sre (~ (or (~ numeric) (~ numeric))) "[^\\D\\D]")
(test-sre (: ($ (or (:) #\@)) #\7) "(|@)7")
(test-sre (: #\A #\s #\k #\Z) "AskZ")
(test-sre (+ (or #\A #\s #\k #\Z)) "[AskZ]+")
(test-sre (+ (~ #\s)) "[^s]+")
(test-sre (+ (~ #\k)) "[^k]+")
(test-sre (+ (~ (or #\s #\k))) "[^sk]+")
(test-sre (: (or (-> A (: #\s #\s)) (-> A (: #\k #\k))) #\space (backref A)) "(?:(?<A>ss)|(?<A>kk)) \\k<A>")
(test-sre (: (or (-> A #\s) (-> A #\k)) #\space (>= 3 (backref A)) #\!) "(?:(?<A>s)|(?<A>k)) \\k<A>{3,}!")
(test-sre #\i "i")
(test-sre #\I "I")
(test-sre #\i "i")
(test-sre (~ #\i) "[^i]")
(test-sre (or #\z #\i) "[zi]")
(test-sre (or #\i #\I) "[iI]")
(test-sre (+ numeric) "\\d+")
(test-sre (: #\> (+ space) #\<) ">\\s+<")
(test-sre (+ (or alnum #\_)) "\\w+")
(test-sre (: (or bow eow) #\A #\B #\C (or bow eow)) "\\bABC\\b")
(test-sre (neg-look-behind ($ (or (:) (: #\l #\space)))) "(?<!(|l ))")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: #\a (* #\b) #\c) "ab*c")
(test-sre (: #\a (+ #\b) #\c) "ab+c")
(test-sre ($ (or #\a (: #\a #\b #\c #\d) (: #\a #\f #\r #\i #\c #\a #\n))) "(a|abcd|african)")
(test-sre (: bos #\a #\b #\c) "^abc")
(test-sre (: #\x numeric #\y (~ numeric) #\z) "x\\dy\\Dz")
(test-sre (: #\x space #\y (~ space) #\z) "x\\sy\\Sz")
(test-sre (: #\x (or alnum #\_) #\y (~ (or alnum #\_)) #\z) "x\\wy\\Wz")
(test-sre (: #\x nonl #\y) "x.y")
(test-sre (: #\a numeric eos) "a\\d$")
(test-sre (~ #\a) "[^a]")
(test-sre (: #\a (? #\b) (or alnum #\_)) "ab?\\w")
(test-sre (: (** 0 3 #\x) #\y #\z) "x{0,3}yz")
(test-sre (: (= 3 #\x) #\y #\z) "x{3}yz")
(test-sre (: (** 2 3 #\x) #\y #\z) "x{2,3}yz")
(test-sre (* numeric) "\\d*")
(test-sre (* (~ numeric)) "\\D*")
(test-sre (+ numeric) "\\d+")
(test-sre (+ (~ numeric)) "\\D+")
(test-sre (: (? numeric) #\A) "\\d?A")
(test-sre (: (? (~ numeric)) #\A) "\\D?A")
(test-sre (+ #\a) "a+")
(test-sre (: bos (* nonl) #\x #\y #\z) "^.*xyz")
(test-sre (: bos (+ nonl) #\x #\y #\z) "^.+xyz")
(test-sre (: bos (? nonl) #\x #\y #\z) "^.?xyz")
(test-sre (: bos (** 2 3 numeric) #\X) "^\\d{2,3}X")
(test-sre (: bos (or #\a #\b #\c #\d) numeric) "^[abcd]\\d")
(test-sre (: bos (* (or #\a #\b #\c #\d)) numeric) "^[abcd]*\\d")
(test-sre (: bos (+ (or #\a #\b #\c #\d)) numeric) "^[abcd]+\\d")
(test-sre (: bos (+ #\a) #\X) "^a+X")
(test-sre (: bos (? (or #\a #\b #\c #\d)) numeric) "^[abcd]?\\d")
(test-sre (: bos (** 2 3 (or #\a #\b #\c #\d)) numeric) "^[abcd]{2,3}\\d")
(test-sre (: bos (* ($ (: #\a #\b #\c))) numeric) "^(abc)*\\d")
(test-sre (: bos (+ ($ (: #\a #\b #\c))) numeric) "^(abc)+\\d")
(test-sre (: bos (? ($ (: #\a #\b #\c))) numeric) "^(abc)?\\d")
(test-sre (: bos (** 2 3 ($ (: #\a #\b #\c))) numeric) "^(abc){2,3}\\d")
(test-sre (: bos ($ (or (: (* #\a) (or alnum #\_)) (: #\a #\b))) #\= ($ (or (: (* #\a) (or alnum #\_)) (: #\a #\b)))) "^(a*\\w|ab)=(a*\\w|ab)")
(test-sre (: bos (look-ahead (: #\a #\b #\c)) (= 5 (or alnum #\_)) #\: eos) "^(?=abc)\\w{5}:$")
(test-sre (: bos (neg-look-ahead (: #\a #\b #\c)) numeric numeric eos) "^(?!abc)\\d\\d$")
(test-sre (: (look-behind (or (: #\a #\b #\c) (: #\x #\y))) #\1 #\2 #\3) "(?<=abc|xy)123")
(test-sre (: (neg-look-behind (or (: #\a #\b #\c) (: #\x #\y))) #\1 #\2 #\3) "(?<!abc|xy)123")
(test-sre (: bos #\a #\b #\c) "^abc")
(test-sre (: bos ($ (or (* #\a) (: #\x #\y #\z)))) "^(a*|xyz)")
(test-sre (: #\x #\y #\z eos) "xyz$")
(test-sre (: bos #\a #\b #\c #\d #\e #\f) "^abcdef")
(test-sre (: bos (** 2 4 #\a) (+ numeric) #\z) "^a{2,4}\\d+z")
(test-sre (: bos #\a #\b #\c #\d #\e #\f) "^abcdef")
(test-sre (: (look-behind (: #\f #\o #\o)) #\b #\a #\r) "(?<=foo)bar")
(test-sre (: (+ ($ (: #\a (* #\b) ($ (or (: #\c #\d) (: #\e #\f)))))) #\X) "(ab*(cd|ef))+X")
(test-sre (: #\t #\h #\e #\space #\q #\u #\i #\c #\k #\space #\b #\r #\o #\w #\n #\space #\f #\o #\x) "the quick brown fox")
(test-sre (: (* #\a) #\a #\b (? #\c) #\x #\y (+ #\z) #\p #\q (= 3 #\r) #\a (>= 2 #\b) #\x (** 4 5 #\y) #\p (** 0 6 #\q) #\A (>= 0 #\B) #\z #\z) "a*abc?xyz+pqr{3}ab{2,}xy{4,5}pq{0,6}AB*zz")
(test-sre (: bos (** 1 2 ($ (: #\a #\b #\c))) #\z #\z) "^(abc){1,2}zz")
(test-sre (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c) "^(b+?|a){1,2}?c")
(test-sre (: bos (** 1 2 ($ (or (+ #\b) #\a))) #\c) "^(b+|a){1,2}c")
(test-sre (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\b #\c) "^(b+|a){1,2}?bc")
(test-sre (: bos (**? 1 2 ($ (or (* #\b) (: #\b #\a)))) #\b #\c) "^(b*|ba){1,2}?bc")
(test-sre (: bos (**? 1 2 ($ (or (: #\b #\a) (* #\b)))) #\b #\c) "^(ba|b*){1,2}?bc")
(test-sre (: bos (or #\a #\b #\] #\c #\d #\e)) "^[ab\\]cde]")
(test-sre (: bos (or #\] #\c #\d #\e)) "^[\\]cde]")
(test-sre (: bos (~ (or #\a #\b #\] #\c #\d #\e))) "^[^ab\\]cde]")
(test-sre (: bos (~ (or #\] #\c #\d #\e))) "^[^\\]cde]")
(test-sre (: bos #\@) "^@")
(test-sre (: bos (+ (char-range #\0 #\9)) eos) "^[0-9]+$")
(test-sre (: bos (* nonl) #\n #\t #\e #\r) "^.*nter")
(test-sre (: bos #\x #\x #\x (+ (char-range #\0 #\9)) eos) "^xxx[0-9]+$")
(test-sre (: bos (+ nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos) "^.+[0-9][0-9][0-9]$")
(test-sre (: bos (**? 1 #f nonl) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) eos) "^.+?[0-9][0-9][0-9]$")
(test-sre (: bos ($ (+ (~ #\!))) #\! ($ (+ nonl)) #\= #\a #\p #\q #\u #\x #\z #\. #\i #\x #\r #\. #\z #\z #\z #\. #\a #\c #\. #\u #\k eos) "^([^!]+)!(.+)=apquxz\\.ixr\\.zzz\\.ac\\.uk$")
(test-sre #\: ":")
(test-sre (: bos (* nonl) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) #\. ($ (** 1 3 numeric)) eos) "^.*\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$")
(test-sre (: bos ($ (+ numeric)) (+ space) #\I #\N (+ space) #\S #\O #\A (+ space) ($ (+ (~ space))) (+ space) ($ (+ (~ space))) (* space) #\( (* space) eos) "^(\\d+)\\s+IN\\s+SOA\\s+(\\S+)\\s+(\\S+)\\s*\\(\\s*$")
(test-sre (: bos (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-)) (* ($ (: #\. (or (char-range #\a #\z) (char-range #\A #\Z) numeric) (* (or (char-range #\a #\z) (char-range #\A #\Z) numeric #\-))))) #\. eos) "^[a-zA-Z\\d][a-zA-Z\\d\\-]*(\\.[a-zA-Z\\d][a-zA-Z\\d\\-]*)*\\.$")
(test-sre (: bos #\* #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric))))) (* ($ (: #\. (char-range #\a #\z) (? ($ (: (* (or (char-range #\a #\z) #\- numeric)) (+ (or (char-range #\a #\z) numeric)))))))) eos) "^\\*\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?(\\.[a-z]([a-z\\-\\d]*[a-z\\d]+)?)*$")
(test-sre (: bos (look-ahead (: #\a #\b ($ (: #\d #\e)))) ($ (: #\a #\b #\d)) ($ #\e)) "^(?=ab(de))(abd)(e)")
(test-sre (: bos (neg-look-ahead (or (: ($ (: #\a #\b)) #\d #\e) #\x)) ($ (: #\a #\b #\d)) ($ #\f)) "^(?!(ab)de|x)(abd)(f)")
(test-sre (: bos (look-ahead ($ (: #\a #\b ($ (: #\c #\d))))) ($ (: #\a #\b))) "^(?=(ab(cd)))(ab)")
(test-sre (: bos eos) "^$")
(test-sre (: bos #\a #\space #\b (or #\c #\space) #\d eos) "^a b[c ]d$")
(test-sre (: bos ($ (: #\a ($ (: #\b ($ #\c))))) ($ (: #\d ($ (: #\e ($ #\f))))) ($ (: #\h ($ (: #\i ($ #\j))))) ($ (: #\k ($ (: #\l ($ #\m))))) eos) "^(a(b(c)))(d(e(f)))(h(i(j)))(k(l(m)))$")
(test-sre (: bos (: #\a ($ (: #\b ($ #\c)))) (: #\d ($ (: #\e ($ #\f)))) (: #\h ($ (: #\i ($ #\j)))) (: #\k ($ (: #\l ($ #\m)))) eos) "^a(b(c))d(e(f))h(i(j))k(l(m))$")
(test-sre (: bos (+ (or #\. #\^ #\$ #\| #\( #\) #\* #\+ #\? #\{ #\, #\}))) "^[.\\^$|()*+?{,}]+")
(test-sre (: bos (* #\a) (or alnum #\_)) "^a*\\w")
(test-sre (: bos (*? #\a) (or alnum #\_)) "^a*?\\w")
(test-sre (: bos (+ #\a) (or alnum #\_)) "^a+\\w")
(test-sre (: bos (**? 1 #f #\a) (or alnum #\_)) "^a+?\\w")
(test-sre (: bos (= 8 numeric) (>= 2 (or alnum #\_))) "^\\d{8}\\w{2,}")
(test-sre (: bos (** 4 5 (or #\a #\e #\i #\o #\u numeric)) eos) "^[aeiou\\d]{4,5}$")
(test-sre (: bos (**? 4 5 (or #\a #\e #\i #\o #\u numeric))) "^[aeiou\\d]{4,5}?")
(test-sre (: bos #\1 #\2 nonl #\3 #\4) "^12.34")
(test-sre (: #\f #\o #\o (neg-look-ahead (: #\b #\a #\r)) ($ (* nonl))) "foo(?!bar)(.*)")
(test-sre (: (or (: (neg-look-ahead (: #\f #\o #\o)) nonl nonl nonl) (: bos (** 0 2 nonl))) #\b #\a #\r ($ (* nonl))) "(?:(?!foo)...|^.{0,2})bar(.*)")
(test-sre (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))) "^(\\D*)(?=\\d)(?!123)")
(test-sre (: (neg-look-ahead bos) #\a #\b #\c) "{!<s}abc")
(test-sre (: (look-ahead bos) #\a #\b #\c) "(?=^)abc")
(test-sre (: #\a (** 1 3 #\b) #\b #\c) "ab{1,3}bc")
(test-sre (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* nonl))) "([^.]*)\\.([^:]*):[T ]+(.*)")
(test-sre (: bos (+ (char-range #\W #\c)) eos) "^[W-c]+$")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: bos #\a #\b #\c (: (? #\newline) eos)) "^abc\\Z")
(test-sre (: bos (* ($ nonl)) (: (? #\newline) eos)) "^(.)*\\Z")
(test-sre (or #\b (+ #\:)) "b|:+")
(test-sre (+ (or #\- #\a #\z)) "[\\-az]+")
(test-sre (+ (or #\a #\z #\-)) "[az\\-]+")
(test-sre (+ (or #\a #\- #\z)) "[a\\-z]+")
(test-sre (+ (char-range #\a #\z)) "[a-z]+")
(test-sre (+ (or numeric #\-)) "[\\d\\-]+")
(test-sre (: #\a #\b #\c eos) "abc$")
(test-sre (: (= 0 #\a) #\b #\c) "a{0}bc")
(test-sre (: (**? 0 0 ($ (or #\a ($ (: #\b #\c))))) #\x #\y #\z) "(a|(bc)){0}?xyz")
(test-sre (~ #\a) "[^a]")
(test-sre (+ (~ #\a)) "[^a]+")
(test-sre (: (~ #\k) eos) "[^k]$")
(test-sre (: (** 2 3 (~ #\k)) eos) "[^k]{2,3}$")
(test-sre (: bos (>= 8 numeric) #\@ (+ nonl) (~ #\k) eos) "^\\d{8,}@.+[^k]$")
(test-sre (~ #\a) "[^a]")
(test-sre (~ (or #\a #\z)) "[^az]")
(test-sre (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 6 (~ #\*)) #\L #\L) "P[^*]TAIRE[^*]{1,6}?LL")
(test-sre (: #\P (~ #\*) #\T #\A #\I #\R #\E (**? 1 #f (~ #\*)) #\L #\L) "P[^*]TAIRE[^*]+?LL")
(test-sre (: ($ (: #\. numeric numeric (? (char-range #\1 #\9)))) (+ numeric)) "(\\.\\d\\d[1-9]?)\\d+")
(test-sre ($ (: #\. numeric numeric ($ (or (look-ahead #\0) (: numeric (look-ahead numeric)))))) "(\\.\\d\\d((?=0)|\\d(?=\\d)))")
(test-sre (: #\f #\o #\o ($ (* nonl)) #\b #\a #\r) "foo(.*)bar")
(test-sre (: #\f #\o #\o ($ (*? nonl)) #\b #\a #\r) "foo(.*?)bar")
(test-sre (: ($ (* nonl)) ($ (+ numeric))) "(.*)(\\d+)")
(test-sre (: ($ (*? nonl)) ($ (+ numeric))) "(.*?)(\\d+)")
(test-sre (: ($ (* nonl)) ($ (+ numeric)) eos) "(.*)(\\d+)$")
(test-sre (: ($ (*? nonl)) ($ (+ numeric)) eos) "(.*?)(\\d+)$")
(test-sre (: ($ (* nonl)) (or bow eow) ($ (+ numeric)) eos) "(.*)\\b(\\d+)$")
(test-sre (: ($ (: (* nonl) (~ numeric))) ($ (+ numeric)) eos) "(.*\\D)(\\d+)$")
(test-sre (: bos (* (~ numeric)) (neg-look-ahead (: #\1 #\2 #\3))) "^\\D*(?!123)")
(test-sre (: bos ($ (* (~ numeric))) (look-ahead numeric) (neg-look-ahead (: #\1 #\2 #\3))) "^(\\D*)(?=\\d)(?!123)")
(test-sre (: bos (or (char-range #\W #\]) #\4 #\6)) "^[W-\\]46]")
(test-sre (: #\w #\o #\r #\d #\space (** 0 10 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d) "word (?:[a-zA-Z0-9]+ ){0,10}otherword")
(test-sre (: #\w #\o #\r #\d #\space (** 0 300 (: (+ (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9))) #\space)) #\o #\t #\h #\e #\r #\w #\o #\r #\d) "word (?:[a-zA-Z0-9]+ ){0,300}otherword")
(test-sre (: bos (= 0 ($ #\a))) "^(a){0}")
(test-sre (: bos (** 0 1 ($ #\a))) "^(a)?")
(test-sre (: bos (** 0 2 ($ #\a))) "^(a){0,2}")
(test-sre (: bos (** 0 3 ($ #\a))) "^(a){0,3}")
(test-sre (: bos (>= 0 ($ #\a))) "^(a)*")
(test-sre (: bos (= 1 ($ #\a))) "^(a)")
(test-sre (: bos (** 1 2 ($ #\a))) "^(a){1,2}")
(test-sre (: bos (** 1 3 ($ #\a))) "^(a){1,3}")
(test-sre (: bos (>= 1 ($ #\a))) "^(a)+")
(test-sre (: (* nonl) #\. #\g #\i #\f) ".*\\.gif")
(test-sre (: (>= 0 nonl) #\. #\g #\i #\f) ".*\\.gif")
(test-sre (: (* nonl) eos) ".*$")
(test-sre ($ (or (: (* nonl) #\X) (: bos #\B))) "(.*X|^B)")
(test-sre (: bos (* nonl) #\B) "^.*B")
(test-sre (: bol (* nonl) #\B) "{<l}.*B")
(test-sre (: bos (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9) (char-range #\0 #\9)) "^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]")
(test-sre (: bos numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric numeric) "^\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d\\d")
(test-sre (: bos (= 12 (or #\a #\b #\c))) "^[abc]{12}")
(test-sre (: bos (= 12 (char-range #\a #\c))) "^[a-c]{12}")
(test-sre (: bos (= 12 ($ (or #\a #\b #\c)))) "^([abc]){12}")
(test-sre (: bos (or #\a #\b #\c #\d #\e #\f #\g #\h #\i #\j #\k #\l #\m #\n #\o #\p #\q #\r #\s #\t #\u #\v #\w #\x #\y #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9)) "^[abcdefghijklmnopqrstuvwxy0123456789]")
(test-sre (: #\a #\b #\c #\d (= 0 #\e)) "abcde{0}")
(test-sre (: #\a #\b (= 0 (or #\c #\d)) #\e) "ab[cd]{0}e")
(test-sre (: #\a #\b (= 0 ($ #\c)) #\d) "ab(c){0}d")
(test-sre (: #\a ($ (* #\b))) "a(b*)")
(test-sre (: #\a #\b (= 0 numeric) #\e) "ab\\d{0}e")
(test-sre (: #\" (* ($ (or (+ (~ (or #\\ #\"))) (: #\\ nonl)))) #\") "\"([^\\\\\"]+|\\\\.)*\"")
(test-sre (*? nonl) ".*?")
(test-sre (or bow eow) "\\b")
(test-sre (: #\a (~ #\a) #\b) "a[^a]b")
(test-sre (: #\a nonl #\b) "a.b")
(test-sre (: #\a (~ #\a) #\b) "a[^a]b")
(test-sre (: #\a nonl #\b) "a.b")
(test-sre (: bos (**? 1 2 ($ (or (**? 1 #f #\b) #\a))) #\c) "^(b+?|a){1,2}?c")
(test-sre (: bos (**? 1 2 ($ (or (+ #\b) #\a))) #\c) "^(b+|a){1,2}?c")
(test-sre (: (neg-look-ahead bos) #\x) "{!<s}x")
(test-sre (: (* ($ (or #\A #\B))) #\C #\D) "([AB])*CD")
(test-sre (: (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o) "(?<!bar)foo")
(test-sre (: (= 3 (or alnum #\_)) (neg-look-behind (: #\b #\a #\r)) #\f #\o #\o) "\\w{3}(?<!bar)foo")
(test-sre (: (look-behind (: ($ (: #\f #\o #\o)) #\a)) #\b #\a #\r) "(?<=(foo)a)bar")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: ($ (+ numeric)) ($ (or alnum #\_))) "(\\d+)(\\w)")
(test-sre (: (* ($ (or (+ #\a) (+ #\b) (+ #\c)))) #\c) "(a+|b+|c+)*c")
(test-sre (* ($ (*? #\a))) "(a*?)*")
(test-sre (* ($ (*? (or #\a #\b)))) "([ab]*?)*")
(test-sre (* ($ (*? (~ #\a)))) "([^a]*?)*")
(test-sre (* ($ (*? (~ (or #\a #\b))))) "([^ab]*?)*")
(test-sre (: (look-behind (: (neg-look-behind (: #\f #\o #\o)) #\b #\a #\r)) #\b #\a #\z) "(?<=(?<!foo)bar)baz")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: #\a (* #\b) #\c) "ab*c")
(test-sre (: #\a (* #\b) #\b #\c) "ab*bc")
(test-sre (= 1 nonl) ".")
(test-sre (** 3 4 nonl) ".{3,4}")
(test-sre (: #\a (>= 0 #\b) #\b #\c) "ab*bc")
(test-sre (: #\a (+ #\b) #\b #\c) "ab+bc")
(test-sre (: #\a (>= 1 #\b) #\b #\c) "ab+bc")
(test-sre (: #\a (** 1 3 #\b) #\b #\c) "ab{1,3}bc")
(test-sre (: #\a (** 3 4 #\b) #\b #\c) "ab{3,4}bc")
(test-sre (: #\a (** 4 5 #\b) #\b #\c) "ab{4,5}bc")
(test-sre (: #\a (? #\b) #\b #\c) "ab?bc")
(test-sre (: #\a (** 0 1 #\b) #\b #\c) "ab?bc")
(test-sre (: #\a (? #\b) #\b #\c) "ab?bc")
(test-sre (: #\a (? #\b) #\c) "ab?c")
(test-sre (: #\a (** 0 1 #\b) #\c) "ab?c")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: bos #\a #\b #\c) "^abc")
(test-sre (: bos #\a #\b #\c eos) "^abc$")
(test-sre (: #\a #\b #\c eos) "abc$")
(test-sre bos "^")
(test-sre eos "$")
(test-sre (: #\a nonl #\c) "a.c")
(test-sre (: #\a (* nonl) #\c) "a.*c")
(test-sre (: #\a (or #\b #\c) #\d) "a[bc]d")
(test-sre (: #\a (char-range #\b #\d) #\e) "a[b-d]e")
(test-sre (: #\a (char-range #\b #\d)) "a[b-d]")
(test-sre (: #\a (or #\- #\b)) "a[\\-b]")
(test-sre (: #\a (or #\b #\-)) "a[b\\-]")
(test-sre (: #\a #\] #\b) "a\\]b")
(test-sre (: #\a (~ (or #\b #\c)) #\d) "a[^bc]d")
(test-sre (: #\a (~ (or #\- #\b)) #\c) "a[^\\-b]c")
(test-sre (: #\a (~ (or #\] #\b)) #\c) "a[^\\]b]c")
(test-sre (: (or bow eow) #\a (or bow eow)) "\\ba\\b")
(test-sre (: (or bow eow) #\y (or bow eow)) "\\by\\b")
(test-sre (: nwb #\a nwb) "\\Ba\\B")
(test-sre (: nwb #\y (or bow eow)) "\\By\\b")
(test-sre (: (or bow eow) #\y nwb) "\\by\\B")
(test-sre (: nwb #\y nwb) "\\By\\B")
(test-sre (or alnum #\_) "\\w")
(test-sre (~ (or alnum #\_)) "\\W")
(test-sre (: #\a space #\b) "a\\sb")
(test-sre (: #\a (~ space) #\b) "a\\Sb")
(test-sre numeric "\\d")
(test-sre (~ numeric) "\\D")
(test-sre (or (: #\a #\b) (: #\c #\d)) "ab|cd")
(test-sre (: ($ (:)) #\e #\f) "()ef")
(test-sre (: eos #\b) "$b")
(test-sre (: #\a #\( #\b) "a\\(b")
(test-sre (: #\a (* #\() #\b) "a\\(*b")
(test-sre (: #\a #\\ #\b) "a\\\\b")
(test-sre ($ ($ #\a)) "((a))")
(test-sre (: ($ #\a) #\b ($ #\c)) "(a)b(c)")
(test-sre (: (+ #\a) (+ #\b) #\c) "a+b+c")
(test-sre (: (>= 1 #\a) (>= 1 #\b) #\c) "a+b+c")
(test-sre (: #\a (**? 1 #f nonl) #\c) "a.+?c")
(test-sre (* ($ (or (+ #\a) #\b))) "(a+|b)*")
(test-sre (>= 0 ($ (or (+ #\a) #\b))) "(a+|b)*")
(test-sre (+ ($ (or (+ #\a) #\b))) "(a+|b)+")
(test-sre (>= 1 ($ (or (+ #\a) #\b))) "(a+|b)+")
(test-sre (? ($ (or (+ #\a) #\b))) "(a+|b)?")
(test-sre (** 0 1 ($ (or (+ #\a) #\b))) "(a+|b)?")
(test-sre (* (~ (or #\a #\b))) "[^ab]*")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (* #\a) "a*")
(test-sre (: (* ($ (or #\a #\b #\c))) #\d) "([abc])*d")
(test-sre (: (* ($ (or #\a #\b #\c))) #\b #\c #\d) "([abc])*bcd")
(test-sre (or #\a #\b #\c #\d #\e) "[abcde]")
(test-sre (: ($ (or #\a #\b #\c #\d #\e)) #\f) "([abcde])f")
(test-sre (: #\a #\b #\c (* #\d) #\e #\f #\g) "abcd*efg")
(test-sre (: #\a (* #\b)) "ab*")
(test-sre (: ($ (or (: #\a #\b) (: #\c #\d))) #\e) "(ab|cd)e")
(test-sre (: (or #\a #\b #\h #\g #\e #\f #\d #\c) #\i #\j) "[abhgefdc]ij")
(test-sre (: bos ($ (or (: #\a #\b) (: #\c #\d))) #\e) "^(ab|cd)e")
(test-sre (: ($ (or (: #\a #\b #\c) (:))) #\e #\f) "(abc|)ef")
(test-sre (: ($ (or #\a #\b)) (* #\c) #\d) "([ab])c*d")
(test-sre (: ($ (or (: #\a #\b) (: #\a (* #\b)))) #\b #\c) "(ab|ab*)bc")
(test-sre (: #\a ($ (* (or #\b #\c))) (* #\c)) "a([bc]*)c*")
(test-sre (: #\a ($ (* (or #\b #\c))) ($ (: (* #\c) #\d))) "a([bc]*)(c*d)")
(test-sre (: #\a ($ (+ (or #\b #\c))) ($ (: (* #\c) #\d))) "a([bc]+)(c*d)")
(test-sre (: #\a ($ (* (or #\b #\c))) ($ (: (+ #\c) #\d))) "a([bc]*)(c+d)")
(test-sre (: #\a (* (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e) "a[bcd]*dcdcde")
(test-sre (: #\a (+ (or #\b #\c #\d)) #\d #\c #\d #\c #\d #\e) "a[bcd]+dcdcde")
(test-sre (: ($ (or (: #\a #\b) #\a)) (* #\b) #\c) "(ab|a)b*c")
(test-sre (: ($ (: ($ #\a) ($ #\b) #\c)) ($ #\d)) "((a)(b)c)(d)")
(test-sre (: (or (char-range #\a #\z) (char-range #\A #\Z) #\_) (* (or (char-range #\a #\z) (char-range #\A #\Z) (char-range #\0 #\9) #\_))) "[a-zA-Z_][a-zA-Z0-9_]*")
(test-sre (or (: bos #\a ($ (or (: #\b (+ #\c)) (: #\b (or #\e #\h)))) #\g) (: nonl #\h eos)) "^a(bc+|b[eh])g|.h$")
(test-sre ($ (or (: #\b (+ #\c) #\d eos) (: #\e (* #\f) #\g nonl) (: (? #\h) #\i ($ (or #\j #\k))))) "(bc+d$|ef*g.|h?i([jk]))")
(test-sre ($ ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a)))))))))) "((((((((((a))))))))))")
(test-sre ($ ($ ($ ($ ($ ($ ($ ($ ($ #\a))))))))) "(((((((((a)))))))))")
(test-sre (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s #\space #\o #\f #\space #\t #\e #\x #\t) "multiple words of text")
(test-sre (: #\m #\u #\l #\t #\i #\p #\l #\e #\space #\w #\o #\r #\d #\s) "multiple words")
(test-sre (: ($ (* nonl)) #\c ($ (* nonl))) "(.*)c(.*)")
(test-sre (: #\( ($ (* nonl)) #\, #\space ($ (* nonl)) #\)) "\\((.*), (.*)\\)")
(test-sre #\k "k")
(test-sre (: #\a #\b #\c #\d) "abcd")
(test-sre (: #\a ($ (: #\b #\c)) #\d) "a(bc)d")
(test-sre (: #\a (? #\-) #\c) "a-?c")
(test-sre (: #\a (neg-look-ahead #\b) nonl) "a(?!b).")
(test-sre (: #\a (look-ahead #\d) nonl) "a(?=d).")
(test-sre (: #\a (look-ahead (or #\c #\d)) nonl) "a(?=[cd]).")
(test-sre (: #\a (or #\b #\c #\d) ($ nonl)) "a[bcd](.)")
(test-sre (: #\a (* (or #\b #\c #\d)) ($ nonl)) "a[bcd]*(.)")
(test-sre (: #\a (**? 1 #f (or #\b #\c #\d)) ($ nonl)) "a[bcd]+?(.)")
(test-sre (: #\a (+ (or #\b #\c #\d)) ($ nonl)) "a[bcd]+(.)")
(test-sre (: #\a (= 2 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{2}(.)")
(test-sre (: #\a (** 4 5 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{4,5}(.)")
(test-sre (: #\a (**? 4 5 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{4,5}?(.)")
(test-sre (* ($ (or ($ (: #\f #\o #\o)) ($ (: #\b #\a #\r))))) "((foo)|(bar))*")
(test-sre (: #\a (** 6 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{6,7}(.)")
(test-sre (: #\a (**? 6 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{6,7}?(.)")
(test-sre (: #\a (** 5 6 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,6}(.)")
(test-sre (: #\a (**? 5 6 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,6}?(.)")
(test-sre (: #\a (** 5 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,7}(.)")
(test-sre (: #\a (**? 5 7 (or #\b #\c #\d)) ($ nonl)) "a[bcd]{5,7}?(.)")
(test-sre (: #\a (**? 1 #f (or #\b (**? 1 2 ($ (or #\c #\e))) #\d)) ($ nonl)) "a(?:b|([ce]){1,2}?|d)+?(.)")
(test-sre (: bos (? ($ (+ nonl))) #\B) "^(.+)?B")
(test-sre (or (: bos ($ (~ (char-range #\a #\z)))) (: ($ #\^) eos)) "^([^a-z])|(\\^)$")
(test-sre (: bos (or #\< #\>) #\&) "^[<>]&")
(test-sre (* (or (: ($ #\f) ($ #\o) ($ #\o)) (: ($ #\b) ($ #\a) ($ #\r)))) "(?:(f)(o)(o)|(b)(a)(r))*")
(test-sre (: (look-behind #\a) #\b) "(?<=a)b")
(test-sre (: (neg-look-behind #\c) #\b) "(?<!c)b")
(test-sre (: (* (: nonl nonl)) #\a) "(?:..)*a")
(test-sre (: (*? (: nonl nonl)) #\a) "(?:..)*?a")
(test-sre (: bos (** 3 5 ($ (:)))) "^(){3,5}")
(test-sre (: (* ($ (or #\a #\x))) #\a #\b) "([ax])*ab")
(test-sre (: (* ($ #\a)) #\a #\b) "(a)*ab")
(test-sre (: (or #\c #\d) (:) (: #\a (:) #\b (: #\b (:)) (: #\b (:) #\b))) "[cd]abbbb")
(test-sre (: (or #\c #\d) (:) (: #\a #\a #\a #\a #\a #\a #\a #\a (:) (: #\b #\b #\b #\b #\b #\b #\b #\b) (: #\b #\b #\b #\b #\b #\b #\b #\b (:)) (: #\b #\b #\b #\b #\b #\b #\b #\b (:) (: #\b #\b #\b #\b #\b #\b #\b #\b)))) "[cd]aaaaaaaabbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb")
(test-sre (: #\f #\o #\o (* (or alnum #\_)) (= 4 numeric) #\b #\a #\z) "foo\\w*\\d{4}baz")
(test-sre (: #\x (* ($ (: #\~ #\~))) (?? #\F)) "x(~~)*F??")
(test-sre (: #\x (* ($ (: #\~ #\~))) (? (? #\F))) "x(~~)*(?:F?)?")
(test-sre (: (neg-look-behind (or #\c #\d)) #\b) "(?<![cd])b")
(test-sre (: (neg-look-behind (or #\c #\d)) (or #\a #\b)) "(?<![cd])[ab]")
(test-sre (: (neg-look-behind ($ (or #\c #\d))) #\b) "(?<!([cd]))b")
(test-sre (: (neg-look-behind ($ (or #\c #\d))) (or #\a #\b)) "(?<!([cd]))[ab]")
(test-sre (: (neg-look-behind (: #\c #\d)) (or #\a #\b)) "(?<!cd)[ab]")
(test-sre (: bol #\b) "{<l}b")
(test-sre (: bol ($ #\b)) "{<l}(b)")
(test-sre (: bos #\b) "^b")
(test-sre (: ($ (:)) bos #\b) "()^b")
(test-sre (+ ($ (: (+ (or alnum #\_)) #\:))) "(\\w+:)+")
(test-sre (: eos (look-behind (: bos ($ #\a)))) "$(?<=^(a))")
(test-sre (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))) "^[^bcd]*(c+)")
(test-sre (: ($ (* #\a)) (+ #\b)) "(a*)b+")
(test-sre (: (? ($ (: (+ (or (or alnum #\_) #\:))) #\: #\:)) ($ (+ (or alnum #\_))) eos) "([\\w:]+::)?(\\w+)$")
(test-sre (: bos (* (~ (or #\b #\c #\d))) ($ (+ #\c))) "^[^bcd]*(c+)")
(test-sre (: ($ (: #\> (+ #\a))) #\a #\b) "(>a+)ab")
(test-sre (: #\a eos) "a$")
(test-sre (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)))) #\f #\o #\o) "(?<=\\d{3}(?!999))foo")
(test-sre (: (look-behind (: (neg-look-ahead (: nonl nonl nonl #\9 #\9 #\9)) (= 3 numeric))) #\f #\o #\o) "(?<=(?!...999)\\d{3})foo")
(test-sre (: (look-behind (: (= 3 numeric) (neg-look-ahead (: #\9 #\9 #\9)) nonl nonl nonl)) #\f #\o #\o) "(?<=\\d{3}(?!999)...)foo")
(test-sre (: (look-behind (: (= 3 numeric) nonl nonl nonl)) (neg-look-behind (: #\9 #\9 #\9)) #\f #\o #\o) "(?<=\\d{3}...)(?<!999)foo")
(test-sre (* ($ (or (+ ($ #\Z)) #\A))) "((Z)+|A)*")
(test-sre (* ($ (or (: #\Z ($ (:))) #\A))) "(Z()|A)*")
(test-sre (* ($ (or (: #\Z ($ ($ (:)))) #\A))) "(Z(())|A)*")
(test-sre (* #\a) "a*")
(test-sre (+ space) "\\s+")
(test-sre (: (neg-look-ahead bos) #\x) "{!<s}x")
(test-sre (: #\a #\b #\c nonl) "abc.")
(test-sre (: #\a (: #\b #\c) #\d) "abcd")
(test-sre (: (look-behind #\Z) #\X nonl) "(?<=Z)X.")
(test-sre (: (look-behind (or #\a (: #\b #\b #\b #\b))) #\c) "(?<=a|bbbb)c")
(test-sre (: #\1 #\2 #\3 #\4) "1234")
(test-sre bos "^")
(test-sre (: (look-behind (: #\C #\newline)) bos) "(?<=C\n)^")
(test-sre (: (? #\A) #\B) "A?B")
(test-sre (: (* #\A) #\B) "A*B")
(test-sre (: (+ (or alnum #\_)) ($ nonl) (? ($ nonl)) #\d #\e #\f) "\\w+(.)(.)?def")
(test-sre (: (+ nonl) #\f #\o #\o) ".+foo")
(test-sre (: bos #\X) "^X")
(test-sre (or (: #\a (neg-look-ahead (:))) (: (or alnum #\_) #\b #\c)) "a(?!)|\\wbc")
(test-sre (: #\X eos) "X$")
(test-sre (or (: (+ numeric) #\X) (: (+ #\9) #\Y)) "\\d+X|9+Y")
(test-sre (: #\Z (neg-look-ahead (:))) "Z(?!)")
(test-sre (: #\d #\o #\g (? ($ (: #\s #\b #\o #\d #\y)))) "dog(sbody)?")
(test-sre (: #\d #\o #\g (?? ($ (: #\s #\b #\o #\d #\y)))) "dog(sbody)??")
(test-sre (or (: #\d #\o #\g) (: #\d #\o #\g #\s #\b #\o #\d #\y)) "dog|dogsbody")
(test-sre (or (: #\d #\o #\g #\s #\b #\o #\d #\y) (: #\d #\o #\g)) "dogsbody|dog")
(test-sre (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)) "\\bthe cat\\b")
(test-sre (: #\d #\o #\g (? ($ (: #\s #\b #\o #\d #\y)))) "dog(sbody)?")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (: (look-behind (: #\a #\b #\c)) #\1 #\2 #\3) "(?<=abc)123")
(test-sre (: (or bow eow) #\a #\b #\c (or bow eow)) "\\babc\\b")
(test-sre (look-ahead #\C) "(?=C)")
(test-sre (: #\a #\b #\c (* #\d)) "abcd*")
(test-sre (: #\a #\b #\c (* numeric)) "abc\\d*")
(test-sre (: #\a #\b #\c (* (or #\d #\e))) "abc[de]*")
(test-sre (: (look-behind (: #\a #\b #\c)) #\d #\e #\f) "(?<=abc)def")
(test-sre (: #\a #\b #\c eos) "abc$")
(test-sre (: #\a #\b #\c (or bow eow)) "abc\\b")
(test-sre (: #\a #\b #\c nwb) "abc\\B")
(test-sre (+ nonl) ".+")
(test-sre (: (= 3 (look-ahead (: #\a #\b #\c))) #\a #\b #\c) "(?=abc){3}abc")
(test-sre (: (= 0 (look-ahead (: #\a #\b #\c))) #\x #\y #\z) "(?=abc){0}xyz")
(test-sre (: (= 1 (look-ahead (: #\a #\b #\c))) #\x #\y #\z) "(?=abc)xyz")
(test-sre (: (? (look-ahead ($ #\a))) nonl) "(?=(a))?.")
(test-sre (: (?? (look-ahead ($ #\a))) nonl) "(?=(a))??.")
(test-sre (: bos (= 0 (neg-look-ahead #\a)) (+ (or alnum #\_))) "^(?!a){0}\\w+")
(test-sre (: (? (look-behind ($ (: #\a #\b #\c)))) #\x #\y #\z) "(?<=(abc))?xyz")
(test-sre (: #\a #\b #\c #\d #\e #\f) "abcdef")
(test-sre (: #\a #\b #\c #\d) "abcd")
(test-sre (* (or #\a #\b)) "[ab]*")
(test-sre (*? (or #\a #\b)) "[ab]*?")
(test-sre (? (or #\a #\b)) "[ab]?")
(test-sre (?? (or #\a #\b)) "[ab]??")
(test-sre (+ (or #\a #\b)) "[ab]+")
(test-sre (**? 1 #f (or #\a #\b)) "[ab]+?")
(test-sre (** 2 3 (or #\a #\b)) "[ab]{2,3}")
(test-sre (**? 2 3 (or #\a #\b)) "[ab]{2,3}?")
(test-sre (>= 2 (or #\a #\b)) "[ab]{2,}")
(test-sre (**? 2 #f (or #\a #\b)) "[ab]{2,}?")
(test-sre (: #\a #\b #\c (look-ahead (: #\x #\y #\z))) "abc(?=xyz)")
(test-sre (: (look-behind (: #\p #\q #\r)) #\a #\b #\c (look-ahead (: #\x #\y #\z))) "(?<=pqr)abc(?=xyz)")
(test-sre (: #\a (or bow eow)) "a\\b")
(test-sre (: #\a #\b #\c (look-ahead (: #\a #\b #\c #\d #\e)) (look-ahead (: #\a #\b))) "abc(?=abcde)(?=ab)")
(test-sre (: (*? #\a) (*? #\b)) "a*?b*?")
(test-sre (or (: ($ #\a) ($ #\b)) ($ #\c)) "(a)(b)|(c)")
(test-sre (-> A (: #\a #\a)) "(?<A>aa)")
(test-sre (: #\a ($ #\b) #\c ($ #\d)) "a(b)c(d)")
(test-sre bos "^")
(test-sre (: (? ($ (: #\0 #\2 #\-))) (= 3 (char-range #\0 #\9)) #\- (= 3 (char-range #\0 #\9))) "(02-)?[0-9]{3}-[0-9]{3}")
(test-sre (: #\a #\b #\c) "abc")
(test-sre (or (: #\a #\b #\c) (: #\b #\c #\d)) "abc|bcd")
(test-sre (look-behind (or (: #\a #\b #\c) (:))) "(?<=abc|)")
(test-sre (look-behind (or (:) (: #\a #\b #\c))) "(?<=|abc)")
(test-sre (or #\a #\b #\c) "[abc]")
(test-sre (: #\f #\o #\o #\b #\a #\r) "foobar")
(test-sre (: (look-behind (: #\p #\q #\r)) #\a #\b #\c (look-ahead (: #\x #\y #\z))) "(?<=pqr)abc(?=xyz)")
(test-sre eos "$")
(test-sre (: (? #\newline) eos) "\\Z")
(test-sre (look-behind (look-ahead (: nonl (look-behind #\x)))) "(?<=(?=.(?<=x)))")
(test-sre (: (neg-look-ahead (or #\a #\b)) (* nonl)) "(?![ab]).*")
(test-sre (or #\a #\[) "[a\\[]")
(test-sre (: (or bow eow) #\X) "\\bX")
(test-sre (: nwb #\X) "\\BX")
(test-sre (: #\X (or bow eow)) "X\\b")
(test-sre (: #\X nwb) "X\\B")
(test-sre (~ #\a) "[^a]")
(test-sre (: #\a nonl #\b) "a.b")
(test-sre (: #\a ($ (= 3 nonl)) #\b) "a(.{3})b")
(test-sre (: #\a ($ (*? nonl)) ($ nonl)) "a(.*?)(.)")
(test-sre (: #\a ($ (* nonl)) ($ nonl)) "a(.*)(.)")
(test-sre (: #\a ($ nonl) ($ nonl)) "a(.)(.)")
(test-sre (: #\a ($ (? nonl)) ($ nonl)) "a(.?)(.)")
(test-sre (: #\a ($ (?? nonl)) ($ nonl)) "a(.??)(.)")
(test-sre (: #\a ($ (= 3 nonl)) #\b) "a(.{3})b")
(test-sre (: #\a ($ (>= 3 nonl)) #\b) "a(.{3,})b")
(test-sre (: #\a ($ (**? 3 #f nonl)) #\b) "a(.{3,}?)b")
(test-sre (: #\a ($ (** 3 5 nonl)) #\b) "a(.{3,5})b")
(test-sre (: #\a ($ (**? 3 5 nonl)) #\b) "a(.{3,5}?)b")
(test-sre (: (look-behind (: #\a #\X #\b)) #\c #\d) "(?<=aXb)cd")
(test-sre (: (look-behind ($ nonl)) #\X) "(?<=(.))X")
(test-sre (+ (~ #\a)) "[^a]+")
(test-sre (: bos (= 2 (~ #\a))) "^[^a]{2}")
(test-sre (: bos (>= 2 (~ #\a))) "^[^a]{2,}")
(test-sre (: bos (**? 2 #f (~ #\a))) "^[^a]{2,}?")
(test-sre (+ (~ #\a)) "[^a]+")
(test-sre (: bos (= 2 (~ #\a))) "^[^a]{2}")
(test-sre (: bos (>= 2 (~ #\a))) "^[^a]{2,}")
(test-sre (: bos (**? 2 #f (~ #\a))) "^[^a]{2,}?")
(test-sre (~ numeric) "\\D")
(test-sre (: #\> (~ space)) ">\\S")
(test-sre numeric "\\d")
(test-sre space "\\s")
(test-sre (+ (~ numeric)) "\\D+")
(test-sre (** 2 3 (~ numeric)) "\\D{2,3}")
(test-sre (**? 2 3 (~ numeric)) "\\D{2,3}?")
(test-sre (+ numeric) "\\d+")
(test-sre (** 2 3 numeric) "\\d{2,3}")
(test-sre (**? 2 3 numeric) "\\d{2,3}?")
(test-sre (+ (~ space)) "\\S+")
(test-sre (** 2 3 (~ space)) "\\S{2,3}")
(test-sre (**? 2 3 (~ space)) "\\S{2,3}?")
(test-sre (: #\> (+ space) #\<) ">\\s+<")
(test-sre (: #\> (** 2 3 space) #\<) ">\\s{2,3}<")
(test-sre (: #\> (**? 2 3 space) #\<) ">\\s{2,3}?<")
(test-sre (+ (or alnum #\_)) "\\w+")
(test-sre (** 2 3 (or alnum #\_)) "\\w{2,3}")
(test-sre (**? 2 3 (or alnum #\_)) "\\w{2,3}?")
(test-sre (+ (~ (or alnum #\_))) "\\W+")
(test-sre (** 2 3 (~ (or alnum #\_))) "\\W{2,3}")
(test-sre (**? 2 3 (~ (or alnum #\_))) "\\W{2,3}?")
(test-sre (: bos (* (or #\a #\c)) #\b) "^[ac]*b")
(test-sre (: bos (* (~ #\x)) #\b) "^[^x]*b")
(test-sre (: bos (* numeric) #\b) "^\\d*b")
(test-sre ($ (or (:) #\a)) "(|a)")
(test-sre (: #\a #\b #\c (* #\d)) "abcd*")
(test-sre (: #\a #\b #\c (* numeric)) "abc\\d*")
(test-sre (: #\a #\b #\c (* (or #\d #\e))) "abc[de]*")
(test-sre (: (or bow eow) #\t #\h #\e #\space #\c #\a #\t (or bow eow)) "\\bthe cat\\b")
(test-sre (: (or bow eow) nonl nonl nonl nwb) "\\b...\\B")
(test-sre (: #\i #\s #\t) "ist")
(test-sre (: #\i (+ #\s) #\t) "is+t")
(test-sre (: #\i (**? 1 #f #\s) #\t) "is+?t")
(test-sre (: #\i (? #\s) #\t) "is?t")
(test-sre (: #\i (= 2 #\s) #\t) "is{2}t")
(test-sre (: bos #\A (+ space) #\Z) "^A\\s+Z")
(test-sre (: #\A #\s #\k #\Z) "AskZ")
(test-sre (+ (or #\A #\s #\k #\Z)) "[AskZ]+")
(test-sre (+ (~ #\s)) "[^s]+")
(test-sre (+ (~ #\k)) "[^k]+")
(test-sre (+ (~ (or #\s #\k))) "[^sk]+")
(test-sre #\i "i")
(test-sre #\I "I")
(test-sre (or #\z #\i) "[zi]")
(test-sre (or #\i #\I) "[iI]")
(test-sre (+ numeric) "\\d+")
(test-sre (: #\> (+ space) #\<) ">\\s+<")
(test-sre (+ (or alnum #\_)) "\\w+")
(test-sre (: (or bow eow) (**? 1 #f nonl) (or bow eow)) "\\b.+?\\b")
(test-sre (: #\c #\a #\f nwb (**? 1 #f nonl) nwb) "caf\\B.+?\\B")
(test-sre (+ (** 1 3 #\x)) "(?:x{1,3})+")
(test-sre (~ #\a) "[^a]")
(test-sre (: (look-behind (: #\C #\newline)) bos) "(?<=C\n)^")
(test-sre (: (+ (or alnum #\_)) (look-ahead #\tab)) "\\w+(?=\t)")
(test-sre (w/nocase (: #\A #\space #\s #\t #\r #\i #\n #\g)) "(?i)A string")
(test-sre (w/nocase (: ($ (* (~ #\.))) #\. ($ (* (~ #\:))) #\: (+ (or #\T #\space)) ($ (* nonl)))) "(?i)([^.]*)\\.([^:]*):[T ]+(.*)")
(test-sre (w/nocase (: bos (+ (char-range #\W #\c)) eos)) "(?i)^[W-c]+$")
(test-sre (w/nocase (~ #\a)) "(?i)[^a]")
(test-sre (: (w/nocase (or (: #\s #\a #\t #\u #\r #\d #\a #\y) (: #\s #\u #\n #\d #\a #\y))) #\:) "(?i:saturday|sunday):")
(test-sre (: (w/nocase #\a) #\b) "(?i:a)b")
(test-sre (w/nocase (: ($ (w/nocase #\a)) #\b)) "(?i)((?i:a))b")
(test-sre (w/nocase (: (w/case #\a) #\b)) "(?i)(?-i:a)b")
(test-sre (w/nocase (: ($ (w/case #\a)) #\b)) "(?i)((?-i:a))b")
(test-sre (w/nocase (: (w/case #\a) #\b)) "(?i)(?-i:a)b")
(test-sre (w/nocase (: (? ($ (: (+ (or (or alnum #\_) #\:))) #\: #\:))) ($ (+ (or alnum #\_))) eos) "(?i)([\\w:]+::)?(\\w+)$")
(test-sre (w/nocase (: #\A #\B (w/case #\C))) "(?i)AB(?-i:C)")
(test-sre (w/nocase (: #\r #\e #\g (or (: #\u #\l (or #\a #\@ (: #\a #\e)) #\r) (: #\e #\x)))) "(?i)reg(?:ul(?:[a@]|ae)r|ex)")
(test-sre (w/nocase (* (~ #\a))) "(?i)[^a]*")
(test-sre (w/nocase (: (*? (~ #\a)) #\X)) "(?i)[^a]*?X")
(test-sre (w/nocase (: (**? 1 #f (~ #\a)) #\X)) "(?i)[^a]+?X")
(test-sre (w/nocase (: (? (~ #\a)) #\X)) "(?i)[^a]?X")
(test-sre (w/nocase (: (?? (~ #\a)) #\X)) "(?i)[^a]??X")
(test-sre (w/nocase (** 2 3 (~ #\a))) "(?i)[^a]{2,3}")
(test-sre (w/nocase (**? 2 3 (~ #\a))) "(?i)[^a]{2,3}?")
(test-sre (w/nocase (: (look-behind (= 2 #\a)) #\b)) "(?i)(?<=a{2})b")
(test-sre (w/nocase (: (neg-look-behind (= 2 #\a)) #\b)) "(?i)(?<!a{2})b")
(test-sre (w/nocase (: (look-behind (= 2 (~ #\a))) #\b)) "(?i)(?<=[^a]{2})b")
(test-sre (w/nocase (: bos (* (~ #\b)) (= 4 (or alnum #\_)))) "(?i)^[^b]*\\w{4}")
(test-sre (w/nocase (: bos (* #\a) (= 4 (or alnum #\_)))) "(?i)^a*\\w{4}")
(test-sre (w/nocase #\s) "(?i)s")
(test-sre (w/nocase (~ #\s)) "(?i)[^s]")
(test-sre (w/nocase (: #\t #\h #\e #\space #\e #\n #\d)) "(?i)the end")
(test-sre (w/nocase (: #\a #\b #\c (* #\d))) "(?i)abcd*")
(test-sre (w/nocase (: #\a #\b #\c (: (? #\newline) eos))) "(?i)abc\\Z")
(test-sre (w/nocase (: bos (*? (~ #\d)) eos)) "(?i)^[^d]*?$")
(test-sre (w/nocase (: #\a #\b #\c)) "(?i)abc")
(test-sre (w/nocase (w/case (: #\t #\h #\e #\space #\e #\n #\d))) "(?i)(?-i)the end")
(test-sre (w/nocase (: ($ (+ (or numeric (char-range #\a #\f) #\:))) eos)) "(?i)([\\da-f:]+)$")
(test-sre (w/nocase (: bos (or numeric (char-range #\a #\f)) (* ($ (: #\. (or numeric (char-range #\a #\f))))) eos)) "(?i)^[\\da-f](\\.[\\da-f])*$")
(test-sre (w/nocase (: bos (+ (char-range #\W #\c)) eos)) "(?i)^[W-c]+$")
(test-sre (w/nocase (: bos (+ (char-range #\? #\_)) eos)) "(?i)^[?-_]+$")
(test-sre (w/nocase (~ #\a)) "(?i)[^a]")
(test-sre (w/nocase (+ (~ #\a))) "(?i)[^a]+")
(test-sre (w/nocase (~ (or #\a #\z))) "(?i)[^az]")
(test-sre (w/nocase (: (or bow eow) ($ (: #\f #\o #\o)) (+ space) ($ (+ (or alnum #\_))))) "(?i)\\b(foo)\\s+(\\w+)")
(test-sre (: #\a (w/nocase #\b) #\c) "a(?i:b)c")
(test-sre (: #\a (* (w/nocase #\b)) #\c) "a(?i:b)*c")
(test-sre (w/nocase (: #\a #\b #\c (* grapheme))) "(?i)abc\\X*")
; selected corner cases
(test-sre (: #\a (or) #\b) "a{}b")
(test-sre (: #\a (or (or)) #\b) "a{}b")
(test-sre (: #\a (or (or (or))) #\b) "a{}b")
(test-sre (: #\a (or (or (or) (or))) #\b) "a{}b")
(test-sre (: #\a (/) #\b) "a{}b")
(test-sre (: #\a (or ("") (/ "" "" "")) #\b) "a{}b")
(test-sre (: #\a (or (or (or) ("")) (or (or (/)) (/ "" "" ""))) #\b) "a{}b")
(test-sre (or ($ #\a) ($ #\a)) "(a)|(a)")
(test-sre (and alnum (w/nocase (w/ascii (or lower numeric)))) "{an&{?i:{?-u:l|d}}}")
(test-sre (or alnum (w/nocase (w/ascii (or lower numeric)))) "{an|{?i:{?-u:l|d}}}")
(test-sre (w/nocase (w/ascii (or lower numeric))) "(?i)(?-u){l|d}")
