<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Erick Gallesio">
<title>STklos Reference Manual : (version 1.70)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #75715e;
  font-style: italic;
}
pre.rouge .cm {
  color: #75715e;
  font-style: italic;
}
pre.rouge .c1 {
  color: #75715e;
  font-style: italic;
}
pre.rouge .cp {
  color: #75715e;
  font-weight: bold;
}
pre.rouge .cs {
  color: #75715e;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .err {
  color: #960050;
  background-color: #1e0010;
}
pre.rouge .gi {
  color: #ffffff;
  background-color: #324932;
}
pre.rouge .gd {
  color: #ffffff;
  background-color: #493131;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .k, pre.rouge .kv {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .kc {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .kd {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .kp {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .kr {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .kt {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .kn {
  color: #f92672;
  font-weight: bold;
}
pre.rouge .ow {
  color: #f92672;
  font-weight: bold;
}
pre.rouge .o {
  color: #f92672;
  font-weight: bold;
}
pre.rouge .mf {
  color: #ae81ff;
}
pre.rouge .mh {
  color: #ae81ff;
}
pre.rouge .il {
  color: #ae81ff;
}
pre.rouge .mi {
  color: #ae81ff;
}
pre.rouge .mo {
  color: #ae81ff;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #ae81ff;
}
pre.rouge .se {
  color: #ae81ff;
}
pre.rouge .sa {
  color: #66d9ef;
  font-weight: bold;
}
pre.rouge .sb {
  color: #e6db74;
}
pre.rouge .sc {
  color: #e6db74;
}
pre.rouge .sd {
  color: #e6db74;
}
pre.rouge .s2 {
  color: #e6db74;
}
pre.rouge .sh {
  color: #e6db74;
}
pre.rouge .si {
  color: #e6db74;
}
pre.rouge .sx {
  color: #e6db74;
}
pre.rouge .sr {
  color: #e6db74;
}
pre.rouge .s1 {
  color: #e6db74;
}
pre.rouge .ss {
  color: #e6db74;
}
pre.rouge .s, pre.rouge .dl {
  color: #e6db74;
}
pre.rouge .na {
  color: #a6e22e;
}
pre.rouge .nc {
  color: #a6e22e;
  font-weight: bold;
}
pre.rouge .nd {
  color: #a6e22e;
  font-weight: bold;
}
pre.rouge .ne {
  color: #a6e22e;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #a6e22e;
  font-weight: bold;
}
pre.rouge .no {
  color: #66d9ef;
}
pre.rouge .bp {
  color: #f8f8f2;
}
pre.rouge .nb {
  color: #f8f8f2;
}
pre.rouge .ni {
  color: #f8f8f2;
}
pre.rouge .nn {
  color: #f8f8f2;
}
pre.rouge .vc {
  color: #f8f8f2;
}
pre.rouge .vg {
  color: #f8f8f2;
}
pre.rouge .vi {
  color: #f8f8f2;
}
pre.rouge .nv, pre.rouge .vm {
  color: #f8f8f2;
}
pre.rouge .w {
  color: #f8f8f2;
}
pre.rouge .nl {
  color: #f8f8f2;
  font-weight: bold;
}
pre.rouge .nt {
  color: #f92672;
}
pre.rouge {
  color: #f8f8f2;
  background-color: #49483e;
}
</style>
<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>STklos Reference Manual : (version 1.70)</h1>
<div class="details">
<span id="author" class="author">Erick Gallesio</span><br>
<span id="email" class="email"><a href="mailto:eg@unice.fr">eg@unice.fr</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#_licences">Licences</a></li>
</ul>
</li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_overview_of_stklos">1.1. Overview of <strong><em>STklos</em></strong></a></li>
<li><a href="#_lexical_conventions">1.2. Lexical Conventions</a></li>
</ul>
</li>
<li><a href="#_expressions">2. Expressions</a>
<ul class="sectlevel2">
<li><a href="#_literal_expressions">2.1. Literal expressions</a></li>
<li><a href="#_procedures">2.2. Procedures</a></li>
<li><a href="#_assignments">2.3. Assignments</a></li>
<li><a href="#_conditionals">2.4. Conditionals</a></li>
<li><a href="#_binding_constructs">2.5. Binding Constructs</a></li>
<li><a href="#_sequencing">2.6. Sequencing</a></li>
<li><a href="#_iterations">2.7. Iterations</a></li>
<li><a href="#_delayed_evaluation">2.8. Delayed Evaluation</a></li>
<li><a href="#_quasiquotation">2.9. Quasiquotation</a></li>
<li><a href="#_macros">2.10. Macros</a></li>
</ul>
</li>
<li><a href="#_program_structure">3. Program structure</a></li>
<li><a href="#_standard_procedures">4. Standard Procedures</a>
<ul class="sectlevel2">
<li><a href="#_equivalence_predicates">4.1. Equivalence predicates</a></li>
<li><a href="#_numbers">4.2. Numbers</a></li>
<li><a href="#_booleans">4.3. Booleans</a></li>
<li><a href="#_pairs_and_lists">4.4. Pairs and lists</a></li>
<li><a href="#_symbols">4.5. Symbols</a></li>
<li><a href="#_characters">4.6. Characters</a></li>
<li><a href="#_strings">4.7. Strings</a></li>
<li><a href="#_vectors">4.8. Vectors</a></li>
<li><a href="#_structures">4.9. Structures</a></li>
<li><a href="#_bytevectors">4.10. Bytevectors</a></li>
<li><a href="#_control_features">4.11. Control features</a></li>
<li><a href="#_input_and_output">4.12. Input and Output</a></li>
<li><a href="#_system_interface">4.13. System interface</a></li>
<li><a href="#_keywords">4.14. Keywords</a></li>
<li><a href="#_hash_tables">4.15. Hash Tables</a></li>
<li><a href="#_dates_and_times">4.16. Dates and Times</a></li>
<li><a href="#_boxes">4.17. Boxes</a></li>
<li><a href="#_processes">4.18. Processes</a></li>
<li><a href="#_sockets">4.19. Sockets</a></li>
<li><a href="#_signals">4.20. Signals</a></li>
<li><a href="#_parameter_objects">4.21. Parameter Objects</a></li>
<li><a href="#_misc">4.22. Misc</a></li>
</ul>
</li>
<li><a href="#_regular_expressions">5. Regular Expressions</a>
<ul class="sectlevel2">
<li><a href="#_backslash">5.1. Backslash</a></li>
<li><a href="#_circumflex_and_dollar">5.2. Circumflex and Dollar</a></li>
<li><a href="#_full_stop_period_dot">5.3. Full Stop (period, dot)</a></li>
<li><a href="#_square_brackets">5.4. Square Brackets</a></li>
<li><a href="#_posix_character_classes">5.5. POSIX character classes</a></li>
<li><a href="#_vertical_bar">5.6. Vertical Bar</a></li>
<li><a href="#_internal_option_setting">5.7. Internal Option Setting</a></li>
<li><a href="#_subpatterns">5.8. Subpatterns</a></li>
<li><a href="#_named_subpatterns">5.9. Named Subpatterns</a></li>
<li><a href="#_repetition">5.10. Repetition</a></li>
<li><a href="#_atomic_grouping_and_possessive_quantifiers">5.11. Atomic Grouping And Possessive Quantifiers</a></li>
<li><a href="#_back_references">5.12. Back References</a></li>
<li><a href="#_assertions">5.13. Assertions</a></li>
<li><a href="#_conditional_subpatterns">5.14. Conditional Subpatterns</a></li>
<li><a href="#_comments_2">5.15. Comments</a></li>
<li><a href="#_subpatterns_as_subroutines">5.16. Subpatterns As Subroutines</a></li>
<li><a href="#_regexp_procedures">5.17. Regexp Procedures</a></li>
</ul>
</li>
<li><a href="#_pattern_matching">6. Pattern Matching</a>
<ul class="sectlevel2">
<li><a href="#_the_pattern_language">6.1. The Pattern Language</a></li>
<li><a href="#_stklos_pattern_matching_facilities">6.2. <strong><em>STklos</em></strong> Pattern Matching Facilities</a></li>
</ul>
</li>
<li><a href="#_exceptions_and_conditions">7. Exceptions and Conditions</a>
<ul class="sectlevel2">
<li><a href="#_exceptions">7.1. Exceptions</a></li>
<li><a href="#_conditions">7.2. Conditions</a></li>
<li><a href="#_predefined_conditions">7.3. Predefined Conditions</a></li>
</ul>
</li>
<li><a href="#_stklos_object_system">8. STklos Object System</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">8.1. Introduction</a></li>
<li><a href="#_object_system_tutorial">8.2. Object System Tutorial</a></li>
<li><a href="#_object_system_reference">8.3. Object System Reference</a></li>
<li><a href="#_main_functions_and_sytaxes">8.4. Main Functions and sytaxes</a></li>
</ul>
</li>
<li><a href="#_threads_mutexes_and_condition_variables">9. Threads, Mutexes and Condition Variables</a>
<ul class="sectlevel2">
<li><a href="#_threads">9.1. Threads</a></li>
<li><a href="#_mutexes">9.2. Mutexes</a></li>
<li><a href="#_condition_variables">9.3. Condition Variables</a></li>
<li><a href="#_conditions_2">9.4. Conditions</a></li>
</ul>
</li>
<li><a href="#_stklos_customization">10. STklos Customization</a>
<ul class="sectlevel2">
<li><a href="#_parameter_objects_2">10.1. Parameter Objects</a></li>
<li><a href="#_environment_variables">10.2. Environment variables</a></li>
</ul>
</li>
<li><a href="#_the_scmpkg_package_system">11. The ScmPkg Package System</a>
<ul class="sectlevel2">
<li><a href="#_scmpkg_tutorial">11.1. <em>ScmPkg</em> "tutorial"</a></li>
<li><a href="#_stklos_pkg_options">11.2. stklos-pkg options</a></li>
</ul>
</li>
<li><a href="#_foreign_function_interface">12. Foreign Function Interface</a>
<ul class="sectlevel2">
<li><a href="#_external_functions">12.1. External functions</a></li>
<li><a href="#_c_pointers">12.2. C pointers</a></li>
</ul>
</li>
<li><a href="#_using_the_slib_package">13. Using the SLIB package</a></li>
<li><a href="#_srfis">14. SRFIs</a>
<ul class="sectlevel2">
<li><a href="#_supported_srfis">14.1. Supported SRFIs</a></li>
<li><a href="#_using_a_srfi">14.2. Using a SRFI</a></li>
<li><a href="#_misc_information">14.3. Misc. Information</a></li>
</ul>
</li>
<li><a href="#_bibliography">Bibliography</a></li>
<li><a href="#_libraries">Appendix A: STklos Libraries</a>
<ul class="sectlevel2">
<li><a href="#_the_scheme_libraries">A.1. The (scheme &#8230;&#8203;) Libraries</a></li>
<li><a href="#_the_srfi_libraries">A.2. The (srfi &#8230;&#8203;) Libraries</a></li>
<li><a href="#_the_stklos_libraries">A.3. The (stklos &#8230;&#8203;) Libraries</a></li>
</ul>
</li>
<li><a href="#FDL">Appendix B: GNU Free Documentation License</a>
<ul class="sectlevel2">
<li><a href="#_preamble">B.1. PREAMBLE</a></li>
<li><a href="#_applicability_and_definitions">B.2. APPLICABILITY AND DEFINITIONS</a></li>
<li><a href="#_verbatim_copying">B.3. VERBATIM COPYING</a></li>
<li><a href="#_copying_in_quantity">B.4. COPYING IN QUANTITY</a></li>
<li><a href="#_modifications">B.5. MODIFICATIONS</a></li>
<li><a href="#_combining_documents">B.6. COMBINING DOCUMENTS</a></li>
<li><a href="#_collections_of_documents">B.7. COLLECTIONS OF DOCUMENTS</a></li>
<li><a href="#_aggregation_with_independent_works">B.8. AGGREGATION WITH INDEPENDENT WORKS</a></li>
<li><a href="#_translation">B.9. TRANSLATION</a></li>
<li><a href="#_termination">B.10. TERMINATION</a></li>
<li><a href="#_future_revisions_of_this_license">B.11. FUTURE REVISIONS OF THIS LICENSE</a></li>
<li><a href="#_relicensing">B.12. RELICENSING</a></li>
<li><a href="#_addendum_how_to_use_this_license_for_your_documents">B.13. ADDENDUM: How to use this License for your documents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides a complete list of procedures and special forms
implemented in version <strong>0.3</strong> of <strong><em>STklos</em></strong>. The language
implemented by <strong><em>STklos</em></strong> is nearly compliant with the language
described in the Revised<sup>5</sup> Report on the Algorithmic Language Scheme
(aka R<sup>5</sup>RS) <a href="#R5RS">[R5RS]</a>.</p>
</div>
<div class="paragraph">
<p>However, since version 1.30, the goal is to make it more compliant
with R<sup>7</sup>RS <a href="#R7RS">[R7RS]</a>. This document states the compliance of each
construction relatively to these reports, or if it is a <strong><em>STklos</em></strong>
extension.</p>
</div>
<div class="sect2">
<h3 id="_licences">Licences</h3>
<div class="ulist">
<ul>
<li>
<p><strong><em>STklos</em></strong> program and supporting files are published under the terms of the
<em>GNU General Public Licence version 2 or later</em>. This licence is available at the
following URL: <a href="https://www.gnu.org/licenses/gpl-3.0.html" class="bare">https://www.gnu.org/licenses/gpl-3.0.html</a></p>
</li>
<li>
<p>The manual you’re now reading is published under the terms of the
<em>GNU Free Documentation License or later</em> (see <a href="#FDL">Appendix B</a>).</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Copyright © 1999-2023 Erick Gallesio</p>
</div>
<div class="paragraph">
<p>Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled <a href="#FDL">"GNU
Free Documentation License"</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_of_stklos">1.1. Overview of <strong><em>STklos</em></strong></h3>
<div class="paragraph">
<p>

<strong><em>STklos</em></strong> is the successor of <strong><em>STk</em></strong> <a href="#STk">[STk]</a>,
a Scheme interpreter which was tightly
connected to the Tk graphical toolkit <a href="#Tk">[Tk]</a>.
<strong><em>STk</em></strong> had an object layer which was called <strong><em>STklos</em></strong>. At this
time, <strong><em>STk</em></strong> was used to denote the base Scheme interpreter and
<strong><em>STklos</em></strong> was used to denote its object layer, which was an
extension.  For instance, when programming a GUI application,
a user could access the widgets at the (low) Tk level, or access
them using a neat hierarchy of classes wrapped in <strong><em>STklos</em></strong>.</p>
</div>
<div class="paragraph">
<p>Since the object layer is now more closely integrated with
the language, the new system has been renamed <strong><em>STklos</em></strong> and
<strong><em>STk</em></strong> is now used to designate the old system.</p>
</div>
<div class="paragraph">
<p>
<strong>Compatibility with STk</strong>:<br>
<strong><em>STklos</em></strong> has been
completely rewritten and as a consequence, due to new
implementation choices, old <strong><em>STk</em></strong> programs are not fully
compatible with the new system. However, these changes are very
minor and adapting a <strong><em>STk</em></strong> program for the <strong><em>STklos</em></strong> system is
generally quite easy. The only programs which need heavier work
are programs which use Tk without objects, since the new
preferred GUI system is now based on GTK+
<a href="#GTK">[GTK]</a>. Programmers used to GUI programming using
<strong><em>STklos</em></strong> classes will find that both system, even if not
identical in every points, share the same philosophy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lexical_conventions">1.2. Lexical Conventions</h3>
<div class="sect3">
<h4 id="_identifiers">1.2.1. Identifiers</h4>
<div class="paragraph">
<p>






In <strong><em>STklos</em></strong>, by default, identifiers which start (or end) with a colon
&#8220;:&#8221; are considered as keywords.  For instance <code>:foo</code> and
<code>bar:</code> are <strong><em>STklos</em></strong> keywords, but <code>not:key</code> is not a
keyword. Alternatively, to be compatible with other Scheme implementations,
the notation <code>#:foo</code> is also available to denote the keyword of name
<code>foo</code>. See <em><a href="#_keywords">Section 4.14</a></em> for more information.</p>
</div>
<div class="paragraph">
<p>The reader behavior, concerning keywords, can also be changed by the
following directives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>#!keyword-colon-position-none</code> tells the reader
that colon in a symbol should not be interpreted as a keyword;</p>
</li>
<li>
<p>the <code>#!keyword-colon-position-before</code> tells the reader
that a symbol starting with a colon should be interpreted as a keyword;</p>
</li>
<li>
<p>the <code>#!keyword-colon-position-after</code>  tells the reader
that a symbol ending with a colon should be interpreted as
a keyword;</p>
</li>
<li>
<p>the <code>#!keyword-colon-position-both</code> tells the reader
that a symbol starting or ending with a colon should be interpreted
as a keyword</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In any case, the notation <code>#:key</code> is always read as a keyword.</p>
</div>
<div class="paragraph">
<p>By default, <strong><em>STklos</em></strong> is case sensitive as specified by R7RS. This
behavior can be changed by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>--case-insensitive</code> option used for the commands <code>stklos</code> or
<code>stklos-compile</code></p>
</li>
<li>
<p>the <code>&#35;!fold-case</code> directive which can appear anywhere comments are permitted but must be followed by a delimiter. This directive (and the <code>&#35;!no-fold-case</code>) are treated as comments, except that they affect the reading of subsequent data from the same port. The <code>&#35;!fold-case</code> directive causes subsequent identifiers and character names to be case-folded as if by <code>string-foldcase</code>. It has no effect on character literals. The <code>&#35;!no-fold-case</code> directive causes the reader to a non-folding behavior.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_comments">1.2.2. Comments</h4>
<div class="paragraph">
<p>


There are four types of comments in <strong><em>STklos</em></strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a semicolon <code>;</code> indicates the start of a comment. This kind of
comment extends to the end of the line (as described in R<sup>5</sup>RS).</p>
</li>
<li>
<p>multi-lines comment use the classical Lisp convention: a comment begins with <code>&#35;|</code> and ends with <code>|&#35;</code>.  This form of comment is now defined by <strong><a href="http://srfi.schemers.org/srfi-30/srfi-30.html">SRFI-30</a></strong> (<em>Nested Multi-line Comments</em>).</p>
</li>
<li>
<p>a sharp sign followed by a semicolon <code>&#35;;</code> comments the next Scheme
expression. This is useful to comment a piece of code which spans
multiple lines</p>
</li>
<li>
<p>comments can also be introduced by <code>&#35;!</code>.  Such a comment extends to
the end of the line which introduces it. This extension is particularly
useful for building <strong><em>STklos</em></strong> scripts. On most Unix implementations,
if the first line of a script looks like this:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>#!/usr/local/bin/stklos -file</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the script can be started directly as if it was a binary
program. <strong><em>STklos</em></strong> is loaded behind the scene and
executes the script as a Scheme program. This form is compatible with
the notation introduced in <strong><a href="http://srfi.schemers.org/srfi-22/srfi-22.html">SRFI-22</a></strong> (<em>Running Scheme Scripts on Unix</em>).</p>
</div>
<div class="paragraph">
<p>Note that, as a special case, that the sequences <code>&#35;!key</code>,
<code>&#35;!optional</code> and <code>&#35;!rest</code> are respectively converted
to the <strong><em>STklos</em></strong> keywords <code>&#35;:key</code>, <code>&#35;:optional</code> and
<code>&#35;:rest</code>. This permits to Scheme lambdas, which accepts
keywords and optional arguments, to be compatible with DSSSL lambdas
<a href="#DSSSL">[DSSSL]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_here_strings">1.2.3. Here Strings</h4>
<div class="paragraph">
<p>

Here strings permit to easily enter multilines strings in programs.
The sequence of characters <code>&#35;&lt;&lt;</code> starts a here string. The characters
following this sequence <code>&#35;&lt;&lt;</code> until a newline character define a terminator for
the here string. The content of the string includes all characters between
the <code>&#35;&lt;&lt;</code> line and a line whose only content is the specified terminator.
No escape sequences are recognized between the starting and terminating lines.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> the sequence</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">#</span><span class="nv">&lt;&lt;EOF</span>
<span class="nv">abc</span>
<span class="nv">def</span>
  <span class="nv">ghi</span>
<span class="nv">EOF</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to the string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="s">"abc\ndef\n  ghi"</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_notations">1.2.4. Other Notations</h4>
<div class="paragraph">
<p>



<strong><em>STk</em></strong> accepts all the notations defined in R<sup>5</sup>RS plus</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>#true</code> and <code>#false</code> are other names for
the constants <code>#t</code> and <code>#f</code> as proposed by R<sup>7</sup>RS.</p>
</li>
<li>
<p><code>[]</code> Brackets are equivalent to
parentheses. They are used for grouping and to build lists. A
list opened with a left square bracket must be closed with a
right square bracket (see <em><a href="#_pairs_and_lists">Section 4.4</a></em>).</p>
</li>
<li>
<p><code>:</code> a colon at the beginning or the end of
a symbol introduces a keyword.  Keywords are described in section
Keywords (see _<a href="#_keywords">Section 4.14</a>).</p>
</li>
<li>
<p><code>&#35;n=</code> 
 is used to represent circular structures.  The value given of <code>n</code>
must be a number. It is used as a label, which can be referenced
later by a <code>&#35;n&#35;</code> notation
(see below). The scope of the label is the expression being read by the
outermost <code>read</code>.</p>
</li>
<li>
<p><code>&#35;n&#35;</code> is used to reference some object previously
labeled by a <code>&#35;n=</code> notation; that is, <code>&#35;n&#35;</code>
represents a pointer to the object labeled exactly by
<code>&#35;n=</code>. For instance, the object returned by the following
expression</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">a</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">b</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'x</span> <span class="nv">a</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can also be represented in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="o">#</span><span class="mi">0</span><span class="nv">=</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">x</span> <span class="o">.</span> <span class="o">#</span><span class="mi">0</span><span class="o">#</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressions">2. Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the main forms available in <strong><em>STklos</em></strong>. R<sup>5</sup>RS
constructions are given
very succinctly here for reference. See <a href="#R5RS">[R5RS]</a> for a complete
description.</p>
</div>
<div class="sect2">
<h3 id="_literal_expressions">2.1. Literal expressions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(quote &lt;datum&gt;)</code></strong><br>
<strong><code>'&lt;datum&gt;</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The quoting mechanism is identical to R<sup>5</sup>RS, except that keywords
constants  evaluate "to themselves" as numerical constants, string
constants, character constants, and boolean constants</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">'</span><span class="s">"abc"</span>     <span class="nv">=&gt;</span>  <span class="s">"abc"</span>
<span class="s">"abc"</span>      <span class="nv">=&gt;</span>  <span class="s">"abc"</span>
<span class="ss">'145932</span>    <span class="nv">=&gt;</span>  <span class="mi">145932</span>
<span class="mi">145932</span>     <span class="nv">=&gt;</span>  <span class="mi">145932</span>
<span class="o">'</span><span class="no">#t</span>        <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="no">#t</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="nv">:foo</span>       <span class="nv">=&gt;</span>  <span class="nv">:foo</span>
<span class="ss">':foo</span>      <span class="nv">=&gt;</span>  <span class="nv">:foo</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
R<sup>5</sup>RS requires to quote constant lists and
constant vectors. This is not necessary with STklos.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_procedures">2.2. Procedures</h3>
<div class="paragraph">
<p>









</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(lambda &lt;formals&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A lambda expression evaluates to a procedure. STklos lambda expression
have been extended to allow a optional and keyword parameters.
<code>&lt;formals&gt;</code> should have one of the following forms:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(&lt;variable<sub>1</sub>&gt; &#8230;&#8203;)</code></dt>
<dd>
<p>The procedure takes a fixed number of arguments;
when the procedure is called, the arguments will be stored in the
bindings of the corresponding variables.  This form is identical to
R<sup>5</sup>RS.</p>
</dd>
<dt class="hdlist1"><code>&lt;variable&gt;</code></dt>
<dd>
<p>The procedure takes any number of arguments; when the
procedure is called, the sequence of actual arguments is converted into
a newly allocated list, and the list is stored in the binding of the
<code>&lt;variable&gt;</code>. This form is identical to R<sup>5</sup>RS.</p>
</dd>
<dt class="hdlist1"><code>(&lt;variable<sub>1</sub>&gt; &#8230;&#8203; &lt;variable<sub>n</sub>&gt; . &lt;variable<sub>n+1</sub>&gt;)</code></dt>
<dd>
<p>If a space-delimited
period precedes the last variable, then the procedure takes n or more
 arguments, where n is the number of formal arguments before the period
(there must be at least one). The value stored in the binding of the
last variable will be a newly allocated list of the actual arguments left
over after all the other actual arguments have been matched up against
the other formal arguments. This form is identical to R<sup>5</sup>RS.</p>
</dd>
<dt class="hdlist1"><code>(&lt;variable<sub>1</sub> &#8230;&#8203; &lt;variable<sub>n</sub>&gt; [:optional &#8230;&#8203;] [:rest &#8230;&#8203;] [:key &#8230;&#8203;])</code></dt>
<dd>
<p>This form is specific to STklos and allows to have procedure with
optional and keyword parameters. The form <code>:optional</code> allows to specify
optional parameters. All the parameters specified after <code>:optional</code> to the end
of <code>&lt;formals&gt;</code> (or until a <code>:rest</code> or <code>:key</code>) are optional parameters. An
optional parameter can declared as:</p>
<div class="ulist">
<ul>
<li>
<p><code>variable</code>: if a value is passed when the procedure is called, it will be
stored in the binding of the corresponding variable, otherwise the value <code>#f</code>
will be stored in it.</p>
</li>
<li>
<p><code>(variable value)</code>: if a value is passed when the procedure is called, it
will be stored in the binding of the corresponding variable, otherwise <code>value</code>
will be stored in it.</p>
</li>
<li>
<p><code>(variable value test?)</code>: if a value is passed when the procedure is called, it
will be stored in the binding of the corresponding variable, otherwise <code>value</code>
will be stored in it. Furthermore, <code>test?</code> will be given the value <code>#t</code> if
a value is passed for the given variable, otherwise <code>test?</code> is set to <code>#f</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hereafter are some examples using <code>:optional</code> parameters</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">:optional</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">:optional</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="no">#f</span><span class="p">)</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">:optional</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">d</span> <span class="mi">100</span><span class="p">))</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">100</span><span class="p">)</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">:optional</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">d</span> <span class="no">#f</span> <span class="nv">d?</span><span class="p">))</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">d?</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The form <code>:rest</code> parameter is similar to the dot notation seen before.
It is used before an identifier to collects the parameters in a single
binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:rest</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="p">())</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:rest</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="p">(</span><span class="nf">2</span><span class="p">))</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:rest</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The form <code>:key</code> allows to use keyword parameter passing. All the parameters
specified after <code>:key</code> to the end of <code>&lt;formals&gt;</code> are keyword parameters. A
keyword  parameter can be declared using the three forms given for optional
parameters. Here are some examples illustrating how to declare and how to use
keyword parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:key</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span> <span class="mi">1</span> <span class="nv">:c</span> <span class="mi">2</span> <span class="nv">:b</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:key</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span> <span class="mi">1</span> <span class="nv">:c</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="no">#f</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:key</span> <span class="p">(</span><span class="nf">b</span> <span class="mi">100</span> <span class="nv">b?</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">b?</span><span class="p">))</span> <span class="mi">1</span> <span class="nv">:c</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">100</span> <span class="mi">2</span> <span class="no">#f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At last, here is an example showing <code>:optional</code> <code>:rest</code> and <code>:key</code> parameters</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">f</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">:optional</span> <span class="nv">b</span> <span class="nv">:rest</span> <span class="nv">c</span> <span class="nv">:key</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">f</span> <span class="mi">1</span><span class="p">)</span>                       <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="no">#f</span> <span class="p">()</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span>
<span class="p">(</span><span class="nf">f</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>                     <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="p">()</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span>
<span class="p">(</span><span class="nf">f</span> <span class="mi">1</span> <span class="mi">2</span> <span class="nv">:d</span> <span class="mi">3</span> <span class="nv">:e</span> <span class="mi">4</span><span class="p">)</span>           <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">:d</span> <span class="mi">3</span> <span class="nv">:e</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">f</span> <span class="mi">1</span> <span class="nv">:d</span> <span class="mi">3</span> <span class="nv">:e</span> <span class="mi">4</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="no">#f</span> <span class="p">(</span><span class="nf">:d</span> <span class="mi">3</span> <span class="nv">:e</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(closure? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>&#35;t</code> if <code>obj</code> is a procedure created with the <code>lambda</code> syntax and
<code>&#35;f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(case-lambda &lt;clause&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Each <code>&lt;clause&gt;</code> should have the form <code>(&lt;formals&gt; &lt;body&gt;)</code>, where
<code>&lt;formals&gt;</code> is a formal arguments list as for <code>lambda</code>.
Each <code>&lt;body&gt;</code> is a <code>&lt;tail-body&gt;</code>, as defined in R<sup>5</sup>RS.</p>
</div>
<div class="paragraph">
<p>A <code>case-lambda</code> expression evaluates to a procedure that
accepts a variable number of arguments and is lexically scoped in
the same manner as procedures resulting from <code>lambda</code>
expressions. When the procedure is called with some arguments
<code>v1 &#8230;&#8203; vk</code>, then the first <code>&lt;clause&gt;</code> for which the arguments agree
with <code>&lt;formals&gt;</code> is selected, where agreement is specified as for the
<code>&lt;formals&gt;</code> of a <code>lambda</code> expression. The variables of <code>&lt;formals&gt;</code>
are bound to fresh locations, the values <code>v1 &#8230;&#8203; vk</code> are stored in those
locations, the <code>&lt;body&gt;</code> is evaluated in the extended environment,
and the results of <code>&lt;body&gt;</code> are returned as the results of the
procedure call.</p>
</div>
<div class="paragraph">
<p>It is an error for the arguments not to agree with the <code>&lt;formals&gt;</code>
of any <code>&lt;clause&gt;</code>.</p>
</div>
<div class="paragraph">
<p>This form is defined in <strong><a href="http://srfi.schemers.org/srfi-16/srfi-16.html">SRFI-16</a></strong> (<em>Syntax for procedures of variable arity</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="k">define</span> <span class="nv">plus</span>
   <span class="p">(</span><span class="nf">case-lambda</span>
    <span class="p">(()</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
    <span class="p">((</span><span class="nf">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">z</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">args</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">+</span> <span class="nv">args</span><span class="p">))))</span>

 <span class="p">(</span><span class="nf">plus</span><span class="p">)</span>                     <span class="nv">=&gt;</span> <span class="mi">0</span>
 <span class="p">(</span><span class="nf">plus</span> <span class="mi">1</span><span class="p">)</span>                   <span class="nv">=&gt;</span> <span class="mi">1</span>
 <span class="p">(</span><span class="nf">plus</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>               <span class="nv">=&gt;</span> <span class="mi">6</span>

 <span class="p">((</span><span class="nf">case-lambda</span>
   <span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
   <span class="p">((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
  <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>                    <span class="nv">=&gt;</span> <span class="nv">error</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assignments">2.3. Assignments</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set! &lt;variable&gt; &lt;expression&gt;)</code></strong><br>
<strong><code>(set! (&lt;proc&gt; &lt;arg&gt; &#8230;&#8203;) &lt;expression&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The first form of <code>set!</code> is the R<sup>5</sup>RS one:</p>
</div>
<div class="paragraph">
<p><code>&lt;Expression&gt;</code> is evaluated, and the resulting value is stored in
the location to which <code>&lt;variable&gt;</code> is bound. <code>&lt;Variable&gt;</code> must be bound
either in some region enclosing the <code>set!</code> expression or at top level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="k">set!</span> <span class="nv">x</span> <span class="mi">4</span><span class="p">)</span>                <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second form of <code>set!</code> is defined in <strong><a href="http://srfi.schemers.org/srfi-17/srfi-17.html">SRFI-17</a></strong> (<em>Generalized set!</em>):</p>
</div>
<div class="paragraph">
<p>This special form <code>set!</code>
is extended so the first operand can be a procedure application, and not
just a variable. The procedure is typically one that extracts a component
from some data structure. Informally, when the procedure is called in the
first operand of <code>set!</code>, it causes the corresponding component to be
replaced by the second operand. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nb">vector-ref</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>would be equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">x</span> <span class="nv">i</span> <span class="nv">v</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each procedure that may be used as the first operand to <code>set!</code> must have
a corresponding <strong><em>setter</em></strong> procedure. The procedure <code>setter</code> (see below)
takes a procedure and returns the corresponding setter procedure.
So,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">proc</span> <span class="nv">arg</span> <span class="o">...</span><span class="p">)</span> <span class="nv">value</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to the call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="nf">setter</span> <span class="nv">proc</span><span class="p">)</span> <span class="nv">arg</span> <span class="o">...</span> <span class="nv">value</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of the <code>set!</code> expression is unspecified.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(setter proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the setter associated to a <code>proc</code>. Setters are defined in the
<strong><a href="http://srfi.schemers.org/srfi-17/srfi-17.html">SRFI-17</a></strong> (<em>Generalized set!</em>) document. A setter proc, can be used in a generalized
assignment, as described in <code>set!</code>.</p>
</div>
<div class="paragraph">
<p>To associate <code>s</code> to the procedure <code>p</code>, use the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">setter</span> <span class="nv">p</span><span class="p">)</span> <span class="nv">s</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, we can write</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">setter</span> <span class="nv">car</span><span class="p">)</span> <span class="nv">set-car!</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following standard procedures have pre-defined setters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span>              <span class="nv">==</span> <span class="p">(</span><span class="nb">set-car!</span> <span class="nv">x</span> <span class="nv">v</span><span class="p">)</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span>              <span class="nv">==</span> <span class="p">(</span><span class="nb">set-cdr!</span> <span class="nv">x</span> <span class="nv">v</span><span class="p">)</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nb">string-ref</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span>     <span class="nv">==</span> <span class="p">(</span><span class="nb">string-set!</span> <span class="nv">x</span> <span class="nv">i</span> <span class="nv">v</span><span class="p">)</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nb">vector-ref</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span>     <span class="nv">==</span> <span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">x</span> <span class="nv">i</span> <span class="nv">v</span><span class="p">)</span><span class="nv">!</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">x</span> <span class="ss">'name</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span>   <span class="nv">==</span> <span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">x</span> <span class="ss">'name</span> <span class="nv">v</span><span class="p">)</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">struct-ref</span> <span class="nv">x</span> <span class="ss">'name</span><span class="p">)</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">==</span> <span class="p">(</span><span class="nf">struct-set!</span> <span class="nv">x</span> <span class="ss">'name</span> <span class="nv">v</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Furhermore, Parameter Objects (see <em><a href="#_parameter_objects">Section 4.21</a></em>) are
their own setter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">real-precision</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="mi">15</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">real-precision</span><span class="p">)</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="nf">real-precision</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="mi">12</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conditionals">2.4. Conditionals</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(if &lt;test&gt; &lt;consequent&gt; &lt;alternate&gt;)</code></strong><br>
<strong><code>(if &lt;test&gt; &lt;consequent&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>An <code>if</code> expression is evaluated as follows: first, <code>&lt;test&gt;</code> is
evaluated.  If it yields a true value, then <code>&lt;consequent&gt;</code> is
evaluated and its value(s) is(are) returned.  Otherwise <code>&lt;alternate&gt;</code>
is evaluated and its value(s) is(are) returned.  If <code>&lt;test&gt;</code> yields a
false value and no <code>&lt;alternate&gt;</code> is specified, then the result of the
expression is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span> <span class="ss">'yes</span> <span class="ss">'no</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="nv">yes</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="ss">'yes</span> <span class="ss">'no</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="nv">no</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">-</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">+</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cond &lt;clause1&gt; &lt;clause2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In a <code>cond</code>, each <code>&lt;clause&gt;</code> should be of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">&lt;test&gt;</span> <span class="nv">&lt;expression1&gt;</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;test&gt;</code> is any expression.  Alternatively, a <code>&lt;clause&gt;</code> may be
of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">&lt;test&gt;</span> <span class="nv">=&gt;</span> <span class="nv">&lt;expression&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The last <code>&lt;clause&gt;</code> may be an "else clause," which has the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">else</span> <span class="nv">&lt;expression1&gt;</span> <span class="nv">&lt;expression2&gt;</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A cond expression is evaluated by evaluating the <code>&lt;test&gt;</code> expressions
of successive <code>&lt;clause&gt;</code>s in order until one of them evaluates to a
true value When a <code>&lt;test&gt;</code> evaluates to a true value, then the
remaining <code>&lt;expression&gt;</code>s in its <code>&lt;clause&gt;</code> are evaluated in order,
and the result(s) of the last <code>&lt;expression&gt;</code> in the <code>&lt;clause&gt;</code> is(are)
returned as the result(s) of the entire cond expression.  If the
selected <code>&lt;clause&gt;</code> contains only the <code>&lt;test&gt;</code> and no <code>&lt;expression&gt;`s,
then the value of the `&lt;test&gt;</code> is returned as the result.  If the
selected <code>&lt;clause&gt;</code> uses the <code>&#8658;</code> alternate form, then the
<code>&lt;expression&gt;</code> is evaluated.  Its value must be a procedure that
accepts one argument; this procedure is then called on the value of
the <code>&lt;test&gt;</code> and the value(s) returned by this procedure is(are)
returned by the cond expression.</p>
</div>
<div class="paragraph">
<p>If all <code>&lt;test&gt;</code>s evaluate to false
values, and there is no else clause, then the result of the
conditional expression is <strong><em>void</em></strong>; if there is an else clause,
then its <code>&lt;expression&gt;</code>s are evaluated, and the value(s) of the last
one is(are) returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">&gt;</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span> <span class="ss">'greater</span><span class="p">)</span>
        <span class="p">((</span><span class="nb">&lt;</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span> <span class="ss">'less</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="nv">greater</span>

  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">&gt;</span> <span class="mi">3</span> <span class="mi">3</span><span class="p">)</span> <span class="ss">'greater</span><span class="p">)</span>
        <span class="p">((</span><span class="nb">&lt;</span> <span class="mi">3</span> <span class="mi">3</span><span class="p">)</span> <span class="ss">'less</span><span class="p">)</span>
        <span class="p">(</span><span class="k">else</span> <span class="ss">'equal</span><span class="p">))</span>                      <span class="nv">=&gt;</span>  <span class="nv">equal</span>

  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">assv</span> <span class="ss">'b</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="mi">2</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="nv">cadr</span><span class="p">)</span>
        <span class="p">(</span><span class="k">else</span> <span class="no">#f</span><span class="p">))</span>                          <span class="nv">=&gt;</span>  <span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(case &lt;key&gt; &lt;clause1&gt; &lt;clause2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In a <code>case</code>, each <code>&lt;clause&gt;</code> should have the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="nf">&lt;datum1&gt;</span> <span class="o">...</span><span class="p">)</span> <span class="nv">&lt;expression1&gt;</span> <span class="nv">&lt;expression2&gt;</span> <span class="o">...</span><span class="p">)</span><span class="o">,</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where each <code>&lt;datum&gt;</code> is an external representation of some object.  All the
<code>&lt;datum&gt;`s must be distinct.  The last `&lt;clause&gt;</code> may be an "else clause," which
has the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">    <span class="p">(</span><span class="k">else</span> <span class="nv">&lt;expression1&gt;</span> <span class="nv">&lt;expression2&gt;</span> <span class="o">...</span><span class="p">)</span><span class="o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A case expression is evaluated as follows. <code>&lt;Key&gt;</code> is evaluated and
its result is compared against each <code>&lt;datum&gt;</code>.  If the result of
evaluating <code>&lt;key&gt;</code> is equivalent (in the sense of eqv?) to a
<code>&lt;datum&gt;</code>, then the expressions in the corresponding <code>&lt;clause&gt;</code> are
evaluated from left to right and the result(s) of the last expression
in the <code>&lt;clause&gt;</code> is(are) returned as the result(s) of the case
expression.  If the result of evaluating <code>&lt;key&gt;</code> is different from
every <code>&lt;datum&gt;</code>, then if there is an else clause its expressions are
evaluated and the result(s) of the last is(are) the result(s) of the
case expression; otherwise the result of the case expression is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p>If the selected <code>&lt;clause&gt;</code> or else clause uses the <code>&#8658;</code> alternate
form, then the <code>expression</code> is evaluated. It is an error if
its value is not a procedure accepting one argument. This
procedure is then called on the value of the hkeyi and the
values returned by this procedure are returned by the case
expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">case</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">)</span> <span class="ss">'prime</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">1</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">9</span><span class="p">)</span> <span class="ss">'composite</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="nv">composite</span>
  <span class="p">(</span><span class="k">case</span> <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span> <span class="nv">d</span><span class="p">))</span>
    <span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="ss">'a</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">b</span><span class="p">)</span> <span class="ss">'b</span><span class="p">))</span>                     <span class="nv">=&gt;</span>  <span class="nv">void</span>
  <span class="p">(</span><span class="k">case</span> <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span> <span class="nv">d</span><span class="p">))</span>
    <span class="p">((</span><span class="nf">a</span> <span class="nv">e</span> <span class="nv">i</span> <span class="nv">o</span> <span class="nv">u</span><span class="p">)</span> <span class="ss">'vowel</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">w</span> <span class="nv">y</span><span class="p">)</span> <span class="ss">'semivowel</span><span class="p">)</span>
    <span class="p">(</span><span class="k">else</span> <span class="ss">'consonant</span><span class="p">))</span>            <span class="nv">=&gt;</span>  <span class="nv">consonant</span>
  <span class="p">(</span><span class="k">case</span> <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span> <span class="nv">d</span><span class="p">))</span>
    <span class="p">((</span><span class="nf">a</span> <span class="nv">e</span> <span class="nv">i</span> <span class="nv">o</span> <span class="nv">u</span><span class="p">)</span> <span class="ss">'vowel</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">w</span> <span class="nv">y</span><span class="p">)</span> <span class="ss">'semivowel</span><span class="p">)</span>
    <span class="p">(</span><span class="k">else</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">x</span><span class="p">))))</span>  <span class="nv">=&gt;</span>  <span class="nv">c</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(and &lt;test<sub>1</sub>&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;test<sub>i</sub>&gt;</code> expressions are evaluated from left to right, and the
value of the first expression that evaluates to a false value is
returned.  Any remaining expressions are not evaluated.  If all the
expressions evaluate to true values, the value of the last expression
is returned.  If there are no expressions then <code>#t</code> is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">))</span>           <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">))</span>           <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="k">and</span> <span class="mi">1</span> <span class="mi">2</span> <span class="ss">'c</span> <span class="o">'</span><span class="p">(</span><span class="nf">f</span> <span class="nv">g</span><span class="p">))</span>             <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">f</span> <span class="nv">g</span><span class="p">)</span>
  <span class="p">(</span><span class="k">and</span><span class="p">)</span>                           <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(or &lt;test<sub>1</sub>&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;test<sub>i</sub>&gt;</code> expressions are evaluated from left to right, and the
value of the first expression that evaluates to a true value is
returned.  Any remaining expressions are not evaluated.  If all
expressions evaluate to false values, the value of the last expression
is returned.  If there are no expressions then <code>#f</code> is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">))</span>            <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">))</span>            <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="k">or</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nb">memq</span> <span class="ss">'b</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">/</span> <span class="mi">3</span> <span class="mi">0</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(when &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>&lt;test&gt;</code> expression yields a true value, the <code>&lt;expression&gt;</code>s are
evaluated from left to right and the value of the last <code>&lt;expression&gt;</code> is
returned. Otherwise, <code>when</code> returns <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(unless &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>&lt;test&gt;</code> expression yields a false value, the <code>&lt;expression&gt;</code>s are
evaluated from left to right and the value of the last <code>&lt;expression&gt;</code> is
returned. Otherwise, <code>unless</code> returns <strong><em>void</em></strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_binding_constructs">2.5. Binding Constructs</h3>
<div class="paragraph">
<p>
The three binding constructs <code>let</code>, <code>let*</code>, and
<code>letrec</code> are available in STklos.
These constructs differ in the regions they establish for
their variable bindings.  In a <code>let</code> expression, the initial values are
computed before any of the variables become bound; in a <code>let*</code>
expression, the bindings and evaluations are performed sequentially; while in a
<code>letrec</code> expression, all the bindings are in effect while their initial
values are being computed, thus allowing mutually recursive definitions.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> also provides a <code>fluid-let</code> form which is described below.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(let &lt;bindings&gt; &lt;body&gt;)</code></strong><br>
<strong><code>(let &lt;variable&gt; &lt;bindings&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In a <code>let</code>, <code>&lt;bindings&gt;</code> should have the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="nf">&lt;variable1&gt;</span> <span class="nv">&lt;init1&gt;</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where each <code>&lt;init<sub>i</sub>&gt;</code> is an expression, and <code>&lt;body&gt;</code> should be a sequence of one or
more expressions.  It is an error for a <code>&lt;variable&gt;</code> to appear more than once in
the list of variables being bound.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;init&gt;</code>s are evaluated in the current environment (in some
unspecified order), the <code>&lt;variable&gt;</code>s are bound to fresh locations holding the
results, the <code>&lt;body&gt;</code> is evaluated in the extended environment, and the value(s)
of the last expression of <code>&lt;body&gt;</code> is(are) returned.  Each binding of a
<code>&lt;variable&gt;</code> has <code>&lt;body&gt;</code> as its region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">y</span> <span class="mi">3</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>                      <span class="nv">=&gt;</span>  <span class="mi">6</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">y</span> <span class="mi">3</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="mi">7</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">*</span> <span class="nv">z</span> <span class="nv">x</span><span class="p">)))</span>                   <span class="nv">=&gt;</span>  <span class="mi">35</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second form of <code>let</code>, which is generally called a <strong><em>named let</em></strong>,
is a variant on the syntax of let which provides a more general
looping construct than <code>do</code> and may also be used to
express recursions. It has the same syntax and semantics as ordinary
let except that <code>&lt;variable&gt;</code> is bound within <code>&lt;body&gt;</code> to a procedure whose
formal arguments are the bound variables and whose body is <code>&lt;body&gt;</code>.
Thus the execution of <code>&lt;body&gt;</code> may be repeated by invoking the procedure
named by <code>&lt;variable&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="nv">loop</span> <span class="p">((</span><span class="nf">numbers</span> <span class="o">'</span><span class="p">(</span><span class="nf">3</span> <span class="mi">-2</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">-5</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">nonneg</span>  <span class="o">'</span><span class="p">())</span>
           <span class="p">(</span><span class="nf">neg</span>     <span class="o">'</span><span class="p">()))</span>
  <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">numbers</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">nonneg</span> <span class="nv">neg</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">&gt;=</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">numbers</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">numbers</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">numbers</span><span class="p">)</span> <span class="nv">nonneg</span><span class="p">)</span>
                 <span class="nv">neg</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">numbers</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">numbers</span><span class="p">)</span>
                  <span class="nv">nonneg</span>
                  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">numbers</span><span class="p">)</span> <span class="nv">neg</span><span class="p">)))))</span>
   <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">6</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">-5</span> <span class="mi">-2</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(let</strong> &lt;bindings&gt; &lt;body&gt;)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In a <code>let*</code>, <code>&lt;bindings&gt;</code> should have the same form as in a <code>let</code> (however, a
&lt;variable&gt; can appear more than once in the list of variables being bound).</p>
</div>
<div class="paragraph">
<p><code>Let*</code> is similar to <code>let</code>, but the bindings are performed sequentially
from left to right, and the region of a binding indicated by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">&lt;variable&gt;</span> <span class="nv">&lt;init&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is that part of the <code>let*</code> expression to the right of the binding.  Thus
the second binding is done in an environment in which the first binding is
visible, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">y</span> <span class="mi">3</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">x</span> <span class="mi">7</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">*</span> <span class="nv">z</span> <span class="nv">x</span><span class="p">)))</span>             <span class="nv">=&gt;</span>  <span class="mi">70</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(letrec &lt;bindings&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>&lt;bindings&gt; should have the form as in <code>let</code>.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;variable&gt;</code>s are bound to fresh locations holding undefined
values, the <code>&lt;init&gt;</code>s are evaluated in the resulting environment (in
some unspecified order), each <code>&lt;variable&gt;</code> is assigned to the result
of the corresponding <code>&lt;init&gt;</code>, the <code>&lt;body&gt;</code> is evaluated in the
resulting environment, and the value(s) of the last expression in
<code>&lt;body&gt;</code> is(are) returned.  Each binding of a <code>&lt;variable&gt;</code> has the
entire <code>letrec</code> expression as its region, making it possible to define
mutually recursive procedures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">letrec</span> <span class="p">((</span><span class="nb">even?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zero?</span> <span class="nv">n</span><span class="p">)</span>
                      <span class="no">#t</span>
                      <span class="p">(</span><span class="nb">odd?</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
         <span class="p">(</span><span class="nb">odd?</span>  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zero?</span> <span class="nv">n</span><span class="p">)</span>
                      <span class="no">#f</span>
                      <span class="p">(</span><span class="nb">even?</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nb">even?</span> <span class="mi">88</span><span class="p">))</span>
                  <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(letrec</strong> &lt;bindings&gt; &lt;body&gt;)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>&lt;bindings&gt; should have the form as in <code>let</code> and body is a sequence
of zero or more definitions followed by one or more expressions.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;variable&gt;</code>s are bound to fresh locations, each <code>variable</code> is
assigned in left-to-right order to the result of evaluating the
corresponding <code>init</code>, the <code>body</code> is evaluated in the resulting
environment, and the values of the last expression in <code>body</code> are
returned. Despite the left-to-right evaluation and assignment order,
each binding of a <code>variable</code> has the entire <code>letrec*</code> expression as its
region, making it possible to define mutually recursive procedures.
If it is not possible to evaluate each <code>init</code> without assigning or
referring to the value of the corresponding <code>variable</code> or the
<code>variable</code> of any of the bindings that follow it in <code>bindings</code>, it is
an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">letrec*</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">q</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">)))))</span>
          <span class="p">(</span><span class="nf">q</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">y</span><span class="p">)</span>
              <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zero?</span> <span class="nv">y</span><span class="p">)</span>
                  <span class="mi">0</span>
                  <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">p</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">y</span> <span class="mi">1</span><span class="p">))))))</span>
          <span class="p">(</span><span class="nf">x</span> <span class="p">(</span><span class="nf">p</span> <span class="mi">5</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">y</span> <span class="nv">x</span><span class="p">))</span>
  <span class="nv">y</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(let-values ((&lt;formals&gt; &lt;expression&gt;) &#8230;&#8203;) &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Each <code>&lt;formals&gt;</code> should be a formal arguments list as for a <code>lambda</code> expression.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;expression&gt;</code>s are evaluated in the current environment,
the variables of the <code>&lt;formals&gt;</code> are bound to fresh locations, the return
values of the <code>&lt;expression&gt;</code>s are stored in the variables, the <code>&lt;body&gt;</code> is
evaluated in the extended environment, and the values of the last expression
of <code>&lt;body&gt;</code> are returned.</p>
</div>
<div class="paragraph">
<p>The matching of each <code>&lt;formals&gt;</code> to values is as for the matching of
<code>&lt;formals&gt;</code> to arguments in a <code>lambda</code> expression, and it is an error
for an <code>&lt;expression&gt;</code> to return a number of values that does not match
its corresponding <code>&lt;formals&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let-values</span> <span class="p">(((</span><span class="nf">root</span> <span class="nv">rem</span><span class="p">)</span> <span class="p">(</span><span class="nf">exact-integer-sqrt</span> <span class="mi">32</span><span class="p">)))</span>
   <span class="p">(</span><span class="nb">*</span> <span class="nv">root</span> <span class="nv">rem</span><span class="p">))</span>            <span class="nv">=&gt;</span>  <span class="mi">35</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">a</span> <span class="ss">'a</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="ss">'b</span><span class="p">)</span> <span class="p">(</span><span class="nf">x</span> <span class="ss">'x</span><span class="p">)</span> <span class="p">(</span><span class="nf">y</span> <span class="ss">'y</span><span class="p">))</span>
   <span class="p">(</span><span class="nf">let-values</span> <span class="p">(((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
                <span class="p">((</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
     <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>      <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(let-values ((&lt;formals&gt; &lt;expression&gt;) &#8230;&#8203;) &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Each <code>&lt;formals&gt;</code> should be a formal arguments list as for a <code>lambda</code> expression.</p>
</div>
<div class="paragraph">
<p><code>let*-values</code> is similar to <code>let-values</code>, but the bindings are performed
sequentially from left to right, and the region of a binding indicated by
<code>(&lt;formals&gt; &lt;expression&gt;)</code> is that part of the <code>let*-values</code> expression to
the right of the binding. Thus the second binding is done in an environment
in which the first binding is visible, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">a</span> <span class="ss">'a</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="ss">'b</span><span class="p">)</span> <span class="p">(</span><span class="nf">x</span> <span class="ss">'x</span><span class="p">)</span> <span class="p">(</span><span class="nf">y</span> <span class="ss">'y</span><span class="p">))</span>
   <span class="p">(</span><span class="nf">let*-values</span> <span class="p">(((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
                <span class="p">((</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
     <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>      <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-values formals expression)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The form <code>define-values</code> creates multiple definitions from a single expression
returning multiple values. Here, <code>expression</code> is evaluated, and the <code>formals</code>
are bound to the return values in the same way that the <code>formals</code> in a
lambda expression are matched to the arguments in a procedure call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">define-values</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">exact-integer-sqrt</span> <span class="mi">17</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>                   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">4</span> <span class="mi">1</span><span class="p">)</span>

<span class="p">(</span><span class="k">let</span> <span class="p">()</span>
   <span class="p">(</span><span class="nf">define-values</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>                     <span class="nv">=&gt;</span> <span class="mi">3</span>

<span class="p">(</span><span class="k">let</span> <span class="p">()</span>
   <span class="p">(</span><span class="nf">define-values</span> <span class="p">(</span><span class="nf">x</span> <span class="o">.</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">values</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">list</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>                  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fluid-let &lt;bindings&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;bindings&gt;</code> are evaluated in the current environment, in some
unspecified order, the current values of the variables present in
<code>&lt;bindings&gt;</code> are saved, and the new evaluated values are assigned to the
<code>&lt;bindings&gt;</code> variables. Once this is done, the expressions of <code>&lt;body&gt;</code>
are evaluated sequentially in the current environment; the value of the
last expression is the result of <code>fluid-let</code>. Upon exit, the stored
variables values are restored. An error is signalled if any of the
<code>&lt;bindings&gt;</code> variable is unbound.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">a</span> <span class="ss">'out</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="nv">a</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">f</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">fluid-let</span> <span class="p">((</span><span class="nf">a</span> <span class="ss">'in</span><span class="p">))</span> <span class="p">(</span><span class="nf">f</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">f</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">out</span> <span class="nv">in</span> <span class="nv">out</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the body of a <code>fluid-let</code> is exited by invoking a continuation,
the new variable values are saved, and the variables are set to their old
values. Then, if the body is reentered by invoking a continuation, the old
values are saved and new values are restored. The following example illustrates
this behavior</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">cont</span> <span class="no">#f</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">l</span>    <span class="o">'</span><span class="p">())</span>
      <span class="p">(</span><span class="nf">a</span>    <span class="ss">'out</span><span class="p">))</span>
  <span class="p">(</span><span class="k">set!</span> <span class="nv">l</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">a</span> <span class="nv">l</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">fluid-let</span> <span class="p">((</span><span class="nf">a</span> <span class="ss">'in</span><span class="p">))</span>
    <span class="p">(</span><span class="k">set!</span> <span class="nv">cont</span> <span class="p">(</span><span class="nb">call-with-current-continuation</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">k</span><span class="p">)</span> <span class="nv">k</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">set!</span> <span class="nv">l</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">a</span> <span class="nv">l</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">set!</span> <span class="nv">l</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">a</span> <span class="nv">l</span><span class="p">))</span>

  <span class="p">(</span><span class="k">if</span> <span class="nv">cont</span> <span class="p">(</span><span class="nf">cont</span> <span class="no">#f</span><span class="p">)</span> <span class="nv">l</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">out</span> <span class="nv">in</span> <span class="nv">out</span> <span class="nv">in</span> <span class="nv">out</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sequencing">2.6. Sequencing</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(begin &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;expression&gt;</code>s are evaluated sequentially from left to right, and the
value(s) of the last <code>&lt;expression&gt;</code> is(are) returned.  This expression type is
used to sequence side effects such as input and output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)</span>

  <span class="p">(</span><span class="k">begin</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">x</span> <span class="mi">5</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span>                  <span class="nv">=&gt;</span>  <span class="mi">6</span>

  <span class="p">(</span><span class="k">begin</span> <span class="p">(</span><span class="nb">display</span> <span class="s">"4 plus 1 equals "</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">4</span> <span class="mi">1</span><span class="p">)))</span>        <span class="nv">|-</span> <span class="mi">4</span> <span class="nv">plus</span> <span class="mi">1</span> <span class="nv">equals</span> <span class="mi">5</span>
                                   <span class="nv">=&gt;</span>  <span class="nv">void</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(tagbody &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br>
<strong><code>(&#8594; tag)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;expression&gt;</code>s are evaluated sequentially from left to right,
and the value(s) of the last &lt;expression&gt; is(are) returned as in a
<code>begin</code> form. Within a <code>tagbody</code> form expressions which are keywords
are considered as tags and the special form <code>(&#8594; tag)</code> is used to
transfer execution to the given tag. This is a <strong>very low level"</strong>
form which is inspired on <code>tabgody</code> Common Lisp&#8217;s form. It can be useful
for defining new syntaxes, and should probably not used as is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">tagbody</span>               <span class="c1">;; an infinite loop</span>
   <span class="o">#</span><span class="nv">:1</span> <span class="p">(</span><span class="nb">display</span> <span class="s">"."</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">-&gt;</span> <span class="o">#</span><span class="nv">:1</span><span class="p">))</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">v</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">tagbody</span>
   <span class="o">#</span><span class="nv">:top</span> <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">v</span> <span class="mi">5</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">display</span> <span class="nv">v</span><span class="p">)</span>
           <span class="p">(</span><span class="k">set!</span> <span class="nv">v</span> <span class="p">(</span><span class="nf">fx+</span> <span class="nv">v</span> <span class="mi">1</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">-&gt;</span> <span class="o">#</span><span class="nv">:top</span><span class="p">))))</span>                      <span class="nv">|-</span> <span class="mi">01234</span>

<span class="p">(</span><span class="nf">tagbody</span> <span class="p">(</span><span class="nb">display</span> <span class="mi">1</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">tagbody</span> <span class="p">(</span><span class="nb">display</span> <span class="mi">2</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">-&gt;</span> <span class="o">#</span><span class="nv">:inner</span><span class="p">)</span>
                  <span class="p">(</span><span class="nb">display</span> <span class="s">"not printed"</span><span class="p">)</span>
           <span class="o">#</span><span class="nv">:inner</span>
                 <span class="p">(</span><span class="nb">display</span> <span class="mi">3</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">-&gt;</span> <span class="o">#</span><span class="nv">:outer</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">display</span> <span class="s">"not printed too"</span><span class="p">))</span>
   <span class="o">#</span><span class="nv">:outer</span>
         <span class="p">(</span><span class="nb">display</span> <span class="s">"4"</span><span class="p">))</span>                        <span class="nv">|-</span> <span class="mi">1234</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_iterations">2.7. Iterations</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(do [[&lt;var1&gt; &lt;init1&gt; &lt;step1&gt;] &#8230;&#8203;] [&lt;test&gt; &lt;expr&gt; &#8230;&#8203;] &lt;command&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Do</code> is an iteration construct.  It specifies a set of variables to be
bound, how they are to be initialized at the start, and how they are
to be updated on each iteration.  When a termination condition is met,
the loop exits after evaluating the <code>&lt;expr&gt;</code>s.</p>
</div>
<div class="paragraph">
<p><code>Do</code> expressions are evaluated as follows: The <code>&lt;init&gt;</code> expressions
are evaluated (in some unspecified order), the <code>&lt;var&gt;</code>s are bound
to fresh locations, the results of the <code>&lt;init&gt;</code> expressions are stored
in the bindings of the <code>&lt;var&gt;</code>s, and then the iteration phase
begins.</p>
</div>
<div class="paragraph">
<p>Each iteration begins by evaluating <code>&lt;test&gt;</code>; if the result is false
then the <code>&lt;command&gt;</code> expressions are evaluated in order for effect,
the <code>&lt;step&gt;</code> expressions are evaluated in some unspecified order, the
<code>&lt;var&gt;</code>s are bound to fresh locations, the results of the <code>&lt;step&gt;</code>s
are stored in the bindings of the <code>&lt;var&gt;</code>s, and the next iteration
begins.</p>
</div>
<div class="paragraph">
<p>If <code>&lt;test&gt;</code> evaluates to a true value, then the <code>&lt;expr&gt;</code>s are
evaluated from left to right and the value(s) of the last <code>&lt;expr&gt;</code>
is(are) returned.  If no <code>&lt;expr&gt;</code>s are present, then the value of
the do expression is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p>The region of the binding of a <code>&lt;var&gt;</code> consists of the entire do
expression except for the <code>&lt;init&gt;</code>s.  It is an error for a <code>&lt;var&gt;</code> to
appear more than once in the list of do variables.</p>
</div>
<div class="paragraph">
<p>A <code>&lt;step&gt;</code> may be omitted, in which case the effect is the same as if</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">&lt;var&gt;</span> <span class="nv">&lt;init&gt;</span> <span class="nv">&lt;var&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>had been written.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="k">do</span> <span class="p">((</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">5</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">i</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">i</span> <span class="mi">1</span><span class="p">)))</span>
      <span class="p">((</span><span class="nb">=</span> <span class="nv">i</span> <span class="mi">5</span><span class="p">)</span> <span class="nv">vec</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">vec</span> <span class="nv">i</span> <span class="nv">i</span><span class="p">))</span>            <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>

  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">9</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">do</span> <span class="p">((</span><span class="nf">x</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">sum</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">sum</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">))))</span>
        <span class="p">((</span><span class="nb">null?</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">sum</span><span class="p">)))</span>             <span class="nv">=&gt;</span>  <span class="mi">25</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(dotimes [var count] &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br>
<strong><code>(dotimes [var count result] &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Evaluates the <code>count</code> expression, which must return an
integer and then evaluates the <code>&lt;expression&gt;</code>s once for each
integer from zero (inclusive) to <code>count</code> (exclusive), in order,
with the symbol <code>var</code> bound to the integer; if the value of
<code>count</code> is zero or negative, then the <code>&lt;expression&gt;</code>s are not
evaluated. When the loop completes, <code>result</code> is evaluated and its
value is returned as the value of the <code>dotimes</code> construction. If
<code>result</code> is omitted, <code>dotimes</code> result is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">l</span> <span class="o">'</span><span class="p">()))</span>
  <span class="p">(</span><span class="nf">dotimes</span> <span class="p">(</span><span class="nf">i</span> <span class="mi">4</span> <span class="nv">l</span><span class="p">)</span>
     <span class="p">(</span><span class="k">set!</span> <span class="nv">l</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">i</span> <span class="nv">l</span><span class="p">))))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(repeat count &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Evaluates the <code>count</code> expression, which must return an
integer and then evaluates the <code>&lt;expression&gt;</code>s once for each
integer from zero (inclusive) to <code>count</code> (exclusive). The result of
<code>repeat</code> is undefined.</p>
</div>
<div class="paragraph">
<p>This form could be easily simulated with <code>dotimes</code>. Its interest is
that it is faster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">repeat</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">display</span> <span class="s">"."</span><span class="p">))</span>     <span class="nv">=&gt;</span> <span class="nv">prints</span> <span class="s">"..."</span>
<span class="p">(</span><span class="nf">repeat</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">display</span> <span class="s">"."</span><span class="p">))</span>     <span class="nv">=&gt;</span> <span class="nv">prints</span> <span class="nv">nothing</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(while &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>While</code> evaluates the <code>&lt;expression&gt;</code>s until <code>&lt;test&gt;</code> returns a false
value. The value returned by this form is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(until &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Until</code> evaluates the <code>&lt;expression&gt;</code>s until <code>&lt;while&gt;</code> returns a false
value. The value returned by this form is <strong><em>void</em></strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_delayed_evaluation">2.8. Delayed Evaluation</h3>
<div class="paragraph">
<p>

</p>
</div>
<div id="delay" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(delay &lt;expression&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>delay</code> construct is used together with the procedure <code>force</code>
to implement <strong><em>lazy evaluation</em></strong> or <strong><em>call by need</em></strong>. <code>(delay
&lt;expression&gt;)</code> returns an object called a <strong><em>promise</em></strong>) which at some
point in the future may be asked (by the <code>force</code> procedure) to
evaluate <code>&lt;expression&gt;</code>, and deliver the resulting value.
The effect of <code>&lt;expression&gt;</code> returning multiple values is unpredictable.</p>
</div>
<div class="paragraph">
<p>See the description of <code>force</code> for a more complete
description of <code>delay</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(delay-force &lt;expression&gt;)</code></strong><br>
<strong><code>(lazy &lt;expression&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The expression <code>(delay-force expression)</code> is conceptually similar
to <code>(delay (force expression))</code>, with the difference that forcing the result
of <code>delay-force</code> will in effect result in a tail call to <code>(force expression)</code>,
while forcing the result of <code>(delay (force expression))</code> might not. Thus
iterative lazy algorithms that might result in a long series of chains of
<code>delay</code> and <code>force</code> can be rewritten using <code>delay-force</code> to prevent consuming
unbounded space during evaluation.</p>
</div>
<div class="paragraph">
<p>The special form <code>delay-force</code> appears with name <code>lazy</code> in <strong><a href="http://srfi.schemers.org/srfi-45/srfi-45.html">SRFI-45</a></strong> (<em>Primitives for Expressing Iterative Lazy Algorithms</em>).</p>
</div>
<div id="force" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(force promise)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Forces the value of <code>promise</code> (see <em><a href="#delay">primitive delay</a></em>).
If no value has been computed for the promise, then a value is
computed and returned. The value of the promise is cached
(or "memoized") so that if it is forced a second time, the
previously computed value is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">force</span> <span class="p">(</span><span class="k">delay</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)))</span>        <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="k">delay</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">force</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">force</span> <span class="nv">p</span><span class="p">)))</span>  <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">3</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">a-stream</span>
  <span class="p">(</span><span class="k">letrec</span> <span class="p">((</span><span class="nf">next</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">cons</span> <span class="nv">n</span> <span class="p">(</span><span class="k">delay</span> <span class="p">(</span><span class="nf">next</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="nf">next</span> <span class="mi">0</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">head</span> <span class="nv">car</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">tail</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">stream</span><span class="p">)</span> <span class="p">(</span><span class="nb">force</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">stream</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">head</span> <span class="p">(</span><span class="nf">tail</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">a-stream</span><span class="p">)))</span>  <span class="nv">=&gt;</span>  <span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Force</code> and <code>delay</code> are mainly intended for programs written in
functional style. The following examples should not be considered
to illustrate good programming style, but they illustrate the
property that only one value is computed for a promise, no matter
how many times it is forced.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">count</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="k">delay</span> <span class="p">(</span><span class="k">begin</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">count</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">count</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">count</span> <span class="nv">x</span><span class="p">)</span>
                            <span class="nv">count</span>
                            <span class="p">(</span><span class="nb">force</span> <span class="nv">p</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">5</span><span class="p">)</span>
<span class="nv">p</span>                     <span class="nv">=&gt;</span>  <span class="nv">a</span> <span class="nv">promise</span>
<span class="p">(</span><span class="nb">force</span> <span class="nv">p</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="mi">6</span>
<span class="nv">p</span>                     <span class="nv">=&gt;</span>  <span class="nv">a</span> <span class="nv">promise,</span> <span class="nv">still</span>
<span class="p">(</span><span class="k">begin</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">x</span> <span class="mi">10</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">force</span> <span class="nv">p</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="mi">6</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See R<sup>5</sup>RS for details on a posssible way to implement
<code>force</code> and <code>delay</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(promise? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a promise, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-promise obj)</code></strong><br>
<strong><code>(eager obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>make-promise</code> procedure returns a promise which,
when forced, will return <code>obj</code> . It is similar to <code>delay</code>, but
does not delay its argument: it is a procedure rather than
syntax. If <code>obj</code> is already a promise, it is returned.</p>
</div>
<div class="paragraph">
<p>The primitve <code>make-promise</code> appears with name <code>eager</code> in
SRFI-45.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quasiquotation">2.9. Quasiquotation</h3>
<div class="paragraph">
<p>





</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(quasiquote &lt;template&gt;)</code></strong><br>
<strong><code>`&lt;template&gt;</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>"Backquote" or "quasiquote" expressions are useful for constructing a
list or vector structure when most but not all of the desired structure
is known in advance.  If no commas appear within the <code>&lt;template&gt;</code>,
the result of evaluating <code>`&lt;template&gt;</code> is equivalent to the result of
evaluating <code>'&lt;template&gt;</code>.  If a comma appears within the
<code>&lt;template&gt;</code>, however, the expression following the comma is evaluated
("unquoted") and its result is inserted into the structure instead of
the comma and the expression.  If a comma appears followed immediately
by an at-sign (@), then the following expression must evaluate to a
list; the opening and closing parentheses of the list are then
"stripped away" and the elements of the list are inserted in place of the comma
at-sign expression sequence.  A comma at-sign should only appear within
a list or vector <code>&lt;template&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">`</span><span class="p">(</span><span class="nb">list</span> <span class="o">,</span><span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nb">list</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">name</span> <span class="ss">'a</span><span class="p">))</span> <span class="o">`</span><span class="p">(</span><span class="nb">list</span> <span class="o">,</span><span class="nv">name</span> <span class="ss">',name</span><span class="p">))</span>
                    <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">a</span><span class="p">))</span>
<span class="o">`</span><span class="p">(</span><span class="nf">a</span> <span class="o">,</span><span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="o">,@</span><span class="p">(</span><span class="nb">map</span> <span class="nv">abs</span> <span class="o">'</span><span class="p">(</span><span class="nf">4</span> <span class="mi">-5</span> <span class="mi">6</span><span class="p">))</span> <span class="nv">b</span><span class="p">)</span>
                    <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="nv">b</span><span class="p">)</span>
<span class="o">`</span><span class="p">((</span><span class="nf">foo</span> <span class="o">,</span><span class="p">(</span><span class="nb">-</span> <span class="mi">10</span> <span class="mi">3</span><span class="p">))</span> <span class="o">,@</span><span class="p">(</span><span class="nb">cdr</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span><span class="p">))</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nb">cons</span><span class="p">)))</span>
                    <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">foo</span> <span class="mi">7</span><span class="p">)</span> <span class="o">.</span> <span class="nv">cons</span><span class="p">)</span>
<span class="o">`#</span><span class="p">(</span><span class="nf">10</span> <span class="mi">5</span> <span class="o">,</span><span class="p">(</span><span class="nb">sqrt</span> <span class="mi">4</span><span class="p">)</span> <span class="o">,@</span><span class="p">(</span><span class="nb">map</span> <span class="nv">sqrt</span> <span class="o">'</span><span class="p">(</span><span class="nf">16</span> <span class="mi">9</span><span class="p">))</span> <span class="mi">8</span><span class="p">)</span>
                    <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">8</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Quasiquote forms may be nested.  Substitutions are made only for unquoted
components appearing at the same nesting level as the outermost backquote.
The nesting level increases by one inside each successive quasiquotation,
and decreases by one inside each unquotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">`</span><span class="p">(</span><span class="nf">a</span> <span class="o">`</span><span class="p">(</span><span class="nf">b</span> <span class="o">,</span><span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="o">,</span><span class="p">(</span><span class="nf">foo</span> <span class="o">,</span><span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">d</span><span class="p">)</span> <span class="nv">e</span><span class="p">)</span> <span class="nv">f</span><span class="p">)</span>
          <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="o">`</span><span class="p">(</span><span class="nf">b</span> <span class="o">,</span><span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="o">,</span><span class="p">(</span><span class="nf">foo</span> <span class="mi">4</span> <span class="nv">d</span><span class="p">)</span> <span class="nv">e</span><span class="p">)</span> <span class="nv">f</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">name1</span> <span class="ss">'x</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">name2</span> <span class="ss">'y</span><span class="p">))</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">a</span> <span class="o">`</span><span class="p">(</span><span class="nf">b</span> <span class="o">,,</span><span class="nv">name1</span> <span class="o">,</span><span class="ss">',name2</span> <span class="nv">d</span><span class="p">)</span> <span class="nv">e</span><span class="p">))</span>
          <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="o">`</span><span class="p">(</span><span class="nf">b</span> <span class="o">,</span><span class="nv">x</span> <span class="o">,</span><span class="ss">'y</span> <span class="nv">d</span><span class="p">)</span> <span class="nv">e</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The two notations <code>`&lt;template&gt;</code> and <code>(quasiquote &lt;template&gt;)</code> are identical
in all respects.  <code>,&lt;expression&gt;</code> is identical to <code>(unquote &lt;expression&gt;)</code>, and
<code>,@&lt;expression&gt;</code> is identical to <code>(unquote-splicing &lt;expression&gt;)</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_macros">2.10. Macros</h3>
<div class="paragraph">
<p>


STklos supports hygienic macros such as the ones defined in R<sup>5</sup>RS as
well as low level macros.</p>
</div>
<div class="paragraph">
<p>
Low level macros are defined with <code>define-macro</code> whereas R<sup>5</sup>RS macros are
defined with <code>define-syntax</code>.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.  Hygienic macros use the implementation
called <strong><em>Macro by Example</em></strong> (Eugene Kohlbecker, R<sup>4</sup>RS) done by Dorai
Sitaram. This implementation generates low level STklos macros. This
implementation of hygienic macros is not expensive.</p>
</div>
<div class="paragraph">
<p>The major drawback of this implementation is that the macros are not
<strong><em>referentially transparent</em></strong> (see section <strong>Macros</strong> in R<sup>4</sup>RS for
details). Lexically scoped macros (i.e., <code>let-syntax</code> and
<code>letrec-syntax</code> are not supported). In any case, the problem of
referential transparency gains poignancy only when <code>let-syntax</code> and
<code>letrec-syntax</code> are used. So you will not be courting large-scale
disaster unless you&#8217;re using system-function names as local variables
with unintuitive bindings that the macro can&#8217;t use. However, if you
must have the full R<sup>5</sup>RS macro functionality, you can do</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require</span> <span class="s">"full-syntax"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to have access to the more featureful (but also more expensive)
versions of <strong>syntax-rules</strong>. Requiring <code>"full-syntax"</code> loads the
version 2.1 of an implementation of hygienic macros by Robert Hieb
and R. Kent Dybvig.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-macro (&lt;name&gt; &lt;formals&gt;) &lt;body&gt;)</code></strong><br>
<strong><code>(define-macro &lt;name&gt; (lambda &lt;formals&gt; &lt;body&gt;))</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>define-macro</code> can be used to define low-level macro
(i.e. ,(emph "non hygienic") macros). This form is similar to the
<code>defmacro</code> form of Common Lisp.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">incr</span> <span class="nv">x</span><span class="p">)</span> <span class="o">`</span><span class="p">(</span><span class="k">set!</span> <span class="o">,</span><span class="nv">x</span> <span class="p">(</span><span class="nb">+</span> <span class="o">,</span><span class="nv">x</span> <span class="mi">1</span><span class="p">)))</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">a</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="nf">incr</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="mi">2</span>

<span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">when</span> <span class="nv">test</span> <span class="o">.</span> <span class="nv">body</span><span class="p">)</span>
  <span class="o">`</span><span class="p">(</span><span class="k">if</span> <span class="o">,</span><span class="nv">test</span> <span class="o">,@</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">body</span><span class="p">))</span> <span class="nv">body</span> <span class="o">`</span><span class="p">((</span><span class="k">begin</span> <span class="o">,@</span><span class="nv">body</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">macro-expand</span> <span class="o">'</span><span class="p">(</span><span class="nf">when</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="k">if</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="p">(</span><span class="nf">macro-expand</span> <span class="o">'</span><span class="p">(</span><span class="nf">when</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>
                           <span class="nv">=&gt;</span> <span class="p">(</span><span class="k">if</span> <span class="nv">a</span> <span class="p">(</span><span class="k">begin</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">my-and</span> <span class="o">.</span> <span class="nv">exprs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span>
   <span class="p">((</span><span class="nb">null?</span> <span class="nv">exprs</span><span class="p">)</span>        <span class="no">#t</span><span class="p">)</span>
   <span class="p">((</span><span class="nb">=</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">exprs</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">exprs</span><span class="p">))</span>
   <span class="p">(</span><span class="k">else</span>                 <span class="o">`</span><span class="p">(</span><span class="k">if</span> <span class="o">,</span><span class="p">(</span><span class="nb">car</span> <span class="nv">exprs</span><span class="p">)</span>
                           <span class="p">(</span><span class="nf">my-and</span> <span class="o">,@</span><span class="p">(</span><span class="nb">cdr</span> <span class="nv">exprs</span><span class="p">))</span>
                           <span class="no">#f</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">macro-expand</span> <span class="o">'</span><span class="p">(</span><span class="nf">my-and</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>
                          <span class="nv">=&gt;</span> <span class="p">(</span><span class="k">if</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">my-and</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="no">#f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-syntax &lt;identifier&gt; &lt;transformer-spec&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>&lt;Define-syntax&gt;</code>  extends the top-level syntactic environment by binding
the <code>&lt;identifier&gt;</code> to the specified transformer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>&lt;transformer-spec&gt;</code> should be an instance of <code>syntax-rules</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define-syntax</span> <span class="nv">let*</span>
  <span class="p">(</span><span class="k">syntax-rules</span> <span class="p">()</span>
    <span class="p">((</span><span class="k">let*</span> <span class="p">()</span> <span class="nv">body1</span> <span class="nv">body2</span> <span class="o">...</span><span class="p">)</span>
     <span class="p">(</span><span class="k">let</span> <span class="p">()</span> <span class="nv">body1</span> <span class="nv">body2</span> <span class="o">...</span><span class="p">))</span>
    <span class="p">((</span><span class="k">let*</span> <span class="p">((</span><span class="nf">name1</span> <span class="nv">val1</span><span class="p">)</span> <span class="p">(</span><span class="nf">name2</span> <span class="nv">val2</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>
       <span class="nv">body1</span> <span class="nv">body2</span> <span class="o">...</span><span class="p">)</span>
     <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">name1</span> <span class="nv">val1</span><span class="p">))</span>
       <span class="p">(</span><span class="k">let*</span> <span class="p">((</span> <span class="nv">name2</span> <span class="nv">val2</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>
         <span class="nv">body1</span> <span class="nv">body2</span> <span class="o">...</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(syntax-rules &lt;literals&gt; &lt;syntax-rule&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>&lt;literals&gt;</code> is a list of identifiers, and each <code>&lt;syntax-rule&gt;</code> should be of
the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">pattern</span> <span class="nv">template</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An instance of <code>&lt;syntax-rules&gt;</code> produces a new macro transformer by
specifying a sequence of hygienic rewrite rules. A use of a macro
whose name is associated with a transformer specified by
&lt;syntax-rules&gt; is matched against the patterns contained in the
&lt;syntax-rules&gt;, beginning with the leftmost syntax-rule. When a match is
found, the macro use is transcribed hygienically according to the
template.</p>
</div>
<div class="paragraph">
<p>Each pattern begins with the name for the macro. This name is not
involved in the matching and is not considered a pattern variable or
literal identifier.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a complete description of the Scheme pattern language,
refer to R<sup>5</sup>RS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(let-syntax &lt;bindings&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>&lt;Bindings&gt;</code> should have the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="nf">&lt;keyword&gt;</span> <span class="nv">&lt;transformer</span> <span class="nv">spec&gt;</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each <code>&lt;keyword&gt;</code> is an identifier, each <code>&lt;transformer spec&gt;</code> is an instance of
<code>syntax-rules</code>, and <code>&lt;body&gt;</code> should be a sequence of one or more expressions.  It
is an error for a <code>&lt;keyword&gt;</code> to appear more than once in the list of keywords
being bound.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;body&gt;</code> is expanded in the syntactic environment obtained by
extending the syntactic environment of the <code>let-syntax</code> expression with macros
whose keywords are the <code>&lt;keyword&gt;</code>s, bound to the specified transformers.  Each
binding of a <code>&lt;keyword&gt;</code> has <code>&lt;body&gt;</code> as its region.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>let-syntax</code> is available only after having required the file
<code>"full-syntax"</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let-syntax</span> <span class="p">((</span><span class="nf">when</span> <span class="p">(</span><span class="k">syntax-rules</span> <span class="p">()</span>
                  <span class="p">((</span><span class="nf">when</span> <span class="nv">test</span> <span class="nv">stmt1</span> <span class="nv">stmt2</span> <span class="o">...</span><span class="p">)</span>
                   <span class="p">(</span><span class="k">if</span> <span class="nv">test</span>
                       <span class="p">(</span><span class="k">begin</span> <span class="nv">stmt1</span>
                              <span class="nv">stmt2</span> <span class="o">...</span><span class="p">))))))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="k">if</span> <span class="no">#t</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">when</span> <span class="nv">if</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">if</span> <span class="ss">'now</span><span class="p">))</span>
    <span class="nv">if</span><span class="p">))</span>                           <span class="nv">=&gt;</span>  <span class="nv">now</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="ss">'outer</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let-syntax</span> <span class="p">((</span><span class="nf">m</span> <span class="p">(</span><span class="k">syntax-rules</span> <span class="p">()</span> <span class="p">((</span><span class="nf">m</span><span class="p">)</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="ss">'inner</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">m</span><span class="p">))))</span>                       <span class="nv">=&gt;</span>  <span class="nv">outer</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(letrec-syntax &lt;bindings&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Syntax of <code>letrec-syntax</code> is the same as for <code>let-syntax</code>.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;body&gt;</code> is expanded in the syntactic environment obtained by
extending the syntactic environment of the <code>letrec-syntax</code> expression
with macros whose keywords are the <code>&lt;keyword&gt;</code>s, bound to the specified
transformers.  Each binding of a <code>&lt;keyword&gt;</code> has the <code>&lt;bindings&gt;</code> as well
as the <code>&lt;body&gt;</code> within its region, so the transformers can transcribe
expressions into uses of the macros introduced by the <code>letrec-syntax</code>
expression.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>letrec-syntax</code> is available only after having required the file
<code>"full-syntax"</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">letrec-syntax</span>
  <span class="p">((</span><span class="nf">my-or</span> <span class="p">(</span><span class="k">syntax-rules</span> <span class="p">()</span>
            <span class="p">((</span><span class="nf">my-or</span><span class="p">)</span> <span class="no">#f</span><span class="p">)</span>
            <span class="p">((</span><span class="nf">my-or</span> <span class="nv">e</span><span class="p">)</span> <span class="nv">e</span><span class="p">)</span>
            <span class="p">((</span><span class="nf">my-or</span> <span class="nv">e1</span> <span class="nv">e2</span> <span class="o">...</span><span class="p">)</span>
             <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">temp</span> <span class="nv">e1</span><span class="p">))</span>
               <span class="p">(</span><span class="k">if</span> <span class="nv">temp</span>
                   <span class="nv">temp</span>
                   <span class="p">(</span><span class="nf">my-or</span> <span class="nv">e2</span> <span class="o">...</span><span class="p">)))))))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="no">#f</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">y</span> <span class="mi">7</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">temp</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let</span> <span class="nv">odd?</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="nv">even?</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">my-or</span> <span class="nv">x</span>
           <span class="p">(</span><span class="k">let</span> <span class="nv">temp</span><span class="p">)</span>
           <span class="p">(</span><span class="k">if</span> <span class="nv">y</span><span class="p">)</span>
           <span class="nv">y</span><span class="p">)))</span>        <span class="nv">=&gt;</span>  <span class="mi">7</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(macro-expand form)</code></strong><br>
<strong><code>(macro-expand</strong> form)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>macro-expand</code> returns the macro expansion of <code>form</code> if it is a macro call,
otherwise <code>form</code> is returned unchanged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">add1</span> <span class="nv">x</span><span class="p">)</span> <span class="o">`</span><span class="p">(</span><span class="nb">+</span> <span class="o">,</span><span class="nv">x</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">macro-expand</span> <span class="o">'</span><span class="p">(</span><span class="nf">add1</span> <span class="nv">foo</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">foo</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">macro-expand</span> <span class="o">'</span><span class="p">(</span><span class="nb">car</span> <span class="nv">bar</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">bar</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>macro-expand</code> returns the <strong>full</strong> macro expansion of <code>form</code>, that is it repeats
the macro-expansion, while the expanded form contains macro calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">add2</span> <span class="nv">x</span><span class="p">)</span> <span class="o">`</span><span class="p">(</span><span class="nf">add1</span> <span class="p">(</span><span class="nf">add1</span> <span class="o">,</span><span class="nv">x</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">macro-expand</span> <span class="o">'</span><span class="p">(</span><span class="nf">add2</span> <span class="nv">foo</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">add1</span> <span class="p">(</span><span class="nf">add1</span> <span class="nv">foo</span><span class="p">))</span>
<span class="p">(</span><span class="nf">macro-expand*</span> <span class="o">'</span><span class="p">(</span><span class="nf">add2</span> <span class="nv">foo</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">foo</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>macro-expand</code> and <code>macro-expand*</code> expand only the global macros.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_program_structure">3. Program structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>



R<sup>5</sup>RS discusses how to structure programs. Everything which is
defined in Section 5 of R<sup>5</sup>RS applies also to <strong><em>STklos</em></strong>. To make
things shorter, this aspects will not be described here (see R<sup>5</sup>RS
for complete information).</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> modules can be used to organize a program into separate
environments (or <strong><em>name spaces</em></strong>). Modules provide a clean way to
organize and enforce the barriers between the components of a program.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> provides a simple module system which is largely inspired from
the one of Tung and Dybvig exposed in Tung and Dybvig paper <a href="#TuD96">[TuD96]</a>. As their
modules system, <strong><em>STklos</em></strong> modules are defined to be easily used in an
interactive environment.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-module &lt;name&gt; &lt;expr1&gt; &lt;expr2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Define-module</code> evaluates the expressions <code>&lt;expr1&gt;</code>, <code>&lt;expr2&gt;</code> &#8230;&#8203; which
constitute the body of the module <code>&lt;name&gt;</code> in the environment of that module.
<code>Name</code> must be a valid symbol. If this symbol has not already been used to
define a module, a new module, named <code>name</code>, is created.
Otherwise, the expressions <code>&lt;expr1&gt;</code>, <code>&lt;expr2&gt;</code> &#8230;&#8203; are evaluated in
the environment of the (old) module <code>&lt;name&gt;</code><sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="paragraph">
<p>Definitions done in a module are local to the module and do not interact with
the definitions in other modules. Consider the following definitions,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="nv">M1</span>
   <span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-module</span> <span class="nv">M2</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">b</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="nv">x</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, two modules are defined and they both bind the symbol <code>a</code> to a
value. However, since <code>a</code> has been defined in two distinct modules
they denote two different locations.</p>
</div>
<div class="paragraph">
<p>The <code>STklos</code> module, which is predefined, is a special module which
contains all the <strong>global bindings</strong> of a R<sup>5</sup>RS program.  A symbol
defined in the <code>STklos</code> module, if not hidden by a local definition, is
always visible from inside a module. So, in the previous exemple, the
<code>x</code> symbol refers the <code>x</code> symbol defined in the <code>STklos</code> module.</p>
</div>
<div class="paragraph">
<p>The result of <code>define-module</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="nv">M</span>
  <span class="p">(</span><span class="nb">display</span>
      <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nf">current-module</span><span class="p">)</span> <span class="p">(</span><span class="nf">find-module</span> <span class="ss">'M</span><span class="p">))</span>
            <span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nf">current-module</span><span class="p">)</span> <span class="p">(</span><span class="nf">find-module</span> <span class="ss">'STklos</span><span class="p">)))))</span>  <span class="nv">|-</span> <span class="p">(</span><span class="no">#t</span> <span class="o">.</span> <span class="no">#f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(find-module name)</code></strong><br>
<strong><code>(find-module name default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>STklos modules are first class objects and <code>find-module</code> returns the
module associated to <code>name</code> if it exists. If there is no module
associated to <code>name</code>, an error is signaled if no <code>default</code> is
provided, otherwise <code>find-module</code> returns <code>default</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(module? object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>object</code> is a module and <code>#f</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">module?</span> <span class="p">(</span><span class="nf">find-module</span> <span class="ss">'STklos</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">module?</span> <span class="ss">'STklos</span><span class="p">)</span>                 <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">module?</span> <span class="mi">123</span> <span class="ss">'no</span><span class="p">)</span>                 <span class="nv">=&gt;</span> <span class="nv">no</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(export &lt;symbol1&gt; &lt;symbol2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the symbols which are exported (i.e. <strong>visible</strong> outside
the current module). By default, symbols defined in a module are not
visible outside this module, excepted if they appear in an <code>export</code>
clause.</p>
</div>
<div class="paragraph">
<p>If several <code>export</code> clauses appear in a module, the set of
exported symbols is determined by "<em>unionizing</em>" symbols exported
in all the <code>export</code> clauses.</p>
</div>
<div class="paragraph">
<p>The result of <code>export</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(import &lt;module1&gt; &lt;module2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the modules which are imported by the current module.
Importing a module makes the symbols it exports visible to the
importer, if not hidden by local definitions. When a symbol
is exported by several of the imported modules, the location denoted by
this symbol in the importer module correspond to the one of the last module
in the list</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">&lt;module1&gt;</span> <span class="nv">&lt;module2&gt;</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which exports it.</p>
</div>
<div class="paragraph">
<p>If several <code>import</code> clauses appear in a module, the set of
imported modules  is determined by appending the various list of modules
in their apparition order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="nv">M1</span>
  <span class="p">(</span><span class="nf">export</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="ss">'M1-a</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">b</span> <span class="ss">'M1-b</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-module</span> <span class="nv">M2</span>
  <span class="p">(</span><span class="nf">export</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">b</span> <span class="ss">'M2-b</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">c</span> <span class="ss">'M2-c</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">d</span> <span class="ss">'M2-d</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-module</span> <span class="nv">M3</span>
  <span class="p">(</span><span class="nf">import</span> <span class="nv">M1</span> <span class="nv">M2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)))</span>  <span class="nv">|-</span> <span class="p">(</span><span class="nf">M1-a</span> <span class="nv">M2-b</span> <span class="nv">M2-c</span> <span class="nv">M2-d</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-module</span> <span class="nv">M4</span>
  <span class="p">(</span><span class="nf">import</span> <span class="nv">M2</span> <span class="nv">M1</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)))</span>  <span class="nv">|-</span> <span class="p">(</span><span class="nf">M1-a</span> <span class="nv">M1-b</span> <span class="nv">M2-c</span> <span class="nv">M2-d</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to import partially (i.e. not all
exported symbols) from a module, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="nv">M5</span>
  <span class="p">(</span><span class="nf">import</span> <span class="p">(</span><span class="nf">M2</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span> <span class="nv">M1</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)))</span>  <span class="nv">|-</span> <span class="p">(</span><span class="nf">M1-a</span> <span class="nv">M1-b</span> <span class="nv">M2-c</span> <span class="nv">M2-d</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, only the symbols <code>c</code> and <code>d</code> are imported from
module <code>M2</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Importations are not "<em>transitive</em>": when
the module -C_ imports the module <em>B</em> which is an importer
of module <em>A</em> the symbols of <em>A</em> are not visible
from <em>C</em>, except  by explicitly importing the <em>A</em> module from <em>C</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The module <code>STklos</code>, which contains the <em>global variables</em>
is always implicitly imported from a module. Furthermore,
this module is always placed at the end of the list of imported modules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(select-module &lt;name&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Changes the value of the current module to the module with the given <code>name</code>.
The expressions evaluated after <code>select-module</code> will take place in
module <code>name</code> environment.  Module <code>name</code> must have been created
previously by a <code>define-module</code>. The result of <code>select-module</code> is
<strong><em>void</em></strong>.
<code>Select-module</code> is particularly useful when debugging since it
allows to place toplevel evaluation in a particular module. The
following transcript shows an usage of <code>select-module</code>.
<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">stklos&gt;</span> <span class="p">(</span><span class="k">define</span> <span class="nv">foo</span> <span class="mi">1</span><span class="p">)</span>
<span class="nv">stklos&gt;</span> <span class="p">(</span><span class="nf">define-module</span> <span class="nv">bar</span>
          <span class="p">(</span><span class="k">define</span> <span class="nv">foo</span> <span class="mi">2</span><span class="p">))</span>
<span class="nv">stklos&gt;</span> <span class="nv">foo</span>
<span class="mi">1</span>
<span class="nv">stklos&gt;</span> <span class="p">(</span><span class="nf">select-module</span> <span class="nv">bar</span><span class="p">)</span>
<span class="nv">bar&gt;</span> <span class="nv">foo</span>
<span class="mi">2</span>
<span class="nv">bar&gt;</span> <span class="p">(</span><span class="nf">select-module</span> <span class="nv">stklos</span><span class="p">)</span>
<span class="nv">stklos&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(symbol-value symbol module)</code></strong><br>
<strong><code>(symbol-value symbol module default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the value bound to <code>symbol</code> in <code>module</code>. If <code>symbol</code> is not bound,
an error is signaled if no <code>default</code> is provided, otherwise <code>symbol-value</code>
returns <code>default</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(symbol-value* symbol module)</code></strong><br>
<strong><code>(symbol-value* symbol module default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the value bound to <code>symbol</code> in <code>module</code>. If <code>symbol</code> is not bound,
an error is signaled if no <code>default</code> is provided, otherwise <code>symbol-value</code>
returns <code>default</code>.</p>
</div>
<div class="paragraph">
<p>Note that this function searches the value of <code>symbol</code> in <code>module</code>
<strong>and</strong> in the STklos module if module is not a R<sup>7</sup>RS library.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(module-name module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name (a symbol) associated to a <code>module</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(module-imports module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the list of modules that <code>module</code> (fully) imports.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(module-exports module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the list of symbols exported by <code>module</code>. Note that this function
returns the list of symbols given in the module <code>export</code> clause and that
some of these symbols can be not yet defined.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(module-symbols module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the list of symbols already defined in <code>module</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(module-symbols* module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the the list of symbols acessible in <code>module</code> (that is the symbols
defined in <code>module</code> and the one defined in the <code>STklos</code> module if module
is not a R<sup>7</sup>RS library.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(all-modules)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the list of all the living modules.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(in-module mod s)</code></strong><br>
<strong><code>(in-module mod s default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This form returns the value of symbol with name <code>s</code> in the module with name
<code>mod</code>. If this symbol is not bound,  an error is signaled if no <code>default</code> is
provided, otherwise <code>in-module</code> returns <code>default</code>. Note that the value of <code>s</code>
is searched in <code>mod</code> and all the modules it imports.</p>
</div>
<div class="paragraph">
<p>This form is in fact a shortcut. In effect,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">in-module</span> <span class="nv">my-module</span> <span class="nv">foo</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">symbol-value*</span> <span class="ss">'foo</span> <span class="p">(</span><span class="nf">find-module</span> <span class="ss">'my-module</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_standard_procedures">4. Standard Procedures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_equivalence_predicates">4.1. Equivalence predicates</h3>
<div class="paragraph">
<p>A predicate is a procedure that always returns a boolean value
(<code>#t</code> or <code>#f</code>). An equivalence predicate is the
computational analogue of a mathematical equivalence relation (it
is symmetric, reflexive, and transitive).  Of the equivalence
predicates described in this section, <code>eq?</code> is the finest
or most discriminating, and <code>equal?</code> is the coarsest.
<code>Eqv?</code> is slightly less discriminating than <code>eq?</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(eqv? obj1 obj2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>eqv?</code> procedure defines a useful equivalence relation on objects.
Briefly, it returns <code>#t</code> if <code>obj1</code> and <code>obj2</code> should normally be regarded
as the same object. This relation is left slightly open to interpretation,
but the following partial specification of <code>eqv?</code> holds for all
implementations of Scheme.</p>
</div>
<div class="paragraph">
<p>The <code>eqv?</code> procedure returns <code>#t</code> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>obj1</code> and <code>obj2</code> are both <code>#t</code> or both <code>#f</code>.</p>
</li>
<li>
<p><code>obj1</code> and <code>obj2</code> are both symbols and</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">string=?</span> <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="nv">obj1</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="nv">obj2</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This assumes that neither <code>obj1</code> nor <code>obj2</code> is an
"uninterned symbol".
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>obj1</code> and <code>obj2</code> are both keywords and</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">string=?</span> <span class="p">(</span><span class="nf">keyword-&gt;string</span> <span class="nv">obj1</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">keyword-&gt;string</span> <span class="nv">obj2</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>obj1</code> and <code>obj2</code> are both numbers, are <em><a href="#numeq">numerically equal</a></em>,
and are either both exact or both inexact.</p>
</li>
<li>
<p><code>obj1</code> and <code>obj2</code> are both characters and are the same character
according to the <em><a href="#chareq"><code>char=?</code> procedure</a>`</em>.</p>
</li>
<li>
<p>both <code>obj1</code> and <code>obj2</code> are the empty list.</p>
</li>
<li>
<p><code>obj1</code> and <code>obj2</code> are pairs, vectors, or strings that denote
the same locations in the store.</p>
</li>
<li>
<p><code>obj1</code> and <code>obj2</code> are procedures whose location tags are equal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>STklos extends R<sup>5</sup>RS <code>eqv?</code> to take into account
the keyword type. Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eqv?</span> <span class="ss">'a</span> <span class="ss">'a</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="ss">'a</span> <span class="ss">'b</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span>                       <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="nv">:foo</span> <span class="nv">:foo</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="o">#</span><span class="nv">:foo</span> <span class="nv">:foo</span><span class="p">)</span>                <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="nv">:foo</span> <span class="nv">:bar</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">())</span>                   <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="mi">100000000</span> <span class="mi">100000000</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="mi">2</span><span class="p">))</span>             <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="no">#f</span> <span class="ss">'nil</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">eqv?</span> <span class="nv">p</span> <span class="nv">p</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following examples illustrate cases in which the above rules do
not fully specify the behavior of <code>eqv?</code>. All that can be said about
such cases is that the value returned by eqv? must be a boolean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eqv?</span> <span class="s">""</span> <span class="s">""</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="o">'#</span><span class="p">()</span> <span class="o">'#</span><span class="p">())</span>         <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eqv?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="nv">y</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="nv">unspecified</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In fact, the value returned by STklos depends on
the way code is entered and can yield <code>#t</code> in some cases and <code>#f</code>
in others.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See R<sup>5</sup>RS for more details on <code>eqv?</code>.</p>
</div>
<div id="eqprim" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(eq? obj1 obj2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Eq?</code> is similar to <code>eqv?</code> except that in some cases it is capable of
discerning distinctions finer than those detectable by <code>eqv?</code>.</p>
</div>
<div class="paragraph">
<p><code>Eq?</code> and <code>eqv?</code> are guaranteed to have the same behavior on symbols,
keywords, booleans, the empty list, pairs, procedures, and non-empty strings
and vectors. <code>Eq?</code>'s behavior on numbers and characters is
implementation-dependent, but it will always return either true or false,
and will return true only when <code>eqv?</code> would also return true.
<code>Eq?</code> may also behave differently from <code>eqv?</code> on empty vectors
and empty strings.<br>
Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>STklos extends R<sup>5</sup>RS <code>eq?</code> to take into account  the keyword type.</p>
</li>
<li>
<p>In STklos, comparison of character returns <code>#t</code> for identical
characters and <code>#f</code> otherwise.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eq?</span> <span class="ss">'a</span> <span class="ss">'a</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">))</span>                 <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">))</span>       <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="s">"a"</span> <span class="s">"a"</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="s">""</span> <span class="s">""</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="nv">:foo</span> <span class="nv">:foo</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="nv">:foo</span> <span class="nv">:bar</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="o">'</span><span class="p">()</span> <span class="o">'</span><span class="p">())</span>                   <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span>                       <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="o">#</span><span class="nv">A</span> <span class="o">#</span><span class="nv">A</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="no">#t</span> <span class="p">(</span><span class="nf">unspecified</span> <span class="nv">in</span> <span class="nv">r5rs</span><span class="p">)</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="nv">car</span> <span class="nv">car</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">n</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">eq?</span> <span class="nv">n</span> <span class="nv">n</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="no">#t</span> <span class="p">(</span><span class="nf">unspecified</span> <span class="nv">in</span> <span class="nv">r5rs</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">eq?</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="o">'#</span><span class="p">()))</span>
  <span class="p">(</span><span class="nb">eq?</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">eq?</span> <span class="nv">p</span> <span class="nv">p</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="nv">:foo</span> <span class="nv">:foo</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="nv">:bar</span> <span class="nv">bar:</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">eq?</span> <span class="nv">:bar</span> <span class="nv">:foo</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(equal? obj1 obj2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Equal?</code> recursively compares the contents of pairs, vectors, and
strings, applying <code>eqv?</code> on other objects such as numbers and symbols.
A rule of thumb is that objects are generally <code>equal?</code> if they print the
same. <code>Equal?</code> always terminates even if its arguments are circular
data structures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">equal?</span> <span class="ss">'a</span> <span class="ss">'a</span><span class="p">)</span>                  <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">equal?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">equal?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span>
        <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">)</span> <span class="nv">c</span><span class="p">))</span>             <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">equal?</span> <span class="s">"abc"</span> <span class="s">"abc"</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">equal?</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span>                    <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">equal?</span> <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">5</span> <span class="ss">'a</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">5</span> <span class="ss">'a</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">equal?</span> <span class="o">'#</span><span class="mi">1</span><span class="nv">=</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="o">.</span> <span class="o">#</span><span class="mi">1</span><span class="o">#</span><span class="p">)</span>
        <span class="o">'#</span><span class="mi">2</span><span class="nv">=</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">a</span> <span class="nv">b</span> <span class="o">.</span> <span class="o">#</span><span class="mi">2</span><span class="o">#</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A rule of thumb is that objects are generally
<code>equal?</code> if they print the same.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_numbers">4.2. Numbers</h3>
<div class="paragraph">
<p>R<sup>5</sup>RS description of numbers is quite long and will not be given here.
STklos support the full number tower as described in R<sup>5</sup>RS; see this
document for a complete description.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> extends the number syntax of R5RS with the following
inexact numerical constants: <code>+inf.0</code> (infinity), <code>-inf.0</code> (negative
infinity), <code>+nan.0</code> (not a number), and <code>-nan.0</code> (not a number).</p>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(number? obj)</code></strong><br>
<strong><code>(complex? obj)</code></strong><br>
<strong><code>(real? obj)</code></strong><br>
<strong><code>(rational? obj)</code></strong><br>
<strong><code>(integer? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These numerical type predicates can be applied to any kind of
argument, including non-numbers. They return <code>#t</code> if the object is of
the named type, and otherwise they return <code>#f</code>. In general, if a type
predicate is true for a number then all higher type predicates are
also true for that number. Consequently, if a type predicate is
false of a number, then all lower type predicates are also false of
that number.</p>
</div>
<div class="paragraph">
<p>If <code>z</code> is an inexact complex number, then <code>(real? z)</code> is true if and
only if <code>(zero? (imag-part z))</code> is true. If <code>x</code> is an inexact real
number, then <code>(integer? x)</code> is true if and only if
<code>(and (finite? x) (= x (round x)))</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nb">complex?</span> <span class="mi">3</span><span class="nv">+4i</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">complex?</span> <span class="mi">3</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">real?</span> <span class="mi">3</span><span class="p">)</span>               <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">real?</span> <span class="mf">-2.5</span><span class="nv">+0</span><span class="o">.</span><span class="mi">0</span><span class="nv">i</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">real?</span> <span class="mx">#e1</span><span class="nv">e10</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">rational?</span> <span class="mi">6</span><span class="nv">/10</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">rational?</span> <span class="mi">6</span><span class="nv">/3</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">integer?</span> <span class="mi">3</span><span class="nv">+0i</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">integer?</span> <span class="mf">3.0</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">integer?</span> <span class="mf">3.2</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">integer?</span> <span class="mi">8</span><span class="nv">/4</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">integer?</span> <span class="s">"no"</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">complex?</span> <span class="m">+inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">real?</span> <span class="m">-inf.0</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">rational?</span> <span class="m">+inf.0</span><span class="p">)</span>      <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">integer?</span> <span class="m">-inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exact? z)</code></strong><br>
<strong><code>(inexact? z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These numerical predicates provide tests for the exactness of a
quantity. For any Scheme number, precisely one of these predicates
is true.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(inexact z)</code></strong><br>
<strong><code>(exact z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These R<sup>7</sup>RS procedures correspond to the R<sup>5</sup>RS <code>exact&#8594;inexact</code>
and <code>inexact&#8594;exact</code> procedure respectively</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exact&#8594;integer? z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns  #t if z is both exact and an integer; otherwise returns #f.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">exact-integer?</span> <span class="mi">32</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">exact-integer?</span> <span class="mf">32.0</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">exact-integer?</span> <span class="mi">32</span><span class="nv">/5</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bignum? x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This predicates returns <code>#t</code> if <code>x</code> is an integer number too large to be
represented with a native integer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">bignum?</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">300</span><span class="p">))</span>     <span class="nv">=&gt;</span> <span class="o">`</span><span class="no">#t</span><span class="o">`</span>   <span class="c1">;; (very likely)</span>
<span class="p">(</span><span class="nf">bignum?</span> <span class="mi">12</span><span class="p">)</span>               <span class="nv">=&gt;</span> <span class="o">`</span><span class="no">#f</span><span class="o">`</span>
<span class="p">(</span><span class="nf">bignum?</span> <span class="s">"no"</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="o">`</span><span class="no">#f</span><span class="o">`</span></code></pre>
</div>
</div>
<div id="numeq" class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(= z1 z2 z3 &#8230;&#8203;)</code></strong><br>
<strong><code>(&lt; x1 x2 x3 &#8230;&#8203;)</code></strong><br>
<strong><code>(&gt; x1 x2 x3 &#8230;&#8203;)</code></strong><br>
<strong><code>(&#8656; x1 x2 x3 &#8230;&#8203;)</code></strong><br>
<strong><code>(&gt;= x1 x2 x3 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing,
monotonically nondecreasing, or monotonically nonincreasing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">=</span> <span class="m">+inf.0</span> <span class="m">+inf.0</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">=</span> <span class="m">-inf.0</span> <span class="m">+inf.0</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">=</span> <span class="m">-inf.0</span> <span class="m">-inf.0</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For any finite real number x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">&lt;</span> <span class="m">-inf.0</span> <span class="nv">x</span> <span class="m">+inf.0</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">&gt;</span> <span class="m">+inf.0</span> <span class="nv">x</span> <span class="m">-inf.0</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>





</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(finite? z)</code></strong><br>
<strong><code>(infinite? z)</code></strong><br>
<strong><code>(zero? z)</code></strong><br>
<strong><code>(positive? x)</code></strong><br>
<strong><code>(negative? x)</code></strong><br>
<strong><code>(odd? n)</code></strong><br>
<strong><code>(even? n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These numerical predicates test a number for a particular property,
returning <code>#t</code> or <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">positive?</span> <span class="m">+inf.0</span><span class="p">)</span>          <span class="nv">==&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">negative?</span> <span class="m">-inf.0</span><span class="p">)</span>          <span class="nv">==&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nf">finite?</span> <span class="m">-inf.0</span><span class="p">)</span>            <span class="nv">==&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nf">infinite?</span> <span class="m">+inf.0</span><span class="p">)</span>          <span class="nv">==&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(nan? z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>nan?</code> procedure returns #t on <code>+nan.0</code>, and on complex
numbers if their real or imaginary parts or both are <code>+nan.0</code>.
Otherwise it returns #f.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">nan?</span> <span class="nv">+nan</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nf">nan?</span> <span class="mi">32</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nf">nan?</span> <span class="nv">+nan</span><span class="o">.</span><span class="mi">0</span><span class="nv">+5</span><span class="o">.</span><span class="mi">0</span><span class="nv">i</span><span class="p">)</span>     <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nf">nan?</span> <span class="mi">1</span><span class="nv">+2i</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-nan negative? quiet? payload)</code></strong><br>
<strong><code>(make-nan negative? quiet? payload float)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a NaN whose sign bit is equal to <code>negative?</code>  (<code>#t</code> for negative,
<code>#f</code> for positive), whose quiet bit is equal to quiet? (<code>#t</code> for quiet,
<code>#f</code> for signaling), and whose payload is the positive exact integer payload.
It is an error if payload is larger than a NaN can hold.</p>
</div>
<div class="paragraph">
<p>The optional parameter <code>float</code>, is never used in <strong><em>STklos</em></strong>.</p>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-208/srfi-208.html">SRFI-208</a></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(nan-negative? nan)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>returns <code>#t</code> if the sign bit of <code>nan</code> is set and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(nan-quiet? nan)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>returns <code>#t</code> if <code>nan</code> is a quiet NaN.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(nan-payload nan)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>returns  the payload bits of <code>nan</code> as a positive exact integer.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(nan=? nan1 nan2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>nan1</code> and <code>nan2</code> have the same sign, quiet bit,
and payload; and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(max x1 x2 &#8230;&#8203;)</code></strong><br>
<strong><code>(min x1 x2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the maximum or minimum of their arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">max</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="mi">4</span>    <span class="c1">; exact</span>
<span class="p">(</span><span class="nb">max</span> <span class="mf">3.9</span> <span class="mi">4</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="mf">4.0</span>  <span class="c1">; inexact</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For any real number x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">max</span> <span class="m">+inf.0</span> <span class="nv">x</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="m">+inf.0</span>
<span class="p">(</span><span class="nb">min</span> <span class="m">-inf.0</span> <span class="nv">x</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="m">-inf.0</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If any argument is inexact, then the result will also be
inexact
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>




</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(floor/ n1 n2)</code></strong><br>
<strong><code>(floor-quotient n1 n2)</code></strong><br>
<strong><code>(floor-remainder n1 n2)</code></strong><br>
<strong><code>(truncate/ n1 n2)</code></strong><br>
<strong><code>(truncate-quotient n1 n2)</code></strong><br>
<strong><code>(truncate-remainder n1 n2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures implement number-theoretic (integer) division.  It is
an error if <code>n2</code> is zero. The procedures ending in '/' return two integers;
the other procedures return an integer.  All the procedures compute a
quotient <code>q</code> and remainder <code>r</code> such that <code>n1=n2*q+r</code>.</p>
</div>
<div class="paragraph">
<p>See R<sup>7</sup>RS for more information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">floor/</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">floor/</span> <span class="mi">-5</span> <span class="mi">2</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">-3</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">floor/</span> <span class="mi">5</span> <span class="mi">-2</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">-3</span> <span class="mi">-1</span>
<span class="p">(</span><span class="nf">floor/</span> <span class="mi">-5</span> <span class="mi">-2</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="mi">2</span> <span class="mi">-1</span>
<span class="p">(</span><span class="nf">truncate/</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">truncate/</span> <span class="mi">-5</span> <span class="mi">2</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">-2</span> <span class="mi">-1</span>
<span class="p">(</span><span class="nf">truncate/</span> <span class="mi">5</span> <span class="mi">-2</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">-2</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">truncate/</span> <span class="mi">-5</span> <span class="mi">-2</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="mi">2</span> <span class="mi">-1</span>
<span class="p">(</span><span class="nf">truncate/</span> <span class="mf">-5.0</span> <span class="mi">-2</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mf">2.0</span> <span class="mf">-1.0</span><span class="nv">%</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(+ z1 &#8230;&#8203;)</code></strong><br>
<strong><code>(</strong> z1 &#8230;&#8203;)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the sum or product of their arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">+</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="mi">7</span>
<span class="p">(</span><span class="nb">+</span> <span class="mi">3</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="nb">+</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="mi">0</span>
<span class="p">(</span><span class="nb">+</span> <span class="m">+inf.0</span> <span class="m">+inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="m">+inf.0</span>
<span class="p">(</span><span class="nb">+</span> <span class="m">+inf.0</span> <span class="m">-inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="nv">+nan</span><span class="o">.</span><span class="mi">0</span>
<span class="p">(</span><span class="nb">*</span> <span class="mi">4</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">4</span>
<span class="p">(</span><span class="nb">*</span><span class="p">)</span>                     <span class="nv">=&gt;</span>  <span class="mi">1</span>
<span class="p">(</span><span class="nb">*</span> <span class="mi">5</span> <span class="m">+inf.0</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="m">+inf.0</span>
<span class="p">(</span><span class="nb">*</span> <span class="mi">-5</span> <span class="m">+inf.0</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="m">-inf.0</span>
<span class="p">(</span><span class="nb">*</span> <span class="m">+inf.0</span> <span class="m">+inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="m">+inf.0</span>
<span class="p">(</span><span class="nb">*</span> <span class="m">+inf.0</span> <span class="m">-inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="m">-inf.0</span>
<span class="p">(</span><span class="nb">*</span> <span class="mi">0</span> <span class="m">+inf.0</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="nv">+nan</span><span class="o">.</span><span class="mi">0</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For any finite number z:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">      <span class="p">(</span><span class="nb">+</span> <span class="m">+inf.0</span> <span class="nv">z</span><span class="p">)</span>      <span class="nv">=&gt;</span>  <span class="m">+inf.0</span>
      <span class="p">(</span><span class="nb">+</span> <span class="m">-inf.0</span> <span class="nv">z</span><span class="p">)</span>      <span class="nv">=&gt;</span>  <span class="m">-inf.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(- z)</code></strong><br>
<strong><code>(- z1 z2)</code></strong><br>
<strong><code>(/ z)</code></strong><br>
<strong><code>(/ z1 z2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>With two or more arguments, these procedures return the difference or quotient
of their arguments, associating to the left. With one argument, however,
they return the additive or multiplicative inverse of their argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">-</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="mi">-1</span>
<span class="p">(</span><span class="nb">-</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span>               <span class="nv">=&gt;</span>  <span class="mi">-6</span>
<span class="p">(</span><span class="nb">-</span> <span class="mi">3</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">-3</span>
<span class="p">(</span><span class="nb">-</span> <span class="m">+inf.0</span> <span class="m">+inf.0</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="nv">+nan</span><span class="o">.</span><span class="mi">0</span>
<span class="p">(</span><span class="nb">/</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span>               <span class="nv">=&gt;</span>  <span class="mi">3</span><span class="nv">/20</span>
<span class="p">(</span><span class="nb">/</span> <span class="mi">3</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">1</span><span class="nv">/3</span>
<span class="p">(</span><span class="nb">/</span> <span class="mf">0.0</span><span class="p">)</span>                 <span class="nv">=&gt;</span> <span class="m">+inf.0</span>
<span class="p">(</span><span class="nb">/</span> <span class="mi">0</span><span class="p">)</span>                   <span class="nv">=&gt;</span> <span class="nv">error</span> <span class="p">(</span><span class="nf">division</span> <span class="nv">by</span> <span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(abs x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Abs</code> returns the absolute value of its argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">abs</span> <span class="mi">-7</span><span class="p">)</span>                <span class="nv">=&gt;</span>  <span class="mi">7</span>
<span class="p">(</span><span class="nb">abs</span> <span class="m">-inf.0</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="m">+inf.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(quotient n1 n2)</code></strong><br>
<strong><code>(remainder n1 n2)</code></strong><br>
<strong><code>(modulo n1 n2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures implement number-theoretic (integer) division. n2 should
be non-zero. All three procedures return integers.</p>
</div>
<div class="paragraph">
<p>If <code>n1/n2</code> is an integer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">quotient</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="nv">n1/n2</span>
<span class="p">(</span><span class="nb">remainder</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nb">modulo</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If n1/n2 is not an integer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">quotient</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="nv">nq</span>
<span class="p">(</span><span class="nb">remainder</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="nv">nr</span>
<span class="p">(</span><span class="nb">modulo</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="nv">nm</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>nq</code> is <code>n1/n2</code> rounded towards zero, 0 &lt; abs(nr) &lt; abs(n2),
0 &lt; abs(nm) &lt; abs(n2), <code>nr</code> and <code>nm</code> differ from n1 by a multiple of n2,
<code>nr</code> has the same sign as n1, and <code>nm</code> has the same sign as n2.</p>
</div>
<div class="paragraph">
<p>From this we can conclude that for integers <code>n1</code> and <code>n2</code> with <code>n2</code> not
equal to 0,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="nb">=</span> <span class="nv">n1</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n2</span> <span class="p">(</span><span class="nb">quotient</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">remainder</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)))</span>   <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>provided all numbers involved in that computation are exact.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">modulo</span> <span class="mi">13</span> <span class="mi">4</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mi">1</span>
<span class="p">(</span><span class="nb">remainder</span> <span class="mi">13</span> <span class="mi">4</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="mi">1</span>

<span class="p">(</span><span class="nb">modulo</span> <span class="mi">-13</span> <span class="mi">4</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="nb">remainder</span> <span class="mi">-13</span> <span class="mi">4</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="mi">-1</span>

<span class="p">(</span><span class="nb">modulo</span> <span class="mi">13</span> <span class="mi">-4</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mi">-3</span>
<span class="p">(</span><span class="nb">remainder</span> <span class="mi">13</span> <span class="mi">-4</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="mi">1</span>

<span class="p">(</span><span class="nb">modulo</span> <span class="mi">-13</span> <span class="mi">-4</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="mi">-1</span>
<span class="p">(</span><span class="nb">remainder</span> <span class="mi">-13</span> <span class="mi">-4</span><span class="p">)</span>      <span class="nv">=&gt;</span>  <span class="mi">-1</span>

<span class="p">(</span><span class="nb">remainder</span> <span class="mi">-13</span> <span class="mf">-4.0</span><span class="p">)</span>    <span class="nv">=&gt;</span>  <span class="mf">-1.0</span>  <span class="c1">; inexact</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(gcd n1 &#8230;&#8203;)</code></strong><br>
<strong><code>(lcm n1 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the greatest common divisor or least common
multiple of their arguments. The result is always non-negative.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">gcd</span> <span class="mi">32</span> <span class="mi">-36</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="mi">4</span>
<span class="p">(</span><span class="nb">gcd</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">0</span>
<span class="p">(</span><span class="nb">lcm</span> <span class="mi">32</span> <span class="mi">-36</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="mi">288</span>
<span class="p">(</span><span class="nb">lcm</span> <span class="mf">32.0</span> <span class="mi">-36</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mf">288.0</span>  <span class="c1">; inexact</span>
<span class="p">(</span><span class="nb">lcm</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(numerator q)</code></strong><br>
<strong><code>(denominator q)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the numerator or denominator of their argument; the
result is computed as if the argument was represented as a fraction in
lowest terms. The denominator is always positive. The denominator of
0 is defined to be 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">numerator</span> <span class="p">(</span><span class="nb">/</span> <span class="mi">6</span> <span class="mi">4</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="nb">denominator</span> <span class="p">(</span><span class="nb">/</span> <span class="mi">6</span> <span class="mi">4</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="mi">2</span>
<span class="p">(</span><span class="nb">denominator</span>
<span class="p">(</span><span class="nb">exact-&gt;inexact</span> <span class="p">(</span><span class="nb">/</span> <span class="mi">6</span> <span class="mi">4</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="mf">2.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(floor x)</code></strong><br>
<strong><code>(ceiling x)</code></strong><br>
<strong><code>(truncate x)</code></strong><br>
<strong><code>(round x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return integers. <code>Floor</code> returns the largest integer not
larger than <code>x</code>. <code>Ceiling</code> returns the smallest integer not smaller than <code>x</code>.
<code>Truncate</code> returns the integer closest to <code>x</code> whose absolute value is not
larger than the absolute value of <code>x</code>. <code>Round</code> returns the closest integer
to <code>x</code>, rounding to even when <code>x</code> is halfway between two integers.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>Round</code> rounds to even for consistency with the default
rounding mode specified by the IEEE floating point standard.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the argument to one of these procedures is inexact, then the
result will also be inexact. If an exact value is needed, the result should
be passed to the <code>inexact&#8594;exact</code> procedure.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">floor</span> <span class="mf">-4.3</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mf">-5.0</span>
<span class="p">(</span><span class="nb">ceiling</span> <span class="mf">-4.3</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="mf">-4.0</span>
<span class="p">(</span><span class="nb">truncate</span> <span class="mf">-4.3</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="mf">-4.0</span>
<span class="p">(</span><span class="nb">round</span> <span class="mf">-4.3</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mf">-4.0</span>

<span class="p">(</span><span class="nb">floor</span> <span class="mf">3.5</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mf">3.0</span>
<span class="p">(</span><span class="nb">ceiling</span> <span class="mf">3.5</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="mf">4.0</span>
<span class="p">(</span><span class="nb">truncate</span> <span class="mf">3.5</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="mf">3.0</span>
<span class="p">(</span><span class="nb">round</span> <span class="mf">3.5</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mf">4.0</span>  <span class="c1">; inexact</span>

<span class="p">(</span><span class="nb">round</span> <span class="mi">7</span><span class="nv">/2</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mi">4</span>    <span class="c1">; exact</span>
<span class="p">(</span><span class="nb">round</span> <span class="mi">7</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="mi">7</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(rationalize x y)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Rationalize returns the simplest rational number differing from <code>x</code>
by no more than <code>y</code>. A rational number <code>r1</code> is simpler than another
rational number <code>r2</code> if <code>r1</code> = <code>p1/q1</code> and <code>r2</code> = <code>p2/q2</code> (in lowest
terms) and abs(p1) &#8656; abs(p2) and abs(q1) &#8656; abs(q2). Thus <code>3/5</code> is
simpler than <code>4/7</code>. Although not all rationals are comparable in
this ordering  (consider <code>2/7</code> and <code>3/5</code>) any interval contains a
rational number that
is simpler than every other rational number in that interval (the
simpler <code>2/5</code> lies between <code>2/7</code> and <code>3/5</code>). Note that <code>0</code> = <code>0/1</code> is the
simplest rational of all.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">rationalize</span>
   <span class="p">(</span><span class="nb">inexact-&gt;exact</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="mi">1</span><span class="nv">/10</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">1</span><span class="nv">/3</span>    <span class="c1">; exact</span>
<span class="p">(</span><span class="nb">rationalize</span> <span class="o">.</span><span class="mi">3</span> <span class="mi">1</span><span class="nv">/10</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="mx">#i1</span><span class="nv">/3</span>  <span class="c1">; inexact</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>






</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exp z)</code></strong><br>
<strong><code>(log z)</code></strong><br>
<strong><code>(log z b)</code></strong><br>
<strong><code>(sin z)</code></strong><br>
<strong><code>(cos z)</code></strong><br>
<strong><code>(tan z)</code></strong><br>
<strong><code>(asin z)</code></strong><br>
<strong><code>(acos z)</code></strong><br>
<strong><code>(atan z)</code></strong><br>
<strong><code>(atan y x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures compute the usual transcendental functions. <code>Log</code> computes the
natural logarithm of z (not the base ten logarithm). <code>Asin</code>, <code>acos</code>,
and <code>atan</code> compute arcsine, arccosine, and  arctangent, respectively.
The two-argument variant of <code>log</code> computes the logarithm of x in base b as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">log</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">log</span> <span class="nv">b</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The two-argument variant of <code>atan</code> computes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">angle</span> <span class="p">(</span><span class="nb">make-rectangular</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When it is possible these procedures produce a real result from a real
argument.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(sqrt z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the principal square root of <code>z</code>. The result will have either
positive real part, or zero real part and non-negative imaginary part.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(square z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the square of <code>z</code>. This is equivalent to <code>(* z z)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">square</span> <span class="mi">42</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">1764</span>
<span class="p">(</span><span class="nf">square</span> <span class="mf">2.0</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="mf">4.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exact-integer-sqrt k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns two non negatives integers <code>s</code> and <code>r</code> where
<code>k=s<strong>2+r</code> and <code>k&lt;(s+1)</strong>2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">exact-integer-sqrt</span> <span class="mi">4</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">2</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">exact-integer-sqrt</span> <span class="mi">5</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">2</span> <span class="mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(expt z1 z2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>z1</code> raised to the power <code>z2</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>0,(sup "z")</code> is 1 if <code>z = 0</code> and <code>0</code> otherwise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>




</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-rectangular x1 x2)</code></strong><br>
<strong><code>(make-polar x3 x)</code></strong><br>
<strong><code>(real-part z)</code></strong><br>
<strong><code>(imag-part z)</code></strong><br>
<strong><code>(magnitude z)</code></strong><br>
<strong><code>(angle z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If x1, x2, x3, and x4 are real numbers and z is a complex number such that</p>
</div>
<div class="paragraph">
<p><code>z = x1 + x2.i = x3 . e,(sup "i.x4")</code></p>
</div>
<div class="paragraph">
<p>Then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">make-rectangular</span> <span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="nv">z</span>
<span class="p">(</span><span class="nb">make-polar</span> <span class="nv">x3</span> <span class="nv">x4</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="nv">z</span>
<span class="p">(</span><span class="nb">real-part</span> <span class="nv">z</span><span class="p">)</span>                  <span class="nv">=&gt;</span> <span class="nv">x1</span>
<span class="p">(</span><span class="nb">imag-part</span> <span class="nv">z</span><span class="p">)</span>                  <span class="nv">=&gt;</span> <span class="nv">x2</span>
<span class="p">(</span><span class="nb">magnitude</span> <span class="nv">z</span><span class="p">)</span>                  <span class="nv">=&gt;</span> <span class="nv">abs</span><span class="p">(</span><span class="nf">x3</span><span class="p">)</span>
<span class="p">(</span><span class="nb">angle</span> <span class="nv">z</span><span class="p">)</span>                      <span class="nv">=&gt;</span> <span class="nv">xa</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where
<code>-,(symbol "pi") &lt; xa &#8656; ,(symbol "pi")</code> with <code>xa = x4 + 2,(symbol "pi")n</code>
for some integer n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">angle</span> <span class="m">+inf.0</span><span class="p">)</span>                 <span class="nv">=&gt;</span> <span class="mf">0.0</span>
<span class="p">(</span><span class="nb">angle</span> <span class="m">-inf.0</span><span class="p">)</span>                 <span class="nv">=&gt;</span> <span class="mf">3.14159265358979</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>Magnitude</code> is the same as <code>abs</code> for a real argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exact&#8594;inexact z)</code></strong><br>
<strong><code>(inexact&#8594;exact z)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Exact&#8594;inexact</code> returns an inexact representation of z.
The value returned is the inexact number that is numerically closest to
the argument.
<code>Inexact&#8594;exact</code> returns an exact representation of z.
The value returned is the exact number that is numerically closest to
the argument.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(number&#8594;string z)</code></strong><br>
<strong><code>(number&#8594;string z radix)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Radix</code> must be an exact integer, either 2, 8, 10, or 16. If omitted, radix
defaults to 10. The procedure <code>number&#8594;string</code> takes a number and a radix
and returns as a string an external representation of the given number in
the given radix such that</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">number</span> <span class="nv">number</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">radix</span> <span class="nv">radix</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">eqv?</span> <span class="nv">number</span>
       <span class="p">(</span><span class="nb">string-&gt;number</span> <span class="p">(</span><span class="nb">number-&gt;string</span> <span class="nv">number</span> <span class="nv">radix</span><span class="p">)</span> <span class="nv">radix</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is true. It is an error if no possible result makes this expression true.</p>
</div>
<div class="paragraph">
<p>If <code>z</code> is inexact, the radix is 10, and the above expression can be
satisfied by a result that contains a decimal point, then the result
contains a decimal point and is expressed using the minimum number of digits
(exclusive of exponent and trailing zeroes) needed to make the above expression
true; otherwise the format of the result is unspecified.</p>
</div>
<div class="paragraph">
<p>The result returned by <code>number&#8594;string</code> never contains an explicit radix
prefix.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The error case can occur only when <code>z</code> is not a complex number or
is a complex number with a non-rational real or imaginary part.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If <code>z</code> is an inexact number represented using flonums, and
the radix is 10, then the above expression is normally satisfied by a result
containing a decimal point. The unspecified case allows for infinities,
NaNs, and non-flonum representations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;number string)</code></strong><br>
<strong><code>(string&#8594;number string radix)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a number of the maximally precise representation expressed by the
given <code>string</code>. <code>Radix</code> must be an exact integer, either 2, 8, 10, or 16.
If supplied, <code>radix</code> is a default radix that may be overridden by an explicit
radix prefix in <code>string</code> (e.g. ,(code "\"#o177\"")). If <code>radix</code> is not
 supplied, then
the default radix is 10. If <code>string</code> is not a syntactically valid notation
for a number, then <code>string&#8594;number</code> returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">string-&gt;number</span> <span class="s">"100"</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="mi">100</span>
<span class="p">(</span><span class="nb">string-&gt;number</span> <span class="s">"100"</span> <span class="mi">16</span><span class="p">)</span>     <span class="nv">=&gt;</span>  <span class="mi">256</span>
<span class="p">(</span><span class="nb">string-&gt;number</span> <span class="s">"1e2"</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="mf">100.0</span>
<span class="p">(</span><span class="nb">string-&gt;number</span> <span class="s">"15##"</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="mf">1500.0</span>
<span class="p">(</span><span class="nb">string-&gt;number</span> <span class="s">"+inf.0"</span><span class="p">)</span>     <span class="nv">=&gt;</span>  <span class="m">+inf.0</span>
<span class="p">(</span><span class="nb">string-&gt;number</span> <span class="s">"-inf.0"</span><span class="p">)</span>     <span class="nv">=&gt;</span>  <span class="m">-inf.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bit-and n1 n2 &#8230;&#8203;)</code></strong><br>
<strong><code>(bit-or n1 n2 &#8230;&#8203;)</code></strong><br>
<strong><code>(bit-xor n1 n2 &#8230;&#8203;)</code></strong><br>
<strong><code>(bit-not n)</code></strong><br>
<strong><code>(bit-shift n m)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures allow the manipulation of integers as bit fields.
The integers can be of arbitrary length. <code>Bit-and</code>, <code>bit-or</code> and
<code>bit-xor</code> respectively compute the bitwise ,(emph "and"), inclusive and
exclusive ,(emph "or"). <code>bit-not</code> returns the bitwise ,(emph "not") of <code>n</code>.
<code>bit-shift</code> returns the bitwise ,(emph "shift") of <code>n</code>. The integer <code>n</code>
is shifted left by <code>m</code> bits; If <code>m</code> is negative, <code>n</code> is shifted right by
<code>-m</code> bits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">bit-or</span> <span class="mi">5</span> <span class="mi">3</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="mi">7</span>
<span class="p">(</span><span class="nf">bit-xor</span> <span class="mi">5</span> <span class="mi">3</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="mi">6</span>
<span class="p">(</span><span class="nf">bit-and</span> <span class="mi">5</span> <span class="mi">3</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">bit-not</span> <span class="mi">5</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">-6</span>
<span class="p">(</span><span class="nf">bit-or</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">8</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="mi">15</span>
<span class="p">(</span><span class="nf">bit-shift</span> <span class="mi">5</span> <span class="mi">3</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="mi">40</span>
<span class="p">(</span><span class="nf">bit-shift</span> <span class="mi">5</span> <span class="mi">-1</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(random-integer n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return an integer in the range \[0, &#8230;&#8203;, <code>n</code>\[.  Subsequent results of
this procedure appear to be independent uniformly distributed over
the range \[0, &#8230;&#8203;, <code>n</code>\[. The argument <code>n</code> must be a positive integer,
otherwise an error is signaled. This function is equivalent to the eponym
function of SRFI-27 (see ,(link-srfi 27) definition for more details).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(random-real)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a real number <code>r</code> such that <code>0 &lt; r &lt; 1</code>.
Subsequent results of this procedure appear to be independent uniformly
distributed. This function is equivalent to the eponym
function of SRFI-27 (see ,(link-srfi 27) definition for more details).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(decode-float n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>decode-float</code> returns three exact integers: <code>significand</code>, <code>exponent</code>
and <code>sign</code> (where <code>-1 &#8656; sign &#8656; 1</code>). The values returned by <code>decode-float</code>
satisfy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">n</span> <span class="nv">=</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">sign</span> <span class="nv">significand</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="nv">exponent</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of <code>decode-float</code> usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">receive</span> <span class="nv">l</span> <span class="p">(</span><span class="nf">decode-float</span> <span class="mf">-1.234</span><span class="p">)</span> <span class="nv">l</span><span class="p">)</span>
                    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">5557441940175192</span> <span class="mi">-52</span> <span class="mi">-1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">exact-&gt;inexact</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">-1</span>
                    <span class="mi">5557441940175192</span>
                    <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">-52</span><span class="p">)))</span>
                    <span class="nv">=&gt;</span> <span class="mf">-1.234</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(integer-length n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Integer-length</code> returns the necessary number of bits to represent <code>n</code>
in 2&#8217;s complement, assuming a leading 1 bit when <code>n</code> is negative. When
<code>n</code> is zero, the procedure returns zero.
This procedure works for any type of integer (fixnums and bignums).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">integer-length</span> <span class="mi">-3</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="mi">-2</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="mi">-1</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="mi">0</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="mi">1</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="mi">2</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="mi">3</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">integer-length</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">5000</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">5001</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_fixnums">4.2.1. Fixnums</h4>
<div class="paragraph">
<p>
<strong><em>STklos</em></strong> defines small integers as fixnums. Operations on fixnums
are generally faster than operations which accept general numbers.
Fixnums operations, as described below, may produce results which are incorrect
if some temporary computation falls outside the range of fixnum. These
functions should be used only when speed really matters.</p>
</div>
<div class="paragraph">
<p>The functions defined in this section are conform to the ones defined in
<strong><a href="http://srfi.schemers.org/srfi-143/srfi-143.html">SRFI-143</a></strong> (<em>Fixnums</em>)</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fixnum? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if obj is an exact integer within the fixnum range,
<code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fixnum-width)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of bits used to represent a fixnum number.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(least-fixnum)</code></strong><br>
<strong><code>(greatest-fixnum)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the minimum value and the maximum value of
the fixnum range.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxzero? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>fxzero?</code> returns <code>#t</code> if <code>obj</code> is the fixnum zero and returns
<code>#f</code> if it is a non-zero fixnum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nf">fxzero?</span> <span class="no">#f</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxzero?</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxzero?</span> <span class="mi">0</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nf">fxzero?</span> <span class="mi">1</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxpositive? obj)</code></strong><br>
<strong><code>(fxnegative? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>fxpositive?</code> returns <code>#t</code> if <code>obj</code> is a positive fixnum and returns
<code>#f</code> if it is a non-positive fixnum. <code>fxnegative?</code> can be used to test
if a fixnum is negative.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nf">fxpositive?</span> <span class="no">#f</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxpositive?</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxpositive?</span> <span class="mi">0</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxpositive?</span> <span class="mi">1</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nf">fxpositive?</span> <span class="mi">-1</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxnegative?</span> <span class="mi">0</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxnegative?</span> <span class="mi">1</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxnegative?</span> <span class="mi">-1</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxodd? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>fxodd?</code> returns <code>#t</code> if <code>obj</code> is a odd fixnum and returns
<code>#f</code> if it is an even fixnum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nf">fxodd?</span> <span class="no">#f</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxodd?</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxodd?</span> <span class="mi">0</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxodd?</span> <span class="mi">1</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nf">fxodd?</span> <span class="mi">4</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxeven?</span> <span class="mi">0</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nf">fxeven?</span> <span class="mi">1</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nf">fxeven?</span> <span class="mi">4</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>






</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fx+ fx1 fx2)</code></strong><br>
<strong><code>(fx- fx1 fx2)</code></strong><br>
<strong><code>(fx</strong> fx1 fx2)</code>*<br>
<strong><code>(fxquotient fx1 fx2)</code></strong><br>
<strong><code>(fxremainder fx1 fx2)</code></strong><br>
<strong><code>(fxmodulo fx1 fx2)</code></strong><br>
<strong><code>(fxabs fx)</code></strong><br>
<strong><code>(fxneg fx)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures compute (respectively) the sum, the difference, the product,
the quotient and the remainder and modulo of the fixnums <code>fx1</code> and <code>fx2</code>.
The call of  <code>fx-</code> with one parameter <code>fx</code> computes the opposite of <code>fx</code>, and
is equivalent in a call of <code>fxneg</code> with this parameter. <code>fxabs</code>
computes the absolute value of <code>fx</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxsquare fx1)</code></strong><br>
<strong><code>(fxsqrt fx1)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures compute (respectively) the square and the square root
of the fixnum <code>fx1</code>.
<code>fxsqrt</code> id semantically equivalent to exact-integer-sqrt (not sqrt), so
that <code>(fxsqrt n)</code> returns two values <code>a</code>, <code>b</code>, such that <code>a*a+b</code>=<code>n</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nf">fxsqrt</span> <span class="no">#f</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxsqrt</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxsqrt</span> <span class="mi">-1</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">error</span>
  <span class="p">(</span><span class="nf">fxsqrt</span> <span class="mi">0</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span>
  <span class="p">(</span><span class="nf">fxsqrt</span> <span class="mi">1</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span>
  <span class="p">(</span><span class="nf">fxsqrt</span> <span class="mi">6</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmax fx1 fx2 &#8230;&#8203;)</code></strong><br>
<strong><code>(fxmin fx1 fx2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the maximum or minimum of their fixnum arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmax</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>              <span class="nv">=&gt;</span>  <span class="mi">4</span>
<span class="p">(</span><span class="nf">fxmax</span> <span class="mf">3.9</span> <span class="mi">4</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="nv">error</span>
<span class="p">(</span><span class="nf">fxmax</span><span class="p">)</span>                  <span class="nv">=&gt;</span>  <span class="nv">error</span>
<span class="p">(</span><span class="nf">fxmax</span> <span class="mi">2</span> <span class="mi">-1</span> <span class="mi">3</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fx&lt;? fx1 fx2 &#8230;&#8203;)</code></strong><br>
<strong><code>(fx&#8656;? fx1 fx2 &#8230;&#8203;)</code></strong><br>
<strong><code>(fx&gt;? fx1 fx2 &#8230;&#8203;)</code></strong><br>
<strong><code>(fx&gt;=? fx1 fx2 &#8230;&#8203;)</code></strong><br>
<strong><code>(fx=? fx1 fx2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These are SRFI-143 procedures that compare the fixnums <code>fx1</code>, <code>fx2</code>, and so on.
<code>fx&lt;?</code> and <code>fx&gt;?</code> return <code>#t</code> if the arguments are in strictly
increasing/decreasing order;
<code>fx&#8656;?</code> and <code>fx&gt;=?</code> do the same, but admit equal neighbors;
<code>fx=?</code> returns <code>#t</code> if the arguments are all equal.</p>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxnot fx1)</code></strong><br>
<strong><code>(fxand fx &#8230;&#8203;)</code></strong><br>
<strong><code>(fxior fx &#8230;&#8203;)</code></strong><br>
<strong><code>(fxxor fx &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures are specified in SRFI-143, and they return
(respectively) the bitwise not, and, inclusive or and exclusive
or of their arguments, which must be fixnums.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxnot</span> <span class="mi">1</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="mi">-2</span>
<span class="p">(</span><span class="nf">fxnot</span> <span class="mi">0</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="mi">-1</span>
<span class="p">(</span><span class="nf">fxand</span> <span class="mh">#x1010</span> <span class="mh">#x1011</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">4112</span>  <span class="c1">; = #x1010</span>
<span class="p">(</span><span class="nf">fxior</span> <span class="mh">#x1010</span> <span class="mh">#x1011</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">4113</span>  <span class="c1">; = #x1011</span>
<span class="p">(</span><span class="nf">fxxor</span> <span class="mh">#x1010</span> <span class="mh">#x1011</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">1</span>     <span class="c1">; = #x0001</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxarithmetic-shift-right fx count)</code></strong><br>
<strong><code>(fxarithmetic-shift-left fx count)</code></strong><br>
<strong><code>(fxarithmetic-shift fx count)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures are specified in SRFI-143, and they perform
bitwise right-shift, left-shft and shift with arbitrary direction
on fixnums. The strictly left and right shifts are more efficient.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxarithmetic-shift-right</span> <span class="mb">#b100110</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">=&gt;</span>   <span class="mi">4</span> <span class="c1">; = #b100</span>
<span class="p">(</span><span class="nf">fxarithmetic-shift-left</span>  <span class="mb">#b100110</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">304</span> <span class="c1">; = #b100110000</span>
<span class="p">(</span><span class="nf">fxarithmetic-shift</span> <span class="mb">#b101</span> <span class="mi">2</span><span class="p">)</span>          <span class="nv">=&gt;</span> <span class="mi">20</span>  <span class="c1">; = #b10100</span>
<span class="p">(</span><span class="nf">fxarithmetic-shift</span> <span class="mb">#b101</span> <span class="mi">-2</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="mi">1</span>  <span class="c1">; =#b1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxlength fx)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that returns the length of the fixnum in
bits (that is, the number of bits necessary to represent the number).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxlength</span> <span class="mb">#b101</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="nf">fxlength</span> <span class="mb">#b1101</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="mi">4</span>
<span class="p">(</span><span class="nf">fxlength</span> <span class="mb">#b0101</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxif mask fx1 fx2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that merge the fixnum bitstrings <code>fx1</code> and <code>fx2</code>, with
bitstring  mask determining from which string to take each bit. That is, if the kth bit
of mask is 1, then the kth bit of the result is the kth bit of <code>fx1</code>, otherwise the kth
bit of <code>fx2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxif</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">8</span><span class="p">)</span>                            <span class="nv">=&gt;</span> <span class="mi">9</span>
<span class="p">(</span><span class="nf">fxif</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">1</span><span class="p">)</span>                            <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">fxif</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>                            <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="p">(</span><span class="nf">fxif</span> <span class="mb">#b00111100</span> <span class="mb">#b11110000</span> <span class="mb">#b00001111</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mb">#b00110011</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxbit-set? index fx)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that returns <code>#t</code> if the <code>index</code>-th bit of
<code>fx</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxbit-set?</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span>          <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">fxbit-set?</span> <span class="mi">2</span> <span class="mi">7</span><span class="p">)</span>          <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">fxbit-set?</span> <span class="mi">3</span> <span class="mi">6</span><span class="p">)</span>          <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">fxbit-set?</span> <span class="mi">5</span> <span class="mb">#b00111100</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxcopy-bit index fx value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that sets the <code>index</code>-th bit if <code>fx</code>
to one if <code>value</code> is <code>#t</code>, and to zero if <code>value</code> is <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxcopy-bit</span> <span class="mi">2</span> <span class="mi">3</span> <span class="no">#t</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mi">7</span>
<span class="p">(</span><span class="nf">fxcopy-bit</span> <span class="mi">2</span> <span class="mi">7</span> <span class="no">#f</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mi">3</span>
<span class="p">(</span><span class="nf">fxcopy-bit</span> <span class="mi">5</span> <span class="mb">#b00111100</span> <span class="no">#f</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">28</span> <span class="c1">; = #b00011100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxbit-count fx1)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that returns the quantity of bits equal to one in
the fixnum <code>fx</code> (that is, computes its Hamming weight).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxbit-count</span> <span class="mi">8</span><span class="p">)</span>                         <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">fxbit-count</span> <span class="mi">3</span><span class="p">)</span>                         <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">fxbit-count</span> <span class="mi">7</span><span class="p">)</span>                         <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="p">(</span><span class="nf">fxbit-count</span> <span class="mb">#b00111010</span><span class="p">)</span>                <span class="nv">=&gt;</span> <span class="mi">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxfirst-set-bit fx1)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that returns the index of the first (smallest index)
1 bit in bitstring <code>fx</code>. Returns -1 if <code>fx</code> contains no 1 bits (i.e., if <code>fx</code>
is zero).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxfirst-set-bit</span>  <span class="mi">8</span><span class="p">)</span>                         <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="p">(</span><span class="nf">fxfirst-set-bit</span>  <span class="mi">3</span><span class="p">)</span>                         <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">fxfirst-set-bit</span>  <span class="mi">7</span><span class="p">)</span>                         <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">fxfirst-set-bit</span>  <span class="mb">#b10110000</span><span class="p">)</span>                <span class="nv">=&gt;</span> <span class="mi">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxbit-field fx1 start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that extracts a bit field from the fixnum <code>fx1</code>.
The bit field is the sequence of bits between <code>start</code> (including) and <code>end</code>
(excluding)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxbit-field</span>  <span class="mb">#b10110000</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">6</span> <span class="c1">; = #b110</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxbit-field-rotate fx)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that returns fx with the field cyclically permuted
by count bits towards high-order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxbit-field-rotate</span> <span class="mb">#b101011100</span> <span class="mi">-2</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">342</span>  <span class="nv">=</span> <span class="mb">#b101010110</span>
<span class="p">(</span><span class="nf">fxbit-field-rotate</span> <span class="mb">#b101011011110</span> <span class="mi">-3</span> <span class="mi">2</span> <span class="mi">10</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">3034</span> <span class="nv">=</span> <span class="mb">#b101111011010</span>
<span class="p">(</span><span class="nf">fxbit-field-rotate</span> <span class="mb">#b101011011110</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">10</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">2806</span> <span class="nv">=</span> <span class="mb">#b101011110110</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxbit-field-reverse fx)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a SRFI-143 procedure that returns fx with the order of the bits in the
field reversed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxbit-field-reverse</span> <span class="mb">#b101011100</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mb">#b101001110</span>
<span class="p">(</span><span class="nf">fxbit-field-reverse</span> <span class="mb">#b101011011110</span> <span class="mi">2</span> <span class="mi">10</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mb">#b101110110110</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fx+/carry i j k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns two values: <code>i</code>+<code>j</code>+<code>k</code>, and carry: it is the value of the computation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let*-values</span> <span class="p">(((</span><span class="nf">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">i</span> <span class="nv">j</span> <span class="nv">k</span><span class="p">))</span>
              <span class="p">((</span><span class="nf">q</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nf">balanced/</span> <span class="nv">s</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="nv">fx-width</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">values</span> <span class="nv">r</span> <span class="nv">q</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fx-/carry i j k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns two values: <code>i</code>-<code>j</code>-<code>k</code>, and carry: it is the value of the computation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let*-values</span> <span class="p">(((</span><span class="nf">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">i</span> <span class="nv">j</span> <span class="nv">k</span><span class="p">))</span>
              <span class="p">((</span><span class="nf">q</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nf">balanced/</span> <span class="nv">s</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="nv">fx-width</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">values</span> <span class="nv">r</span> <span class="nv">q</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fx</strong>/carry i j k)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns two values: <code>i</code>*<code>j</code>+<code>k</code>, and carry: it is the value of the computation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let*-values</span> <span class="p">(((</span><span class="nf">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">i</span> <span class="nv">j</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
              <span class="p">((</span><span class="nf">q</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nf">balanced/</span> <span class="nv">s</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="nv">fx-width</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">values</span> <span class="nv">r</span> <span class="nv">q</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_booleans">4.3. Booleans</h3>
<div class="paragraph">
<p>


Of all the standard Scheme values, only <code>#f</code> counts as false in
conditional expressions.  Except for <code>#f</code>, all standard Scheme values,
including <code>#t</code>, pairs, the empty list, symbols, numbers, strings,
vectors, and procedures, count as true.</p>
</div>
<div class="paragraph">
<p>Boolean constants evaluate to themselves, so they do not need to be
quoted in programs.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(not obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Not returns <code>#t</code> if <code>obj</code> is false, and returns <code>#f</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nb">not</span> <span class="no">#t</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">not</span> <span class="mi">3</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">3</span><span class="p">))</span>   <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">not</span> <span class="no">#f</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">not</span> <span class="o">'</span><span class="p">())</span>        <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">list</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">not</span> <span class="ss">'nil</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(boolean? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Boolean?</code> returns <code>#t</code> if <code>obj</code> is either <code>#t</code> or <code>#f</code> and returns
<code>#f</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nb">boolean?</span> <span class="no">#f</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>
  <span class="p">(</span><span class="nb">boolean?</span> <span class="mi">0</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#f</span>
  <span class="p">(</span><span class="nb">boolean?</span> <span class="o">'</span><span class="p">())</span>        <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(boolean=? boolean1 boolean2  &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if all the arguments are booleans and all are <code>#t</code> or all are <code>#f</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pairs_and_lists">4.4. Pairs and lists</h3>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(pair? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Pair?</code> returns <code>#t</code> if <code>obj</code> is a pair, and otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cons obj1 obj2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated pair whose car is obj1 and whose cdr is obj2.
The pair is guaranteed to be different (in the sense of eqv?) from every
existing object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">    <span class="p">(</span><span class="nb">cons</span> <span class="ss">'a</span> <span class="o">'</span><span class="p">())</span>           <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="s">"a"</span> <span class="o">'</span><span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">))</span>       <span class="nv">=&gt;</span>  <span class="p">(</span><span class="s">"a"</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="ss">'a</span> <span class="mi">3</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="ss">'c</span><span class="p">)</span>        <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="o">.</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(car pair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the contents of the car field of pair.
Note that it is an error to take the <code>car</code> of the empty list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">    <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>          <span class="nv">=&gt;</span>  <span class="nv">a</span>
    <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>      <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>          <span class="nv">=&gt;</span>  <span class="mi">1</span>
    <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">())</span>               <span class="nv">=&gt;</span>  <span class="nv">error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cdr pair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the contents of the cdr field of pair.
Note that it is an error to take the <code>cdr</code> of the empty list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">    <span class="p">(</span><span class="nb">cdr</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>      <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cdr</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>          <span class="nv">=&gt;</span>  <span class="mi">2</span>
    <span class="p">(</span><span class="nb">cdr</span> <span class="o">'</span><span class="p">())</span>               <span class="nv">=&gt;</span>  <span class="nv">error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set-car! pair obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>obj</code> in the car field of <code>pair</code>.
The value returned by <code>set-car!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'not-a-constant-list</span><span class="p">))</span>
   <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">g</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">constant-list</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">set-car!</span> <span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">set-car!</span> <span class="p">(</span><span class="nf">g</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span>             <span class="nv">=&gt;</span>  <span class="nv">error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set-cdr! pair obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>obj</code> in the cdr field of <code>pair</code>.
The value returned by <code>set-cdr!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p>


























</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(caar pair)</code></strong><br>
<strong><code>(cadr pair)</code></strong><br>
<strong><code>&#8230;&#8203;</code></strong><br>
<strong><code>(cdddar pair)</code></strong><br>
<strong><code>(cddddr pair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures are compositions of <code>car</code> and <code>cdr</code>, where for example
<code>caddr</code> could be defined by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="k">define</span> <span class="nv">caddr</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">)))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Arbitrary compositions, up to four deep, are provided.
There are twenty-eight of these procedures in all.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(null? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is the empty list, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(pair-mutable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a mutable pair, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">pair-mutable?</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>    <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">pair-mutable?</span> <span class="p">(</span><span class="nb">cons</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">pair-mutable?</span> <span class="mi">12</span><span class="p">)</span>          <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a list, otherwise returns <code>#f</code>. By definition,
all lists have finite length and are terminated by the empty list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">list?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">list?</span> <span class="o">'</span><span class="p">())</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">list?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="o">.</span> <span class="nv">b</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)))</span>
     <span class="p">(</span><span class="nb">set-cdr!</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">list?</span> <span class="nv">x</span><span class="p">))</span>         <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-list k)</code></strong><br>
<strong><code>(make-list k fill)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated list of k elements. If a second
argument is given, then each element is initialized to fill .
Otherwise the initial contents of each element is unspecified.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated list of its arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="ss">'c</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="mi">7</span> <span class="nv">c</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span><span class="p">)</span>                          <span class="nv">=&gt;</span>  <span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list</strong> obj &#8230;&#8203;)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>list*</code> is like <code>list</code> except that the last argument to <code>list*</code> is
used as the ,(emph "cdr") of the last pair constructed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nf">list*</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">list*</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="o">'</span><span class="p">(</span><span class="nf">4</span> <span class="mi">5</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">list*</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(length list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the length of <code>list</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">length</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>               <span class="nv">=&gt;</span>  <span class="mi">3</span>
   <span class="p">(</span><span class="nb">length</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)))</span>       <span class="nv">=&gt;</span>  <span class="mi">3</span>
   <span class="p">(</span><span class="nb">length</span> <span class="o">'</span><span class="p">())</span>                    <span class="nv">=&gt;</span>  <span class="mi">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(append list &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a list consisting of the elements of the first list
followed by the elements of the other lists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">append</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">y</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">append</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>          <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">append</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">))</span> <span class="o">'</span><span class="p">((</span><span class="nf">c</span><span class="p">)))</span>        <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting list is always newly allocated, except that it shares
structure with the last list argument. The last argument may actually
be any object; an improper list results if the last argument is not a
proper list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">append</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span> <span class="o">.</span> <span class="nv">d</span><span class="p">))</span>        <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="o">.</span> <span class="nv">d</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">append</span> <span class="o">'</span><span class="p">()</span> <span class="ss">'a</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="nv">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(append! list &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a list consisting of the elements of the first list
followed by the elements of the other lists.
Contrarily to <code>append</code>, the parameter lists (except the last one) are
physically modified: their last pair is changed to the value of the next
list in the <code>append!</code> formal parameter list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">l1</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">l2</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">3</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">l3</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">l4</span> <span class="p">(</span><span class="nf">append!</span> <span class="nv">l1</span> <span class="nv">l2</span> <span class="nv">l3</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">l1</span> <span class="nv">l2</span> <span class="nv">l3</span> <span class="nv">l4</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">4</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An error is signaled if one of the given lists is a constant list.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(reverse list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated list consisting of the elements of <code>list</code> in
reverse order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">reverse</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">c</span> <span class="nv">b</span> <span class="nv">a</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">reverse</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">d</span> <span class="p">(</span><span class="nf">e</span> <span class="p">(</span><span class="nf">f</span><span class="p">))))</span>  <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">e</span> <span class="p">(</span><span class="nf">f</span><span class="p">))</span> <span class="nv">d</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(reverse! list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a list consisting of the elements of <code>list</code> in reverse order.
Contrarily to <code>reverse</code>, the returned value is not newly allocated but
computed "in place".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">l</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">reverse!</span> <span class="nv">l</span><span class="p">)</span> <span class="nv">l</span><span class="p">))</span>        <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">c</span> <span class="nv">b</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">a</span><span class="p">))</span>
<span class="p">(</span><span class="nf">reverse!</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">constant</span> <span class="nv">list</span><span class="p">))</span>   <span class="nv">=&gt;</span>  <span class="nv">error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list-tail list k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the sublist of <code>list</code> obtained by omitting the first <code>k</code> elements.
It is an error if list has fewer than <code>k</code> elements. List-tail could
be defined by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="k">define</span> <span class="nv">list-tail</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">k</span><span class="p">)</span>
         <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zero?</span> <span class="nv">k</span><span class="p">)</span>
            <span class="nv">x</span>
            <span class="p">(</span><span class="nb">list-tail</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">k</span> <span class="mi">1</span><span class="p">)))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(last-pair list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the last pair of <code>list</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">last-pair</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">last-pair</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="o">.</span> <span class="mi">3</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list-ref list k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the <code>k`th element of `list</code>. (This is the same as the car
of <code>(list-tail list k)</code>.) It is an error if list has fewer than <code>k</code>
elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">list-ref</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="nv">c</span>
   <span class="p">(</span><span class="nb">list-ref</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">inexact-&gt;exact</span> <span class="p">(</span><span class="nb">round</span> <span class="mf">1.8</span><span class="p">)))</span> <span class="nv">=&gt;</span>  <span class="nv">c</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list-set! list k obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>list-set!</code> procedure stores <code>obj</code> in element <code>k</code> of <code>list</code>.
It is an error if <code>k</code> is not a valid index of <code>list</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">ls</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'one</span> <span class="ss">'two</span> <span class="ss">'five!</span><span class="p">)))</span>
   <span class="p">(</span><span class="nf">list-set!</span> <span class="nv">ls</span> <span class="mi">2</span> <span class="ss">'three</span><span class="p">)</span>
   <span class="nv">ls</span><span class="p">)</span>                              <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">one</span> <span class="nv">two</span> <span class="nv">three</span><span class="p">)</span>
<span class="p">(</span><span class="nf">list-set!</span> <span class="o">'</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">1</span> <span class="s">"oops"</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="nv">error</span> <span class="p">(</span><span class="nf">constant</span> <span class="nv">list</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(memq obj list)</code></strong><br>
<strong><code>(memv obj list)</code></strong><br>
<strong><code>(member obj list)</code></strong><br>
<strong><code>(member obj list compare)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the first sublist of list whose car is <code>obj</code>,
where the sublists of list are the non-empty lists returned by
<code>(list-tail list k)</code> for <code>k</code> less than the length of list.
If <code>obj</code> does not occur in <code>list</code>, then <code>#f</code> (not the empty list) is
returned. <code>Memq</code> uses <code>eq?</code> to compare obj with the elements of list,
while <code>memv</code> uses <code>eqv?</code> and <code>member</code> uses <code>compare</code>, if given, and
<code>equal?</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">memq</span> <span class="ss">'a</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">memq</span> <span class="ss">'b</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">memq</span> <span class="ss">'a</span> <span class="o">'</span><span class="p">(</span><span class="nf">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">memq</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">b</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="nv">c</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span>
           <span class="o">'</span><span class="p">(</span><span class="nf">b</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="nv">c</span><span class="p">))</span>             <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">member</span> <span class="s">"B"</span>
           <span class="err">’</span><span class="p">(</span><span class="s">"a"</span> <span class="s">"b"</span> <span class="s">"c"</span><span class="p">)</span>
           <span class="nv">string-ci=?</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"b"</span> <span class="s">"c"</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">memv</span> <span class="mi">101</span> <span class="o">'</span><span class="p">(</span><span class="nf">100</span> <span class="mi">101</span> <span class="mi">102</span><span class="p">))</span>       <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">101</span> <span class="mi">102</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As in R<sup>7</sup>RS, the <code>member</code> function accepts also a
comparison function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(assq obj alist)</code></strong><br>
<strong><code>(assv obj alist)</code></strong><br>
<strong><code>(assoc obj alist)</code></strong><br>
<strong><code>(assoc obj alist compare)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Alist</code> (for "association list") must be a list of pairs. These procedures
find the first pair in <code>alist</code> whose car field is <code>obj</code>, and returns that
pair. If no pair in <code>alist</code> has <code>obj</code> as its car, then <code>#f</code> (not the empty
list) is returned. <code>Assq</code> uses <code>eq?</code> to compare <code>obj</code> with the car fields
of the pairs in <code>alist</code>, while <code>assv</code> uses <code>eqv?</code> and <code>assoc</code> uses <code>equal?</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="k">define</span> <span class="nv">e</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span> <span class="mi">3</span><span class="p">)))</span>
   <span class="p">(</span><span class="nb">assq</span> <span class="ss">'a</span> <span class="nv">e</span><span class="p">)</span>                <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="mi">1</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">assq</span> <span class="ss">'b</span> <span class="nv">e</span><span class="p">)</span>                <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="mi">2</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">assq</span> <span class="ss">'d</span> <span class="nv">e</span><span class="p">)</span>                <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">assq</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span> <span class="o">'</span><span class="p">(((</span><span class="nf">a</span><span class="p">))</span> <span class="p">((</span><span class="nf">b</span><span class="p">))</span> <span class="p">((</span><span class="nf">c</span><span class="p">))))</span>
                              <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">assoc</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span> <span class="o">'</span><span class="p">(((</span><span class="nf">a</span><span class="p">))</span> <span class="p">((</span><span class="nf">b</span><span class="p">))</span> <span class="p">((</span><span class="nf">c</span><span class="p">))))</span>
                              <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">a</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">assoc</span> <span class="mf">2.0</span> <span class="o">'</span><span class="p">((</span><span class="nf">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=</span><span class="p">)</span>
                              <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">4</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">assv</span> <span class="mi">5</span> <span class="o">'</span><span class="p">((</span><span class="nf">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="nf">11</span> <span class="mi">13</span><span class="p">)))</span>
                              <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Although they are ordinarily used as predicates,
<code>memq</code>, <code>memv</code>, <code>member</code>, <code>assq</code>, <code>assv</code>, and <code>assoc</code> do not have question
marks in their names because they return useful values rather than just
<code>#t</code> or #<code>f</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As in R<sup>7</sup>RS, the <code>assoc</code> function accepts also a
comparison function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list-copy obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>list-copy</code> recursively copies trees of pairs. If <code>obj</code> is
not a pair, it is returned; otherwise the result is a new pair whose
<code>car</code> and <code>cdr</code> are obtained by calling <code>list-copy</code> on
the <code>car</code> and <code>cdr</code> of <code>obj</code>, respectively.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(filter  pred list)</code></strong><br>
<strong><code>(filter! pred list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Filter</code> returns all the elements of <code>list</code> that satisfy predicate
<code>pred</code>. The <code>list</code> is not disordered: elements that appear in the
result list occur in the same order as they occur in the argument
list. <code>Filter!</code> does the same job as <code>filter</code> by physically
modifying its <code>list</code> argument</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">filter</span> <span class="nv">even?</span> <span class="o">'</span><span class="p">(</span><span class="nf">0</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">43</span> <span class="mi">-4</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">-4</span><span class="p">)</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">l1</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">0</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">43</span> <span class="mi">-4</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">l2</span> <span class="p">(</span><span class="nf">filter!</span> <span class="nv">even?</span> <span class="nv">l1</span><span class="p">)))</span>
   <span class="p">(</span><span class="nb">list</span> <span class="nv">l1</span> <span class="nv">l2</span><span class="p">))</span>                <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">-4</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">-4</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An error is signaled if <code>list</code> is a constant list.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(remove pred list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Remove</code> returns <code>list</code> without the elements that satisfy predicate <code>pred</code>:</p>
</div>
<div class="paragraph">
<p>The list is not disordered&#8201;&#8212;&#8201;elements that appear in the result list occur
in the same order as they occur in the argument list. <code>Remove!</code> does the
same job than <code>remove</code> by physically modifying its <code>list</code> argument</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">remove</span> <span class="nv">even?</span> <span class="o">'</span><span class="p">(</span><span class="nf">0</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">43</span> <span class="mi">-4</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">7</span> <span class="mi">43</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(delete  x list [=])</code></strong><br>
<strong><code>(delete! x list [=])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Delete</code> uses the comparison procedure <code>=</code>, which defaults to
<code>equal?</code>, to find all elements of <code>list</code> that are equal to <code>x</code>, and
deletes them from <code>list</code>. The dynamic order in which the various
applications of <code>=</code> are made is not specified.</p>
</div>
<div class="paragraph">
<p>The list is not disordered&#8201;&#8212;&#8201;elements that appear in the result
list occur in the same order as they occur in the argument list.</p>
</div>
<div class="paragraph">
<p>The comparison procedure is used in this way: <code>(= x ei)</code>. That is,
<code>x</code> is always the first argument, and a list element is always the
second argument. The comparison procedure will be used to compare
each element of list exactly once; the order in which it is applied
to the various <code>ei</code> is not specified. Thus, one can reliably remove
all the numbers greater than five from a list with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">delete</span> <span class="mi">5</span> <span class="nv">list</span> <span class="nv">&lt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>delete!</code> is the linear-update variant of <code>delete</code>. It is allowed,
but not required, to alter the cons cells in its argument <code>list</code> to
construct the result.</p>
</div>
</div>
<div class="sect2">
<h3 id="_symbols">4.5. Symbols</h3>
<div class="paragraph">
<p>The STklos reader can read symbols whose names contain special
characters or letters in the non standard case.  When a symbol is
read, the parts enclosed in bars <code>|</code> will be entered
verbatim into the symbol&#8217;s name. The <code>|</code> characters are not
part of the symbol; they only serve to delimit the sequence of
characters that must be entered "as is". In order to maintain
read-write invariance, symbols containing such sequences of special
characters will be written between a pair of <code>|</code>.</p>
</div>
<div class="paragraph">
<p>In addition, any character can be used within an identifier when
specified via an inline hex escape . For example, the identifier
<code>H\x65;llo</code> is the same as the identifier Hello, and, if the
UTF-8 encoding is used, the identifier <code>\x3BB;</code> is the same as
the identifier <code>λ</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="ss">'|a|</span>                  <span class="nv">=&gt;</span> <span class="nv">a</span>
<span class="p">(</span><span class="nb">string-&gt;symbol</span> <span class="s">"a"</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="nv">|A|</span>
<span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="ss">'|A|</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"A"</span>
<span class="ss">'|a</span>  <span class="nv">b|</span>               <span class="nv">=&gt;</span> <span class="nv">|a</span>  <span class="nv">b|</span>
<span class="ss">'a|B|c</span>                <span class="nv">=&gt;</span> <span class="nv">|aBc|</span>
<span class="p">(</span><span class="nb">write</span> <span class="ss">'|FoO|</span><span class="p">)</span>        <span class="nv">|-</span> <span class="nv">|FoO|</span>
<span class="p">(</span><span class="nb">display</span> <span class="ss">'|FoO|</span><span class="p">)</span>      <span class="nv">|-</span> <span class="nv">FoO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(symbol? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if obj is a symbol, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">symbol?</span> <span class="ss">'foo</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">symbol?</span> <span class="p">(</span><span class="nb">car</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>  <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">symbol?</span> <span class="s">"bar"</span><span class="p">)</span>         <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">symbol?</span> <span class="ss">'nil</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">symbol?</span> <span class="o">'</span><span class="p">())</span>           <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">symbol?</span> <span class="no">#f</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">symbol?</span> <span class="nv">:key</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(symbol=? symbol1 symbol2  &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns #t if all the arguments are symbols and all have the same name in
the sense of <code>string=?</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(symbol&#8594;string string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name of <code>symbol</code> as a string. If the symbol was part of an
object returned as the value of a literal expression or by a call to the
<code>read</code> procedure, and its name contains alphabetic characters, then the
string returned will contain characters in the implementation&#8217;s preferred
standard case&#8201;&#8212;&#8201;STklos prefers lower case. If the symbol was returned
by <code>string&#8594;symbol</code>, the case of characters in the string returned will be
the same as the case in the string that was passed to <code>string&#8594;symbol</code>. It
is an error to apply mutation procedures like <code>string-set!</code> to strings
returned by this procedure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="ss">'flying-fish</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="s">"flying-fish"</span>
   <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="ss">'Martin</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="s">"martin"</span>
   <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="p">(</span><span class="nb">string-&gt;symbol</span> <span class="s">"Malvina"</span><span class="p">))</span>
                                  <span class="nv">=&gt;</span>  <span class="s">"Malvina"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;symbol string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the symbol whose name is <code>string</code>. This procedure can create
symbols with names containing special characters or letters in the
non-standard case, but it is usually a bad idea to create such symbols
because in some implementations of Scheme they cannot be read as themselves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'mISSISSIppi</span> <span class="ss">'mississippi</span><span class="p">)</span>                   <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">string-&gt;symbol</span> <span class="s">"mISSISSIppi"</span><span class="p">)</span>                    <span class="nv">=&gt;</span>  <span class="nv">|mISSISSIppi|</span>
   <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'bitBlt</span> <span class="p">(</span><span class="nb">string-&gt;symbol</span> <span class="s">"bitBlt"</span><span class="p">))</span>           <span class="nv">=&gt;</span>  <span class="no">#f</span>
   <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'JollyWog</span>
        <span class="p">(</span><span class="nb">string-&gt;symbol</span>
          <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="ss">'JollyWog</span><span class="p">)))</span>               <span class="nv">=&gt;</span>  <span class="no">#t</span>
   <span class="p">(</span><span class="nb">string=?</span> <span class="s">"K. Harper, M.D."</span>
             <span class="p">(</span><span class="nb">symbol-&gt;string</span>
               <span class="p">(</span><span class="nb">string-&gt;symbol</span> <span class="s">"K. Harper, M.D."</span><span class="p">)))</span>  <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;unterned-symbol string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the symbol whose print name is made from the characters of
<code>string</code>. This symbol is guaranteed to be <em>unique</em> (i.e. not
<code>eq?</code> to any other symbol):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">ua</span> <span class="p">(</span><span class="nf">string-&gt;uninterned-symbol</span> <span class="s">"a"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">eq?</span> <span class="ss">'a</span> <span class="nv">ua</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">eqv?</span> <span class="ss">'a</span> <span class="nv">ua</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">eq?</span> <span class="nv">ua</span> <span class="p">(</span><span class="nf">string-&gt;uninterned-symbol</span> <span class="s">"a"</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">eqv?</span> <span class="nv">ua</span> <span class="p">(</span><span class="nf">string-&gt;uninterned-symbol</span> <span class="s">"a"</span><span class="p">))))</span>
          <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#f</span> <span class="no">#t</span> <span class="no">#f</span> <span class="no">#t</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(gensym)</code></strong><br>
<strong><code>(gensym prefix)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates a new symbol. The print name of the generated symbol
consists of a prefix (which defaults to "G") followed by the decimal
representation of a number. If <code>prefix</code> is specified, it must be
either a string or a symbol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">gensym</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="nv">|G100|</span>
<span class="p">(</span><span class="nf">gensym</span> <span class="s">"foo-"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="nv">foo-101</span>
<span class="p">(</span><span class="nf">gensym</span> <span class="ss">'foo-</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="nv">foo-102</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_characters">4.6. Characters</h3>
<div class="paragraph">
<p>

The following table gives the list of allowed character names with their
ASCII eqivalent expressed in octal. Some chracaters have an alternate name
which is also shown in this table.</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">value</th>
<th class="tableblock halign-left valign-top">alt. name</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">value</th>
<th class="tableblock halign-left valign-top">alt. name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">soh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">002</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">etx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">003</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">004</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">005</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">006</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alarm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backspace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ht</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">012</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">013</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">np</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">014</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">015</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">so</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">016</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">si</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">017</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">020</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dc1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">021</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dc2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">022</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dc3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">023</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dc4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">024</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">025</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">syn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">026</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">etb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">027</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">can</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">030</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">em</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">031</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">032</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">escape</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">034</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">035</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">036</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">us</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">037</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">040</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">177</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong><em>STklos</em></strong> supports the complete Unicode character set, if UTF-8 encoding is
used. Hereafter, are some examples of characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="sc">#\A</span>                <span class="nv">=&gt;</span> <span class="nv">uppercase</span> <span class="nv">A</span>
<span class="sc">#\a</span>                <span class="nv">=&gt;</span> <span class="nv">lowercase</span> <span class="nv">a</span>
<span class="sc">#\x41</span>              <span class="nv">=&gt;</span> <span class="nv">the</span> <span class="nv">U+0041</span> <span class="nv">character</span> <span class="p">(</span><span class="nf">uppercase</span> <span class="nv">A</span><span class="p">)</span>
<span class="sc">#\x03bb</span>            <span class="nv">=&gt;</span> <span class="err">λ</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a character, otherwise returns <code>#f</code>.</p>
</div>
<div id="chareq" class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char=? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char&lt;? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char&gt;? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char&#8656;? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char&gt;=? char1 char2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures impose a total ordering on the set of characters.
It is guaranteed that under this ordering:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The upper case characters are in order.</p>
</li>
<li>
<p>The lower case characters are in order.</p>
</li>
<li>
<p>The digits are in order.</p>
</li>
<li>
<p>Either all the digits precede all the upper case letters, or vice versa.</p>
</li>
<li>
<p>Either all the digits precede all the lower case letters, or vice versa.
)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char-ci=? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char-ci&lt;? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char-ci&gt;? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char-ci&#8656;? char1 char2 &#8230;&#8203;)</code></strong><br>
<strong><code>(char-ci&gt;=? char1 char2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures are similar to <code>char=?</code> et cetera, but they treat
upper case and lower case letters as the same. For example,
<code>(char-ci=? #\A #\a)</code> returns <code>#t</code>.</p>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char-alphabetic? char)</code></strong><br>
<strong><code>(char-numeric? char)</code></strong><br>
<strong><code>(char-whitespace? char)</code></strong><br>
<strong><code>(char-upper-case? letter)</code></strong><br>
<strong><code>(char-lower-case? letter)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return <code>#t</code> if their arguments are alphabetic, numeric,
whitespace, upper case, or lower case characters, respectively, otherwise they
return <code>#f</code>. The following remarks, which are specific to the ASCII character
set, are intended only as a guide: The alphabetic characters are the 52
upper and lower case letters. The numeric characters are the ten decimal
digits. The whitespace characters are space, tab, line feed, form feed,
and carriage return.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char&#8594;integer char)</code></strong><br>
<strong><code>(integer&#8594;char n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Given a character, <code>char&#8594;integer</code> returns an exact integer
representation of the character. Given an exact integer that is the
image of a character under <code>char&#8594;integer</code>, <code>integer&#8594;char</code> returns
that character. These procedures implement order-preserving
isomorphisms between the set of characters under the <code>char&#8656;?</code>
ordering and some subset of the integers under the <code>&#8656;</code>
ordering. That is, if</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">char&lt;=?</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="nv">and</span>  <span class="p">(</span><span class="nb">&lt;=</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and x and y are in the domain of <code>integer&#8594;char</code>, then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nb">&lt;=</span> <span class="p">(</span><span class="nb">char-&gt;integer</span> <span class="nv">a</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">char-&gt;integer</span> <span class="nv">b</span><span class="p">))</span>         <span class="nv">=&gt;</span>  <span class="no">#t</span>

  <span class="p">(</span><span class="nb">char&lt;=?</span> <span class="p">(</span><span class="nb">integer-&gt;char</span> <span class="nv">x</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">integer-&gt;char</span> <span class="nv">y</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>integer&#8594;char</code> accepts an exact number between 0 and #xD7FFF or between
#xE000 and #x10FFFF, if UTF8 encoding is used. Otherwise, it accepts a
number between 0 and #xFF.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char-upcase char)</code></strong><br>
<strong><code>(char-downcase char)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return a character <code>char2</code> such that
<code>(char-ci=? char char2)</code>. In addition, if char is alphabetic, then the
result of <code>char-upcase</code> is upper case and the result of <code>char-downcase</code> is
lower case.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char-foldcase char)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure applies the Unicode simple case folding algorithm and returns
the result. Note that language-sensitive folding is not used. If
the argument is an uppercase letter, the result will be either a
lowercase letter or the same as the argument if the lowercase letter
does not exist.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(digit-value char)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns the numeric value (0 to 9) of its
argument if it is a numeric digit (that is, if char-numeric?
returns #t), or #f on any other character.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">digit-value</span>
<span class="p">(</span><span class="nf">digit-value</span> <span class="sc">#\3</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="p">(</span><span class="nf">digit-value</span> <span class="sc">#\x0664</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="mi">4</span>
<span class="p">(</span><span class="nf">digit-value</span> <span class="sc">#\x0AE6</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">digit-value</span> <span class="sc">#\x0EA6</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_strings">4.7. Strings</h3>
<div class="paragraph">
<p>
STklos string constants allow the insertion of arbitrary characters
by encoding them as escape sequences. An escape sequence is introduced
by a backslash "$\backslash$".  The valid escape sequences are shown in
the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sequence</th>
<th class="tableblock halign-left valign-top">Character inserted</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backspace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escape</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Horizontal Tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carriage Return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">doublequote U+0022</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\\</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backslash U+005C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\0abc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASCII character with octal value abc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\x&lt;hexa value&gt;;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASCII character with given hexadecimal value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\&lt;intraline whitespace&gt;&lt;newline&gt;&lt;intraline whitespace&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None (permits to enter a string on several lines)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\&lt;other&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;other&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For instance, the string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="s">"ab\040\x20;c\nd\
         e"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is the string consisting of the characters
<code>&#35;\a</code>, <code>&#35;\b</code>, <code>&#35;\space</code>, <code>&#35;\space</code>,
<code>&#35;\c</code>, <code>&#35;\newline</code>, <code>&#35;\d</code> and <code>&#35;\e</code>.</p>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using octal code is limited to characters in the range 0
to #xFF. It is then not convenient to enter Unicode characters. This
form is deprecated should not be used anymore.</p>
</li>
<li>
<p>A line ending which is preceded by &lt;intraline whitespace&gt;
expands to nothing (along with any trailing &lt;intraline
whitespace&gt;), and can be used to indent strings for improved
legibility.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a string, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-string k)</code></strong><br>
<strong><code>(make-string k char)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Make-string</code> returns a newly allocated string of length <code>k</code>. If <code>char</code> is
given, then all elements of the string are initialized to <code>char</code>, otherwise
the contents of the string are unspecified.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string char &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated string composed of the arguments.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-length string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of characters in the given <code>string</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-ref string k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String-ref</code> returns character k of string using zero-origin indexing
(<code>k</code> must be a valid index of string).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-set! string k char)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String-set!</code> stores <code>char</code> in element <code>k</code> of <code>string</code> and returns
<strong><em>void</em></strong> (<code>k</code> must be a valid index of <code>string</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="nb">make-string</span> <span class="mi">3</span> <span class="o">#</span><span class="err">\</span><span class="nv">*</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">g</span><span class="p">)</span> <span class="s">"***"</span><span class="p">)</span>
<span class="p">(</span><span class="nb">string-set!</span> <span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="mi">0</span> <span class="sc">#\?</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="nv">void</span>
<span class="p">(</span><span class="nb">string-set!</span> <span class="p">(</span><span class="nf">g</span><span class="p">)</span> <span class="mi">0</span> <span class="sc">#\?</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="nv">error</span>
<span class="p">(</span><span class="nb">string-set!</span> <span class="p">(</span><span class="nb">symbol-&gt;string</span> <span class="ss">'immutable</span><span class="p">)</span> <span class="mi">0</span> <span class="sc">#\?</span><span class="p">)</span>
                         <span class="nv">=&gt;</span>  <span class="nv">error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string=? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string-ci=? string1 string2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if all the strings are the same length and contain the same
characters in the same positions, otherwise returns <code>#f</code>. <code>String-ci=?</code>
treats upper and lower case letters as though they were the same character,
but <code>string=?</code> treats upper and lower case as distinct characters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
R<sup>5</sup>RS version of these functions accept only two arguments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>






</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&lt;? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string&gt;? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string&#8656;? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string&gt;=? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string-ci&lt;? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string-ci&gt;? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string-ci&#8656;? string1 string2 &#8230;&#8203;)</code></strong><br>
<strong><code>(string-ci&gt;=? string1 string2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures are the lexicographic extensions to strings of the
corresponding orderings on characters. For example, <code>string&lt;?</code> is the
lexicographic ordering on strings induced by the ordering <code>char&lt;?</code> on
characters. If two strings differ in length but are the same up to the
length of the shorter string, the shorter string is considered to be
lexicographically less than the longer string.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
R<sup>5</sup>RS version of these functions accept only two arguments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(substring string start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String</code> must be a string, and <code>start</code> and <code>end</code> must be exact integers
satisfying</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="mi">0</span> <span class="nv">&lt;=</span> <span class="nv">start</span> <span class="nv">&lt;=</span> <span class="nv">end</span> <span class="nv">&lt;=</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">string</span><span class="p">)</span><span class="o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Substring</code> returns a newly allocated string formed from the characters
of <code>string</code> beginning with index <code>start</code> (inclusive) and ending with
index <code>end</code> (exclusive).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-append string &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated string whose characters form the concatenation
of the given strings.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;list string)</code></strong><br>
<strong><code>(string&#8594;list string start)</code></strong><br>
<strong><code>(string&#8594;list string start end)</code></strong><br>
<strong><code>(list&#8594;string list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String&#8594;list</code> returns a newly allocated list of the characters of
<code>string</code> between <code>start</code> and <code>end</code>. <code>List&#8594;string</code> returns a newly
allocated string formed from the characters in the list <code>list</code>,
which must be a list of characters. <code>String&#8594;list</code> and
<code>list&#8594;string</code> are inverses so far as <code>equal?</code> is concerned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The R<sup>5</sup>RS version of <code>string&#8594;list</code> accepts only one
parameter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-copy string)</code></strong><br>
<strong><code>(string-copy string start)</code></strong><br>
<strong><code>(string-copy string start stop)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated copy of the part of the given <code>string</code>
between <code>start</code> and <code>stop</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The R<sup>5</sup>RS version of <code>string-copy</code> accepts only one argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-copy! to at from)</code></strong><br>
<strong><code>(string-copy! to at from start)</code></strong><br>
<strong><code>(string-copy! to at from start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Copies the characters of <code>string</code> from between <code>start</code> and <code>end</code>
to string <code>to</code>, starting at <code>at</code>. The order in which characters are copied
is unspecified, except that if the source and destination overlap,
copying takes place as if the source is first copied into a temporary
string and then into the destination. This can be achieved without
allocating storage by making sure to copy in the correct direction in
such circumstances.</p>
</div>
<div class="paragraph">
<p>It is an error if <code>at</code> is less than zero or greater than the length
of <code>to</code>. It is also an error if <code>(- (string-length to) at)</code> is less
than <code>(- end start)</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-split str)</code></strong><br>
<strong><code>(string-split str delimiters)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Parses <code>string</code> and returns a list of tokens ended by a character of the
<code>delimiters</code> string. If <code>delimiters</code> is omitted, it defaults to a string
containing a space, a tabulation and a newline characters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-split</span> <span class="s">"/usr/local/bin"</span> <span class="s">"/"</span><span class="p">)</span>
                       <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"usr"</span> <span class="s">"local"</span> <span class="s">"bin"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">string-split</span> <span class="s">"once   upon a time"</span><span class="p">)</span>
                       <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"once"</span> <span class="s">"upon"</span> <span class="s">"a"</span> <span class="s">"time"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-position str1 str2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the (first) index where <code>str1</code> is a substring of <code>str2</code> if it exists;
otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-position</span> <span class="s">"ca"</span> <span class="s">"abracadabra"</span><span class="p">)</span> <span class="nv">=&gt;</span>  <span class="mi">4</span>
<span class="p">(</span><span class="nf">string-position</span> <span class="s">"ba"</span> <span class="s">"abracadabra"</span><span class="p">)</span> <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function was also called <code>string-index</code>. This name is deprecated
since it conficts with the <code>string-index</code> defined in SRFI-13.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-find? str1 str2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>str1</code> appears somewhere in <code>str2</code>; otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-fill! string char)</code></strong><br>
<strong><code>(string-fill! string char start)</code></strong><br>
<strong><code>(string-fill! string char start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>char</code> in every element of the given <code>string</code> between <code>start</code> and <code>end</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The R<sup>5</sup>RS version of <code>string-fill!</code> accepts only one argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-blit! s1 s2 offset)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function places the characters of string <code>s2</code> in the string <code>s1</code>
starting at position <code>offset</code>. The result of <code>string-blit!</code> may modify
the string <code>s1</code>. Note that the characters of <code>s2</code> can be written after
the end of <code>s1</code> (in which case a new string is allocated).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-blit!</span> <span class="p">(</span><span class="nb">make-string</span> <span class="mi">6</span> <span class="sc">#\X</span><span class="p">)</span> <span class="s">"abc"</span> <span class="mi">2</span><span class="p">)</span>
              <span class="nv">=&gt;</span> <span class="s">"XXabcX"</span>
<span class="p">(</span><span class="nf">string-blit!</span> <span class="p">(</span><span class="nb">make-string</span> <span class="mi">10</span> <span class="sc">#\X</span><span class="p">)</span> <span class="s">"abc"</span> <span class="mi">5</span><span class="p">)</span>
              <span class="nv">=&gt;</span> <span class="s">"XXXXXabcXX"</span>
<span class="p">(</span><span class="nf">string-blit!</span> <span class="p">(</span><span class="nb">make-string</span> <span class="mi">6</span> <span class="sc">#\X</span><span class="p">)</span> <span class="s">"a"</span> <span class="mi">10</span><span class="p">)</span>
              <span class="nv">=&gt;</span> <span class="s">"XXXXXX\0\0\0\0a"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-mutable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a mutable string, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-mutable?</span> <span class="s">"abc"</span><span class="p">)</span>                <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">string-mutable?</span> <span class="p">(</span><span class="nb">string-copy</span> <span class="s">"abc"</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">string-mutable?</span> <span class="p">(</span><span class="nb">string</span> <span class="sc">#\a</span> <span class="sc">#\b</span> <span class="sc">#\c</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">string-mutable?</span> <span class="mi">12</span><span class="p">)</span>                   <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
The following string primitives are compatible with <strong><a href="http://srfi.schemers.org/srfi-13/srfi-13.html">SRFI-13</a></strong> (<em>String Library</em>)
and their documentation comes from the SRFI document.</p>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The string SRFI is supported by <strong><em>STklos</em></strong>. The
function listed below just don&#8217;t need to load the full SRFI to be
used</p>
</li>
<li>
<p>The functions <code>string-upcase</code>, <code>string-downcase</code> and
<code>string-foldcase</code> are also defined in R<sup>7</sup>RS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-downcase str)</code></strong><br>
<strong><code>(string-downcase str start)</code></strong><br>
<strong><code>(string-downcase str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string in which the upper case letters of string <code>str</code> between the
<code>start</code> and <code>end</code> indices have been replaced by their lower case equivalent.
If <code>start</code> is omited, it defaults to 0. If <code>end</code> is omited, it defaults to
the length of <code>str</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-downcase</span> <span class="s">"Foo BAR"</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="s">"foo bar"</span>
<span class="p">(</span><span class="nf">string-downcase</span> <span class="s">"Foo BAR"</span> <span class="mi">4</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="s">"bar"</span>
<span class="p">(</span><span class="nf">string-downcase</span> <span class="s">"Foo BAR"</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="s">"ba"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In R<sup>7</sup>RS, <code>string-downcase</code> accepts only one argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-downcase! str)</code></strong><br>
<strong><code>(string-downcase! str start)</code></strong><br>
<strong><code>(string-downcase! str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the in-place side-effecting variant of <code>string-downcase</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-downcase!</span> <span class="p">(</span><span class="nb">string-copy</span> <span class="s">"Foo BAR"</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="s">"Foo bar"</span>
<span class="p">(</span><span class="nf">string-downcase!</span> <span class="p">(</span><span class="nb">string-copy</span> <span class="s">"Foo BAR"</span><span class="p">)</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="s">"Foo baR"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-upcase str)</code></strong><br>
<strong><code>(string-upcase str start)</code></strong><br>
<strong><code>(string-upcase str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string in which the lower case letters of string <code>str</code> between the
<code>start</code> and <code>end</code> indices have been replaced by their upper case equivalent.
If <code>start</code> is omited, it defaults to 0. If <code>end</code> is omited, it defaults to
the length of <code>str</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In R<sup>7</sup>RS, <code>string-upcase</code> accepts only one argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-upcase! str)</code></strong><br>
<strong><code>(string-upcase! str start)</code></strong><br>
<strong><code>(string-upcase! str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the in-place side-effecting variant of <code>string-upcase</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-titlecase str)</code></strong><br>
<strong><code>(string-titlecase str start)</code></strong><br>
<strong><code>(string-titlecase str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function returns a string.  For every character <code>c</code> in the
selected range of <code>str</code>, if <code>c</code> is preceded by a cased character, it
is downcased; otherwise it is titlecased. If <code>start</code> is omited, it
defaults to 0. If <code>end</code> is omited, it defaults to the length of <code>str</code>.
Note that if a <code>start</code> index is specified, then the character preceding
<code>s[start]</code> has no effect on the titlecase decision for character <code>s[start]</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">"--capitalize tHIS sentence."</span><span class="p">)</span>
         <span class="nv">=&gt;</span>  <span class="s">"--Capitalize This Sentence."</span>
<span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">"see Spot run. see Nix run."</span><span class="p">)</span>
         <span class="nv">=&gt;</span>  <span class="s">"See Spot Run. See Nix Run."</span>
<span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">"3com makes routers."</span><span class="p">)</span>
         <span class="nv">=&gt;</span>  <span class="s">"3Com Makes Routers."</span>
<span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">"greasy fried chicken"</span> <span class="mi">2</span><span class="p">)</span>
         <span class="nv">=&gt;</span> <span class="s">"Easy Fried Chicken"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-titlecase! str)</code></strong><br>
<strong><code>(string-titlecase! str start)</code></strong><br>
<strong><code>(string-titlecase! str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the in-place side-effecting variant of <code>string-titlecase</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-append! string &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Extends string by appending each value (in order) to the end of string.
A value can be a character or a string.</p>
</div>
<div class="paragraph">
<p>It is guaranteed that string-append! will return the same object that
was passed to it as first argument, whose size may be larger.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is defined in SRFI-118.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-replace! dst dst-start dst-end src)</code></strong><br>
<strong><code>(string-replace! dst dst-start dst-end src src-start)</code></strong><br>
<strong><code>(string-replace! dst dst-start dst-end src src-start src-end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Replaces the characters of the variable-size string dst (between
dst-start and dst-end) with the characters of the string src
(between src-start and src-end). The number of characters from src
may be different from the number replaced in dst, so the string may
grow or contract. The special case where dst-start is equal to
dst-end corresponds to insertion; the case where src-start is equal
to src-end corresponds to deletion. The order in which characters
are copied is unspecified, except that if the source and
destination overlap, copying takes place as if the source is first
copied into a temporary string and then into the destination.
Returns string, appended with the characters form the concatenation
of the given arguments, which can be either strings or characters.</p>
</div>
<div class="paragraph">
<p>It is guaranteed that string-replace! will return the same object that
was passed to it as first argument, whose size may be larger.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is defined in SRFI-118.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-foldcase str)</code></strong><br>
<strong><code>(string-foldcase str start)</code></strong><br>
<strong><code>(string-foldcase str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string in which the Unicode simple case-folding algorithm has
been applied on <code>str</code> between the <code>start</code> and <code>end</code> indices.
If <code>start</code> is omited, it defaults to 0. If <code>end</code> is omited, it defaults to
the length of <code>str</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In R<sup>7</sup>RS, <code>string-foldcase</code> accepts only one argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-foldcase! str)</code></strong><br>
<strong><code>(string-foldcase! str start)</code></strong><br>
<strong><code>(string-foldcase! str start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the in-place side-effecting variant of <code>string-foldcase</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_vectors">4.8. Vectors</h3>
<div class="paragraph">
<p>
Vectors are heterogenous structures whose elements are
indexed by integers.  A vector typically occupies less space than
a list of the same length, and the average time required to
access a randomly chosen element is typically less for the vector
than for the list.</p>
</div>
<div class="paragraph">
<p>The length of a vector is the number of elements that it
contains.  This number is a non-negative integer that is fixed
when the vector is created.  The valid indexes of a vector are
the exact non-negative integers less than the length of the
vector.  The first element in a vector is indexed by zero, and
the last element is indexed by one less than the length of the
vector.</p>
</div>
<div class="paragraph">
<p>Vectors are written using the notation <code>#(obj &#8230;&#8203;)</code>.
For example, a vector of length 3 containing the number zero in
element 0, the list <code>(2 2 2 2)</code> in element 1, and the
string <code>"Anna"</code> in element 2 can be written as
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">#</span><span class="p">(</span><span class="nf">0</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="s">"Anna"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In STklos, vectors constants don&#8217;t need to be quoted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a vector, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-vector k)</code></strong><br>
<strong><code>(make-vector k fill)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated vector of <code>k</code> elements. If a second argument is
given, then each element is initialized to <code>fill</code>. Otherwise, the initial
contents of each element is unspecified.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated vector whose elements contain the given arguments.
Analogous to <code>list</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">vector</span> <span class="ss">'a</span> <span class="ss">'b</span> <span class="ss">'c</span><span class="p">)</span>               <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-length vector)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of elements in <code>vector</code> as an exact integer.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-ref vector k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>k</code> must be a valid index of <code>vector</code>. <code>Vector-ref</code> returns the contents of
element <code>k</code> of vector.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">vector-ref</span> <span class="o">'#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">13</span> <span class="mi">21</span><span class="p">)</span>
            <span class="mi">5</span><span class="p">)</span>                                    <span class="nv">=&gt;</span>  <span class="mi">8</span>
<span class="p">(</span><span class="nb">vector-ref</span> <span class="o">'#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">13</span> <span class="mi">21</span><span class="p">)</span>
            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">i</span> <span class="p">(</span><span class="nb">round</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">acos</span> <span class="mi">-1</span><span class="p">)))))</span>
              <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">inexact?</span> <span class="nv">i</span><span class="p">)</span>
                  <span class="p">(</span><span class="nb">inexact-&gt;exact</span> <span class="nv">i</span><span class="p">)</span>
                  <span class="nv">i</span><span class="p">)))</span>                            <span class="nv">=&gt;</span> <span class="mi">13</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-set! vector k obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>k</code> must be a valid index of <code>vector</code>. <code>Vector-set!</code> stores <code>obj</code> in element
<code>k</code> of <code>vector</code>. The value returned by <code>vector-set!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">vector</span> <span class="mi">0</span> <span class="o">'</span><span class="p">(</span><span class="nf">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="s">"Anna"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">vec</span> <span class="mi">1</span> <span class="o">'</span><span class="p">(</span><span class="s">"Sue"</span> <span class="s">"Sue"</span><span class="p">))</span>
  <span class="nv">vec</span><span class="p">)</span>      <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">0</span> <span class="p">(</span><span class="s">"Sue"</span> <span class="s">"Sue"</span><span class="p">)</span> <span class="s">"Anna"</span><span class="p">)</span>

<span class="p">(</span><span class="nb">vector-set!</span> <span class="o">'#</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">1</span> <span class="s">"doe"</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="nv">error</span>  <span class="c1">; constant vector</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector&#8594;list vector)</code></strong><br>
<strong><code>(vector&#8594;list vector start)</code></strong><br>
<strong><code>(vector&#8594;list vector start end)</code></strong><br>
<strong><code>(list&#8594;vector list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Vector&#8594;list</code> returns a newly allocated list of the objects contained in
the elements of <code>vector</code> between start an end. <code>List&#8594;vector</code> returns a
newly created vector initialized to the elements of the list <code>list</code>.</p>
</div>
<div class="paragraph">
<p>In both procedures, order is preserved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">vector-&gt;list</span> <span class="o">'#</span><span class="p">(</span><span class="nf">dah</span> <span class="nv">dah</span> <span class="nv">didah</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">dah</span> <span class="nv">dah</span> <span class="nv">didah</span><span class="p">)</span>
<span class="p">(</span><span class="nb">vector-&gt;list</span> <span class="o">'#</span><span class="p">(</span><span class="nf">dah</span> <span class="nv">dah</span> <span class="nv">didah</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">dah</span><span class="p">)</span>
<span class="p">(</span><span class="nb">list-&gt;vector</span> <span class="o">'</span><span class="p">(</span><span class="nf">dididit</span> <span class="nv">dah</span><span class="p">))</span>        <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">dididit</span> <span class="nv">dah</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The R<sup>5</sup>RS version of <code>vector&#8594;list</code> accepts only one
parameter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector&#8594;string string)</code></strong><br>
<strong><code>(vector&#8594;string string start)</code></strong><br>
<strong><code>(vector&#8594;string string start end)</code></strong><br>
<strong><code>(string&#8594;vector vector)</code></strong><br>
<strong><code>(string&#8594;vector vector start)</code></strong><br>
<strong><code>(string&#8594;vector vector start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>vector&#8594;string</code> procedure returns a newly allocated
string of the objects contained in the elements of <code>vector</code>
between <code>start</code> and <code>end</code>. It is an error if any element of <code>vector</code>
between <code>start</code> and <code>end</code> is not a character.</p>
</div>
<div class="paragraph">
<p>The <code>string&#8594;vector</code> procedure returns a newly created vector
initialized to the elements of <code>string</code> between <code>start</code> and <code>end</code>.</p>
</div>
<div class="paragraph">
<p>In both procedures, order is preserved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-&gt;vector</span> <span class="s">"ABC"</span><span class="p">)</span>           <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="sc">#\A</span> <span class="sc">#\B</span> <span class="sc">#\C</span><span class="p">)</span>
<span class="p">(</span><span class="nf">vector-&gt;string</span> <span class="o">#</span><span class="p">(</span><span class="sc">#\1</span> <span class="sc">#\2</span> <span class="sc">#\3</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="s">"123"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-append vector &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated vector whose elements are the
concatenation of the elements of the given vectors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">vector-append</span> <span class="o">#</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="o">#</span><span class="p">(</span><span class="nf">d</span> <span class="nv">e</span> <span class="nv">f</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span> <span class="nv">f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-fill! vector fill)</code></strong><br>
<strong><code>(vector-fill! vector fill start)</code></strong><br>
<strong><code>(vector-fill! vector fill start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>fill</code> in every element of <code>vector</code> between <code>start</code> and <code>end</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The R<sup>5</sup>RS version of <code>vector-fill!</code> accepts only one
parameter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS / R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-copy v)</code></strong><br>
<strong><code>(vector-copy v start)</code></strong><br>
<strong><code>(vector-copy v start stop)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a newly allocated copy of the elements of the given
vector between <code>start</code> and <code>end</code> . The elements of the new
vector are the same (in the sense of eqv?) as the elements
of the old.</p>
</div>
<div class="paragraph">
<p>Note that, if <code>v</code> is a constant vector, its copy is not constant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="o">#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">8</span> <span class="mi">2</span> <span class="mi">8</span><span class="p">))</span>         <span class="c1">; a is immutable</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">vector-copy</span> <span class="nv">a</span><span class="p">))</span>    <span class="c1">; b is mutable</span>
<span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">b</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">)</span>
<span class="nv">b</span>                            <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">3</span> <span class="mi">8</span> <span class="mi">2</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">vector-copy</span> <span class="nv">b</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">))</span>
<span class="nv">c</span>                            <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">8</span> <span class="mi">2</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-copy! to at from)</code></strong><br>
<strong><code>(vector-copy! to at from start)</code></strong><br>
<strong><code>(vector-copy! to at from start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-resize v size)</code></strong><br>
<strong><code>(vector-resize v size fill)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a copy of v of the given <code>size</code>. If <code>size</code> is greater
than the vector size of <code>v</code>, the contents of the newly allocated vector cells
is  set to the value of <code>fill</code>. If <code>fill</code> is omitted the content of the
new cells is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-mutable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a mutable vector, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">vector-mutable?</span> <span class="o">'#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>            <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">vector-mutable?</span> <span class="p">(</span><span class="nf">vector-copy</span> <span class="o">'#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)))</span>  <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">vector-mutable?</span> <span class="p">(</span><span class="nb">vector</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>         <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">vector-mutable?</span> <span class="mi">12</span><span class="p">)</span>                     <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(sort obj predicate)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Obj</code> must be a list or a vector. <code>Sort</code> returns a copy of <code>obj</code> sorted
according to <code>predicate</code>. <code>Predicate</code> must be a procedure which takes
two arguments and returns a true value if the first argument is strictly
``before'' the second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">sort</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">-4</span> <span class="mi">12</span> <span class="mi">9</span> <span class="mi">-1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">&lt;</span><span class="p">)</span>
               <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">-4</span> <span class="mi">-1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">9</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="nf">sort</span> <span class="o">'#</span><span class="p">(</span><span class="s">"one"</span> <span class="s">"two"</span> <span class="s">"three"</span> <span class="s">"four"</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">y</span><span class="p">))))</span>
               <span class="nv">=&gt;</span> <span class="o">'#</span><span class="p">(</span><span class="s">"three"</span> <span class="s">"four"</span> <span class="s">"one"</span> <span class="s">"two"</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_structures">4.9. Structures</h3>
<div class="paragraph">
<p>
A structure type is a record data type composing a number of slots. A
structure, an instance of a structure type, is a first-class value
that contains a value for each field of the structure type.</p>
</div>
<div class="paragraph">
<p>Structures can be created with the <code>define-struct</code> high
level syntax. However, <strong><em>STklos</em></strong> also offers some low-level functions
to build and access the internals of a structure.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-struct &lt;name&gt; &lt;slot&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Defines a structure type whose name is <code>&lt;name&gt;</code>. Once a structure type is
defined, the following symbols are bound:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;name&gt;</code> denotes the structure type.</p>
</li>
<li>
<p><code>make-&lt;name&gt;</code> is a procedure which takes 0 to <code>n</code> parameters (if there
are <code>n</code> slots defined). Each parameter is assigned to the corresponding
field (in the definition order).</p>
</li>
<li>
<p><code>&lt;name&gt;?</code> is a predicate which returns <code>#t</code> when applied to an
instance of the <code>&lt;name&gt;</code> structure type and <code>#f</code> otherwise</p>
</li>
<li>
<p><code>&lt;name&gt;-&lt;slot&gt;</code> (one for each defined <code>&lt;slot&gt;</code>) to read the
content of an instance of the <code>&lt;name&gt;</code> structure type. Writting the
content of a slot can be done using a generalized <code>set!</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-struct</span> <span class="nv">point</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">point?</span> <span class="nv">p</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">point?</span> <span class="mi">100</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">point-x</span> <span class="nv">p</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">point-y</span> <span class="nv">p</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">point-x</span> <span class="nv">p</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="nf">point-x</span> <span class="nv">p</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="mi">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-struct-type name parent slots)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This form which is more general than <code>define-struct</code> permits to define a
new structure type whose name is <code>name</code>. Parent is the structure
type from which is the new structure type is a subtype (or <code>#f</code> is the
new structure-type has no super type). <code>Slots</code> is the list of the slot
names which constitute the structure tpe.</p>
</div>
<div class="paragraph">
<p>When a structure type is s subtype of a previous type, its slots are added
to the ones of the super type.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-type? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a structure type, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">type</span> <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">struct-type?</span> <span class="nv">type</span><span class="p">))</span>         <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-type-slots structype)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the slots of the structure type <code>structype</code> as a list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">point</span>  <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">circle</span> <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'circle</span> <span class="nv">point</span> <span class="o">'</span><span class="p">(</span><span class="nf">r</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">struct-type-slots</span> <span class="nv">point</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="p">(</span><span class="nf">struct-type-slots</span> <span class="nv">circle</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span> <span class="nv">r</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-type-parent structype)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the super type of the structure type <code>structype</code>, if it exists
or <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-type-name structype)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name associated to the structure type <code>structype</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-type-change-writer! structype proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Change the default writer associated to structures of type <code>structype</code>
to the <code>proc</code> procedure. The <code>proc</code> procedure must accept 2 arguments
(the structure to write and the port wher the structure must be written
in that order). The value returned by <code>struct-type-change-writer!</code> is the
old writer associated to <code>structype</code>. To restore the standard structure
writer for <code>structype</code>, use the special value <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">point</span> <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">struct-type-change-writer!</span>
  <span class="nv">point</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">s</span> <span class="nv">port</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">type</span> <span class="p">(</span><span class="nf">struct-type</span> <span class="nv">s</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">format</span> <span class="nv">port</span> <span class="s">"{~A"</span> <span class="p">(</span><span class="nf">struct-type-name</span> <span class="nv">type</span><span class="p">))</span>
      <span class="c1">;; display the slots and their value</span>
      <span class="p">(</span><span class="nb">for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">format</span> <span class="nv">port</span> <span class="s">" ~A=~S"</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">struct-ref</span> <span class="nv">s</span> <span class="nv">x</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">struct-type-slots</span> <span class="nv">type</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">format</span> <span class="nv">port</span> <span class="s">"}"</span><span class="p">))))</span>
<span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">|-</span> <span class="err">{</span><span class="nv">point</span> <span class="nv">x=1</span> <span class="nv">y=2</span><span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-struct structype expr &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated instance of the structure type <code>structype</code>,
whose slots are initialized to <code>expr</code> &#8230;&#8203; If fewer <code>expr</code> than the number of
instances are given to <code>make-struct</code>, the remaining slots are inialized with
the special <strong><em>void</em></strong> value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a structure, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">type</span> <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">inst</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">type</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">struct?</span> <span class="nv">inst</span><span class="p">))</span>         <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-type s)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the structure type of the <code>s</code> structure</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-ref s slot-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the value associated to slot <code>slot-name</code> of the <code>s</code> structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">point</span>  <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">circle</span> <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'circle</span> <span class="nv">point</span> <span class="o">'</span><span class="p">(</span><span class="nf">r</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">circle</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">30</span><span class="p">))</span>
<span class="p">(</span><span class="nf">struct-ref</span> <span class="nv">p</span> <span class="ss">'y</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">struct-ref</span> <span class="nv">c</span> <span class="ss">'r</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">30</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-set! s slot-name value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores value in the to slot <code>slot-name</code> of the <code>s</code> structure. The value
returned by <code>struct-set!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">point</span>  <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">struct-ref</span> <span class="nv">p</span> <span class="ss">'x</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">struct-set!</span> <span class="nv">p</span> <span class="ss">'x</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nf">struct-ref</span> <span class="nv">p</span> <span class="ss">'x</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct-is-a? s structype)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a boolean that indicates if the structure <code>s</code> is of type <code>structype</code>.
Note that if <code>s</code> is an instance of a subtype of <em>S</em>, it is considered
also as an instance of type <em>S</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">point</span>  <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">circle</span> <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'circle</span> <span class="nv">point</span> <span class="o">'</span><span class="p">(</span><span class="nf">r</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">circle</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">30</span><span class="p">))</span>
<span class="p">(</span><span class="nf">struct-is-a?</span> <span class="nv">p</span> <span class="nv">point</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">struct-is-a?</span> <span class="nv">c</span> <span class="nv">point</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">struct-is-a?</span> <span class="nv">p</span> <span class="nv">circle</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">struct-is-a?</span> <span class="nv">c</span> <span class="nv">circle</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(struct&#8594;list s)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the content of structure <code>s</code> as an A-list whose keys are the
slots of the structure type of <code>s</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">point</span>  <span class="p">(</span><span class="nf">make-struct-type</span> <span class="ss">'point</span> <span class="no">#f</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">make-struct</span> <span class="nv">point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">struct-&gt;list</span> <span class="nv">p</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">x</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">y</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bytevectors">4.10. Bytevectors</h3>
<div class="paragraph">
<p>
<em>Bytevectors</em> represent blocks of binary data.  They
are fixed-length sequences of bytes, where a <em>byte</em> is an
exact integer in the range <code>(0, 255)</code>. A bytevector is typically more
space-efficient than a vector containing the same values.</p>
</div>
<div class="paragraph">
<p>The <em>length</em> of a bytevector is the number of elements that it contains. This
number is a non-negative integer that is fixed when the bytevector is
created. The <em>valid indexes</em> of a bytevector are the exact non-negative
integers less than the length of the bytevector, starting at index zero as
with vectors.</p>
</div>
<div class="paragraph">
<p>Bytevectors are written using the notation <code>#u8(byte &#8230;&#8203;)</code>.  For example, a
bytevector of length 3 containing the byte 0 in element 0, the byte 10 in
element 1, and the byte 5 in element 2 can be written as follows: <code>#u8(0 10
5)</code></p>
</div>
<div class="paragraph">
<p>Bytevector constants are self-evaluating, so they do not
need to be quoted in programs.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bytevector? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>!t</code> if <code>obj</code> is a bytevector and returns <code>!f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-bytevector k)</code></strong><br>
<strong><code>(make-bytevector k byte)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated bytevector of k bytes. If If <code>byte</code> is given,
then all elements of the bytevector are initialized to <code>byte</code>, otherwise
the contents of each element is 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">make-bytevector</span> <span class="mi">2</span> <span class="mi">12</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">12</span> <span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="nf">make-bytevector</span> <span class="mi">3</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bytevector byte &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated bytevector containing its arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">bytevector</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nf">bytevector</span><span class="p">)</span>               <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">u8</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bytevector-length bytevector)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the length of <code>bytevector</code> in bytes as an exact integer.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bytevector-copy bytevector)</code></strong><br>
<strong><code>(bytevector-copy bytevector start)</code></strong><br>
<strong><code>(bytevector-copy bytevector start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated bytevector containing the bytes in <code>bytevector</code>
between <code>start</code> and <code>end</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="nf">bytevector-copy</span> <span class="nv">a</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">))</span>       <span class="nv">=&gt;</span>  <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">3</span> <span class="mi">4</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bytevector-copy! to at from)</code></strong><br>
<strong><code>(bytevector-copy! to at from start)</code></strong><br>
<strong><code>(bytevector-copy! to at from start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Copies the bytes of bytevector <code>from</code> between <code>start</code> and <code>end</code>
to bytevector <code>to</code>, starting at <code>at</code>. The order in which bytes
are copied is unspecified, except that if the source and
destination overlap, copying takes place as if the source is first
copied into a temporary bytevector and then into the destination.
This can be achieved without allocating storage by making sure
to copy in the correct direction in such circumstances.</p>
</div>
<div class="paragraph">
<p>It is an error if <code>at</code> is less than zero or greater than the length
of <code>to</code>. It is also an error if <code>(- (bytevector-length to) at)</code> is
less than <code>(- end start)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">bytevector</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">bytevector</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">30</span> <span class="mi">40</span> <span class="mi">50</span><span class="p">))</span>
<span class="p">(</span><span class="nf">bytevector-copy!</span> <span class="nv">b</span> <span class="mi">1</span> <span class="nv">a</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">b</span>                                  <span class="nv">=&gt;</span>  <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">10</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">40</span> <span class="mi">50</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(bytevector-append bytevector &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated bytevector whose elements are
the concatenation of the elements in the given bytevectors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">bytevector-append</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
                    <span class="nv">=&gt;</span>  <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(utf8&#8594;string bytevector)</code></strong><br>
<strong><code>(utf8&#8594;string bytevector start)</code></strong><br>
<strong><code>(utf8&#8594;string bytevector start end)</code></strong><br>
<strong><code>(string&#8594;utf8 string)</code></strong><br>
<strong><code>(string&#8594;utf8 string start)</code></strong><br>
<strong><code>(string&#8594;utf8 string start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures translate between strings and bytevectors
that encode those strings using the UTF-8 encoding.
The <code>utf8&#8594;string</code> procedure decodes the bytes of
a bytevector between <code>start</code> and <code>end</code> and returns the
corresponding string; the <code>string&#8594;utf8</code> procedure encodes the
characters of a string between <code>start</code> and <code>end</code> and returns
the corresponding bytevector.</p>
</div>
<div class="paragraph">
<p>It is an error for <code>bytevector</code> to contain invalid UTF-8 byte
sequences.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">utf8-&gt;string</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="mh">#x41</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="s">"A"</span>
<span class="p">(</span><span class="nf">string-&gt;utf8</span> <span class="s">"λ"</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">u8</span><span class="p">((</span><span class="mh">#xce</span> <span class="mh">#xbb</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_control_features">4.11. Control features</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(procedure? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a procedure, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">procedure?</span> <span class="nv">car</span><span class="p">)</span>                            <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">procedure?</span> <span class="ss">'car</span><span class="p">)</span>                           <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">procedure?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)))</span>           <span class="nv">=&gt;</span>  <span class="no">#t</span>
<span class="p">(</span><span class="nb">procedure?</span> <span class="o">'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)))</span>          <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nb">call-with-current-continuation</span> <span class="nv">procedure?</span><span class="p">)</span> <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(apply proc arg1 &#8230;&#8203; args)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Proc</code> must be a procedure and <code>args</code> must be a list. Calls <code>proc</code> with the
elements of the list</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">arg1</span> <span class="o">...</span><span class="p">)</span> <span class="nv">args</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>as the actual arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">apply</span> <span class="nv">+</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="mi">7</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">compose</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">g</span><span class="p">)</span>
     <span class="p">(</span><span class="k">lambda</span> <span class="nv">args</span>
       <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">apply</span> <span class="nv">g</span> <span class="nv">args</span><span class="p">)))))</span>

<span class="p">((</span><span class="nf">compose</span> <span class="nv">sqrt</span> <span class="nv">*</span><span class="p">)</span> <span class="mi">12</span> <span class="mi">75</span><span class="p">)</span>          <span class="nv">=&gt;</span>  <span class="mi">30</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(map proc list1 list2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>list`s must be lists, and `proc</code> must be a procedure taking as many
arguments as there are lists and returning a single value.
If more than one list is given, then they must all be the same length.
<code>Map</code> applies <code>proc</code> element-wise to the elements of the `list`s and returns
a list of the results, in order.  The dynamic order in which proc is applied
to the elements of the lists is unspecified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">map</span> <span class="nv">cadr</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">)</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">h</span><span class="p">)))</span>   <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">e</span> <span class="nv">h</span><span class="p">)</span>

<span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">expt</span> <span class="nv">n</span> <span class="nv">n</span><span class="p">))</span>
     <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>                <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">1</span> <span class="mi">4</span> <span class="mi">27</span> <span class="mi">256</span> <span class="mi">3125</span><span class="p">)</span>

<span class="p">(</span><span class="nb">map</span> <span class="nv">+</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>         <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span> <span class="mi">9</span><span class="p">)</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">count</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">ignored</span><span class="p">)</span>
      <span class="p">(</span><span class="k">set!</span> <span class="nv">count</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">count</span> <span class="mi">1</span><span class="p">))</span>
      <span class="nv">count</span><span class="p">)</span>
       <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>                   <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)</span> <span class="o">,</span><span class="p">(</span><span class="nf">emph</span> <span class="s">"or"</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-map proc string1 string2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>strings</code> must be strings, and <code>proc</code> must be a procedure taking as
many arguments as there are strings and returning a single
value. If more than one string is given and not all strings have the
same length, <code>string-map</code> terminates when the shortest list runs
out. <code>String-map</code> applies <code>proc</code> element-wise to the elements of the
strings and returns a string of the results, in order. The dynamic
order in which proc is applied to the elements of the <code>strings</code> is
unspecified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-map</span> <span class="nv">char-downcase</span> <span class="s">"AbdEgH"</span><span class="p">)</span>
         <span class="nv">=&gt;</span> <span class="s">"abdegh"</span>

<span class="p">(</span><span class="nf">string-map</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">integer-&gt;char</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">char-&gt;integer</span> <span class="nv">c</span><span class="p">))))</span>
  <span class="s">"HAL"</span><span class="p">)</span>
         <span class="nv">=&gt;</span> <span class="s">"IBM"</span>

<span class="p">(</span><span class="nf">string-map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span> <span class="nv">k</span><span class="p">)</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eqv?</span> <span class="nv">k</span> <span class="sc">#\u</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">char-upcase</span> <span class="nv">c</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">char-downcase</span> <span class="nv">c</span><span class="p">)))</span>
         <span class="s">"studlycaps"</span>
         <span class="s">"ululululul"</span><span class="p">)</span>
      <span class="nv">=&gt;</span> <span class="s">"StUdLyCaPs"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-map proc vector1 vector2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>vectors</code> must be vectors, and <code>proc</code> must be a procedure
taking as many arguments as there are vectors and returning a single
value. If more than one vector is given and not all vectors have the
same length, <code>vector-map</code> terminates when the shortest list runs
out. <code>Vector-map</code> applies <code>proc</code> element-wise to the elements of the
vectors and returns a vector of the results, in order. The dynamic
order in which proc is applied to the elements of the <code>vectors</code> is
unspecified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">vector-map</span> <span class="nv">cadr</span> <span class="o">'#</span><span class="p">((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">)</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">h</span><span class="p">)))</span>
    <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">b</span> <span class="nv">e</span> <span class="nv">h</span><span class="p">)</span>

<span class="p">(</span><span class="nf">vector-map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">expt</span> <span class="nv">n</span> <span class="nv">n</span><span class="p">))</span>
         <span class="o">'#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">4</span> <span class="mi">27</span> <span class="mi">256</span> <span class="mi">3125</span><span class="p">)</span>

<span class="p">(</span><span class="nf">vector-map</span> <span class="nv">+</span> <span class="o">'#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="o">'#</span><span class="p">(</span><span class="nf">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">5</span> <span class="mi">7</span> <span class="mi">9</span><span class="p">)</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">count</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">vector-map</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">ignored</span><span class="p">)</span>
      <span class="p">(</span><span class="k">set!</span> <span class="nv">count</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">count</span> <span class="mi">1</span><span class="p">))</span>
      <span class="nv">count</span><span class="p">)</span>
    <span class="o">'#</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>
    <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">or</span> <span class="o">#</span><span class="p">(</span><span class="nf">2</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(for-each proc list1 list2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The arguments to <code>for-each</code> are like the arguments to <code>map</code>, but <code>for-each</code>
calls proc for its side effects rather than for its values.
Unlike <code>map</code>, <code>for-each</code> is guaranteed to call proc on the elements of
the lists in order from the first element(s) to the last, and the value
returned by <code>for-each</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">v</span> <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">5</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">i</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">v</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">i</span> <span class="nv">i</span><span class="p">)))</span>
            <span class="o">'</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
  <span class="nv">v</span><span class="p">)</span>                                <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string-for-each proc string1 string2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The arguments to <code>string-for-each</code> are like the arguments to
<code>string-map</code>, but <code>string-for-each</code> calls <code>proc</code> for its side effects
rather than for its values. Unlike <code>string-map</code>, <code>string-for-each</code> is
guaranteed to call <code>proc</code> on the elements of the lists in order from
the first element(s) to the last, and the value returned by
<code>string-for-each</code> is unspecified. If more than one string is given and
not all strings have the same length, <code>string-for-each</code> terminates when
the shortest string runs out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">v</span> <span class="p">(</span><span class="nb">list</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">string-for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">v</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">char-&gt;integer</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">v</span><span class="p">)))</span>
                   <span class="s">"abcde"</span><span class="p">)</span>
   <span class="nv">v</span><span class="p">)</span>
       <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">101</span> <span class="mi">100</span> <span class="mi">99</span> <span class="mi">98</span> <span class="mi">97</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(vector-for-each proc vector1 vector2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The arguments to <code>vector-for-each</code> are like the arguments to
<code>vector-map</code>, but <code>vector-for-each</code> calls <code>proc</code> for its side effects
rather than for its values. Unlike <code>vector-map</code>, <code>vector-for-each</code> is
guaranteed to call <code>proc</code> on the elements of the lists in order from
the first element(s) to the last, and the value returned by
<code>vector-for-each</code> is unspecified. If more than one vector is given and
not all vectors have the same length, <code>vector-for-each</code> terminates when
the shortest vector runs out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">v</span> <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">5</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">vector-for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">v</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">i</span> <span class="nv">i</span><span class="p">)))</span>
                <span class="o">'#</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
  <span class="nv">v</span><span class="p">)</span>
       <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(every pred list1 list2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>every</code> applies the predicate <code>pred</code> across the lists, returning true if
the predicate returns true on every application.</p>
</div>
<div class="paragraph">
<p>If there are n list arguments <code>list1</code> &#8230;&#8203; <code>listn</code>, then <code>pred</code> must be
a procedure taking n arguments and returning a boolean result.</p>
</div>
<div class="paragraph">
<p><code>every</code> applies pred to the first elements of the <code>listi</code> parameters. If
this application returns false, every immediately returns <code>#f</code>.
Otherwise, it iterates, applying <code>pred</code> to the second elements of the <code>listi</code>
parameters, then the third, and so forth. The iteration stops when a
false value is produced or one of the lists runs out of values.
In the latter case, <code>every</code> returns the true value produced by its final
application of pred. The application of pred to the last element of the
lists is a tail call.</p>
</div>
<div class="paragraph">
<p>If one of the <code>listi</code> has no elements, <code>every</code> simply returns <code>#t</code>.</p>
</div>
<div class="paragraph">
<p>Like <code>any</code>, every&#8217;s name does not end with a question mark&#8201;&#8212;&#8201;this is to
indicate that it does not return a simple boolean (<code>#t</code> or <code>#f</code>), but a
general value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(any pred list1 list2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>any</code> applies the predicate across the lists, returning true if the
predicate returns true on any application.</p>
</div>
<div class="paragraph">
<p>If there are n list arguments <code>list1</code> &#8230;&#8203; <code>listn</code>, then <code>pred</code> must be
a procedure taking n arguments.</p>
</div>
<div class="paragraph">
<p><code>any</code> applies <code>pred</code> to the first elements of the <code>listi</code> parameters. If
this application returns a true value, <code>any</code> immediately returns that value.
Otherwise, it iterates, applying <code>pred</code> to the second elements of the <code>listi</code>
parameters, then the third, and so forth. The iteration stops when a true
value is produced or one of the lists runs out of values; in the latter case,
any returns <code>#f</code>. The application of <code>pred</code> to the last element of the
lists is a tail call.</p>
</div>
<div class="paragraph">
<p>Like every, <code>any&#8217;s name does not end with a question mark&#8201;&#8212;&#8201;this is
to indicate that it does not return a simple boolean (</code>#t` or <code>#f</code>), but
a general value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">any</span> <span class="nv">integer?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="mi">3</span> <span class="nv">b</span> <span class="mf">2.7</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">any</span> <span class="nv">integer?</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="mf">3.1</span> <span class="nv">b</span> <span class="mf">2.7</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">any</span> <span class="nv">&lt;</span> <span class="o">'</span><span class="p">(</span><span class="nf">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span>
       <span class="o">'</span><span class="p">(</span><span class="nf">2</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">2</span><span class="p">))</span>          <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call-with-current-continuation proc)</code></strong><br>
<strong><code>(call/cc proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Proc</code> must be a procedure of one argument. The procedure
<code>call-with-current-continuation</code> packages up the current continuation
(see the rationale below) as an "<em>escape procedure</em>" and passes it as
an argument to <code>proc</code>. The escape procedure is a Scheme procedure that, if
it is later called, will abandon whatever continuation is in effect at
that later time and will instead use the continuation that was in effect
when the escape procedure was created. Calling the escape procedure may cause
the invocation of before and after thunks installed using <code>dynamic-wind</code>.</p>
</div>
<div class="paragraph">
<p>The escape procedure accepts the same number of arguments as
the continuation to the original call to
<code>call-with-current-continuation</code>. Except for continuations created
by the <code>call-with-values</code> procedure, all continuations take exactly
one value.</p>
</div>
<div class="paragraph">
<p>The escape procedure that is passed to proc has unlimited extent
just like any other procedure in Scheme. It may be stored in variables
or data structures and may be called as many times as desired.</p>
</div>
<div class="paragraph">
<p>The following examples show only the most common ways in which
<code>call-with-current-continuation</code> is used. If all real uses were as simple
as these examples, there would be no need for a procedure with the power
of <code>call-with-current-continuation</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">call-with-current-continuation</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">exit</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
                <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">negative?</span> <span class="nv">x</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">exit</span> <span class="nv">x</span><span class="p">)))</span>
              <span class="o">'</span><span class="p">(</span><span class="nf">54</span> <span class="mi">0</span> <span class="mi">37</span> <span class="mi">-3</span> <span class="mi">245</span> <span class="mi">19</span><span class="p">))</span>
    <span class="no">#t</span><span class="p">))</span>                                <span class="nv">=&gt;</span>  <span class="mi">-3</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">list-length</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">obj</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">call-with-current-continuation</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">return</span><span class="p">)</span>
        <span class="p">(</span><span class="k">letrec</span> <span class="p">((</span><span class="nf">r</span>
                  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">obj</span><span class="p">)</span>
                    <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">obj</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
                          <span class="p">((</span><span class="nb">pair?</span> <span class="nv">obj</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nf">r</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">obj</span><span class="p">))</span> <span class="mi">1</span><span class="p">))</span>
                          <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">return</span> <span class="no">#f</span><span class="p">))))))</span>
          <span class="p">(</span><span class="nf">r</span> <span class="nv">obj</span><span class="p">))))))</span>

<span class="p">(</span><span class="nf">list-length</span> <span class="o">'</span><span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>                <span class="nv">=&gt;</span>  <span class="mi">4</span>
<span class="p">(</span><span class="nf">list-length</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="o">.</span> <span class="nv">c</span><span class="p">))</span>                <span class="nv">=&gt;</span>  <span class="no">#f</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
common use of <code>call-with-current-continuation</code>
is for structured, non-local exits from loops or procedure bodies,
but in fact <code>call-with-current-continuation</code> is extremely useful
for implementing a wide variety of advanced control structures.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whenever a Scheme expression is evaluated there is a continuation
wanting the result of the expression. The continuation represents
an entire (default) future for the computation. If the expression
is evaluated at top level, for example, then the continuation
might take the result, print it on the screen, prompt for the
next input, evaluate it, and so on forever. Most of the time the
continuation includes actions specified by user code, as in a
continuation that will take the result, multiply it by the value
stored in a local variable, add seven, and give the answer to the
top level continuation to be printed. Normally these ubiquitous
continuations are hidden behind the scenes and programmers do not
think much about them. On rare occasions, however, a programmer
may need to deal with continuations explicitly.
<code>Call-with-current-continuation</code> allows Scheme
programmers to do that by creating a procedure that acts just
like the current continuation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>call/cc</code> is just another name for
<code>call-with-current-continuation</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call/ec proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>call/ec</code> is an short name for <code>call-with-escape-continuation</code>. <code>call/ec</code>
calls <code>proc</code> with one parameter, which is the current escape continuation
(a continuation which can only be used to abort a computation and hence
cannot be "re-enterered".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">list</span> <span class="mi">1</span>
      <span class="p">(</span><span class="nf">call/ec</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">return</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span> <span class="p">(</span><span class="nf">return</span> <span class="ss">'b</span><span class="p">)</span> <span class="ss">'c</span><span class="p">)))</span>
      <span class="mi">3</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="nv">b</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>call/ec</code> is cheaper than the full call/cc. It is particularily useful
when all the power of <code>call/cc</code> is not needded.</p>
</div>
<div id="values" class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(values obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Delivers all of its arguments to its continuation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
R<sup>5</sup>RS imposes to use multiple values in the context
of a <code>call-with-values</code>. In STklos, if <code>values</code> is not used with
<code>call-with-values</code>, only the first value is used (i.e. others values are
<em>ignored</em>)).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call-with-values producer consumer)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Calls its producer argument with no values and a continuation that,
when passed some values, calls the consumer procedure with those values
as arguments. The continuation for the call to consumer is the
continuation of the call to call-with-values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">call-with-values</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">values</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
                  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">b</span><span class="p">))</span>                <span class="nv">=&gt;</span>  <span class="mi">5</span>

<span class="p">(</span><span class="nb">call-with-values</span> <span class="nv">*</span> <span class="nv">-</span><span class="p">)</span>                             <span class="nv">=&gt;</span>  <span class="mi">-1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(receive &lt;formals&gt; &lt;expression&gt; &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This form is defined in <strong><a href="http://srfi.schemers.org/srfi-8/srfi-8.html">SRFI-8</a></strong> (<em>Receive: Binding to multiple values</em>). It simplifies
the usage of multiple values. Specifically, <code>&lt;formals&gt;</code> can have any
of three forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(<code>&lt;variable<sub>1</sub>&gt;</code> &#8230;&#8203; <code>&lt;variable<sub>n</sub>&gt;</code>):
The environment in which the
receive-expression is evaluated is extended by binding <code>&lt;variable<sub>1</sub>&gt;</code>, &#8230;&#8203;,
<code>&lt;variable<sub>n</sub>&gt;</code> to fresh locations.<br>
The <code>&lt;expression&gt;</code> is evaluated, and its
values are stored into those locations. (It is an error if <code>&lt;expression&gt;</code>
does not have exactly n values.)</p>
</li>
<li>
<p><code>&lt;variable&gt;</code>: The environment in which the receive-expression is
evaluated is extended by binding <code>&lt;variable&gt;</code> to a fresh location.<br>
The <code>&lt;expression&gt;</code> is evaluated, its values are converted into a newly
allocated list, and the list is stored in the location bound to <code>&lt;variable&gt;</code>.</p>
</li>
<li>
<p>(<code>&lt;variable<sub>1</sub>&gt;</code> &#8230;&#8203; <code>&lt;variable<sub>n</sub>&gt;</code> . <code>&lt;variable<sub>n+1</sub>&gt;</code>):  The environment
in which the receive-expression is evaluated is extended by binding
<code>&lt;variable<sub>1</sub>&gt;</code>, &#8230;&#8203;, <code>&lt;variable<sub>n+1</sub>&gt;</code> to fresh locations.
The <code>&lt;expression&gt;</code> is evaluated. Its first n values are stored into the
locations bound to <code>&lt;variable<sub>1</sub>&gt;</code> &#8230;&#8203; <code>&lt;variable<sub>n</sub>&gt;</code>. Any remaining values
are converted into a newly allocated list, which is stored into the location
bound to <code>&lt;variable<sub>n+1</sub>&gt;</code>. (It is an error if <code>&lt;expression&gt;</code> does not have
at least n values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In any case, the expressions in <code>&lt;body&gt;</code> are evaluated sequentially in
the extended environment. The results of the last expression in the body
are the values of the receive-expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">n</span> <span class="mi">123</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">receive</span> <span class="p">(</span><span class="nf">q</span> <span class="nv">r</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nb">quotient</span> <span class="nv">n</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="nb">modulo</span> <span class="nv">n</span> <span class="mi">10</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">cons</span> <span class="nv">q</span> <span class="nv">r</span><span class="p">)))</span>
              <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">12</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(dynamic-wind before thunk after)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Calls <code>thunk</code> without arguments, returning the result(s) of this call.
<code>Before</code> and <code>after</code> are called, also without arguments, as required by
the following rules (note that in the absence of calls to continuations
captured using <code>call-with-current-continuation</code> the three arguments are
called once each, in order).  <code>Before</code> is called whenever execution enters
the dynamic extent of the call to <code>thunk</code> and <code>after</code> is called whenever
it exits that dynamic extent.  The dynamic extent of a procedure call is
the period between when the call is initiated and when it returns.
In Scheme, because of <code>call-with-current-continuation</code>, the dynamic
extent of a call may not be a single, connected time period. It is
defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The dynamic extent is entered when execution of the body of
the called procedure begins.</p>
</li>
<li>
<p>The dynamic extent is also entered when execution is not
within the dynamic extent and a continuation is invoked that was
captured (using <code>call-with-current-continuation</code>) during the dynamic
extent.</p>
</li>
<li>
<p>It is exited when the called procedure returns.</p>
</li>
<li>
<p>It is also exited when execution is within the dynamic
extent and a continuation is invoked that was captured while not within
the dynamic extent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a second call to <code>dynamic-wind</code> occurs within the dynamic extent
of the call to <code>thunk</code> and then a continuation is invoked in such a
way that the afters from these two invocations of <code>dynamic-wind</code>
are both to be called, then the after associated with the
second (inner) call to <code>dynamic-wind</code> is called first.</p>
</div>
<div class="paragraph">
<p>If a second call to <code>dynamic-wind</code> occurs within the dynamic extent
of the call to <code>thunk</code> and then a continuation is invoked in such a
way that the befores from these two invocations of <code>dynamic-wind</code>
are both to be called, then the before associated with the
first (outer) call to <code>dynamic-wind</code> is called first.</p>
</div>
<div class="paragraph">
<p>If invoking a continuation requires calling the <code>before</code> from one
call to <code>dynamic-wind</code> and the <code>after</code> from another, then the <code>after</code>
is called first.</p>
</div>
<div class="paragraph">
<p>The effect of using a captured continuation to enter or exit the
dynamic extent of a call to <code>before</code> or <code>after</code> is undefined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">path</span> <span class="o">'</span><span class="p">())</span>
      <span class="p">(</span><span class="nf">c</span> <span class="no">#f</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">add</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">s</span><span class="p">)</span>
               <span class="p">(</span><span class="k">set!</span> <span class="nv">path</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">s</span> <span class="nv">path</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">dynamic-wind</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">add</span> <span class="ss">'connect</span><span class="p">))</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nb">call-with-current-continuation</span>
               <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c0</span><span class="p">)</span>
                 <span class="p">(</span><span class="k">set!</span> <span class="nv">c</span> <span class="nv">c0</span><span class="p">)</span>
                 <span class="ss">'talk1</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">add</span> <span class="ss">'disconnect</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">path</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">c</span> <span class="ss">'talk2</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">reverse</span> <span class="nv">path</span><span class="p">))))</span>
                  <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">connect</span> <span class="nv">talk1</span> <span class="nv">disconnect</span>
                       <span class="nv">connect</span> <span class="nv">talk2</span> <span class="nv">disconnect</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(eval expression environment)</code></strong><br>
<strong><code>(eval expression)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Evaluates expression in the specified environment and returns its
value. <code>Expression</code> must be a valid Scheme expression represented
as data. <code>Environment</code> may be a R<sup>5</sup>RS environment-specifier
(<code>interaction-environment</code>, <code>scheme-report-environment</code> or
<code>null-environment</code>) or a <strong><em>STklos</em></strong> module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eval</span> <span class="o">'</span><span class="p">(</span><span class="nb">*</span> <span class="mi">7</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nb">scheme-report-environment</span> <span class="mi">5</span><span class="p">))</span>
              <span class="nv">=&gt;</span> <span class="mi">21</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">f</span> <span class="p">(</span><span class="nb">eval</span> <span class="o">'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
               <span class="p">(</span><span class="nb">null-environment</span> <span class="mi">5</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">f</span> <span class="nv">+</span> <span class="mi">10</span><span class="p">))</span>
              <span class="nv">=&gt;</span> <span class="mi">20</span>
<span class="p">(</span><span class="nf">define-module</span> <span class="nv">A</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nb">eval</span> <span class="o">'</span><span class="p">(</span><span class="nb">cons</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">find-module</span> <span class="ss">'A</span><span class="p">))</span>
              <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(environment set1 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns a specifier for the environment that
results by starting with an empty environment and then
importing each <strong>set</strong>, considered as an import
set, into it. The bindings of the environment represented by
the specifier, as is the environment itself.</p>
</div>
<div class="paragraph">
<p>In STklos,
- each <code>set</code> argument can be a list (specifying an R<sup>7</sup>RS
  library) or a symbol (specifying a module).
- the return environment is an R<sup>7</sup>RS library (which can be
  passed to <code>eval</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eval</span> <span class="o">'</span><span class="p">(</span><span class="nb">*</span> <span class="mi">7</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">environment</span> <span class="o">'</span><span class="p">(</span><span class="nf">scheme</span> <span class="nv">base</span><span class="p">)))</span>    <span class="nv">=&gt;</span> <span class="mi">21</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">f</span> <span class="p">(</span><span class="nb">eval</span> <span class="o">'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
               <span class="p">(</span><span class="nb">null-environment</span> <span class="mi">5</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">f</span> <span class="nv">+</span> <span class="mi">10</span><span class="p">))</span>                                     <span class="nv">=&gt;</span> <span class="mi">20</span>

<span class="p">(</span><span class="nb">eval</span> <span class="o">'</span><span class="p">(</span><span class="k">define</span> <span class="nv">foo</span> <span class="mi">32</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">environment</span> <span class="o">'</span><span class="p">(</span><span class="nf">scheme</span> <span class="nv">base</span><span class="p">)))</span>             <span class="nv">=&gt;</span> <span class="nv">errror</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">e</span> <span class="p">(</span><span class="nf">environment</span> <span class="o">'</span><span class="p">(</span><span class="nf">only</span> <span class="p">(</span><span class="nf">scheme</span> <span class="nv">base</span><span class="p">)</span> <span class="nv">+</span> <span class="nv">-</span><span class="p">)</span>
                      <span class="o">'</span><span class="p">(</span><span class="nf">only</span> <span class="p">(</span><span class="nf">scheme</span> <span class="nv">write</span><span class="p">)</span> <span class="nv">display</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">length</span> <span class="p">(</span><span class="nf">module-symbols</span> <span class="nv">e</span><span class="p">)))</span>                  <span class="nv">=&gt;</span> <span class="mi">3</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">e</span> <span class="p">(</span><span class="nf">environment</span> <span class="o">'</span><span class="p">(</span><span class="nf">prefix</span> <span class="p">(</span><span class="nf">only</span> <span class="p">(</span><span class="nf">scheme</span> <span class="nv">base</span><span class="p">)</span> <span class="nv">car</span><span class="p">)</span>
                               <span class="nv">foo-</span><span class="p">))))</span>
   <span class="p">(</span><span class="nf">module-symbols</span> <span class="nv">e</span><span class="p">))</span>                            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">foo-car</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(scheme-report-environment)</code></strong><br>
<strong><code>(scheme-report-environment version)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a specifier for an environment that contains the bindings defined
in the R<sup>5</sup>RS report.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In STklos, <code>scheme-report-environment</code> function can be called
without the version number (defaults to 5).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(null-environment)</code></strong><br>
<strong><code>(null-environment version)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a specifier for an environment that is empty except for
the (syntactic) bindings for all syntactic keywords defined in
the R<sup>5</sup>RS report.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In STklos, <code>null-environment</code> function can be called
without the version number (defaults to 5).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(interaction-environment)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns the environment in the expression are
evaluated by default (the <strong><em>STklos</em></strong> module). The returned environment
is mutable.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(eval-from-string str)</code></strong><br>
<strong><code>(eval-from-string str module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Read an expression from <code>str</code> and evaluates it with <code>eval</code>. If a <code>module</code>
is passed, the evaluation takes place in the environment of this module.
Otherwise, the evaluation takes place in the environment returned by
<code>current-module</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-module</span> <span class="nv">M</span>
  <span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">100</span><span class="p">))</span>
<span class="p">(</span><span class="nf">eval-from-string</span> <span class="s">"(+ x x)"</span><span class="p">)</span>                   <span class="nv">=&gt;</span> <span class="mi">20</span>
<span class="p">(</span><span class="nf">eval-from-string</span> <span class="s">"(+ x x)"</span> <span class="p">(</span><span class="nf">find-module</span> <span class="ss">'M</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="mi">200</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input_and_output">4.12. Input and Output</h3>
<div class="paragraph">
<p>



R<sup>5</sup>RS states that ports represent input and output
devices.  However, it defines only ports which are attached to
files.  In <strong><em>STklos</em></strong>, ports can also be attached to strings, to a
external command input or output, or even be virtual (i.e. the
behavior of the port is given by the user).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String ports are similar to file ports, except that characters are read from
(or written to) a string rather than a file.</p>
</li>
<li>
<p>External command input or output ports are implemented with Unix pipes and
are called <strong><em>pipe ports</em></strong>. A pipe port is created by specifying the command to
execute prefixed with the string <code>"| "</code> (that is a pipe bar followed by a
space).  Specification of a pipe port can occur everywhere a file name is
needed.</p>
</li>
<li>
<p>Virtual ports are created by supplying basic I/O functions at port creation
time. These functions will be used to simulate low level accesses to a
``virtual device''. This kind of port is particularly convenient for reading
or writing in a graphical window as if it was a file. Once a virtual port is
created, it can be accessed as a normal port with the standard Scheme
primitives.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ports">4.12.1. Ports</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call-with-port port proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>call-with-port</code> procedure calls <code>proc</code> with <code>port</code> as an
argument. If <code>proc</code> returns, then the <code>port</code> is closed automatically
and the values yielded by the <code>proc</code> are returned.
If <code>proc</code> does not return, then the <code>port</code> must not be closed
automatically unless it is possible to prove that the port
will never again be used for a read or write operation.</p>
</div>
<div class="paragraph">
<p>It is an error if proc does not accept one argument.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call-with-input-file string proc)</code></strong><br>
<strong><code>(call-with-output-file string proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String</code> should be a string naming a file, and <code>proc</code> should be a procedure
that accepts one argument. For <code>call-with-input-file</code>, the file should
already exist. These procedures call <code>proc</code> with one argument: the port
obtained by opening the named file for input or output. If the file cannot
be opened, an error is signaled. If <code>proc</code> returns, then the port is closed
automatically and the value(s) yielded by the proc is(are) returned.
If proc does not return, then the port will not be closed automatically.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Because Scheme&#8217;s escape procedures have unlimited extent,
it is possible to escape from the current continuation but later to escape
back in. If implementations were permitted to close the port on any escape
from the current continuation, then it would be impossible to write portable
code using both <code>call-with-current-continuation</code> and <code>call-with-input-file</code>
or <code>call-with-output-file</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call-with-input-string string proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>behaves as <code>call-with-input-file</code> except that the port passed to <code>proc</code>
is the sting port obtained from <code>port</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">call-with-input-string</span> <span class="s">"123 456"</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
     <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">n1</span> <span class="p">(</span><span class="nb">read</span> <span class="nv">x</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">n2</span> <span class="p">(</span><span class="nb">read</span> <span class="nv">x</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">cons</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">))))</span>          <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">123</span> <span class="o">.</span> <span class="mi">456</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(call-with-output-string proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Proc</code> should be a procedure of one argument. <code>Call-with-output-string</code>
calls <code>proc</code> with a freshly opened output string port. The result of
this procedure is a string containing all the text that has been written
on the string port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">call-with-output-string</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">write</span> <span class="mi">123</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="s">"Hello"</span> <span class="nv">x</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="s">"123Hello"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(input-port? obj)</code></strong><br>
<strong><code>(output-port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an input port or output port respectively,
otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(textual-port? obj)</code></strong><br>
<strong><code>(binary-port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a textual port or binary port respectively,
otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an input port or an output port,
otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(input-string-port? obj)</code></strong><br>
<strong><code>(output-string-port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an input string port or output string port
respectively, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(input-bytevector-port? obj)</code></strong><br>
<strong><code>(output-bytevector-port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an input bytevector port or output bytevector port
respectively, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(input-file-port? obj)</code></strong><br>
<strong><code>(output-file-port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a file input port or a file output port respectively,
otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(input-virtual-port? obj)</code></strong><br>
<strong><code>(output-virtual-port? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a virtual input port or a virtual output port
respectively, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(interactive-port? port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>port</code> is connected to a terminal and <code>#f</code> otherwise.</p>
</div>
<div id="curroport" class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-input-port obj)</code></strong><br>
<strong><code>(current-output-port obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current default input or output port.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-error-port obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current default error port.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-input-from-file string thunk)</code></strong><br>
<strong><code>(with-output-to-file string thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String</code> should be a string naming a file, and <code>proc</code> should be a
procedure of no arguments. For <code>with-input-from-file</code>, the file should
already exist. The file is opened for input or output, an input or output
port connected to it is made the default value returned by
<code>current-input-port</code> or <code>current-output-port</code> (and is used by <code>(read)</code>,
<code>(write obj)</code>, and so forth), and the thunk is called with no arguments.
When the thunk returns, the port is closed and the previous default is
restored. <code>With-input-from-file</code> and <code>with-output-to-file</code> return(s)
the value(s) yielded by thunk.</p>
</div>
<div class="paragraph">
<p>The following example uses a pipe port opened for reading. It permits to
read all the lines produced by an external ,(emph "ls") command (i.e. the
output of the ,(emph "ls") command is ,(emph "redirected") to the Scheme pipe
port).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">with-input-from-file</span> <span class="s">"| ls -ls"</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="k">do</span> <span class="p">((</span><span class="nf">l</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)))</span>
        <span class="p">((</span><span class="nb">eof-object?</span> <span class="nv">l</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">display</span> <span class="nv">l</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">newline</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hereafter is another example of Unix command redirection. This time,
it is the standard input of the Unix command which is redirected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">with-output-to-file</span> <span class="s">"| mail root"</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">display</span> <span class="s">"A simple mail from Scheme"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">newline</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-error-to-file string thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure is similar to with-output-to-file, excepted that it uses the
current error port instead of the output port.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-input-from-string string thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A string port is opened for input from <code>string</code>. <code>Current-input-port</code>
is set to the port and <code>thunk</code> is called. When <code>thunk</code> returns,
the previous default input port is restored. <code>With-input-from-string</code>
returns the value(s) computed by <code>thunk</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-input-from-string</span> <span class="s">"123 456"</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">read</span><span class="p">)))</span>                       <span class="nv">=&gt;</span>  <span class="mi">123</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-output-to-string thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A string port is opened for output. <code>Current-output-port</code>
is set to it and <code>thunk</code> is called. When <code>thunk</code> returns,
the previous default output port is restored. <code>With-output-to-string</code>
returns the string containing the text written on the string port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-output-to-string</span>
   <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">write</span> <span class="mi">123</span><span class="p">)</span> <span class="p">(</span><span class="nb">write</span> <span class="s">"Hello"</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="s">"123\\"</span><span class="nv">Hello</span><span class="err">\\</span><span class="s">""</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-input-from-port port thunk)</code></strong><br>
<strong><code>(with-output-to-port port thunk)</code></strong><br>
<strong><code>(with-error-to-port port thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Port</code> should be a port, and <code>proc</code> should be a
procedure of no arguments. These procedures do a job similar to the
<code>with-&#8230;&#8203;-file</code> counterparts  excepted that they use an open port instead
of string specifying a file name</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-input-file filename)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Takes a string naming an existing file and returns an input port capable
of delivering characters from the file. If the file cannot be opened,
an error is signalled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if <code>filename</code> starts with the string <code>"| "</code>, this procedure returns a pipe port.
Consequently, it is not possible to open a file whose name starts with those two
characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-input-string str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an input string port capable of delivering characters from
<code>str</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-input-string bytevector)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Takes a bytevector and returns a binary input port that
delivers bytes from the <code>bytevector</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-input-virtual :key  (read-char #f) (ready? #f) (eof? #f) (close #f))</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a virtual port using the <code>read-char</code> procedure to read a
character from the port, <code>ready?</code> to know if there is any data to
read from the port, <code>eof?</code> to know if the end of file is reached
on the port and finally <code>close</code> to close the port. All these
procedure takes one parameter which is the port from which the input
takes place.  <code>Open-input-virtual</code> accepts also the special value
<code>#f</code> for the I/O procedures with the following conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>read-char</code> or <code>eof?</code> is <code>#f</code>, any attempt to read
the virtual port will return an eof object;</p>
</li>
<li>
<p>if <code>ready?</code> is <code>#f</code>, the file is always  ready for reading;</p>
</li>
<li>
<p>if <code>close</code> is <code>#f</code>, no action is done when the port is closed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hereafter is a possible implementation of <code>open-input-string</code>
using virtual ports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">open-input-string</span> <span class="nv">str</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">index</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">open-input-virtual</span>
       <span class="nv">:read-char</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">p</span><span class="p">)</span>
                    <span class="c1">;; test on eof is already done by the system</span>
                    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">res</span> <span class="p">(</span><span class="nb">string-ref</span> <span class="nv">str</span> <span class="nv">index</span><span class="p">)))</span>
                      <span class="p">(</span><span class="k">set!</span> <span class="nv">index</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">index</span> <span class="mi">1</span><span class="p">))</span>
                      <span class="nv">res</span><span class="p">))</span>
       <span class="nv">:eof?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;=</span> <span class="nv">index</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">str</span><span class="p">))))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-output-file filename)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Takes a string naming an output file to be created and returns an output
port capable of writing characters to a new file by that name. If the file
cannot be opened, an error is signalled. If a file with the given name
already exists, it is rewritten.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if <code>filename</code> starts with the string <code>"| "</code>, this procedure returns a pipe port.
Consequently, it is not possible to open a file whose name starts with those two
characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-output-string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an output string port capable of receiving and collecting characters.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-output-bytevector)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a binary output port that will accumulate bytes
for retrieval by <code>get-output-bytevector</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-output-virtual :key  (write-char #f) (write-string #f) (flush #f) (close #f))</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a virtual port using the <code>write-char</code> procedure to write a
character to the port, <code>write-string</code> to write a string to the port,
<code>flush</code> to (eventuelly) flush the characters on the port and finally
<code>close`to close the port. `Write-char</code> takes two parameters: a character and
the port to which the output must be done. <code>write-string</code> takes two
parameters: a string and a port. <code>Flush</code> and <code>Close</code> take one
parameter which is the port on which the action must be done.
<code>Open-output-virtual</code> accepts also the special value <code>#f</code>
for the I/O procedures. If a procedure is <code>#f</code> nothing is done
on the corresponding action.</p>
</div>
<div class="paragraph">
<p>Hereafter is a (very inefficient) implementation of a variant of
<code>open-output-string</code> using virtual ports. The value of the output
string is printed when the port is closed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">open-output-string</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">str</span> <span class="s">""</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">open-output-virtual</span>
       <span class="nv">:write-char</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span> <span class="nv">p</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">set!</span> <span class="nv">str</span> <span class="p">(</span><span class="nb">string-append</span> <span class="nv">str</span> <span class="p">(</span><span class="nb">string</span> <span class="nv">c</span><span class="p">))))</span>
       <span class="nv">:write-string</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">s</span> <span class="nv">p</span><span class="p">)</span>
                       <span class="p">(</span><span class="k">set!</span> <span class="nv">str</span> <span class="p">(</span><span class="nb">string-append</span> <span class="nv">str</span> <span class="nv">s</span><span class="p">)))</span>
       <span class="nv">:close</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">write</span> <span class="nv">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">)))))</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>write-string</code> is mainly used for writing strings and is
generally more efficient than writing the string character by character.
However, if <code>write-string</code> is not provided, strings are printed with
<code>write-char</code>.  On the other hand, if <code>write-char</code> is absent,
characters are written by successive allocation of one character strings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hereafter is another example: a virtual file port where all characters
are converted to upper case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">open-output-uppercase-file</span> <span class="nv">file</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">out</span> <span class="p">(</span><span class="nf">open-file</span> <span class="nv">file</span> <span class="s">"w"</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">and</span> <span class="nv">out</span>
         <span class="p">(</span><span class="nf">open-output-virtual</span>
             <span class="nv">:write-string</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">s</span> <span class="nv">p</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nf">string-upper</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">out</span><span class="p">))</span>
             <span class="nv">:close</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">p</span><span class="p">)</span>
                      <span class="p">(</span><span class="nf">close-port</span> <span class="nv">out</span><span class="p">))))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(open-file filename mode)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Opens the file whose name is <code>filename</code> with the specified string
<code>mode</code> which can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"r"</code> to open file for reading. The stream is positioned at
the beginning of the file.</p>
</li>
<li>
<p><code>"r+"</code> to open file for reading and writing.  The stream is
positioned at the beginning of the file.</p>
</li>
<li>
<p><code>"w"</code> to truncate file to zero length or create file for writing.
The stream is positioned at the beginning of the file.</p>
</li>
<li>
<p><code>"w+"</code> to open  file for reading and writing. The file is created
if it does not exist, otherwise it is truncated. The stream is positioned
at the beginning of the file.</p>
</li>
<li>
<p><code>"a"</code> to open for writing.  The file is created if  it  does
not exist. The stream is positioned at the end of the file.</p>
</li>
<li>
<p><code>"a+"</code> to open file for reading and writing. The file is created
if it does not exist. The stream is positioned at the end of the file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the file can be opened, <code>open-file</code> returns the textual port associated
with the given file, otherwise it returns <code>#f</code>. Here again, the <strong><em>magic</em></strong>
string "| " permits to open a pipe port (in this case mode can only be
<code>"r"</code> or <code>"w"</code>).</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(get-output-string port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string containing all the text that has been written on the
output string <code>port</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nf">open-output-string</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">display</span> <span class="s">"Hello, world"</span> <span class="nv">p</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">get-output-string</span> <span class="nv">p</span><span class="p">))</span>         <span class="nv">=&gt;</span> <span class="s">"Hello, world"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(get-output-bytevector port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a bytevector consisting of the bytes that have been
output to the <code>port</code> so far in the order they were output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nf">open-output-bytevector</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">u8-write</span> <span class="mi">65</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">u8-write</span> <span class="mi">66</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">get-output-bytevector</span> <span class="nv">p</span><span class="p">))</span>         <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">u8</span><span class="p">(</span><span class="nf">65</span> <span class="mi">66</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(close-input-port port)</code></strong><br>
<strong><code>(close-output-port port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Closes the port associated with <code>port</code>, rendering the port incapable of
delivering or accepting characters. These routines have no effect if the
port has already been closed. The value returned is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(close-port port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Closes the port associated with <code>port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-rewind port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sets the port position to the beginning of <code>port</code>. The value returned by
<code>port-rewind</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-seek port pos)</code></strong><br>
<strong><code>(port-seek port pos whence)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sets the file position for the given <code>port</code> to the position <code>pos</code>.
The new position, measured in bytes, is obtained by adding <code>pos</code>
bytes to the position specified by <code>whence</code>. If passed, <code>whence</code>
must be one of <code>:start</code>, <code>:current</code> or <code>:end</code>. The resulting
position is relative to the start of the file, the current position
indicator, or end-of-file, respectively. If <code>whence</code> is omitted, it
defaults to <code>:start</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After using port-seek, the value returned by
<code>port-current-line</code> may be incorrect.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-current-line)</code></strong><br>
<strong><code>(port-current-line port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current line number associated to the given input <code>port</code> as an
integer. The <code>port</code> argument may be omitted, in which case it defaults to
the value returned by <code>current-input-port</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>port-seek</code>, <code>read-chars</code> and <code>read-chars!</code> procedures
generally break the line-number. After using one of these procedures, the
value returned by <code>port-current-line</code> will be <code>-1</code> (except a <code>port-seek</code>
at the beginning of the port reinitializes the line counter).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-current-position)</code></strong><br>
<strong><code>(port-current-position port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the position associated to the given <code>port</code> as an
integer (i.e. number of characters from the beginning of the port).
The <code>port</code> argument may be omitted, in which case it defaults to
the value returned by <code>current-input-port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-file-name port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the file name used to open <code>port</code>; <code>port</code> must be a file port.</p>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-idle-register! port thunk)</code></strong><br>
<strong><code>(port-idle-unregister! port thunk)</code></strong><br>
<strong><code>(port-idle-reset! port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>port-idle-register!</code> allows to register <code>thunk</code> as an idle handler
when reading on port. That means that <code>thunk</code> will be called continuously
while waiting  an input on <code>port</code> (and only while using a reading
primitive on this port). <code>port-idle-unregister!</code> can be used to
unregister a handler previously set by <code>port-idle-register!</code>. The
primitive <code>port-idle-reset!</code> unregisters all the handlers set on
<code>port</code>.</p>
</div>
<div class="paragraph">
<p>Hereafter is a (not too realistic) example: a message will be displayed
repeatedly until a <strong><em>sexpr</em></strong> is read on the current input port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">idle</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">display</span> <span class="s">"Nothing to read!\\n"</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">port-idle-register!</span> <span class="p">(</span><span class="nb">current-input-port</span><span class="p">)</span> <span class="nv">idle</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">result</span> <span class="p">(</span><span class="nb">read</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">port-idle-unregister!</span> <span class="p">(</span><span class="nb">current-input-port</span><span class="p">)</span> <span class="nv">idle</span><span class="p">)</span>
    <span class="nv">result</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-closed? port)</code></strong><br>
<strong><code>(port-open?  port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>port-closed?</code> returns <code>#t</code> if <code>port</code> is closed and <code>#f</code> otherwise.
On the contrary, <code>port-open?</code> returns <code>#t</code> if <code>port</code> is open and
<code>#f</code> otherwise.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>port-closed?</code> was the usual STklos function to
test if a port is closed. <code>port-open?</code> has been added to be the companion
of the R<sup>7</sup>RS functions <code>input-port-open?</code> and <code>output-port-open?</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-close-hook-set! port thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Associate the procedure <code>thunk</code> to <code>port</code>. The thunk will be called
the first time <code>port</code> is closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">tmp</span> <span class="p">(</span><span class="nf">temporary-file-name</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">p</span>   <span class="p">(</span><span class="nb">open-output-file</span> <span class="nv">tmp</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">foo</span> <span class="no">#t</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">port-close-hook-set!</span> <span class="nv">p</span>
                     <span class="p">(</span><span class="k">lambda</span><span class="p">()</span>
                       <span class="p">(</span><span class="nf">remove-file</span> <span class="nv">tmp</span><span class="p">)</span>
                       <span class="p">(</span><span class="k">set!</span> <span class="nv">foo</span> <span class="no">#t</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">close-port</span> <span class="nv">p</span><span class="p">)</span>
  <span class="nv">foo</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-close-hook port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the user close procedure associated to the given <code>port</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> The following procedures are defined in *link:http://srfi.schemers.org/srfi-192/srfi-192.html[SRFI-192]* (_Port Positioning_)(((SRFI-192))) which is fully
  supported:((("SRFI-192")))
(((port-has-port-position?)))</pre>
</div>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-has-port-position? port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The port-has-port-position? procedure returns #t if the port
supports the port-position operation, and #f otherwise. If the port
does not support the operation, port-position signals an error.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-position port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The port-position procedure returns an object representing the
information state  about the port current position as is
necessary to save and restore that position. This value can be useful
only as the pos argument to set-port-position!, if the latter is even
supported on the port. However, if the port is binary and the object
is an exact integer, then it is the position measured in bytes, and
can be used to compute a new position some specified number of bytes
away.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port-has-set-port-position!? port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The port-has-set-port-position!? procedure returns #t if the port supports
the set-port-position! operation, and #f otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set-port-position! port pos)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>For a textual port, it is implementation-defined what happens if pos is not
the return value of a call to port-position on port. However, a binary port
will also accept an exact integer, in which case the port position is set to
the specified number of bytes from the beginning of the port data. If this
is not sufficient information to specify the port state, or the specified
position is uninterpretable by the port, an error satisfying
i/o-invalid-position-error? is signaled.</p>
</div>
<div class="paragraph">
<p>If <code>set-port-position!</code> procedure is invoked on a port that does not support
the operation or if pos is not in the range of valid positions of port,
<code>set-port-position!</code> signals an error. Otherwise, it sets the current position
of the port to pos. If port is an output port, <code>set-port-position!</code> first flushes
port (even if the port position will not change).</p>
</div>
<div class="paragraph">
<p>If port is a binary output port and the current position is set beyond the
current end of the data in the underlying data sink, the object is not extended
until new data is written at that position. The contents of any intervening
positions are unspecified. It is also possible to set the position of a binary
input port beyond the end of the data in the data source, but a read will fail
unless the data has been extended by other means. File ports can always be
extended in this manner within the limits of the underlying operating system.
In other types of ports, if an attempt is made to set the position beyond the
current end of data in the underlying object, and the object does not support
extension, an error satisfying <code>i/o-invalid-position-error?</code> is signaled.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-i/o-invalid-position-error pos)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a condition object which satisfies i/o-invalid-position-error?.
The pos argument represents a position passed to set-position!.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(i/o-invalid-position-error? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an object created by
<code>make-i/o-invalid-position-error?</code> or an object raised in the circumstances
described in <strong><a href="http://srfi.schemers.org/srfi-192/srfi-192.html">SRFI-192</a></strong> (attempt to access an invalid position in the
stream), or <code>#f</code> if it is not.</p>
</div>
</div>
<div class="sect3">
<h4 id="_input">4.12.2. Input</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read)</code></strong><br>
<strong><code>(read port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Read</code> converts external representations of Scheme objects into the
objects themselves. <code>Read</code> returns the next object parsable from the given
input port, updating port to point to the first character past the end of
the external representation of the object.</p>
</div>
<div class="paragraph">
<p>If an end of file is encountered in the input before any characters are found
that can begin an object, then an end of file object is returned. The port
remains open, and further attempts to read will also return an end of file
object. If an end of file is encountered after the beginning of an object&#8217;s
external representation, but the external representation is incomplete
and therefore not parsable, an error is signalled.</p>
</div>
<div class="paragraph">
<p>The port argument may be omitted, in which case it defaults to the value
returned by <code>current-input-port</code>. It is an error to read from a closed port.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> <code>read</code> supports the <strong><a href="http://srfi.schemers.org/srfi-10/srfi-10.html">SRFI-10</a></strong> <code>#,()</code> form that can be used
to denote values that do not have a convenient printed representation. See
the SRFI document for more information.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-with-shared-structure)</code></strong><br>
<strong><code>(read-with-shared-structure  port)</code></strong><br>
<strong><code>(read/ss)</code></strong><br>
<strong><code>(read/ss port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>read-with-shared-structure</code> is identical to <code>read</code>. It has been added to
be compatible with ,(link-srfi 38). STklos always knew how to deal with
recursive input data. <code>read/ss</code> is only a shorter name for
<code>read-with-shared-structure</code>.</p>
</div>
<div id="readerctor" class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-reader-ctor tag proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure permits to define a new user to reader constructor procedure
at run-time. It is defined in ,(link-srfi 10) document. See  SRFI document
for more information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-reader-ctor</span> <span class="ss">'rev</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">y</span> <span class="nv">x</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">with-input-from-string</span> <span class="s">"#,(rev 1 2)"</span> <span class="nv">read</span><span class="p">)</span>
                             <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-char)</code></strong><br>
<strong><code>(read-char port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the next character available from the input <code>port</code>, updating the <code>port</code>
to point to the following character. If no more characters are available,
an end of file object is returned. <code>Port</code> may be omitted, in which case
it defaults to the value returned by <code>current-input-port</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-bytes size)</code></strong><br>
<strong><code>(read-bytes size port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated string made of <code>size</code> characters read from <code>port</code>.
If less than <code>size</code> characters are available on the input port, the returned
string is smaller than <code>size</code> and its size is the number of available
characters. <code>Port</code> may be omitted, in which case it defaults to the
value returned by <code>current-input-port</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function was previously called <code>read-chars</code>. Usage
of the old name is deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-bytevector k)</code></strong><br>
<strong><code>(read-bytevector k port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Reads the next <code>k</code> bytes, or as many as are available
before the end of file, from the textual input <code>port</code> into a
newly allocated string in left-to-right order and returns the
string. If no characters are available before the end of file,
an end-of-file object is returned.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-bytevector! k)</code></strong><br>
<strong><code>(read-bytevector! k port)</code></strong><br>
<strong><code>(read-bytevector! k port start)</code></strong><br>
<strong><code>(read-bytevector! k port start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Reads the next <code>end - start</code> bytes, or as many as are available
before the end of file, from the binary input port
into <code>bytevector</code> in left-to-right order beginning at the start
position. If <code>end</code> is not supplied, reads until the end of
<code>bytevector</code> has been reached. If <code>start</code> is not supplied, reads
beginning at position 0. Returns the number of bytes read.
If no bytes are available, an end-of-file object is returned.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-bytes! str)</code></strong><br>
<strong><code>(read-bytes! str port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function reads the characters available from <code>port</code> in the string <code>str</code>
by chuncks whose size is equal to the length of <code>str</code>.
The value returned by <code>read-bytes!</code> is an integer indicating the number
of characters read. <code>Port</code> may be omitted, in which case it defaults to the
value returned by <code>current-input-port</code>.</p>
</div>
<div class="paragraph">
<p>This function is similar to <code>read-bytes</code> except that it avoids to allocate
a new string for each read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">copy-file</span> <span class="nv">from</span> <span class="nv">to</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">size</span> <span class="mi">1024</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">in</span>  <span class="p">(</span><span class="nb">open-input-file</span> <span class="nv">from</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">out</span> <span class="p">(</span><span class="nb">open-output-file</span> <span class="nv">to</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">s</span>   <span class="p">(</span><span class="nb">make-string</span> <span class="nv">size</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let</span> <span class="nv">Loop</span> <span class="p">()</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">n</span> <span class="p">(</span><span class="nf">read-bytes!</span> <span class="nv">s</span> <span class="nv">in</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">cond</span>
          <span class="p">((</span><span class="nb">=</span> <span class="nv">n</span> <span class="nv">size</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">write-chars</span> <span class="nv">s</span> <span class="nv">out</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">Loop</span><span class="p">))</span>
          <span class="p">(</span><span class="k">else</span>
             <span class="p">(</span><span class="nf">write-chars</span> <span class="p">(</span><span class="nb">substring</span> <span class="nv">s</span> <span class="mi">0</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">out</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">close-port</span> <span class="nv">out</span><span class="p">)))))))</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function was previously called <code>read-chars!</code>. Usage
of the old name is deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-byte)</code></strong><br>
<strong><code>(read-byte port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the next character available from the input <code>port</code> as an integer.
If the end of file is reached, this function returns the end of file
object.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(peek-char)</code></strong><br>
<strong><code>(peek-char port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the next character available from the input <code>port</code>, without updating
the port to point to the following character. If no more characters are
available, an end of file object is returned. <code>Port</code> may be omitted, in
which case it defaults to the value returned by <code>current-input-port</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The value returned by a call to <code>peek-char</code> is the same as the
value that would have been returned by a call to <code>read-char</code> with the same
port. The only difference is that the very next call to <code>read-char</code> or
<code>peek-char</code> on that port will return the value returned by the preceding
call to <code>peek-char</code>. In particular, a call to <code>peek-char</code> on an interactive
port will hang waiting for input whenever a call to <code>read-char</code> would have
hung.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(peek-byte)</code></strong><br>
<strong><code>(peek-byte port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the next character available from the input <code>port</code>, without updating
the port to point to the following character. Whereas <code>peek-char</code>
returns a character, this function returns an integer between 0and 255.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(eof-object? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an end of file object, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(eof-object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>
end of file
Returns an end of file object. Note that the special notation <code>#eof</code> is
another way to return such an end of file object.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(char-ready?)</code></strong><br>
<strong><code>(char-ready? port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if a character is ready on the input port and returns <code>#f</code>
otherwise. If char-ready returns <code>#t</code> then the next read-char operation on
the given port is guaranteed not to hang. If the port is at end of file
then <code>char-ready?</code> returns <code>#t</code>. Port may be omitted, in which case it
defaults to the value returned by <code>current-input-port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-string k)</code></strong><br>
<strong><code>(read-string k port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Reads the next <code>k</code> characters, or as many as are available
before the end of file, from the textual input <code>port</code> into a
newly allocated string in left-to-right order and returns the
string. If no characters are available before the end of file,
an end-of-file object is returned.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-u8)</code></strong><br>
<strong><code>(read-u8 port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the next byte available from the binary input <code>port</code>,
updating the <code>port</code> to point to the following byte. If no more
bytes are available, an end-of-file object is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is similar to the <code>read-byte</code>
function, excepted that it can be used only on  a binary port.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(peek-u8)</code></strong><br>
<strong><code>(peek-u8 port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the next byte available from the binary input <code>port</code>,
but without updating the <code>port</code> to point to the following
byte. If no more bytes are available, an end-of-file object
is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is similar to the <code>peek-byte</code>
function, excepted that it can be used only on  a binary port.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(u8-ready?)</code></strong><br>
<strong><code>(u8-ready? port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if a byte is ready on the binary input <code>port</code> and
returns <code>#f</code> otherwise. If <code>u8-ready?</code> returns <code>#t</code> then the
next read-u8 operation on the given port is guaranteed
not to hang. If the <code>port</code> is at end of file then <code>u8-ready?</code>
returns <code>#t</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-line)</code></strong><br>
<strong><code>(read-line port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Reads the next line available from the input port <code>port</code>. This function
returns 2 values: the first one is the string which contains the line
read, and the second one is the end of line delimiter. The end of line
delimiter can be an end of file object, a character or a string in case
of a multiple character delimiter. If no more characters are available
on <code>port</code>, an end of file object is returned.  <code>Port</code> may be omitted,
in which case it defaults to the value returned by <code>current-input-port</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As said in <em><a href="#values">primitive <code>values</code></a></em>, if <code>read-line</code> is not
used in  the context of <code>call-with-values</code>, the second value returned by
this procedure is ignored.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-from-string str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Performs a read from the given <code>str</code>. If <code>str</code> is the empty string,
an end of file object is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">read-from-string</span> <span class="s">"123 456"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">123</span>
<span class="p">(</span><span class="nf">read-from-string</span> <span class="s">""</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="nv">an</span> <span class="nv">eof</span> <span class="nv">object</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(port&#8594;string port)</code></strong><br>
<strong><code>(port&#8594;sexp-list port)</code></strong><br>
<strong><code>(port&#8594;string-list port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>All these procedures take a port opened for reading. <code>Port&#8594;string</code> reads
<code>port</code> until the it reads an end of file object and returns all the
characters read as a string. <code>Port&#8594;sexp-list</code> and <code>port&#8594;string-list</code>
do the same things except that they return a list of S-expressions and
a list of strings respectively. For the following example we suppose that
file <code>"foo"</code> is formed of two lines which contains respectively the number
<code>100</code> and the string <code>"bar"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">port-&gt;sexp-list</span> <span class="p">(</span><span class="nb">open-input-file</span> <span class="s">"foo"</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">100</span> <span class="s">"bar"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">port-&gt;string-list</span> <span class="p">(</span><span class="nb">open-input-file</span> <span class="s">"foo"</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"100"</span> <span class="s">"\"bar\""</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_output">4.12.3. Output</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write obj)</code></strong><br>
<strong><code>(write obj port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes a written representation of <code>obj</code> to the given <code>port</code>. Strings that
appear in the written representation are enclosed in doublequotes, and
within those strings backslash and doublequote characters are escaped
by backslashes. Character objects are written using the ,(emph "#\\") notation.
<code>Write</code> returns an unspecified value. The <code>port</code> argument may be omitted, in
which case it defaults to the value returned by <code>current-output-port</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-shared obj)</code></strong><br>
<strong><code>(write-shared obj port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes a written representation of <code>obj</code> to the given port.  The
main difference with the <code>write</code> procedure is that <code>write*</code>
handles data structures with cycles. Circular structure written by
this procedure use the <code>"&#35;n="</code>)) and  <code>"&#35;n&#35;"</code>))
notations (see <a href="#_other_notations">Section 1.2.4</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is also called <code>write*</code>.
The name <code>write*</code> was the name used by <strong><em>STklos</em></strong> for
<code>write-shared</code> before it was introduced in R<sup>7</sup>RS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-with-shared-structure obj)</code></strong><br>
<strong><code>(write-with-shared-structure obj port)</code></strong><br>
<strong><code>(write-with-shared-structure obj port optarg)</code></strong><br>
<strong><code>(write/ss obj)</code></strong><br>
<strong><code>(write/ss obj port)</code></strong><br>
<strong><code>(write/ss obj port optarg)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>write-with-shared-structure</code> has been added to be compatible with
<strong><a href="http://srfi.schemers.org/srfi-38/srfi-38.html">SRFI-38</a></strong> (<em>External representation of shared structures</em>). It is is identical to <code>write*</code>, except that it accepts one
more parameter (<code>optarg</code>). This parameter, which is not specified
in <strong><a href="http://srfi.schemers.org/srfi-38/srfi-38.html">SRFI-38</a></strong>, is always ignored. <code>write/ss</code> is only a shorter name for
<code>write-with-shared-structure</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(display obj)</code></strong><br>
<strong><code>(display obj port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes a representation of <code>obj</code> to the given <code>port</code>. Strings that
appear in the written representation are not enclosed in
doublequotes, and no characters are escaped within those
strings. Character objects appear in the representation as if
written by <code>write-char</code> instead of by <code>write</code>. <code>Display</code> returns an
unspecified value. The <code>port</code> argument may be omitted, in which
case it defaults to the value returned by <code>current-output-port</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>Write</code> is intended for producing machine-readable
output and <code>display</code> is for producing human-readable output.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As required by R<sup>7</sup>RS does not loop forever when
<code>obj</code> contains self-references.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(display-shared obj)</code></strong><br>
<strong><code>(display-shared obj port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>display-shared</code> procedure is the same as <code>display</code>, except
that shared structure are represented using datum labels.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(display-simple obj)</code></strong><br>
<strong><code>(display-simple obj port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>display-simple</code> procedure is the same as <code>display</code>, except
that shared structure is never represented using datum labels.
This can cause <code>display-simple</code> not to terminate if <code>obj</code>
contains circular structure.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(newline)</code></strong><br>
<strong><code>(newline port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes an end of line to <code>port</code>. Exactly how this is done differs from
one operating system to another. Returns an unspecified value. The <code>port</code>
argument may be omitted, in which case it defaults to the value returned
by <code>current-output-port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-string string)</code></strong><br>
<strong><code>(write-string string port)</code></strong><br>
<strong><code>(write-string string port start)</code></strong><br>
<strong><code>(write-string string port start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes the characters of <code>string</code> from <code>start</code> to <code>end</code> in
left-to-right order to the textual output <code>port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-u8 byte)</code></strong><br>
<strong><code>(write-u8 byte port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes the <code>byte</code> to the given binary output port.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-bytevector bytevector)</code></strong><br>
<strong><code>(write-bytevector bytevector port)</code></strong><br>
<strong><code>(write-bytevector bytevector port start)</code></strong><br>
<strong><code>(write-bytevector bytevector port start end)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes the bytes of <code>bytevector</code> from <code>start</code> to <code>end</code> in
left-to-right order to the binary output <code>port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-char char)</code></strong><br>
<strong><code>(write-char char port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes the character <code>char</code> (not an external representation of the
character) to the given <code>port</code> and returns an unspecified value.
The <code>port</code> argument may be omitted, in which case it defaults to the
value returned by <code>current-output-port</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-chars str)</code></strong><br>
<strong><code>(write-chars str port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes the characters of string <code>str</code> to the given <code>port</code> and
returns an unspecified value.  The <code>port</code> argument may be omitted,
in which case it defaults to the value returned by
<code>current-output-port</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is generally
faster than <code>display</code> for strings. Furthermore, this primitive does
not use the buffer associated to <code>port</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-byte b)</code></strong><br>
<strong><code>(write-byte b port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Write byte <code>b</code> to the port. <code>b</code> must be an exact integer in range between 0
and 255.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div id="format" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(format port str obj &#8230;&#8203;)</code></strong><br>
<strong><code>(format str obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Writes the <code>obj`s to the given `port</code>, according to the format
string <code>str</code>. <code>Str</code> is written literally, except for the following
sequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>~a</code> or <code>~A</code> is replaced by the printed representation of the
next <code>obj</code>.</p>
</li>
<li>
<p><code>~s</code> or <code>~S</code> is replaced by the <em>slashified</em> printed
representation of the next <code>obj</code>.</p>
</li>
<li>
<p><code>~w</code> or <code>~W</code> is replaced by the printed representation
of the next <code>obj</code> (circular structures are correctly handled and
printed using <code>write*</code>).</p>
</li>
<li>
<p><code>~d</code> or <code>~D</code> is replaced by the decimal printed representation
of the next <code>obj</code> (which must be a number).</p>
</li>
<li>
<p><code>~x</code> or <code>~X</code> is replaced by the hexadecimal printed representation
of the next <code>obj</code> (which must be a number).</p>
</li>
<li>
<p><code>~o</code> or <code>~O</code> is replaced by the octal printed representation
of the next <code>obj</code> (which must be a number).</p>
</li>
<li>
<p><code>~b</code> or <code>~B</code> is replaced by the binary printed representation
of the next <code>obj</code> (which must be a number).</p>
</li>
<li>
<p><code>~c</code> or <code>~C</code> is replaced by the printed representation
of the next <code>obj</code> (which must be a character).</p>
</li>
<li>
<p><code>~y</code> or <code>~Y</code> is replaced by the pretty-printed representation
of the next <code>obj</code>. The standard pretty-printer is used here.</p>
</li>
<li>
<p><code>~?</code> is replaced by the result of the recursive call of <code>format</code>
with the two next <code>obj</code>: the first item should be a string, and the
second, a list with the arguments.</p>
</li>
<li>
<p><code>~k</code> or <code>~K</code> is another name for <code>~?</code></p>
</li>
<li>
<p><code>~[w[,d]]f</code> or <code>~[w[,d]]F</code> is replaced by the printed
representation of next <code>obj</code> (which must be a number) with width <code>w</code>
and <code>d</code> digits after the decimal. Eventually, <code>d</code> may be omitted.</p>
</li>
<li>
<p><code>~~</code> is replaced by a single tilde character.</p>
</li>
<li>
<p><code>~%</code> is replaced by a newline</p>
</li>
<li>
<p><code>~t</code> or <code>~T</code> is replaced by a tabulation character.</p>
</li>
<li>
<p><code>~&amp;</code> is replaced by a newline character if it is known that the
previous character was not a newline</p>
</li>
<li>
<p><code>~_</code> is replaced by a space</p>
</li>
<li>
<p><code>~h</code> or <code>~H</code> provides some help</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Port</code> can be a boolean or a port. If <code>port</code> is <code>#t</code>, output goes to
the current output port; if <code>port</code> is <code>#f</code>, the output is returned as a
string.  Otherwise, the output is printed on the specified port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">"A test."</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="s">"A test."</span>
   <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">"A ~a."</span> <span class="s">"test"</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="s">"A test."</span>
   <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">"A ~s."</span> <span class="s">"test"</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="s">"A \"test\"."</span>
   <span class="p">(</span><span class="nf">format</span> <span class="s">"~8,2F"</span> <span class="mi">1</span><span class="nv">/3</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="s">"    0.33"</span>
   <span class="p">(</span><span class="nf">format</span> <span class="s">"~6F"</span> <span class="mi">32</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="s">"    32"</span>
   <span class="p">(</span><span class="nf">format</span> <span class="s">"~1,2F"</span> <span class="mi">4321</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="s">"4321.00"</span>
   <span class="p">(</span><span class="nf">format</span> <span class="s">"~1,2F"</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="mf">-3.9</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="s">"0.00+1.97i"</span>
   <span class="p">(</span><span class="nf">format</span> <span class="s">"#d~d #x~x #o~o #b~b~%"</span> <span class="mi">32</span> <span class="mi">32</span> <span class="mi">32</span> <span class="mi">32</span><span class="p">)</span>
                                <span class="nv">=&gt;</span> <span class="s">"#d32 #x20 #o40 #b100000\n"</span>
   <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">"~&amp;1~&amp;~&amp;2~&amp;~&amp;~&amp;3~%"</span><span class="p">)</span>
                                <span class="nv">=&gt;</span> <span class="s">"\n1\n2\n3\n"</span>
   <span class="p">(</span><span class="nf">format</span> <span class="s">"~a ~? ~a"</span> <span class="ss">'a</span> <span class="s">"~s"</span> <span class="o">'</span><span class="p">(</span><span class="nf">new</span><span class="p">)</span> <span class="ss">'test</span><span class="p">)</span>
                                <span class="nv">=&gt;</span> <span class="s">"a new test"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The second form of <code>format</code> is compliant with <strong><a href="http://srfi.schemers.org/srfi-28/srfi-28.html">SRFI-28</a></strong> (<em>Basic Format Strings</em>).
That is, when <code>port</code> is omitted, the output is returned as a string as if
<code>port</code> was given the value <code>#f</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since version 0.58, <code>format</code> is also compliant with <strong><a href="http://srfi.schemers.org/srfi-48/srfi-48.html">SRFI-48</a></strong> (<em>Intermediate Format Strings</em>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(flush-output-port)</code></strong><br>
<strong><code>(flush-output-port port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Flushes the buffer associated with the given output <code>port</code>. The
<code>port</code> argument may be omitted, in which case it defaults to the value
returned by <code>current-output-port</code></p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(print obj &#8230;&#8203;)</code></strong><br>
<strong><code>(printerr obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures display all their arguments followed by a newline. The
procedure <code>print</code> uses the standard output port, whereas <code>printerr</code> uses the
current error port</p>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(printf fmt obj &#8230;&#8203;)</code></strong><br>
<strong><code>(fprintf port fmt obj &#8230;&#8203;)</code></strong><br>
<strong><code>(eprintf fmt obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures are specialized versions of <em><a href="#format"><code>format</code> primitive</a></em>.
In these procedures, <code>fmt</code> is a string using the <code>format</code> conventions.
<code>printf</code> outputs go on the current output port.
<code>fprintf</code> outputs go on the specified <code>port</code>.
<code>eprintf</code> outputs go on the current error port (note that eprintf always
flushes the characters printed).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_interface">4.13. System interface</h3>
<div class="paragraph">
<p>The <strong><em>STklos</em></strong> system interface offers all the functions defined in
R<sup>7</sup>RS. Note, that the base implementation provides also a subset of the
functions defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>). These functions are described here.</p>
</div>
<div class="paragraph">
<p>Note, however that <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> is fully supported and accessing the
other functions it defines can be done by requiring it, as the other SRFIs
that STklos supports.</p>
</div>
<div class="sect3">
<h4 id="_loading_code">4.13.1. Loading code</h4>
<div class="paragraph">
<p></p>
</div>
<div id="load" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(load filename)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>

<code>Filename</code> should be a string naming an existing file containing Scheme
expressions. <code>Load</code> has been extended in STklos to allow loading of
file containing Scheme compiled code as well as object files (<em>aka</em>
shared objects). The loading of object files is not available on
all architectures. The value returned by <code>load</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p>If the file whose name is <code>filename</code> cannot be located, <code>load</code> will try
to find it in one of the directories given by <code>"load-path"</code>
with the suffixes given by <code>"load-suffixes"</code>.</p>
</div>
<div id="tryload" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(try-load filename)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>try-load</code> tries to load the file named <code>filename</code>. As <code>load</code>,
<code>try-load</code> tries to find the file given the current load path
and a set of suffixes if <code>filename</code> cannot be loaded. If <code>try-load</code>
is able to find a readable file, it is loaded, and <code>try-load</code> returns
<code>#t</code>. Otherwise,  <code>try-load</code> retuns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(find-path str)</code></strong><br>
<strong><code>(find-path str path)</code></strong><br>
<strong><code>(find-path str path suffixes)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In its first form, <code>find-path</code> returns the path name of the file
that should be loaded by the procedure  <code>load</code> given the name <code>str</code>.
The string returned depends of the current  load path and of the
currently accepted suffixes.</p>
</div>
<div class="paragraph">
<p>The other forms of <code>find-path</code> are more general and allow to give a path
list (a list of strings representing supposed directories) and a set
of suffixes (given as a list of strings too) to try for finding a file.
If no file is found, <code>find-path</code> returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>For instance, on a "classical" Unix box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">find-path</span> <span class="s">"passwd"</span> <span class="o">'</span><span class="p">(</span><span class="s">"/bin"</span> <span class="s">"/etc"</span> <span class="s">"/tmp"</span><span class="p">))</span>
            <span class="nv">=&gt;</span> <span class="s">"/etc/passwd"</span>
<span class="p">(</span><span class="nf">find-path</span> <span class="s">"stdio"</span> <span class="o">'</span><span class="p">(</span><span class="s">"/usr"</span> <span class="s">"/usr/include"</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="s">"c"</span> <span class="s">"h"</span> <span class="s">"stk"</span><span class="p">))</span>
            <span class="nv">=&gt;</span> <span class="s">"/usr/include/stdio.h"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-loading-file)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the path of the file that is currently being load.</p>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(require string)</code></strong><br>
<strong><code>(provide string)</code></strong><br>
<strong><code>(require/provide string)</code></strong><br>
<strong><code>(provided? string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Require</code> loads the file whose name is <code>string</code> if it was not
previously "<em>provided</em>". <code>Provide</code> permits to store <code>string</code> in
the list of already provided files. Providing a file permits to avoid
subsequent loads of this file. <code>Require/provide</code> is more or less equivalent to
a <code>require</code> followed by a <code>provide</code>. <code>Provided?</code> returns <code>#t</code> if
<code>string</code> was already provided; it returns <code>#f</code> otherwise.</p>
</div>
</div>
<div class="sect3">
<h4 id="_file_primitives">4.13.2. File Primitives</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(temp-file-prefix)</code></strong><br>
<strong><code>(temp-file-prefix value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This parameter object permits to change the default prefix used to build
temporary file name. Its default value is built using the <code>TMPDIR</code>
environment variable (if it is defined) and the current process ID.
If a value is provided, it must be a string designating a valid prefix path.</p>
</div>
<div class="paragraph">
<p>This parameter object is also defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(create-temp-file)</code></strong><br>
<strong><code>(create-temp-file prefix)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates a new temporary file and returns two values: its name and an opened
file port on it. The optional argument specifies the filename prefix
to use, and defaults to the result of invoking <code>temp-file-prefix</code>.
The returned file port is opened in read/write mode. It ensures that
the name cannot be reused by another process before being used
in the program that calls <code>create-temp-file</code>.
Note, that if the opened port is not used, it can be closed and collected
by the GC.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let-values</span> <span class="p">(((</span><span class="nf">name</span> <span class="nv">port</span><span class="p">)</span> <span class="p">(</span><span class="nf">create-temp-file</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">msg</span> <span class="p">(</span><span class="nf">format</span> <span class="s">"Name: ~s\n"</span> <span class="nv">name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">display</span> <span class="nv">msg</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display</span> <span class="nv">msg</span> <span class="nv">port</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">close-port</span> <span class="nv">port</span><span class="p">)))</span>     <span class="nv">=&gt;</span> <span class="nv">prints</span> <span class="nv">the</span> <span class="nv">name</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">temp</span><span class="o">.</span> <span class="nv">file</span> <span class="nv">on</span> <span class="nv">the</span>
                               <span class="nv">current</span> <span class="nv">output</span> <span class="nv">port</span> <span class="nv">and</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">file</span> <span class="nv">itself</span><span class="o">.</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is also defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).However,
in SRFI-170, <code>create-temp-file</code> returns only the name of the temporary file.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>temporary-file-name</code> is another name for this function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(create-temp-directory)</code></strong><br>
<strong><code>(create-temp-directory prefix)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates a new temporary directory and returns its name as a string.
The optional argument specifies the filename prefix to use, and
defaults to the result of invoking <code>temp-file-prefix</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(rename-file string1 string2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Renames the file whose path-name is <code>string1</code> to a file whose path-name is
<code>string2</code>. The result of <code>rename-file</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p>This function is also defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(delete-file string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Removes the file whose path name is given in <code>string</code>.
The result of <code>delete-file</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p>This function is also called <code>remove-file</code> for compatibility
reasons. ,(index "remove-file")</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(copy-file string1 string2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Copies the file whose path-name is <code>string1</code> to a file whose path-name is
<code>string2</code>. If the file <code>string2</code> already exists, its content prior
the call to <code>copy-file</code> is lost. The result of <code>copy-file</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(copy-port in out)</code></strong><br>
<strong><code>(copy-port in out max)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Copy the content of port <code>in</code>, which must be opened for reading, on
port <code>out</code>, which must be opened for writing. If <code>max</code> is not specified,
All the characters from the input port are copied on ouput port. If <code>max</code>
is specified, it must be an integer indicating the maximum number of characters
which are copied from <code>in</code> to <code>out</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(file-exists? string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if the path name given in <code>string</code> denotes an existing file;
returns <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(file-is-directory?  string)</code></strong><br>
<strong><code>(file-is-regular?    string)</code></strong><br>
<strong><code>(file-is-readable?   string)</code></strong><br>
<strong><code>(file-is-writable?   string)</code></strong><br>
<strong><code>(file-is-executable? string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if the predicate is true for the path name given in
<code>string</code>; returns <code>#f</code> otherwise (or if <code>string</code> denotes a file
which does not exist).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(file-size string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the size of the file whose path name is given in
<code>string</code>. If <code>string</code> denotes a file which does not exist,
<code>file-size</code> returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(getcwd)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string containing the current working directory.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(chmod str)</code></strong><br>
<strong><code>(chmod str option1 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Change the access mode of the file whose path name is given in <code>string</code>.
The options must be composed of either an integer or one of the
following symbols <code>read</code>, <code>write</code> or <code>execute</code>. Giving no option to <code>chmod</code>
is equivalent to pass it the integer <code>0</code>. If the operation succeeds,
<code>chmod</code> returns <code>#t</code>; otherwise it returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">chmod</span> <span class="s">"~/.stklos/stklosrc"</span> <span class="ss">'read</span> <span class="ss">'execute</span><span class="p">)</span>
<span class="p">(</span><span class="nf">chmod</span> <span class="s">"~/.stklos/stklosrc"</span> <span class="mo">#o644</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(chdir dir)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Changes the current directory to the directory given in string <code>dir</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(create-directory dir)</code></strong><br>
<strong><code>(create-directory dir permissions)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Create a directory with name <code>dir</code>. If <code>permissions</code> is omitted, it
defaults to #o775 (masked by the current umask).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is also defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>). The old name
<code>make-directory</code> is deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(create-directories dir)</code></strong><br>
<strong><code>(create-directories dir permissions)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Create a directory with name <code>dir</code>. No error is signaled if <code>dir</code> already exists.
Parent directories of <code>dir</code> are created as needed. If <code>permissions</code> is omitted,
it defaults to #o775 (masked by the current umask).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function was also called <code>make-directories</code>. This old name is
obsolete.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ensure-directories-exist path)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Create a directory with name <code>dir</code> (and its parent directories if needed), if it
does not exist yet.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(delete-directory dir)</code></strong><br>
<strong><code>(remove-directory dir)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Delete the directory with name <code>dir</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is also defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>). The name
<code>remove-directory</code> is kept for compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(directory-files path)</code></strong><br>
<strong><code>(directory-files path dotfiles?)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the list of the files in the directory <code>path</code>. The <code>dotfiles?</code> flag
(default <code>#f</code>) causes files beginning with ,(q ".") to be included in the list.
Regardless of the value of <code>dotfiles?</code>, the two files ,(q ".") and ,(q "..")
are never  returned.</p>
</div>
<div class="paragraph">
<p>This function is also defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(expand-file-name path)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Expand-file-name</code> expands the filename given in <code>path</code> to
an absolute path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="c1">;; Current directory is ~eg/stklos (i.e. /users/eg/stklos)</span>
  <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">".."</span><span class="p">)</span>            <span class="nv">=&gt;</span> <span class="s">"/users/eg"</span>
  <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">"~eg/../eg/bin"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"/users/eg/bin"</span>
  <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">"~/stklos)"</span>      <span class="nv">=&gt;</span> <span class="s">"/users/eg/stk"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(canonical-file-name path)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Expands all symbolic links in <code>path</code> and returns its canonicalized
absolute path name. The resulting path does not have symbolic links.
If <code>path</code> doesn&#8217;t designate a valid path name, <code>canonical-file-name</code>
returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(decompose-file-name string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an <code>`exploded'' list of the path name components given in
`string</code>.
The first element in the list denotes if the given <code>string</code> is an
absolute path or a relative one, being "/" or "." respectively.
Each component of this list is a string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">decompose-file-name</span> <span class="s">"/a/b/c.stk"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"/"</span> <span class="s">"a"</span> <span class="s">"b"</span> <span class="s">"c.stk"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">decompose-file-name</span> <span class="s">"a/b/c.stk"</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"."</span> <span class="s">"a"</span> <span class="s">"b"</span> <span class="s">"c.stk"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(winify-file-name fn)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>On Win32 system, when compiled with the Cygwin environment,
file names are internally represented in a POSIX-like internal form.
<code>Winify-file-bame</code> permits to obtain back the Win32 name of an interned
file name</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">winify-file-name</span> <span class="s">"/tmp"</span><span class="p">)</span>
    <span class="nv">=&gt;</span> <span class="s">"C:\\cygwin\\tmp"</span>
<span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">getcwd</span><span class="p">)</span> <span class="p">(</span><span class="nf">winify-file-name</span> <span class="p">(</span><span class="nf">getcwd</span><span class="p">)))</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"//saxo/homes/eg/Projects/STklos"</span>
        <span class="s">"\\\\saxo\\homes\\eg\\Projects\\STklos"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posixify-file-name fn)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>On Win32 system, when compiled with the Cygwin environment,
file names are internally represented in a POSIX-like internal form.
<code>posixify-file-bame</code> permits to obtain the interned file name from
its external form.
file name</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">posixify-file-name</span> <span class="s">"C:\\cygwin\\tmp"</span><span class="p">)</span>
       <span class="nv">=&gt;</span> <span class="s">"/tmp"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(basename str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string containing the last component of the path name
given in <code>str</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">basename</span> <span class="s">"/a/b/c.stk"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"c.stk"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(dirname str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string containing all but the last component of the path
name given in <code>str</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">dirname</span> <span class="s">"/a/b/c.stk"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"/a/b"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(file-suffix pathname)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the suffix of given <code>pathname</code>. If no suffix is found, <code>file-suffix</code>
returns #f.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">file-suffix</span> <span class="s">"./foo.tar.gz"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"gz"</span>
<span class="p">(</span><span class="nf">file-suffix</span> <span class="s">"./a.b/c"</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">file-suffix</span> <span class="s">"./a.b/c."</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="s">""</span>
<span class="p">(</span><span class="nf">file-suffix</span> <span class="s">"~/.profile"</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(file-prefix pathname)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the prefix of given <code>pathname</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">file-prefix</span> <span class="s">"./foo.tar.gz"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"./foo.tar"</span>
<span class="p">(</span><span class="nf">file-prefix</span> <span class="s">"./a.b/c"</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="s">"./a.b/c"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(file-separator)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Retuns the operating system file separator as a character. This is typically
<code>&#35;\/</code> on Unix (or Cygwin) systems and <code>&#35;\\</code> on Windows.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-path dirname .  names)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Builds a file name from the directory <code>dirname</code> and <code>names</code>. For instance,
on a Unix system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">make-path</span> <span class="s">"a"</span> <span class="s">"b"</span> <span class="s">"c"</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="s">"a/b/c"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(glob pattern &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Glob</code> performs file name <code>`globbing'' in a fashion similar to the
csh shell. `Glob</code> returns a list of the filenames that match at least
one of <code>pattern</code> arguments.  The <code>pattern</code> arguments may contain
the following special characters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>?</code> Matches any single character.</p>
</li>
<li>
<p><code>*</code> Matches any sequence of zero or more characters.</p>
</li>
<li>
<p><code>\[chars\]</code> Matches any single character in <code>chars</code>.
If chars contains a sequence of the form <code>a-b</code> then any character
between <code>a</code> and <code>b</code> (inclusive) will match.</p>
</li>
<li>
<p><code>\x</code> Matches the character <code>x</code>.</p>
</li>
<li>
<p><code>{a,b,&#8230;&#8203;}</code> Matches any of the strings <code>a</code>, <code>b</code>, etc.
)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with csh, a '.' at the beginning of a file&#8217;s name or just after
a '/' must be matched explicitly or with a <code>@{@}</code> construct.
In addition, all '/' characters must be matched explicitly.</p>
</div>
<div class="paragraph">
<p>If the first character in a pattern is '~' then it refers to
the home directory of the user whose name follows the '~'.
If the '~' is followed immediately by '/' then the value of
the environment variable HOME is used.</p>
</div>
<div class="paragraph">
<p><code>Glob</code> differs from csh globbing in two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>it does not  sort its result list (use the <code>sort</code> procedure
if you want the list  sorted).</p>
</li>
<li>
<p><code>glob</code> only returns the names of files that actually exist;
in csh no check for existence is made unless a pattern contains a
<code>?</code>, <code>*</code>, or <code>[]</code> construct.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posix-error? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns <code>#t</code> if <code>obj</code> is a condition object that describes a
POSIX error, and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posix-error-name posix-error)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns a symbol that is the name associated with the
value of <code>errno</code> when the POSIX function reported an error. This can be
used to provide programmatic recovery when a POSIX function can return
more than one value of <code>errno</code>.</p>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posix-error-message posix-error)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns a string that is an error message reflecting the
value of errno when the POSIX function reported an error. This string
is useful for reporting the cause of the error to the user</p>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong> (<em>POSIX API</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posix-error-errno posix-error)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns the value of <code>errno</code> (an exact integer).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posix-error-procedure posix-error)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns the name of the Scheme procedure that raised
the error.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(posix-error-args posix-error)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure returns the list of the Scheme procedure arguments
that raised the error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_environment">4.13.3. Environment</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(getenv str)</code></strong><br>
<strong><code>(getenv)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Looks for the environment variable named <code>str</code> and returns its
value as a string, if it exists. Otherwise, <code>getenv</code> returns <code>#f</code>.
If <code>getenv</code> is called without parameter, it returns the list of
all the environment variables accessible from the program as an
A-list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">getenv</span> <span class="s">"SHELL"</span><span class="p">)</span>
     <span class="nv">=&gt;</span> <span class="s">"/bin/zsh"</span>
<span class="p">(</span><span class="nf">getenv</span><span class="p">)</span>
     <span class="nv">=&gt;</span> <span class="p">((</span><span class="s">"TERM"</span> <span class="o">.</span> <span class="s">"xterm"</span><span class="p">)</span> <span class="p">(</span><span class="s">"PATH"</span> <span class="o">.</span> <span class="s">"/bin:/usr/bin"</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(setenv! var value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sets the environment variable <code>var</code> to <code>value</code>. <code>Var</code> and
<code>value</code> must be strings. The result of <code>setenv!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(unsetenv! var)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Unsets the environment variable <code>var</code>. <code>Var</code> must be a string.
The result of <code>unsetenv!</code> is <strong><em>void</em></strong>.</p>
</div>
<hr>
<div class="paragraph">
<p><strong><em>STklos</em></strong> defines also the R<sup>7</sup>RS (and <strong><a href="http://srfi.schemers.org/srfi-96/srfi-96.html">SRFI-96</a></strong>) standard
primivitives to acess environment variables.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(get-environment-variable name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the value of the named environment variable as a string, or
<code>#f</code> if the named environment variable is not found. The name argument
is expected to be a string. This function is similar to the <code>getenv</code>. It
has been added to be  support <strong><a href="http://srfi.schemers.org/srfi-98/srfi-98.html">SRFI-98</a></strong> (<em>Interface to access environment variables</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(get-environment-variables)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns names and values of all the environment variables as an a-list.
This function is defined by <strong><a href="http://srfi.schemers.org/srfi-98/srfi-98.html">SRFI-98</a></strong> (<em>Interface to access environment variables</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(build-path-from-shell-variable var)</code></strong><br>
<strong><code>(build-path-from-shell-variable var sep)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Builds a path as a list of strings (which is the way STklos represents
paths) from the environment variable <code>var</code>, given the separator characters
given in <code>sep</code> (which defaults to <code>":"</code>, the standrad Unix path separator).
If the <code>var</code> is not definied in the environment,
<code>build-path-from-shell-variable</code> returns the empty list.</p>
</div>
<div class="paragraph">
<p>If the shell variable <code>MYPATH</code> is "/bin:/sbin:/usr/bin"`, then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">build-path-from-shell-variable</span> <span class="s">"MYPATH"</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"/bin"</span> <span class="s">"/sbin"</span> <span class="s">"/usr/bin"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">build-path-from-shell-variable</span> <span class="s">"MYPATH"</span> <span class="s">"/:"</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"bin"</span> <span class="s">"sbin"</span> <span class="s">"usr"</span> <span class="s">"bin"</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time">4.13.4. Time</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-second)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an inexact number representing the current time on the
International Atomic Time (TAI) scale.  The value 0.0 represents
midnight on January 1, 1970 TAI (equivalent to ten seconds before
midnight Universal Time) and the value 1.0 represents one TAI
second later.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-jiffy)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of <em>jiffies</em> as an exact integer that
have elapsed since an arbitrary, implementation-defined
epoch. A jiffy is an implementation-defined fraction of
a second which is defined by the return value of the
<code>jiffies-per-second</code> procedure. The starting epoch is
guaranteed to be constant during a run of the program,
but may vary between runs.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(jiffies-per-seconds)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an exact integer representing the number of jiffies
per second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">time-length</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">list</span> <span class="p">(</span><span class="nf">make-list</span> <span class="mi">100000</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">start</span> <span class="p">(</span><span class="nf">current-jiffy</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">length</span> <span class="nv">list</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nf">current-jiffy</span><span class="p">)</span> <span class="nv">start</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">jiffies-per-second</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(clock)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an approximation of processor time, in milliseconds, used so far by the
program.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(sleep n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Suspend the execution of the program for at <code>ms</code> milliseconds. Note that due
to system clock resolution, the pause may be a little bit longer. If a
signal arrives during the pause, the execution may be resumed.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(time expr1 expr2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Evaluates the expressions <code>expr1</code>, <code>expr2</code>, &#8230;&#8203; and returns the
result of the last expression. This form prints also the time spent
for this evaluation, in milliseconds, on the current error port.
This is CPU time, and not real ("wall") time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_information">4.13.5. System Information</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(features)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a list of the feature identifiers which <code>cond-expand</code>
treats as true. Here is an
example of what <code>features</code> might return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">features</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">STklos</span> <span class="nv">STklos-0</span><span class="o">.</span><span class="mi">3</span> <span class="nv">exact-complex</span>
               <span class="nv">ieee-float</span> <span class="nv">full-unicode</span> <span class="nv">ratios</span> <span class="nv">little-endian</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(running-os)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name of the underlying Operating System which is running
the program.
The value returned by <code>runnin-os</code> is a symbol. For now, this procedure
returns either <code>unix</code>, <code>android</code>, <code>windows</code>, or <code>cygwin-windows</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hostname)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the  host name of the current processor as a string.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(command-line)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the command line passed to the process as a list
of strings. The first string corresponds to the command
name.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(command-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returnd the name of the running program if it is a standalone and #f
otherwise. This function is defined in <strong><a href="http://srfi.schemers.org/srfi-193/srfi-193.html">SRFI-193</a></strong> (<em>Command line</em>).</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(command-args)</code></strong><br>
<strong><code>(argv)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a list of the arguments given on the shell command line. The
interpreter options are no included in the result. The name <code>argv</code> is
deprecated and should not be used.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(argc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of arguments present on the command line.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(program-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the invocation name of the current program as a string. If the file is
not a script (in sense of <strong><a href="http://srfi.schemers.org/srfi-193/srfi-193.html">SRFI-193</a></strong>), it is the name of the
running <strong><em>STklos</em></strong> interpreter, otherwise it is the name of the running script.
This function always returns a string whereas the <code>command-name</code> procedure returns
<code>#f</code> when the program name is not a script.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(script-file)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the absolute path of the current script.
If the calling program is not a script, #f is returned.
This function is defined in <strong><a href="http://srfi.schemers.org/srfi-193/srfi-193.html">SRFI-193</a></strong> (<em>Command line</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(script-directory)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the non-filename part of script-file as a string.
As with <code>script-file</code>, this is an absolute pathname.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(version)</code></strong><br>
<strong><code>(implementation-version)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string identifying the current version of the system. A
version is constituted of two numbers separated by a point: the version
and the release numbers. Note that <code>implementation-version</code> corresponds
to the <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong> (<em>Environment Inquiry</em>) name of this function.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(machine-type)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string identifying the kind of machine which is running the
program. The result string is of the form
<code>[os-name]-[os-version]-[cpu-architecture]</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(implementation-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong> (<em>Environment Inquiry</em>); it returns the Scheme
implementation (i.e. the string <code>"STklos"</code>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cpu-architecture)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong> (<em>Environment Inquiry</em>); it returns the CPU
architecture, real or virtual, on which this implementation
is executing.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(machine-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong> (<em>Environment Inquiry</em>); it returns a name for the
particular machine on which the implementation is running.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(os-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong> (<em>Environment Inquiry</em>); it returns the name for
the operating system, platform, or equivalent on which the
implementation is running.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(os-version)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function is defined in <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong> (<em>Environment Inquiry</em>); it returns the version for
the operating system, platform, or equivalent on which the
implementation is running.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(getpid)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the system process number of the current program (i.e. the
Unix <em>PID</em> as an integer).</p>
</div>
</div>
<div class="sect3">
<h4 id="_program_arguments_parsing">4.13.6. Program Arguments Parsing</h4>
<div class="paragraph">
<p>
<strong><em>STklos</em></strong> provides a simple way to parse program arguments with the
<code>parse-arguments</code> special form. This form is generally used into
the <code>main</code>| function in a Scheme script. See <strong><a href="http://srfi.schemers.org/srfi-22/srfi-22.html">SRFI-22</a></strong> (<em>Running Scheme Scripts on Unix</em>) on how to
use a <code>main</code> function in a Scheme program.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(parse-arguments &lt;args&gt; &lt;clause1&gt; &lt;clause2&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>parse-arguments</code> special form is used to parse the
command line arguments of a Scheme script. The implementation of
this form internally uses the GNU C <code>getopt</code> function. As a
consequence <code>parse-arguments</code> accepts options which start with
the '-' (short option) or '--' characters (long option).</p>
</div>
<div class="paragraph">
<p>The first argument of <code>parse-arguments</code> is a list of the arguments
given to the program (comprising the program name in the CAR of this
list). Following arguments are clauses. Clauses are described later.</p>
</div>
<div class="paragraph">
<p>By  default, <code>parse-arguments</code> permutes the contents of (a copy) of
the arguments as it scans, so that eventually all the non-options are
at the end. However, if the shell environment variable <code>POSIXLY_CORRECT</code>
is set, then option processing stops as soon as a non-option argument
is encountered.</p>
</div>
<div class="paragraph">
<p>A clause must follow the syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>&lt;clause&gt;       =&gt; string | &lt;list-clause&gt;
&lt;list clause&gt;  =&gt; (&lt;option descr&gt; &lt;expr&gt; ...) | (else &lt;expr&gt; ...)
&lt;option descr&gt; =&gt; (&lt;option name&gt; [&lt;keyword&gt; value]*)
&lt;option name&gt;  =&gt; string
&lt;keyword&gt;      =&gt; :alternate | :arg | :help</code></pre>
</div>
</div>
<div class="paragraph">
<p>A string clause is used to build the  help associated to the command.
A list clause must follow the syntax describes an option. The
<code>&lt;expr&gt;</code>s associated to a list clauses are executed when the option
is recognized.
The <code>else</code> clauses is executed when all parameters have
been parsed. The <code>:alternate</code> key permits to have an alternate name for an
option (generally a short or long name if the option name is a
short or long name).  The <code>:help</code> is used to provide help about the
the option. The <code>:arg</code> is used when the option admit a parameter:
the symbol given after <code>:arg</code> will be bound to the value of the option
argument when the corresponding `&lt;expr&gt;`s will be executed.</p>
</div>
<div class="paragraph">
<p>In an <code>else</code> clause the symbol <code>other-arguments</code> is bound to the
list of the arguments which are not options.</p>
</div>
<div class="paragraph">
<p>The following example shows a rather complete usage of the
<code>parse-arguments</code> form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">stklos</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">main</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">parse-arguments</span> <span class="nv">args</span>
     <span class="s">"Usage: foo [options] [parameter ...]"</span>
     <span class="s">"General options:"</span>
         <span class="p">((</span><span class="s">"verbose"</span> <span class="nv">:alternate</span> <span class="s">"v"</span> <span class="nv">:help</span> <span class="s">"be more verbose"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">printf</span> <span class="s">"Seen the verbose option~%"</span><span class="p">))</span>
         <span class="p">((</span><span class="s">"long"</span> <span class="nv">:help</span> <span class="s">"a long option alone"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">printf</span> <span class="s">"Seen the long option~%"</span><span class="p">))</span>
         <span class="p">((</span><span class="s">"s"</span> <span class="nv">:help</span> <span class="s">"a short option alone"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">printf</span> <span class="s">"Seen the short option~%"</span><span class="p">))</span>
     <span class="s">"File options:"</span>
         <span class="p">((</span><span class="s">"input"</span> <span class="nv">:alternate</span> <span class="s">"f"</span> <span class="nv">:arg</span> <span class="nv">file</span>
                   <span class="nv">:help</span> <span class="s">"use &lt;file&gt; as input"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">printf</span> <span class="s">"Seen the input option with ~S argument~%"</span> <span class="nv">file</span><span class="p">))</span>
         <span class="p">((</span><span class="s">"output"</span> <span class="nv">:alternate</span> <span class="s">"o"</span> <span class="nv">:arg</span> <span class="nv">file</span>
                    <span class="nv">:help</span> <span class="s">"use &lt;file&gt; as output"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">printf</span> <span class="s">"Seen the output option with ~S argument~%"</span> <span class="nv">file</span><span class="p">))</span>
     <span class="s">"Misc:"</span>
         <span class="p">((</span><span class="s">"help"</span> <span class="nv">:alternate</span> <span class="s">"h"</span>
                  <span class="nv">:help</span> <span class="s">"provides help for the command"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">arg-usage</span> <span class="p">(</span><span class="nf">current-error-port</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">exit</span> <span class="mi">1</span><span class="p">))</span>
     <span class="p">(</span><span class="k">else</span>
         <span class="p">(</span><span class="nf">printf</span> <span class="s">"All options parsed. Remaining arguments are ~S~%"</span>
                 <span class="nv">other-arguments</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following program invocation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">foo</span> <span class="nv">-vs</span> <span class="nv">--input</span> <span class="nv">in</span> <span class="nv">-o</span> <span class="nv">out</span> <span class="nv">arg1</span> <span class="nv">arg2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>produces the following output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Seen the verbose option
Seen the short option
Seen the input option with "in" argument
Seen the output option with "out" argument
All options parsed. Remaining arguments are ("arg1" "arg2")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the program invocation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">foo</span> <span class="nv">--help</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>produces the following output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Usage: foo [options] [parameter ...]
General options:
  --verbose, -v               be more verbose
  --long                      a long option alone
  -s                          a short option alone
File options:
  --input=&lt;file&gt;, -f &lt;file&gt;   use &lt;file&gt; as input
  --output=&lt;file&gt;, -o &lt;file&gt;  use &lt;file&gt; as output
Misc:
  --help, -h                  provides help for the command</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Short option can be concatenated. That is,</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">prog</span> <span class="nv">-abc</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to the following program call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">prog</span> <span class="nv">-a</span> <span class="nv">-b</span> <span class="nv">-c</span></code></pre>
</div>
</div>
</li>
<li>
<p>Any argument following a '--' argument is no more considered as
an option, even if it starts with a '-' or '--'.</p>
</li>
<li>
<p>Option with a parameter can be written in several ways. For instance
to set the output in the <code>bar</code> file for the previous example can be
expressed as</p>
<div class="ulist">
<ul>
<li>
<p><code>--output=bar</code>, or</p>
</li>
<li>
<p><code>-o bar</code>, or</p>
</li>
<li>
<p><code>-obar</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(arg-usage port)</code></strong><br>
<strong><code>(arg-usage port as-sexpr)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure is only bound inside a <code>parse-arguments</code> form.
It pretty prints the help associated to the clauses of the
<code>parse-arguments</code> form on the given port. If the argument
<code>as-sexpr</code> is passed and is not <code>#f</code>, the help strings are
printed on <code>port</code> as <em>Sexpr</em>s. This is useful if the help
strings need to be manipulated by a program.</p>
</div>
</div>
<div class="sect3">
<h4 id="_misc_system_procedures">4.13.7. Misc. System Procedures</h4>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(system string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sends the given <code>string</code> to the system shell <code>/bin/sh</code>. The result of
<code>system</code> is the integer status code the shell returns.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exec str)</code></strong><br>
<strong><code>(exec-list str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures execute the command given in <code>str</code>. The command given
in <code>str</code> is passed to <code>/bin/sh</code>. <code>Exec</code> returns a string which contains
all the characters that the command <code>str</code> has printed on it&#8217;s standard
output, whereas <code>exec-list</code> returns a list of the lines which constitute
the output of <code>str</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">exec</span> <span class="s">"echo A; echo B"</span><span class="p">)</span>                <span class="nv">=&gt;</span> <span class="s">"A\nB\n"</span>
<span class="p">(</span><span class="nf">exec-list</span> <span class="s">"echo A; echo B"</span><span class="p">)</span>           <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"A"</span> <span class="s">"B"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(address-of obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the address of the object <code>obj</code> as an integer.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(exit)</code></strong><br>
<strong><code>(exit ret-code)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Exits the program with the specified integer return code. If <code>ret-code</code>
is omitted, the program terminates with a return code of 0.
If  program has registered exit functions with <code>register-exit-function!</code>,
they are called (in an order which is the reverse of their call order).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong><em>STklos</em></strong> <code>exit</code> primitive accepts also an
integer value as parameter (R<sup>7</sup>RS accepts only a boolean).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(emergency-exit)</code></strong><br>
<strong><code>(emergency-exit ret-code)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Terminates the program without running any outstanding
dynamic-wind <em>after</em> procedures and communicates an exit
value to the operating system in the same manner as <code>exit</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong><em>STklos</em></strong> <code>emergency-exit</code> primitive accepts also an
integer value as parameter (R<sup>7</sup>RS accepts only a boolean).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(die message)</code></strong><br>
<strong><code>(die message status)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Die</code> prints the given <code>message</code> on the current error port and exits
the program with the <code>status</code> value. If <code>status</code> is omitted, it
defaults to 1.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(get-password)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This primitive permits to enter a password (character echoing
being turned off). The value returned by <code>get-password</code> is the entered
password as a string.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(register-exit-function! proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function registers <code>proc</code> as an exit function. This function will
be called when the program exits. When called, <code>proc</code> will be passed one
parmater which is the status given to the <code>exit</code> function (or 0 if the
programe terminates normally). The result of  <code>register-exit-function!</code>
is undefined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">tmp</span> <span class="p">(</span><span class="nf">temporary-file-name</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">out</span> <span class="p">(</span><span class="nb">open-output-file</span> <span class="nv">tmp</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">register-exit-function!</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span>
                             <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nb">zero?</span> <span class="nv">n</span><span class="p">)</span>
                               <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">tmp</span><span class="p">))))</span>
  <span class="nv">out</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keywords">4.14. Keywords</h3>
<div class="paragraph">
<p>




Keywords are symbolic constants which evaluate to themselves.
   By default, a keyword is a symbol whose first (or last) character is a colon
   (<strong><em>":"</em></strong>). Alternatively, to be compatible with other Scheme
   implementations, the notation <code>#:foo</code> is also available to denote
   the keyword of name <code>foo</code>.</p>
</div>
<div class="paragraph">
<p>Note that the four directives <code>keyword-colon-position-xxx</code> or the
   parameter object ` keyword-colon-position` permit to change the
   default behavior. See section~Identifiers for more
   information.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(keyword obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a keyword, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">keyword?</span> <span class="ss">'foo</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">keyword?</span> <span class="ss">':foo</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="c1">; depends of keyword-colon-position</span>
<span class="p">(</span><span class="nf">keyword?</span> <span class="ss">'foo:</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="c1">; depends of keyword-colon-position</span>
<span class="p">(</span><span class="nf">keyword?</span> <span class="o">'#</span><span class="nv">:foo</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="c1">; always</span>
<span class="p">(</span><span class="nf">keyword?</span> <span class="nv">:foo</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="c1">; depends of keyword-colon-position</span>
<span class="p">(</span><span class="nf">keyword?</span> <span class="nv">foo:</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="c1">; depends of keyword-colon-position</span>
<span class="p">(</span><span class="nf">keyword?</span> <span class="o">#</span><span class="nv">:foo</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="no">#t</span>  <span class="c1">; always</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-keyword s)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Builds a keyword from the given <code>s</code>. The parameter <code>s</code> must be a symbol
or a string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">make-keyword</span> <span class="s">"test"</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">:test</span>
<span class="p">(</span><span class="nf">make-keyword</span> <span class="ss">'test</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">:test</span>
<span class="p">(</span><span class="nf">make-keyword</span> <span class="s">":hello"</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="o">#</span><span class="nv">::hello</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(keyword&#8594;string key)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name of <code>key</code> as a string. The result does not contain a colon.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;keyword str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function function has been added to be compatibe with SRFI-88.
It is equivalent to make-keyword, except that the parameter cannot be
a symbol.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(key-get list key)</code></strong><br>
<strong><code>(key-get list key default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>List</code> must be a list of keywords and their respective values.
<code>key-get</code> scans the <code>list</code> and returns the value
associated with the given <code>key</code>. If  <code>key</code> does
not appear in an odd position in <code>list</code>, the specified
<code>default</code> is returned, or an error is raised if no <code>default</code> was
specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">key-get</span> <span class="o">'</span><span class="p">(</span><span class="o">#</span><span class="nv">:one</span> <span class="mi">1</span> <span class="o">#</span><span class="nv">:two</span> <span class="mi">2</span><span class="p">)</span> <span class="o">#</span><span class="nv">:one</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">key-get</span> <span class="o">'</span><span class="p">(</span><span class="o">#</span><span class="nv">:one</span> <span class="mi">1</span> <span class="o">#</span><span class="nv">:two</span> <span class="mi">2</span><span class="p">)</span> <span class="o">#</span><span class="nv">:four</span> <span class="no">#f</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">key-get</span> <span class="o">'</span><span class="p">(</span><span class="o">#</span><span class="nv">:one</span> <span class="mi">1</span> <span class="o">#</span><span class="nv">:two</span> <span class="mi">2</span><span class="p">)</span> <span class="o">#</span><span class="nv">:four</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="nv">error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(key-set! list key value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>List</code> must be a list of keywords and their respective values.
<code>key-set!</code> sets the value associated to <code>key</code> in the keyword list.
If the key is already present in <code>list</code>, the keyword list is
,(emph "physically") changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">l</span> <span class="p">(</span><span class="nb">list</span> <span class="o">#</span><span class="nv">:one</span> <span class="mi">1</span> <span class="o">#</span><span class="nv">:two</span> <span class="mi">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">set!</span> <span class="nv">l</span> <span class="p">(</span><span class="nf">key-set!</span> <span class="nv">l</span> <span class="o">#</span><span class="nv">:three</span> <span class="mi">3</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">key-get</span> <span class="nv">l</span> <span class="o">#</span><span class="nv">:one</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">key-get</span> <span class="nv">l</span> <span class="o">#</span><span class="nv">:three</span><span class="p">)))</span>            <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(key-delete  list key)</code></strong><br>
<strong><code>(key-delete! list key)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>List</code> must be a list of keywords and their respective values.
<code>key-delete</code> remove the <code>key</code> and its associated value of the keyword
list. The key can be absent of the list.</p>
</div>
<div class="paragraph">
<p><code>key-delete!</code> does the same job as <code>key-delete</code> by physically
modifying its <code>list</code> argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">key-delete</span> <span class="o">'</span><span class="p">(</span><span class="nf">:one</span> <span class="mi">1</span> <span class="nv">:two</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">:two</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:one</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">key-delete</span> <span class="o">'</span><span class="p">(</span><span class="nf">:one</span> <span class="mi">1</span> <span class="nv">:two</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">:three</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:one</span> <span class="mi">1</span> <span class="nv">:two</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">l</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">:one</span> <span class="mi">1</span> <span class="nv">:two</span> <span class="mi">2</span><span class="p">)))</span>
   <span class="p">(</span><span class="nf">key-delete!</span> <span class="nv">l</span> <span class="nv">:two</span><span class="p">)</span>
   <span class="nv">l</span><span class="p">)</span>                                 <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">:one</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(keyword-colon-position)</code></strong><br>
<strong><code>(keyword-colon-position value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This parameter object indicates the convention used by the reader to
denote keywords. The allowed values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong>, to forbid a symbol with colon to be interpreted as a keyword,</p>
</li>
<li>
<p><strong>before</strong>, to read symbols starting with a colon as keywords,</p>
</li>
<li>
<p><strong>after</strong>, to read symbols ending with a colon as keywords,</p>
</li>
<li>
<p><strong>both</strong>,  to read symbols starting or ending with a colon as keywords.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the notation <code>#:key</code> is always read as a keyword independently
of the value of <code>keyword-colon-position</code>. Hence, we have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">keyword?</span> <span class="ss">':a</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">keyword?</span> <span class="ss">'a:</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">keyword?</span> <span class="o">'#</span><span class="nv">:a</span><span class="p">))</span>
                 <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#f</span> <span class="no">#f</span> <span class="no">#t</span><span class="p">)</span>  <span class="c1">; if keyword-colon-position is none</span>
                 <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#t</span> <span class="no">#f</span> <span class="no">#t</span><span class="p">)</span>  <span class="c1">; if keyword-colon-position is before</span>
                 <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#f</span> <span class="no">#t</span> <span class="no">#t</span><span class="p">)</span>  <span class="c1">; if keyword-colon-position is after</span>
                 <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#t</span> <span class="no">#t</span> <span class="no">#t</span><span class="p">)</span>  <span class="c1">; if keyword-colon-position is both</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hash_tables">4.15. Hash Tables</h3>
<div class="paragraph">
<p>
A hash table consists of zero or more entries, each consisting of a key
and a value. Given the key for an entry, the hashing function can very
quickly locate the entry, and hence the corresponding value. There may
be at most one entry in a hash table with a particular key, but many
entries may have the same value.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> hash tables grow gracefully as the number of entries
increases, so that there are always less than three entries per hash
bucket, on average.  This allows for fast lookups regardless of the
number of entries in a table.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> hash tables procedures are identical to the ones
defined in <strong><a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI-69</a></strong> (<em>Basic Hash Tables</em>). Note that the default comparison function
is <code>eq?</code> whereas it is <code>equal?</code> in this SRFI. See
SRFI&#8217;s documentation for more information.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-hash-table)</code></strong><br>
<strong><code>(make-hash-table comparison)</code></strong><br>
<strong><code>(make-hash-table comparison hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Make-hash-table</code> admits three different forms.  The most general form
admit two arguments. The first argument is a comparison function which
determines how keys are compared; the second argument is a function which
computes a hash code for an object and returns the hash code as a non
negative integer. Objets with the same hash code are stored in an A-list
registered in the bucket corresponding to the key.</p>
</div>
<div class="paragraph">
<p>If omitted,</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hash</code> defaults to the <code>hash-table-hash</code> procedure
(see <em><a href="#hashtablehash"><code>hash-table-hash</code> primitive</a></em>).</p>
</li>
<li>
<p><code>comparison</code> defaults to the <code>eq?</code> procedure
(see <em><a href="#eqprim"><code>eq?</code> primitive</a></em>)).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consequently,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">h</span> <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">h</span> <span class="p">(</span><span class="nf">make-hash-table</span> <span class="nv">eq?</span> <span class="nv">hash-table-hash</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An interesting example is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">h</span> <span class="p">(</span><span class="nf">make-hash-table</span> <span class="nv">string-ci=?</span> <span class="nv">string-length</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which defines a new hash table which uses <code>string-ci=?</code> for
comparing keys. Here, we use the string-length as a (very simple)
hashing function. Of course, a function which gives a key depending
of the characters composing the string gives a better repartition
and should probably enhance performances. For instance, the following
call to <code>make-hash-table</code> should return a more efficient, even if
not perfect, hash table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">make-hash-table</span>
   <span class="nv">string-ci=?</span>
   <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">s</span><span class="p">)</span>
     <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">len</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">s</span><span class="p">)))</span>
       <span class="p">(</span><span class="k">do</span> <span class="p">((</span><span class="nf">h</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">(</span><span class="nf">i</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">i</span> <span class="mi">1</span><span class="p">)))</span>
           <span class="p">((</span><span class="nb">=</span> <span class="nv">i</span> <span class="nv">len</span><span class="p">)</span> <span class="nv">h</span><span class="p">)</span>
         <span class="p">(</span><span class="k">set!</span> <span class="nv">h</span>
               <span class="p">(</span><span class="nb">+</span> <span class="nv">h</span> <span class="p">(</span><span class="nb">char-&gt;integer</span>
                      <span class="p">(</span><span class="nb">char-downcase</span> <span class="p">(</span><span class="nb">string-ref</span> <span class="nv">s</span> <span class="nv">i</span><span class="p">)))))))))</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hash tables with a comparison function equal to <code>eq?</code> or
<code>string=?</code> are handled in an more efficient way (in fact, they don&#8217;t use
the <code>hash-table-hash</code> function to speed up hash table retrievals).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a hash table, returns <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div id="hashtablehash" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-hash obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Computes a hash code for an object and returns this hash code as a
non-negative integer. A property of <code>hash-table-hash</code> is that</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">equal?</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nb">equal?</span> <span class="p">(</span><span class="nf">hash-table-hash</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">hash-table-hash</span> <span class="nv">y</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>as the Common Lisp <code>sxhash</code> function from which this procedure is
modeled.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(alist&#8594;hash-table alist)</code></strong><br>
<strong><code>(alist&#8594;hash-table alist comparison)</code></strong><br>
<strong><code>(alist&#8594;hash-table alist comparison hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns hash-table built from the <em>association list</em>
<code>alist</code>. This function maps the <code>car</code> of every element in <code>alist</code>
to the <code>cdr</code> of corresponding elements in <code>alist</code>. the <code>comparison</code> and
<code>hash</code> functions are interpreted as in <code>make-hash-table</code>. If some key
occurs multiple times in <code>alist</code>, the value in the first
association will take precedence over later ones.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table&#8594;alist hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an <em>association list</em> built from the entries in <code>hash</code>.
Each entry in <code>hash</code> will be represented as a pair whose <code>car</code> is the
entry&#8217;s key and whose <code>cdr</code> is its value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the order of pairs in the resulting list is unspecified.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">h</span> <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">dotimes</span> <span class="p">(</span><span class="nf">i</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">number-&gt;string</span> <span class="nv">i</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">hash-table-&gt;alist</span> <span class="nv">h</span><span class="p">))</span>
       <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">3</span> <span class="o">.</span> <span class="s">"3"</span><span class="p">)</span> <span class="p">(</span><span class="nf">4</span> <span class="o">.</span> <span class="s">"4"</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="o">.</span> <span class="s">"0"</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="s">"1"</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="s">"2"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-set! hash key value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enters an association between <code>key</code> and <code>value</code> in the`hash` table.
The value returned by <code>hash-table-set!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-ref hash key)</code></strong><br>
<strong><code>(hash-table-ref hash key thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the value associated with <code>key</code> in the given <code>hash</code> table. If no
value has been associated with <code>key</code> in <code>hash</code>, the specified <code>thunk</code> is
called and its value is returned; otherwise an error is raised.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">h1</span> <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">))</span>
<span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h1</span> <span class="ss">'foo</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="nf">hash-table-ref</span>  <span class="nv">h1</span> <span class="ss">'foo</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">hash-table-ref</span>  <span class="nv">h1</span> <span class="ss">'bar</span>
                    <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="ss">'absent</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="nv">absent</span>
<span class="p">(</span><span class="nf">hash-table-ref</span>  <span class="nv">h1</span> <span class="ss">'bar</span><span class="p">)</span>                 <span class="nv">=&gt;</span>  <span class="nv">error</span>
<span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h1</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="ss">'present</span><span class="p">)</span>
<span class="p">(</span><span class="nf">hash-table-ref</span>  <span class="nv">h1</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="ss">'absent</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="nv">absent</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">h2</span> <span class="p">(</span><span class="nf">make-hash-table</span> <span class="nv">equal?</span><span class="p">))</span>
<span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h2</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="ss">'present</span><span class="p">)</span>
<span class="p">(</span><span class="nf">hash-table-ref</span>  <span class="nv">h2</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>             <span class="nv">=&gt;</span> <span class="nv">present</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-ref/default hash key default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">hash-table-ref</span> <span class="nv">hash</span> <span class="nv">key</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="nv">default</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-delete! hash key)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Deletes the entry for <code>key</code> in <code>hash</code>, if it exists. Result of
<code>hash-table-delete!</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">h</span> <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">))</span>
<span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h</span> <span class="ss">'foo</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="nf">hash-table-ref</span> <span class="nv">h</span> <span class="ss">'foo</span><span class="p">)</span>                <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">hash-table-delete!</span> <span class="nv">h</span> <span class="ss">'foo</span><span class="p">)</span>
<span class="p">(</span><span class="nf">hash-table-ref</span> <span class="nv">h</span> <span class="ss">'foo</span>
                  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="ss">'absent</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="nv">absent</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-exists? hash key)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if there is any association of <code>key</code> in
<code>hash</code>. Returns <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-update! hash key update-fun thunk)</code></strong><br>
<strong><code>(hash-table-update!/default hash key update-fun default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Update the value associated to <code>key</code> in table <code>hash</code> if key is already in
table with the value <code>(update-fun current-value)</code>. If no value is
associated to <code>key</code>, a new entry in the table is first inserted
before updating it (this new entry being the result of calling <code>thunk</code>).</p>
</div>
<div class="paragraph">
<p>Note that the expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">hash-table-update!/default</span> <span class="nv">hash</span> <span class="nv">key</span> <span class="nv">update-fun</span> <span class="nv">default</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">hash-table-update!</span> <span class="nv">hash</span> <span class="nv">key</span> <span class="nv">update-fun</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="nv">default</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">h</span>   <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">1+</span>  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">hash-table-update!/default</span> <span class="nv">h</span> <span class="ss">'test</span> <span class="mi">1</span><span class="nv">+</span> <span class="mi">100</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-table-update!/default</span> <span class="nv">h</span> <span class="ss">'test</span> <span class="mi">1</span><span class="nv">+</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-table-ref</span> <span class="nv">h</span> <span class="ss">'test</span><span class="p">))</span>             <span class="nv">=&gt;</span> <span class="mi">102</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-for-each hash proc)</code></strong><br>
<strong><code>(hash-table-walk hash proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Proc</code> must be a procedure taking two arguments. <code>Hash-table-for-each</code>
calls <code>proc</code> on each key/value association in <code>hash</code>, with the key as
the first argument and the value as the second.  The value returned by
<code>hash-table-for-each</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of application of <code>proc</code> is unspecified.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>hash-table-walk</code> is another name for <code>hash-table-for-each</code>
(this is the name used in <strong><a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI-69</a></strong> (<em>Basic Hash Tables</em>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">h</span>   <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">sum</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h</span> <span class="ss">'foo</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h</span> <span class="ss">'bar</span> <span class="mi">3</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-table-for-each</span> <span class="nv">h</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">key</span> <span class="nv">value</span><span class="p">)</span>
                           <span class="p">(</span><span class="k">set!</span> <span class="nv">sum</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">sum</span> <span class="nv">value</span><span class="p">))))</span>
  <span class="nv">sum</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-map hash proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Proc</code> must be a procedure taking two arguments. <code>Hash-table-map</code>
calls <code>proc</code> on each key/value association in <code>hash</code>, with the key as
the first argument and the value as the second.  The result of
<code>hash-table-map</code> is a list of the values returned by <code>proc</code>, in an
unspecified order.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of application of <code>proc</code> is unspecified.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">h</span> <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">dotimes</span> <span class="p">(</span><span class="nf">i</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">hash-table-set!</span> <span class="nv">h</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">number-&gt;string</span> <span class="nv">i</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">hash-table-map</span> <span class="nv">h</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">key</span> <span class="nv">value</span><span class="p">)</span>
                       <span class="p">(</span><span class="nb">cons</span> <span class="nv">key</span> <span class="nv">value</span><span class="p">))))</span>
             <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">3</span> <span class="o">.</span> <span class="s">"3"</span><span class="p">)</span> <span class="p">(</span><span class="nf">4</span> <span class="o">.</span> <span class="s">"4"</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="o">.</span> <span class="s">"0"</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="s">"1"</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="s">"2"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-keys hash)</code></strong><br>
<strong><code>(hash-table-values hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the keys or the values of <code>hash</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-fold hash func init-value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure calls <code>func</code> for every association in <code>hash</code>
with three arguments: the key of the association key, the value
of the association value, and an accumulated value, <code>val</code>. <code>Val</code> is
init-value for the first invocation of <code>func</code>, and for subsequent
invocations of <code>func</code>, the return value of the previous invocation of
<code>func</code>. The value <code>final-value</code> returned by <code>hash-table-fold</code> is the
return value of the last invocation of <code>func</code>. The order in which <code>func</code> is
called for different associations is unspecified.</p>
</div>
<div class="paragraph">
<p>For instance, the following expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">hash-table-fold</span> <span class="nv">ht</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">k</span> <span class="nv">v</span> <span class="nv">acc</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">acc</span> <span class="mi">1</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>computes the number of associations present in the <code>ht</code> hash table.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-copy hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a copy of <code>hash</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-merge! hash1 hash2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Adds all mappings in <code>hash2</code> into <code>hash1</code> and returns the resulting
hash table. This function may modify <code>hash1</code> destructively.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-equivalence-function hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the equivalence predicate used for keys in <code>hash</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-hash-function hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the hash function used for keys in <code>hash</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-size hash)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of entries in the <code>hash</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(hash-table-stats hash)</code></strong><br>
<strong><code>(hash-table-stats hash port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Prints  overall information about <code>hash</code>, such as the number of entries
it contains, the number of buckets in its hash array, and the utilization
of the buckets. Informations are printed on <code>port</code>. If no <code>port</code> is given
to <code>hash-table-stats</code>, information are printed on the current output port
(see <em><a href="#curroport"><code>current-output-port</code> primitive</a></em>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_dates_and_times">4.16. Dates and Times</h3>
<div class="paragraph">
<p><strong><em>STklos</em></strong> stores dates and times with a compact
representation which consists is an integer which represents the
number of seconds elapsed since the <strong><em>Epoch</em></strong> (00:00:00 on
January 1, 1970, Coordinated Universal Time --UTC). Dates can
also be represented with date structures.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-second)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an inexact number representing the current time on the
International Atomic Time (TAI) scale.  The value 0.0 represents
midnight on January 1, 1970 TAI (equivalent to ten seconds before
midnight Universal Time) and the value 1.0 represents one TAI
second later.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-seconds)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the time since the Epoch (that is 00:00:00 UTC, January 1, 1970),
measured in seconds in the Coordinated Universal Time (UTC) scale.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This <strong><em>STklos</em></strong> function should not be confused with
the R<sup>7</sup>RS  primitive <code>current-second</code> which returns an inexact number
and whose result is expressed using  the International Atomic Time
instead of UTC.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-time)</code></strong><br>
<strong><code>(current-time type)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the current time as time object. The type can be <code>time-utc</code> or <code>time-tai</code>.
If omitted, <code>type</code> is <code>time-utc</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use more time types, such as <code>time-monotonic</code> and <code>time-process</code>, please
load <strong><a href="http://srfi.schemers.org/srfi-19/srfi-19.html">SRFI-19</a></strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-time nanosecond second)</code></strong><br>
<strong><code>(make-time type nanosecond second)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates a time structure with the given <code>nanosecond</code> and <code>second</code>.
If <code>type</code> is passed, it must be a symbol representing one of the
supported time types (<code>time-tai</code>, <code>time-utc</code>, <code>time-monotonic</code>,
<code>time-process</code> and <code>time-duration</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>time-monotonic</code>, <code>time-process</code> and <code>time-duration</code> can
be created, but operations on them are only available when SRFI-19 is
loaded.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>




</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(time-type t)</code></strong><br>
<strong><code>(set-time-type! t v)</code></strong><br>
<strong><code>(time-second t)</code></strong><br>
<strong><code>(set-time-second! t s)</code></strong><br>
<strong><code>(time-nanosecond t)</code></strong><br>
<strong><code>(set-time-nanosecond! t n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These are accessors for time structures.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(time? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return <code>#t</code> if <code>obj</code> is a time object, othererwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(time&#8594;seconds time)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Convert the time object <code>time</code> into an inexact real number representing
the number of seconds elapsed since the Epoch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">time-&gt;seconds</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>  <span class="nv">==&gt;</span>  <span class="mf">1138983411.09337</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(seconds&#8594;time x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Converts into a time object the real number <code>x</code> representing the number
of seconds elapsed since the Epoch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">seconds-&gt;time</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">10</span> <span class="p">(</span><span class="nf">time-&gt;seconds</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))))</span>
         <span class="nv">==&gt;</span>  <span class="nv">a</span> <span class="nv">time</span> <span class="nv">object</span> <span class="nv">representing</span> <span class="mi">10</span> <span class="nv">seconds</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">future</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(time-utc&#8594;time-tai t)</code></strong><br>
<strong><code>(time-utc&#8594;time-tai! t)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Converts <code>t</code>, which must be of type <code>time-utc</code>, to the type
<code>time-tai</code>.</p>
</div>
<div class="paragraph">
<p><code>Time-utc&#8594;time-tai</code> creates a new object, while <code>time-utc&#8594;time-tai</code>
can use <code>t</code> to build the returned object.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(time-tai&#8594;time-utc t)</code></strong><br>
<strong><code>(time-tai&#8594;time-utc! t)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Converts <code>t</code>, which must be of type <code>time-tai</code>, to the type
<code>time-utc</code>.</p>
</div>
<div class="paragraph">
<p><code>Time-tai&#8594;time-utc</code> creates a new object, while <code>time-tai&#8594;time-utc</code>
can use <code>t</code> to build the returned object.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-date)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current system date.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-date :key      nanosecond second minute hour day month year zone-offset)</code></strong><br>
<strong><code>(make-date :optional nanosecond second minute hour day month year zone-offset)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Build a date from its argument. <code>hour</code>, <code>minute</code>, <code>second</code>, <code>nanosecond</code>
default to 0; <code>day</code> and <code>month</code> default to 1; <code>year</code> defaults to 1970.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return <code>#t</code> if <code>obj</code> is a date, and otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-nanosecond d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the nanosecond of date <code>d</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-second d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the second of date <code>d</code>, in the range 0 to 59.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-minute d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the minute of date <code>d</code>, in the range 0 to 59.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-hour d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the hour of date <code>d</code>, in the range 0 to 23.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-day d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the day of date <code>d</code>, in the range 1 to 31</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-month d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the month of date <code>d</code>, in the range 1 to 12</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-year d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the year of date <code>d</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-week-day d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the week day of date <code>d</code>, in the range 0 to 6 (0 is Sunday).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-year-day d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the the number of days since January 1 of date <code>d</code>, in the range
1 to 366.</p>
</div>
<div id="datedst" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-dst d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return an indication about daylight saving adjustment of date <code>d</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0 if no daylight saving adjustment</p>
</li>
<li>
<p>1 if daylight saving adjustment</p>
</li>
<li>
<p>-1 if the information is not available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date-tz d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the time zone of date <code>d</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(local-timezone-offset)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the local timezone offset, in seconds.</p>
</div>
<div class="paragraph">
<p>For example, for GMT+2 it will be <code>2 * 60 * 60</code> = <code>7200</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">local-timezone-offset</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">0</span>        <span class="c1">;; for GMT</span>
<span class="p">(</span><span class="nf">local-timezone-offset</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">7200</span>     <span class="c1">;; for GMT+2</span>
<span class="p">(</span><span class="nf">local-timezone-offset</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">-10800</span>   <span class="c1">;; for GMT-3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The timezone is searched for in the environment variable <code>TZ</code>. If this
variable does not appear in the environment, the system timezone is used.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date&#8594;seconds d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Convert the date <code>d</code> to the number of seconds since the <em>Epoch</em>,
1970-01-01 00:00:00 +0000 (UTC).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">date-&gt;seconds</span> <span class="p">(</span><span class="nf">make-date</span> <span class="mi">0</span> <span class="mi">37</span> <span class="mi">53</span> <span class="mi">1</span> <span class="mi">26</span> <span class="mi">10</span> <span class="mi">2012</span> <span class="mi">0</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="mf">1351216417.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date&#8594;string d)</code></strong><br>
<strong><code>(date&#8594;string d format)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Convert the date <code>d</code> using the string <code>format</code> as a
specification. Conventions for format are the same as the one
of <em><a href="#seconds2string">primitive <code>seconds&#8594;string</code></a></em>.
If <code>format</code> is omitted, it defaults to <code>"~c"</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(seconds&#8594;date n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Convert the date <code>n</code> expressed as a number of seconds since the <em>Epoch</em>,
1970-01-01 00:00:00 +0000 (UTC) into a date.
<code>n</code> can be an exact integer or an inexact real.</p>
</div>
<div class="paragraph">
<p>This is equivalent to converting time-UTC to date.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">seconds-&gt;date</span> <span class="mi">1351216417</span><span class="p">)</span>           <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">[</span><span class="nf">date</span> <span class="mi">2012-10-26</span> <span class="mi">1</span><span class="nv">:53:37</span><span class="p">]</span></code></pre>
</div>
</div>
<div id="seconds2string" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(seconds&#8594;string format n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Convert a date expressed in seconds using the string <code>format</code> as a
specification. Conventions for <code>format</code> are given below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>~~</strong> a literal ~</p>
</li>
<li>
<p><strong>~a</strong> locale&#8217;s abbreviated weekday name (Sun&#8230;&#8203;Sat)</p>
</li>
<li>
<p><strong>~A</strong> locale&#8217;s full weekday name (Sunday&#8230;&#8203;Saturday)</p>
</li>
<li>
<p><strong>~b</strong> locale&#8217;s abbreviate month name (Jan&#8230;&#8203;Dec)</p>
</li>
<li>
<p><strong>~B</strong> locale&#8217;s full month day (January&#8230;&#8203;December)</p>
</li>
<li>
<p><strong>~c</strong> locale&#8217;s date and time
(e.g., ,(code "Fri Jul 14 20:28:42-0400 2000"))</p>
</li>
<li>
<p><strong>~d</strong> day of month, zero padded (01&#8230;&#8203;31)</p>
</li>
<li>
<p><strong>~D</strong> date (mm/dd/yy)</p>
</li>
<li>
<p><strong>~e</strong> day of month, blank padded ( 1&#8230;&#8203;31)</p>
</li>
<li>
<p><strong>~f</strong> seconds+fractional seconds, using locale&#8217;s
decimal separator (e.g. 5.2).</p>
</li>
<li>
<p><strong>~h</strong> same as ~b</p>
</li>
<li>
<p><strong>~H</strong> hour, zero padded, 24-hour clock (00&#8230;&#8203;23)</p>
</li>
<li>
<p><strong>~I</strong> hour, zero padded, 12-hour clock (01&#8230;&#8203;12)</p>
</li>
<li>
<p><strong>~j</strong> day of year, zero padded</p>
</li>
<li>
<p><strong>~k</strong> hour, blank padded, 24-hour clock (00&#8230;&#8203;23)</p>
</li>
<li>
<p><strong>~l</strong> hour, blank padded, 12-hour clock (01&#8230;&#8203;12)</p>
</li>
<li>
<p><strong>~m</strong> month, zero padded (01&#8230;&#8203;12)</p>
</li>
<li>
<p><strong>~M</strong> minute, zero padded (00&#8230;&#8203;59)</p>
</li>
<li>
<p><strong>~n</strong> new line</p>
</li>
<li>
<p><strong>~p</strong> locale&#8217;s AM or PM</p>
</li>
<li>
<p><strong>~r</strong> time, 12 hour clock, same as "~I:~M:~S ~p"</p>
</li>
<li>
<p><strong>~s</strong> number of full seconds since <em>the epoch</em> (in UTC)</p>
</li>
<li>
<p><strong>~S</strong> second, zero padded (00&#8230;&#8203;61)</p>
</li>
<li>
<p><strong>~t</strong> horizontal tab</p>
</li>
<li>
<p><strong>~T</strong> time, 24 hour clock, same as "~H:~M:~S"</p>
</li>
<li>
<p><strong>~U</strong> week number of year with Sunday as first day of week
(00&#8230;&#8203;53)</p>
</li>
<li>
<p><strong>~V</strong> weekISO 8601:1988 week number of year (01&#8230;&#8203;53)
(week 1 is the first week that has at least 4 days in
the current year, and  with  Monday  as  the first day
of the week)</p>
</li>
<li>
<p><strong>~w</strong> day of week (1&#8230;&#8203;7, 1 is Monday)</p>
</li>
<li>
<p><strong>~W</strong> week number of year with Monday as first day of week
(01&#8230;&#8203;52)</p>
</li>
<li>
<p><strong>~x</strong> week number of year with Monday as first day of week
(00&#8230;&#8203;53)</p>
</li>
<li>
<p><strong>~X</strong> locale&#8217;s date representation, for example: "07/31/00"</p>
</li>
<li>
<p><strong>~y</strong> last two digits of year (00&#8230;&#8203;99)</p>
</li>
<li>
<p><strong>~Y</strong> year</p>
</li>
<li>
<p><strong>~z</strong> time zone in RFC-822 style</p>
</li>
<li>
<p><strong>~Z</strong> symbol time zone</p>
</li>
</ul>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(seconds&#8594;list sec)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a keyword list for the date given by <code>sec</code> (a date based on the
Epoch). The keyed values returned are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>nanosecond : 0 to 999999</p>
</li>
<li>
<p>second : 0 to 59 (but can be up to 61 to allow for leap seconds)</p>
</li>
<li>
<p>minute : 0 to 59</p>
</li>
<li>
<p>hour : 0 to 23</p>
</li>
<li>
<p>day : 1 to 31</p>
</li>
<li>
<p>month : 1 to 12</p>
</li>
<li>
<p>year : e.g., 2002</p>
</li>
<li>
<p>week-day : 0 (Sunday) to 6 (Saturday)</p>
</li>
<li>
<p>year-day : 0 to 365 (365 in leap years)</p>
</li>
<li>
<p>dst : indication about daylight savings time
(see <em><a href="#datedst">primitive <code>date-dst</code></a></em>).</p>
</li>
<li>
<p>tz : the difference between Coordinated Universal Time
(UTC) and local standard time in seconds.])</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">seconds-&gt;list</span> <span class="p">(</span><span class="nf">current-second</span><span class="p">))</span>
       <span class="nv">=&gt;</span> <span class="p">(</span><span class="o">#</span><span class="nv">:nanosecond</span> <span class="mi">182726</span> <span class="o">#</span><span class="nv">:second</span> <span class="mi">21</span> <span class="o">#</span><span class="nv">:minute</span> <span class="mi">35</span> <span class="o">#</span><span class="nv">:hour</span> <span class="mi">20</span> <span class="o">#</span><span class="nv">:day</span> <span class="mi">10</span> <span class="o">#</span><span class="nv">:month</span> <span class="mi">1</span>
           <span class="o">#</span><span class="nv">:year</span> <span class="mi">2022</span> <span class="o">#</span><span class="nv">:week-day</span> <span class="mi">1</span> <span class="o">#</span><span class="nv">:year-day</span> <span class="mi">10</span> <span class="o">#</span><span class="nv">:dst</span> <span class="mi">0</span> <span class="o">#</span><span class="nv">:tz</span> <span class="mi">-3600</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(date)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current date in a string.</p>
</div>
</div>
<div class="sect2">
<h3 id="_boxes">4.17. Boxes</h3>
<div class="paragraph">
<p>Boxes are objects which contain one or several states.  A box may
be constructed with the box, constant-box. <strong><em>STklos</em></strong> boxes are
compatible with the one defined in <strong><a href="http://srfi.schemers.org/srfi-111/srfi-111.html">SRFI-111</a></strong> (<em>Boxes</em>) or <strong><a href="http://srfi.schemers.org/srfi-195/srfi-195.html">SRFI-195</a></strong> (<em>Multiple-value boxes</em>).  Boxes of
SRFI-111 can contain only one value, whereas SRFI-195 boxes can contain multiple
values. Furthermore, <strong><em>STklos</em></strong> defines also the notion of constant boxes which
are not mutable.</p>
</div>
<div class="paragraph">
<p>The read primitive can also make single valued boxes (using the <code>#&amp;</code>
notation). Such boxes are mutable.</p>
</div>
<div class="paragraph">
<p>Note that two boxes are <code>equal?</code> <strong><em>iff</em></strong> their content are <code>equal?</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(box value &#8230;&#8203;)</code></strong><br>
<strong><code>(make-box value &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new box that contains all the given `value`s.
The box is mutable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="p">(</span><span class="nf">box</span> <span class="mi">10</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="mi">10</span> <span class="nv">x</span><span class="p">))</span>        <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">10</span> <span class="o">#</span><span class="nv">&amp;10</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name <code>make-box</code> is now obsolete and kept only for compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(constant-box value &#8230;&#8203;)</code></strong><br>
<strong><code>(make-constant-box value &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new box that contains all the given `value`s. The box is immutable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name <code>make-constant-box</code> is now obsolete and kept only for compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(box? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a box, <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(box-mutable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a mutable box, <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set-box! box value &#8230;&#8203;)</code></strong><br>
<strong><code>(box-set! box value &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Changes <code>box</code> to hold <code>value`s. It is an error if `set-box!</code> is called
with a number of values that differs from the number of values in the box
being set. (In other words, <code>set-box!</code> does not allocate memory.)
It is also an error to call <code>set-box!</code> on a box which is not mutable.</p>
</div>
<div class="paragraph">
<p>The name <code>box-set!</code> is now obsolete and kept only for compatibility.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(unbox box)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the values currently in <code>box</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(box-arity box)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of values in <code>box</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(unbox-value box i)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the <code>i</code>th value of <code>box</code>. It is an error if <code>i</code> is not an exact integer
between 0 and <code>n</code>-1, when <code>n</code> is the number of values in <code>box</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set-box-value! box i obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Changes the <code>i</code>th value of <code>box</code> to <code>obj</code>. It is an error if <code>i</code> is not an
exact integer between 0 and <code>n</code>-1, when <code>n</code> is the number of values in <code>box</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_processes">4.18. Processes</h3>
<div class="paragraph">
<p>

<strong><em>STklos</em></strong> provides access to Unix processes as first class objects.
Basically, a process contains several informations such as the standard
system process identification (aka PID on Unix Systems), the files where
the standard files of the process are redirected.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(run-process command p1 p2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>run-process</code> creates a new process and run the executable
specified in <code>command</code>. The <code>p</code> correspond to the command line
arguments. The following values of <code>p</code> have a special meaning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:input</code> permits to redirect the standard input file of the
process. Redirection can come from a file or from a pipe. To redirect
the standard input from a file, the name of this file must be
specified after <code>:input</code>. Use the special keyword <code>:pipe</code> to
redirect the standard input from a pipe.</p>
</li>
<li>
<p><code>:output</code> permits to redirect the standard output file of the
process. Redirection can go to a file or to a pipe. To redirect
the standard output to a file, the name of this file must be
specified after <code>:output</code>. Use the special keyword <code>:pipe</code> to
redirect the standard output to a pipe.</p>
</li>
<li>
<p><code>:error</code> permits to redirect the standard error file of the
process. Redirection can go to a file or to a pipe. To redirect
the standard error to a file, the name of this file must be
specified after <code>error</code>. Use the special keyword <code>:pipe</code> to
redirect the standard error to a pipe.</p>
</li>
<li>
<p><code>:wait</code> must be followed by a boolean value. This value
specifies if the process must be run asynchronously or not. By
default, the process is run asynchronously (i.e. <code>:wait</code> is <code>#f</code>).</p>
</li>
<li>
<p><code>:host</code> must be followed by a string. This string represents
the name of the machine on which the command must be executed. This
option uses the external command <code>rsh</code>. The shell variable
<code>PATH</code> must be correctly set for accessing it without specifying its
abolute path.</p>
</li>
<li>
<p><code>:fork</code> must be followed by a boolean value. This value
specifies if a <em>fork"</em> system call must be done before running
the process. If the process is run without <em>fork</em> the Scheme
program is lost. This feature mimics the <code>``exec&#8217;' primitive of the
Unix shells. By default, a fork is executed before running the process
(i.e. `:fork</code> is <code>#t</code>). This option works on Unix implementations only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example launches a process which executes the
Unix command <code>ls</code> with the arguments <code>-l</code> and <code>/bin</code>. The lines
printed by this command are stored in the file <code>/tmp/X</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">run-process</span> <span class="s">"ls"</span> <span class="s">"-l"</span> <span class="s">"/bin"</span> <span class="nv">:output</span> <span class="s">"/tmp/X"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a process , otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-alive? proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if process <code>proc</code> is currently running, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-pid proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an integer which represents the Unix identification (PID) of the
processus.</p>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-input proc)</code></strong><br>
<strong><code>(process-output proc)</code></strong><br>
<strong><code>(process-error proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the file port associated to the standard input, output or error
of <code>proc</code>, if it is redirected in (or to) a pipe; otherwise
returns <code>#f</code>. Note that the returned port is opened for reading
when calling <code>process-output</code> or <code>process-error</code>; it is opened
for writing when calling <code>process-input</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-wait proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stops the current process (the Scheme process) until <code>proc</code> completion.
<code>Process-wait</code> returns <code>#f</code> when <code>proc</code> is already terminated; it returns
<code>#t</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-exit-status proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the exit status of <code>proc</code> if it has finished its execution;
returns <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-send-signal proc sig)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sends the integer signal <code>sig</code> to <code>proc</code>. Since value of <code>sig</code> is system
dependant, use the symbolic defined signal constants to make your program
independant of the running system (see <a href="#_signals">Section 4.20</a>).
The result of <code>process-send-signal</code> is <strong><em>void</em></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-kill proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Kills (brutally) <code>process</code>. The result of <code>process-kill</code>
is <em>void</em>. This procedure is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">process-send-signal</span> <span class="nv">process</span> <span class="nv">SIGTERM</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-stop proc)</code></strong><br>
<strong><code>(process-continue proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Process-stop</code> stops the execution of <code>proc</code> and <code>process-continue</code> resumes
its execution. They are equivalent, respectively, to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">process-send-signal</span> <span class="nv">process</span> <span class="nv">SIGSTOP</span><span class="p">)</span>
<span class="p">(</span><span class="nf">process-send-signal</span> <span class="nv">process</span> <span class="nv">SIGCONT</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(process-list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the list of processes which are currently running (i.e. alive).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fork)</code></strong><br>
<strong><code>(fork thunk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure is a wrapper around the standard Unix <code>fork</code> system
call which permits to create a new (heavy) process.
When called without parameter, this procedure returns two times
(one time in the parent process and one time in the child process).
The value returned to the parent process is a process object
representing the child process and the value returned to the child
process is always the value <code>#f</code>.
When called with a parameter (which must be a thunk), the new process
excutes <code>thunk</code> and terminate it execution when <code>thunk</code> returns. The
value returned to the parent process is a process object representing
the child process.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sockets">4.19. Sockets</h3>
<div class="paragraph">
<p>
<strong><em>STklos</em></strong> defines <strong>sockets</strong>, on systems which support them,
as first class objects. Sockets permits processes to communicate even if
they are on different machines. Sockets are useful for creating client-server
applications.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-client-socket hostname port-number)</code></strong><br>
<strong><code>(make-client-socket hostname port_number line-buffered)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>make-client-socket</code> returns a new socket object. This socket
establishes a link between the running program and the application
listening on port <code>port-number</code> of <code>hostname</code>.  If  the optional argument
<code>line-buffered</code> has a true value, a line buffered policy is used when writing
to the client socket (i.e. characters on the socket are tranmitted as soon
as a <code>"#\newline</code> character is encountered). The default value of
<code>line-buffered</code> is <code>#t</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-server-socket)</code></strong><br>
<strong><code>(make-server-socket port-number)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>make-server-socket</code> returns a new socket object. If <code>port-number</code>
is specified, the socket is listening on the specified port;
otherwise, the communication port is chosen by the system.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-shutdown sock)</code></strong><br>
<strong><code>(socket-shutdown sock close)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Socket-shutdown</code> shutdowns the connection associated to
<code>socket</code>. If the socket is a server socket, <code>socket-shutdown</code> is called
on all the client sockets connected to this server.
<code>Close</code> indicates if the socket must be closed or not, when
the connection is destroyed. Closing the socket forbids further
connections on the same port with the <code>socket-accept</code> procedure.
Omitting a value for <code>close</code> implies the closing of socket.</p>
</div>
<div class="paragraph">
<p>The following example shows a simple server: when there is
a new connection on the port number 12345, the server displays
the first line sent to it by the client, discards the others and
go back waiting for further client connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">s</span> <span class="p">(</span><span class="nf">make-server-socket</span> <span class="mi">12345</span><span class="p">)))</span>
   <span class="p">(</span><span class="k">let</span> <span class="nv">loop</span> <span class="p">()</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">ns</span> <span class="p">(</span><span class="nf">socket-accept</span> <span class="nv">s</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">"I've read: ~A\\n"</span>
                <span class="p">(</span><span class="nf">read-line</span> <span class="p">(</span><span class="nf">socket-input</span> <span class="nv">ns</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">socket-shutdown</span> <span class="nv">ns</span> <span class="no">#f</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">loop</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-accept socket)</code></strong><br>
<strong><code>(socket-accept socket line-buffered)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>socket-accept</code> waits for a client connection on the given
<code>socket</code>. If no client is already waiting for a connection, this
procedure blocks its caller; otherwise, the first connection request
on the queue of pending connections is connected and <code>socket-accept</code>
returns a new client socket to serve this request.
This procedure must be called on a server socket created
with <code>make-server-socket</code>. The result of <code>socket-accept</code> is undefined.
<code>Line-buffered</code> indicates if the port should be considered as a
line buffered. If <code>line-buffered</code> is omitted, it defaults to <code>#t</code>.</p>
</div>
<div class="paragraph">
<p>The following example is a simple server which waits for a connection
on the port 12345 <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
<div class="paragraph">
<p>Once the connection with the distant program is established, we read
a line on the input port associated to the socket, and we write the
length of this line on its output port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">server</span> <span class="p">(</span><span class="nf">make-server-socket</span> <span class="mi">12345</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">client</span> <span class="p">(</span><span class="nf">socket-accept</span> <span class="nv">server</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">l</span>      <span class="p">(</span><span class="nf">read-line</span> <span class="p">(</span><span class="nf">socket-input</span> <span class="nv">client</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="p">(</span><span class="nf">socket-output</span> <span class="nv">client</span><span class="p">)</span>
          <span class="s">"Length is: ~a\n"</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">l</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">socket-shutdown</span> <span class="nv">server</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that shutting down the <code>server</code> socket suffices here to close
also the connection to <code>client</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>socket</code> is a socket, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-server? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>socket</code> is a server socket, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-client? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>socket</code> is a client socket, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-host-name socket)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string which contains the name of the distant host
attached to <code>socket</code>. If <code>socket</code> has been created with
<code>make-client-socket</code> this procedure returns the official name of
the distant machine used for connection. If <code>socket</code> has been
created with <code>make-server-socket</code>, this function returns the
 official name of the client connected to the socket. If no client
has used yet <code>socket</code>, this function returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-host-address socket)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string which contains the IP number of the distant host
attached to <code>socket</code>. If <code>socket</code> has been created with
<code>make-client-socket</code> this procedure returns the IP number of the
distant machine used for connection. If <code>socket</code> has been created
with <code>make-server-socket</code>, this function returns the address of the
client connected to the socket.  If no client has used yet
<code>socket</code>, this function returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-local-address socket)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a string which contains the IP number of the local host
attached to <code>socket</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-port-number socket)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the integer number of the port used for <code>socket</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(socket-input socket)</code></strong><br>
<strong><code>(socket-output socket)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the port associated for reading or writing with the
program connected with <code>socket</code>. Note that this port is both textual
and binary. If no connection has already been established,
these functions return <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to make a client socket. Here we
create a socket on port 13 of the machine
<code>kaolin.unice.fr</code> <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">s</span> <span class="p">(</span><span class="nf">make-client-socket</span> <span class="s">"kaolin.unice.fr"</span> <span class="mi">13</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">"Time is: ~A~%"</span> <span class="p">(</span><span class="nf">read-line</span> <span class="p">(</span><span class="nf">socket-input</span> <span class="nv">s</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">socket-shutdown</span>  <span class="nv">s</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_signals">4.20. Signals</h3>
<div class="paragraph">
<p><strong><em>STklos</em></strong> permits to associate handlers to POSIX.1 signals. When a
signal handler is called, the integer value of this signal is passed
to it as (the only) parameter.</p>
</div>
<div class="paragraph">
<p>The following POXIX.1 values for signal numbers are defined:
<code>SIGABRT</code> <code>SIGALRM</code>, <code>SIGFPE</code>, <code>SIGHUP</code>,<code>SIGILL</code>, <code>SIGINT</code>, <code>SIGKILL</code>,
<code>SIGPIPE</code>, <code>SIGQUIT</code>, <code>SIGSEGV</code>, <code>SIGTERM</code>, <code>SIGUSR1</code>, <code>SIGUSR2</code>,
<code>SIGCHLD</code>, <code>SIGCONT</code>, <code>SIGSTOP</code>, <code>SIGTSTP</code>, <code>SIGTTIN</code>, <code>SIGTTOU</code>.
Moreover, the following constants, which are often available on most
systems are also defined (if supported by the running system):
<code>SIGTRAP</code>, <code>SIGIOT</code>, <code>SIGEMT</code>, <code>SIGBUS</code>, <code>SIGSYS</code>, <code>SIGURG</code>, <code>SIGCLD</code>,
<code>SIGIO</code>, <code>SIGPOLL</code>, <code>SIGXCPU</code>, <code>SIGXFSZ</code>, <code>SIGVTALRM</code>, <code>SIGPROF</code>,
<code>SIGWINCH</code>, <code>SIGLOST</code>.</p>
</div>
<div class="paragraph">
<p>See your Unix documentation for the exact meaning of each constant or
<a href="#POSIX">[POSIX]</a>. Use symbolic constants rather than their numeric value if
you plan to port your program on another system.</p>
</div>
<div id="set-signal-handler!" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(set-signal-handler! sig handler)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Replace the handler for integer signal <code>sig</code> with <code>handler</code>.
The value of <code>handler</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>#t</code> to reset the signal handler for <code>sig</code> to the
default system handler.</p>
</li>
<li>
<p><code>#f</code> to  ignore the <code>sig</code> signal. Note that POSIX states that
<code>SIGKILL</code> and <code>SIGSTOP</code> cannot be ignored or caught.</p>
</li>
<li>
<p>a one parameter procedure, which will be called when the
processus  receives the signal <code>sig</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure returns <strong><em>void</em></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="no">#f</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">set-signal-handler!</span> <span class="nv">SIGUSR1</span>
                       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">x</span> <span class="no">#t</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">send-signal</span> <span class="nv">SIGUSR1</span><span class="p">)</span>
  <span class="nv">x</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(get-signal-handler! sig)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the handler for integer signal <code>sig</code>.
The value of <code>handler</code> can be a boolean value or a procedure.
See <a href="#set-signal-handler!">primitive <code>set-signal-handler!</code></a> for
more information.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(send-signal sig)</code></strong><br>
<strong><code>(send-signal sig pid)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Send the integer signal <code>sig</code> to the process with <code>pid</code> process id.
If the second parameter is absent, it deaults to the one of the running
program.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameter_objects">4.21. Parameter Objects</h3>
<div class="paragraph">
<p><strong><em>STklos</em></strong> parameters correspond to the ones defined in <strong><a href="http://srfi.schemers.org/srfi-39/srfi-39.html">SRFI-39</a></strong> (<em>Parameters objects</em>).
See SRFI document for more information.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-parameter init)</code></strong><br>
<strong><code>(make-parameter init converter)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new parameter object which is bound in the global dynamic
environment to a cell containing the value returned by the call
<code>(converter init)</code>. If the conversion procedure <code>converter</code> is not
specified the identity function is used instead.</p>
</div>
<div class="paragraph">
<p>The parameter object is a procedure which accepts zero or one
argument. When it is called with no argument, the content of the
cell bound to this parameter object in the current dynamic
environment is returned. When it is called with one argument, the
content of the cell bound to this parameter object in the current
dynamic environment is set to the result of the call
<code>(converter arg)</code>, where <code>arg</code> is the argument passed to the
parameter object, and
an unspecified value is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">radix</span>
    <span class="p">(</span><span class="nf">make-parameter</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">write-shared</span>
   <span class="p">(</span><span class="nf">make-parameter</span>
      <span class="no">#f</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">boolean?</span> <span class="nv">x</span><span class="p">)</span>
            <span class="nv">x</span>
            <span class="p">(</span><span class="nf">error</span> <span class="ss">'write-shared</span> <span class="s">"bad boolean ~S"</span> <span class="nv">x</span><span class="p">)))))</span>

 <span class="p">(</span><span class="nf">radix</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mi">10</span>
 <span class="p">(</span><span class="nf">radix</span> <span class="mi">2</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">radix</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="mi">2</span>
 <span class="p">(</span><span class="nf">write-shared</span> <span class="mi">0</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="nv">error</span>

 <span class="p">(</span><span class="k">define</span> <span class="nv">prompt</span>
   <span class="p">(</span><span class="nf">make-parameter</span>
     <span class="mi">123</span>
     <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">string?</span> <span class="nv">x</span><span class="p">)</span>
           <span class="nv">x</span>
           <span class="p">(</span><span class="nf">with-output-to-string</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">write</span> <span class="nv">x</span><span class="p">)))))))</span>

 <span class="p">(</span><span class="nf">prompt</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="s">"123"</span>
 <span class="p">(</span><span class="nf">prompt</span> <span class="s">"&gt;"</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">prompt</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="s">"&gt;"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(parameterize ((expr1 expr2) &#8230;&#8203;) &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The expressions <code>expr1</code> and <code>expr2</code> are evaluated in an unspecified order.
The value of the <code>expr1</code> expressions must be parameter objects.
For each <code>expr1</code> expression and in an unspecified order, the local
dynamic environment is extended with a binding of the parameter object
<code>expr1</code> to a new cell whose content is the result of the call
<code>(converter val)</code>, where <code>val</code> is the value of <code>expr2</code> and converter
is the conversion procedure of the parameter object. The resulting
dynamic environment is then used for the evaluation of <code>&lt;body&gt;</code>
(which refers to the R<sup>5</sup>RS grammar nonterminal of that name).
The result(s) of the parameterize form are the result(s) of
the <code>&lt;body&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">radix</span><span class="p">)</span>                                              <span class="nv">=&gt;</span>  <span class="mi">2</span>
<span class="p">(</span><span class="nf">parameterize</span> <span class="p">((</span><span class="nf">radix</span> <span class="mi">16</span><span class="p">))</span> <span class="p">(</span><span class="nf">radix</span><span class="p">))</span>                  <span class="nv">=&gt;</span>  <span class="mi">16</span>
<span class="p">(</span><span class="nf">radix</span><span class="p">)</span>                                              <span class="nv">=&gt;</span>  <span class="mi">2</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">number-&gt;string</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">radix</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">f</span> <span class="mi">10</span><span class="p">)</span>                                               <span class="nv">=&gt;</span>  <span class="s">"1010"</span>
<span class="p">(</span><span class="nf">parameterize</span> <span class="p">((</span><span class="nf">radix</span> <span class="mi">8</span><span class="p">))</span> <span class="p">(</span><span class="nf">f</span> <span class="mi">10</span><span class="p">))</span>                    <span class="nv">=&gt;</span>  <span class="s">"12"</span>
<span class="p">(</span><span class="nf">parameterize</span> <span class="p">((</span><span class="nf">radix</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="nf">prompt</span> <span class="p">(</span><span class="nf">f</span> <span class="mi">10</span><span class="p">)))</span> <span class="p">(</span><span class="nf">prompt</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="s">"1010"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(parameter? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a parameter object, otherwise returns <code>#f</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_misc">4.22. Misc</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(gc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Force a garbage collection step.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(void)</code></strong><br>
<strong><code>(void arg1 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the special <strong><em>void</em></strong> object. If arguments are passed to <code>void</code>,
they are evalued and simply ignored.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(error str obj &#8230;&#8203;)</code></strong><br>
<strong><code>(error name str obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>error</code> is used to signal an error to the user. The second form
of <code>error</code> takes  a symbol as first parameter; it is generally used for the
name of the procedure which raises the error.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The specification string may follow the <em>tilde conventions</em> of
<code>format</code> (see <em><a href="#format">primitive <code>format</code></a></em>); in this case this
procedure builds an error message according to the specification
given in <code>str</code>. Otherwise,
this procedure is in conformance with the <code>error</code> procedure defined in
<strong><a href="http://srfi.schemers.org/srfi-23/srfi-23.html">SRFI-23</a></strong> (<em>Error reporting mechanism</em>) and <code>str</code> is printed with the <code>display</code> procedure,
whereas the <code>obj`s are printed  with the `write</code> procedure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hereafter, are some calls of the <code>error</code> procedure using a formatted string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">error</span> <span class="s">"bad integer ~A"</span> <span class="s">"a"</span><span class="p">)</span>
                     <span class="nv">|-</span> <span class="nv">bad</span> <span class="nv">integer</span> <span class="nv">a</span>
<span class="p">(</span><span class="nf">error</span> <span class="ss">'vector-ref</span> <span class="s">"bad integer ~S"</span> <span class="s">"a"</span><span class="p">)</span>
                     <span class="nv">|-</span> <span class="nv">vector-ref:</span> <span class="nv">bad</span> <span class="nv">integer</span> <span class="s">"a"</span>
<span class="p">(</span><span class="nf">error</span> <span class="ss">'foo</span> <span class="s">"~A is not between ~A and ~A"</span> <span class="s">"bar"</span> <span class="mi">0</span> <span class="mi">5</span><span class="p">)</span>
                     <span class="nv">|-</span> <span class="nv">foo:</span> <span class="nv">bar</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">between</span> <span class="mi">0</span> <span class="nv">and</span> <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and some conform to <strong><a href="http://srfi.schemers.org/srfi-23/srfi-23.html">SRFI-23</a></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">error</span> <span class="s">"bad integer"</span> <span class="s">"a"</span><span class="p">)</span>
                    <span class="nv">|-</span> <span class="nv">bad</span> <span class="nv">integer</span> <span class="s">"a"</span>
<span class="p">(</span><span class="nf">error</span> <span class="ss">'vector-ref</span> <span class="s">"bad integer"</span> <span class="s">"a"</span><span class="p">)</span>
                   <span class="nv">|-</span> <span class="nv">vector-ref:</span> <span class="nv">bad</span> <span class="nv">integer</span> <span class="s">"a"</span>
<span class="p">(</span><span class="nf">error</span> <span class="s">"bar"</span> <span class="s">"is not between"</span> <span class="mi">0</span> <span class="s">"and"</span> <span class="mi">5</span><span class="p">)</span>
                   <span class="nv">|-</span> <span class="nv">bar</span> <span class="s">"is not between"</span> <span class="mi">0</span> <span class="s">"and"</span> <span class="mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(signal-error cond str obj &#8230;&#8203;)</code></strong><br>
<strong><code>(signal-error cond name str obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure is similar to error, except that the type of the error
can be passed as the first parameter. The type of the error must be a
condition which inherits from <code>&amp;error-message</code>.</p>
</div>
<div class="paragraph">
<p>Note that <code>(error arg &#8230;&#8203;)</code> is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">signal-error</span> <span class="nv">&amp;error-message</span> <span class="nv">arg</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-error? obj)</code></strong><br>
<strong><code>(file-error? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Error type predicates. Returns #t if <code>obj</code> is an object raised
by the read procedure or by the inability to open an input or
output port on a file, respectively. Otherwise, it returns #f.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(error-object? obj )</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns #t if obj is an object created by error. Otherwise,
it returns #f.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(error-object-message error-object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the message encapsulated by <code>error-object</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(error-object-irritants error-object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the message encapsulated by <code>error-object</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(error-object-location error-object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the location encapsulated by <code>error-object</code> if it exists.
Returns #f otherwise. The location corresponds generally to the name
of the procedure which raised the error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">guard</span> <span class="p">(</span><span class="nf">cnd</span>
         <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nf">error-object-location</span> <span class="nv">cnd</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">error</span> <span class="ss">'foo</span> <span class="s">"error message"</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="nv">foo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(require-extension &lt;clause&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The syntax of require-extension is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-extension</span> <span class="nv">&lt;clause&gt;</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A clause may have the form:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>(srfi number &#8230;&#8203;)</code></p>
</li>
<li>
<p><code>(identifier &#8230;&#8203;)</code></p>
</li>
<li>
<p><code>identifier</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the first form the functionality of the indicated SRFIs are made
available in the context in which the <code>require-extension</code> form appears.
For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-extension</span> <span class="p">(</span><span class="nf">srfi</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span> <span class="c1">; Make the SRFI 1 and 2 available</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This form is compatible with <strong><a href="http://srfi.schemers.org/srfi-55/srfi-55.html">SRFI-55</a></strong> (<em>Require-extension</em>).</p>
</div>
<div class="paragraph">
<p>The second and third forms are <strong><em>STklos</em></strong> extensions.
If the form is a list, it is equivalent to an import. That is,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-extension</span> <span class="p">(</span><span class="nf">streams</span> <span class="nv">primitive</span><span class="p">)</span> <span class="p">(</span><span class="nf">streams</span> <span class="nv">derived</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">import</span> <span class="p">(</span><span class="nf">streams</span> <span class="nv">primitive</span><span class="p">)</span> <span class="p">(</span><span class="nf">streams</span> <span class="nv">derived</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The final form permits to use symbolic names for requiring some extensions.
For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-extension</span> <span class="nv">lists</span> <span class="nv">and-let*</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to the requiring <code>srfi-1</code> and <code>srfi-2</code>.</p>
</div>
<div class="paragraph">
<p>A list of available symbolic names for features is given in <a href="#_srfis">Chapter 14</a>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(require-feature feature)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This primitive ensures that the <code>feature</code> (in sense of SRFI-0 feature)
can be used. In particular, it eventually requires the loading of the
files needed to used <code>feature</code>. The <code>feature</code> can be expressed as a
string or a symbol, If feature is an integer <code>n</code>, it is equivalent to <code>srfi-n</code>.
Consequently, to use <strong><a href="http://srfi.schemers.org/srfi-1/srfi-1.html">SRFI-1</a></strong> the following forms are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-feature</span> <span class="ss">'srfi-1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require-feature</span> <span class="s">"srfi-1"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require-feature</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require-feature</span> <span class="ss">'lists</span><span class="p">)</span>      <span class="c1">;; Since this feature name is an alias for SRFI-1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#_srfis">Chapter 14</a> for more information.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(repl)</code></strong><br>
<strong><code>(repl :in inport :out outport :err errport)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure launches a new Read-Eval-Print-Loop. Calls to <code>repl</code> can be
embedded. The ports used for input/output as well as the error port can
be passed when <code>repl</code> is called. If not passed, they default to
<code>current-input-port</code>, <code>current-output-port</code> and <code>current-error-port</code>.</p>
</div>
<div id="assume" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(assume obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The special form <code>assume</code> is defined in <strong><a href="http://srfi.schemers.org/srfi-145/srfi-145.html">SRFI-145</a></strong> (<em>Assumptions</em>).
When <strong><em>STklos</em></strong> is in debug mode, this special form is an expression
that evaluates to the value of <code>obj</code> if <code>obj</code> evaluates to a true
value and it is an error if <code>obj</code> evaluates to a false value.</p>
</div>
<div class="paragraph">
<p>When <strong><em>STklos</em></strong> is not in debug mode, the call to <code>assume</code> is elided.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(version-alist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function returns an association list of STklos properties as defined by
<strong><a href="http://srfi.schemers.org/srfi-176/srfi-176.html">SRFI-176</a></strong> (<em>Version flag</em>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(apropos obj)</code></strong><br>
<strong><code>(apropos obj module)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Apropos</code> returns a list of symbols whose print name contains the
characters of <code>obj</code> as a substring . The given <code>obj</code> can be a string or
symbol. This function returns the list of matched symbols which can
be accessed from the given <code>module</code> (defaults to the current module if not
provided).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(help obj)</code></strong><br>
<strong><code>(help)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When called with an argument, <code>help</code> tries to give some help on the
given object, which could be a symbol, a procedure, a generic function
or a method. Whe called called without arguments, <code>help</code> enters a
read-help-print loop. The documentation for an object is searched in
the object itself or, if absent, in STklos documentation.  Inserting
the documentation in an objet is very similar to Emacs docstrings: a
documentation string is defined among the code. Exemples of such
strings are given below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">foo</span> <span class="nv">n</span><span class="p">)</span>
  <span class="s">"If the function body starts with a string, it's a docstring"</span>
  <span class="p">(</span><span class="nb">+</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-generic</span> <span class="nv">bar</span>
  <span class="nv">:documentation</span> <span class="s">"Generic function docsting for bar"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">bar</span> <span class="p">((</span><span class="nf">x</span> <span class="nv">&lt;integer&gt;</span><span class="p">))</span>
  <span class="s">"Probably less useful: as in functions, methods can have docstrings"</span>
  <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(describe obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Shows a brief description of <code>obj</code>. If the object is structured
such as a struct, class or instance, some information about its
internal structure will be shown.</p>
</div>
<div class="paragraph">
<p><strong>Using <code>describe</code> on simple values</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">describe</span> <span class="mi">5</span><span class="p">)</span>
  <span class="mi">5</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">integer</span><span class="o">.</span>

<span class="p">(</span><span class="nf">describe</span> <span class="mf">5.4</span><span class="p">)</span>
  <span class="mf">5.4</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">real</span><span class="o">.</span>

<span class="p">(</span><span class="nf">describe</span> <span class="mi">2</span><span class="nv">+3i</span><span class="p">)</span>
  <span class="mi">2</span><span class="nv">+3i</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">complex</span> <span class="nv">number</span><span class="o">.</span>

<span class="p">(</span><span class="nf">describe</span> <span class="sc">#\A</span><span class="p">)</span>
  <span class="sc">#\A</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">character,</span> <span class="nv">ascii</span> <span class="nv">value</span> <span class="nv">is</span> <span class="mi">65</span><span class="o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Using `describe on a class</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">describe</span> <span class="nv">&lt;integer&gt;</span><span class="p">)</span>
  <span class="nv">&lt;integer&gt;</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">class</span><span class="o">.</span> <span class="nv">It</span><span class="ss">'s</span> <span class="nv">an</span> <span class="nv">instance</span> <span class="nv">of</span> <span class="nv">&lt;class&gt;</span><span class="o">.</span>
  <span class="nv">Superclasses</span> <span class="nv">are:</span>
      <span class="nv">&lt;rational&gt;</span>
  <span class="p">(</span><span class="nf">No</span> <span class="nv">direct</span> <span class="nv">slot</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">No</span> <span class="nv">direct</span> <span class="nv">subclass</span><span class="p">)</span>
  <span class="nv">Class</span> <span class="nv">Precedence</span> <span class="nv">List</span> <span class="nv">is:</span>
      <span class="nv">&lt;integer&gt;</span>
      <span class="nv">&lt;rational&gt;</span>
      <span class="nv">&lt;real&gt;</span>
      <span class="nv">&lt;complex&gt;</span>
      <span class="nv">&lt;number&gt;</span>
      <span class="nv">&lt;top&gt;</span>
  <span class="p">(</span><span class="nf">No</span> <span class="nv">direct</span> <span class="nv">method</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Using <code>describe</code> on structures</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-struct</span> <span class="nv">person</span> <span class="nv">name</span> <span class="nv">email</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">one</span> <span class="p">(</span><span class="nf">make-person</span> <span class="s">"Some One"</span> <span class="s">"one@domain.org"</span><span class="p">))</span>

<span class="p">(</span><span class="nf">describe</span> <span class="nv">person</span><span class="p">)</span>
  <span class="o">#</span><span class="p">[</span><span class="nf">struct-type</span> <span class="nv">person</span> <span class="mi">139786494092352</span><span class="p">]</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">structure</span> <span class="nv">type</span> <span class="nv">whose</span> <span class="nv">name</span> <span class="nv">is</span> <span class="nv">person</span><span class="o">.</span>
  <span class="nv">Parent</span> <span class="nv">structure</span> <span class="nv">type:</span> <span class="no">#f</span>
  <span class="nv">Slots</span> <span class="nv">are:</span>
       <span class="nv">name</span>
       <span class="nv">email</span>

<span class="p">(</span><span class="nf">describe</span> <span class="nv">one</span><span class="p">)</span>
  <span class="o">#</span><span class="p">[</span><span class="nf">struct</span> <span class="nv">person</span> <span class="mi">139786494288064</span><span class="p">]</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">instance</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">structure</span> <span class="nv">type</span> <span class="nv">person</span><span class="o">.</span>
  <span class="nv">Slots</span> <span class="nv">are:</span>
       <span class="nv">name</span> <span class="nv">=</span> <span class="s">"Some One"</span>
       <span class="nv">email</span> <span class="nv">=</span> <span class="s">"one@domain.org"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(trace f-name &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Invoking <code>trace</code> with one or more function names causes the functions
named to be traced. Henceforth, whenever such a function is invoked,
information about the call and the returned values, if any, will be
printed on the current error port.</p>
</div>
<div class="paragraph">
<p>Calling <code>trace</code> with no argument returns the list of traced functions.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(untrace f-name &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Invoking <code>untrace</code> with one or more function names causes the functions
named not to be traced anymore.</p>
</div>
<div class="paragraph">
<p>Calling <code>untrace</code> with no argument will untrace all the functions
currently traced.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(pretty-print sexpr :key port width)</code></strong><br>
<strong><code>(pp sexpr :key port width)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function tries to obtain a pretty-printed representation of <code>sexpr</code>.
The pretty-printed form is written on <code>port</code> with lines which are no
more long than <code>width</code> characters. If <code>port</code> is omitted if defaults to
the current error port. As a special convention, if <code>port</code> is <code>#t</code>,
output goes to the current output port and if <code>port</code> is <code>#f</code>, the output
is returned as a string by <code>pretty-print</code>.
Note that <code>pp</code> is another name for <code>pretty-print</code>.</p>
</div>
<div id="ansicolor" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ansi-color e1 e2 &#8230;&#8203; en)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>ansi-color</code> permits to build a string which embeds ANSI codes to
colorize texts on a terminal. Each expression e<sub>i</sub> must be a string,
a symbol or an integer.</p>
</div>
<div class="paragraph">
<p>Strings constitute the message to be displayed.</p>
</div>
<div class="paragraph">
<p>A symbol can designate</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a color in the set {<code>black</code>, <code>red</code>, <code>green</code>, <code>yellow</code>, <code>blue</code>,
<code>magenta</code>, <code>cyan</code>, <code>white</code>} for foreground colors</p>
</li>
<li>
<p>a color in the set {<code>bg-black</code>, <code>bg-red</code>, <code>bg-green</code>, <code>bg-yellow</code>,
<code>bg-blue</code>, <code>bg-magenta</code>, <code>bg-cyan</code>, <code>bg-white</code>} for background colors.</p>
</li>
<li>
<p>a qualifier such as <code>normal</code>, <code>bold</code>, <code>italic</code>, <code>underline</code>, <code>blink</code>,
<code>reverse</code> or <code>no-bold</code>, <code>no-italic</code>, <code>no-underline</code>, <code>no-blink</code>,
<code>no-reverse</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Integer values can be used for terminals which are able to display  256 colors.
If the number is positive, it is used as a foreground color. Otherwise,
it is uses as a background color. Note that not all the terminals are able to
use more than eight colors.</p>
</div>
<div class="paragraph">
<p>For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">display</span> <span class="p">(</span><span class="nf">ansi-color</span> <span class="s">"a word in "</span>
                     <span class="ss">'bold</span> <span class="ss">'red</span> <span class="s">"RED"</span> <span class="ss">'normal</span>
                     <span class="s">" and another in "</span>
                     <span class="ss">'reverse</span> <span class="ss">'blue</span> <span class="s">"BLUE"</span> <span class="ss">'normal</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will display the words BLUE and RED in color.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(disassemble proc)</code></strong><br>
<strong><code>(disassemble proc port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function prints on the given port (by default the current output
port) the instructions of procedure <code>proc</code>. The printed code uses an
<em>ad-hoc</em> instruction set that should be quite understandable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">fact</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
      <span class="mi">1</span>
      <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">fact</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The call <code>(disassemble fact)</code> will produce the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="mi">000</span><span class="nv">:</span>  <span class="nv">LOCAL-REF0-PUSH</span>
   <span class="mi">001</span><span class="nv">:</span>  <span class="nv">SMALL-INT</span>            <span class="mi">2</span>
   <span class="mi">003</span><span class="nv">:</span>  <span class="nv">JUMP-NUMGE</span>           <span class="mi">2</span>  <span class="c1">;; ==&gt; 007</span>
   <span class="mi">005</span><span class="nv">:</span>  <span class="nv">IM-ONE</span>
   <span class="mi">006</span><span class="nv">:</span>  <span class="nv">RETURN</span>
   <span class="mi">007</span><span class="nv">:</span>  <span class="nv">LOCAL-REF0-PUSH</span>
   <span class="mi">008</span><span class="nv">:</span>  <span class="nv">PREPARE-CALL</span>
   <span class="mi">009</span><span class="nv">:</span>  <span class="nv">LOCAL-REF0</span>
   <span class="mi">010</span><span class="nv">:</span>  <span class="nv">IN-SINT-ADD2</span>         <span class="mi">-1</span>
   <span class="mi">012</span><span class="nv">:</span>  <span class="nv">PUSH-GREF-INVOKE</span>     <span class="mi">0</span> <span class="mi">1</span>
   <span class="mi">015</span><span class="nv">:</span>  <span class="nv">IN-MUL2</span>
   <span class="mi">016</span><span class="nv">:</span>  <span class="nv">RETURN</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The code of a procedure may be patched after the first execution
of <code>proc</code> to optimize it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>proc</code> is an anonymous function, you can use the special
notation <code>#pxxx</code> to disassemble it:
*</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">disassemble</span> <span class="o">#</span><span class="nv">p7fee1dd82f80</span><span class="p">)</span>  <span class="c1">;; (address-of (lambda() 42))</span>

      <span class="mi">000</span><span class="nv">:</span>  <span class="nv">SMALL-INT</span>            <span class="mi">42</span>
      <span class="mi">002</span><span class="nv">:</span>  <span class="nv">RETURN</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(disassemble-expr sexpr)</code></strong><br>
<strong><code>(disassemble-expr sexpr show-consts)</code></strong><br>
<strong><code>(disassemble-expr sexpr show-consts port)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This function prints on the given <code>port</code> (by default the current output
port) the instructions of the given <code>sexpr</code>. If <code>show-consts</code> is true,
the table of the contants used in <code>sexpr</code> is also printed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">disassemble-expr</span> <span class="o">'</span><span class="p">(</span><span class="k">begin</span>
                      <span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">y</span> <span class="mi">10</span><span class="p">))</span>
                      <span class="p">(</span><span class="nb">cons</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
                    <span class="no">#t</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="mi">000</span><span class="nv">:</span>  <span class="nv">GLOBAL-REF</span>           <span class="mi">0</span>
<span class="mi">002</span><span class="nv">:</span>  <span class="nv">IN-SINT-ADD2</span>         <span class="mi">10</span>
<span class="mi">004</span><span class="nv">:</span>  <span class="nv">DEFINE-SYMBOL</span>        <span class="mi">1</span>
<span class="mi">006</span><span class="nv">:</span>  <span class="nv">GLOBAL-REF-PUSH</span>      <span class="mi">1</span>
<span class="mi">008</span><span class="nv">:</span>  <span class="nv">GLOBAL-REF</span>           <span class="mi">0</span>
<span class="mi">010</span><span class="nv">:</span>  <span class="nv">IN-CONS</span>
<span class="mi">011</span><span class="nv">:</span>

<span class="nv">Constants:</span>
<span class="mi">0</span><span class="nv">:</span> <span class="nv">y</span>
<span class="mi">1</span><span class="nv">:</span> <span class="nv">x</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(uri-parse str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Parses the string <code>str</code> as an RFC-2396 URI and return a keyed list with the
following components</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scheme</code> : the scheme used as a string (defaults to <code>"file"</code>)</p>
</li>
<li>
<p><code>user</code>: the user information (generally expressed as <code>login:password</code>)</p>
</li>
<li>
<p><code>host</code> : the host as a string (defaults to "")</p>
</li>
<li>
<p><code>port</code> : the port as an integer (0 if no port specified)</p>
</li>
<li>
<p><code>path</code> : the path</p>
</li>
<li>
<p><code>query</code> : the qury part of the URI as a string (defaults to the
empty string)</p>
</li>
<li>
<p><code>fragment</code> : the fragment of the URI as a string (defaults to the
empty string)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">uri-parse</span> <span class="s">"http://google.com"</span><span class="p">)</span>
   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:scheme</span> <span class="s">"http"</span> <span class="nv">:user</span> <span class="s">""</span> <span class="nv">:host</span> <span class="s">"google.com"</span> <span class="nv">:port</span> <span class="mi">80</span>
        <span class="nv">:path</span> <span class="s">"/"</span> <span class="nv">:query</span> <span class="s">""</span> <span class="nv">:fragment</span> <span class="s">""</span><span class="p">)</span>

<span class="p">(</span><span class="nf">uri-parse</span> <span class="s">"http://stklos.net:8080/a/file?x=1;y=2#end"</span><span class="p">)</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:scheme</span> <span class="s">"http"</span> <span class="nv">:user</span> <span class="s">""</span> <span class="nv">:host</span> <span class="s">"stklos.net"</span> <span class="nv">:port</span> <span class="mi">8080</span>
        <span class="nv">:path</span> <span class="s">"/a/file"</span> <span class="nv">:query</span> <span class="s">"x=1;y=2"</span> <span class="nv">:fragment</span> <span class="s">"end"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">uri-parse</span> <span class="s">"http://foo:secret@stklos.net:2000/a/file"</span><span class="p">)</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:scheme</span> <span class="s">"http"</span> <span class="nv">:user</span> <span class="s">"foo:secret"</span> <span class="nv">:host</span> <span class="s">"stklos.net"</span>
        <span class="nv">:port</span> <span class="mi">2000</span>  <span class="nv">:path</span> <span class="s">"/a/file"</span> <span class="nv">:query</span> <span class="s">""</span> <span class="nv">:fragment</span> <span class="s">""</span><span class="p">)</span>

<span class="p">(</span><span class="nf">uri-parse</span> <span class="s">"/a/file"</span><span class="p">)</span>
   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:scheme</span> <span class="s">"file"</span> <span class="nv">:user</span> <span class="s">""</span> <span class="nv">:host</span> <span class="s">""</span> <span class="nv">:port</span> <span class="mi">0</span> <span class="nv">:path</span> <span class="s">"/a/file"</span>
       <span class="nv">:query</span> <span class="s">""</span> <span class="nv">:fragment</span> <span class="s">""</span><span class="p">)</span>

<span class="p">(</span><span class="nf">uri-parse</span> <span class="s">""</span><span class="p">)</span>
   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">:scheme</span> <span class="s">"file"</span>  <span class="nv">:user</span> <span class="s">""</span> <span class="nv">:host</span> <span class="s">""</span> <span class="nv">:port</span> <span class="mi">0</span> <span class="nv">:path</span> <span class="s">""</span>
       <span class="nv">:query</span> <span class="s">""</span> <span class="nv">:fragment</span> <span class="s">""</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;html str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This primitive is a convenience function; it returns a string where
the HTML special chars are properly translated. It can easily be written
in Scheme, but this version is fast.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">string-&gt;html</span> <span class="s">"Just a &lt;test&gt;"</span><span class="p">)</span>
   <span class="nv">=&gt;</span> <span class="s">"Just a &amp;lt;test&amp;gt;"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(md5sum obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a string contening the md5 sum of <code>obj</code>. The given parameter can
be a string or an open input port.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(md5sum-file str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a string contening the md5 sum of the file whose name is <code>str</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(base64-encode in)</code></strong><br>
<strong><code>(base64-encode in out)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Encode in Base64 the characters from input port <code>in</code> to the output port
<code>out</code>. If <code>out</code> is not specified, it defaults to the current output port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-input-from-string</span> <span class="s">"Hello"</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">with-output-to-string</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nf">base64-encode</span> <span class="p">(</span><span class="nb">current-input-port</span><span class="p">))))))</span> <span class="nv">=&gt;</span> <span class="s">"SGVsbG8="</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(base64-decode in)</code></strong><br>
<strong><code>(base64-decode in out)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Decode the Base64 characters from input port <code>in</code> to the output port
<code>out</code>. If <code>out</code> is not specified, it defaults to the current output port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-input-from-string</span> <span class="s">"SGVsbG8="</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">with-output-to-string</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
        <span class="p">(</span><span class="nf">base64-decode</span> <span class="p">(</span><span class="nb">current-input-port</span><span class="p">))))))</span>  <span class="nv">=&gt;</span> <span class="s">"Hello"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(base64-encode-string str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a string contening the contents of <code>str</code> converted to Base64
encoded format.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(base64-encode-string str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Decode the contents of <code>str</code> expressed in Base64.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_regular_expressions">5. Regular Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>

<strong><em>STklos</em></strong> uses the Philip Hazel&#8217;s Perl-compatible Regular Expression (PCRE)
library for implementing regexps <a href="#PCRE">[PCRE]</a>.  Consequently, the <strong><em>STklos</em></strong> regular
expression syntax is the same as PCRE, and Perl by the way.</p>
</div>
<div class="paragraph">
<p>The following text is extracted from the PCRE package. However, to make things
shorter, some of the original documentation as not been reported here. In
particular some possibilities of PCRE have been completely occulted (those
whose description was too long and which seems (at least to me), not too
important). Read the documentation provided with PCRE for a complete
description \footnote{The latest release of PCRE is available from
<a href="http://www.pcre.org/" class="bare">http://www.pcre.org/</a>.</p>
</div>
<div class="paragraph">
<p>A regular expression is a pattern that is matched against a subject string
from left to right. Most characters stand for themselves in a pattern, and
match the corresponding characters in the subject. As a trivial example, the
pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>The quick brown fox</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches a portion of a subject string that is identical to itself.  The power
of regular expressions comes from the ability to include alternatives and
repetitions in the pattern. These are encoded in the pattern by the use of
<em>meta-characters</em>, which do not stand for themselves but instead are
interpreted in some special way.</p>
</div>
<div class="paragraph">
<p>There are two different sets of meta-characters: those that are recognized
anywhere in the pattern except within square brackets, and those that are
recognized in square brackets. Outside square brackets, the meta-characters
are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general escape character with several uses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert start of subject (or line, in multiline mode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert end of subject (or line, in multiline mode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">match any character except newline (by default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start character class definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start of alternative branch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start subpattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">end subpattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends the meaning of '('<br>
also 0 or 1 quantifier<br>
also quantifier minimizer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 or more quantifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 or more quantifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start min/max quantifier</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Part of a pattern that is in square brackets is called a "character
class". In a character class the only meta-characters are:</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general escape character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">negate the class, but only if the first character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates character range</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POSIX character class (only if followed by POSIX syntax)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">terminates the character class</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following sections describe the use of each of the meta-characters.</p>
</div>
<div class="sect2">
<h3 id="_backslash">5.1. Backslash</h3>
<div class="paragraph">
<p>The backslash character has several uses. Firstly, if it is followed by a
non-alphameric character, it takes away any special meaning that character may
have. This use of backslash as an escape character applies both inside and
outside character classes.</p>
</div>
<div class="paragraph">
<p>For example, if you want to match a <code><strong></code> character, you write
<code>\</strong></code> in the pattern.  This escaping action applies whether or not
the following character would otherwise be interpreted as a
meta-character, so it is always safe to precede a non-alphameric
with backslash to specify that it stands for itself. In
particular, if you want to match a backslash, you write <code>\\</code>.</p>
</div>
<div class="paragraph">
<p>If you want to remove the special meaning from a sequence of characters, you
can do so by putting them between <code>\Q</code> and <code>\E</code>. This is different from Perl
in that <code>$</code> and <code>@</code> are handled as literals in <code>\Q</code>&#8230;&#8203;<code>\E</code> sequences in PCRE,
whereas in Perl, <code>`$</code> and <code>@</code> cause variable interpolation. Note the following
examples:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pattern</th>
<th class="tableblock halign-left valign-top">PCRE matches</th>
<th class="tableblock halign-left valign-top">Perl matches</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\Qabc$xyz\E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc$xyz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc followed by the contents of $xyz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\Qabc\$xyz\E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc\$xyz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc\$xyz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\Qabc\E\$\Qxyz\E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc$xyz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abc$xyz</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>\Q&#8230;&#8203;\E</code> sequence is recognized both inside and outside character
classes.</p>
</div>
<div class="paragraph">
<p>A second use of backslash provides a way of encoding non-printing
characters in patterns in a visible manner. There is no restriction on
the appearance of non-printing characters, apart from the binary zero
that terminates a pattern, but when a pattern is being prepared by
text editing, it is usually easier to use one of the following escape
sequences than the binary character it represents:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alarm, that is, the BEL character (hex 07)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\cx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>control-x</em>, where x is any character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">escape (hex 1B)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">formfeed (hex 0C)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newline (hex 0A)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carriage return (hex 0D)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tab (hex 09)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\ddd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">character with octal code ddd, or backreference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\xhh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">character with hex code hh</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The precise effect of <code>\x</code> is as follows: if <code>x</code> is a lower case
letter, it is converted to upper case. Then bit 6 of the character
(hex 40) is inverted.  Thus <code>\cz</code> becomes hex 1A, but <code>\c{</code> becomes
hex 3B, while <code>\c;</code> becomes hex 7B.</p>
</div>
<div class="paragraph">
<p>The handling of a backslash followed by a digit other than 0 is
complicated.  Outside a character class, PCRE reads it and any
following digits as a decimal number. If the number is less than 10,
or if there have been at least that many previous capturing left
parentheses in the expression, the entire sequence is taken as a <em>back
reference</em>. A description of how this works is given later, following
the discussion of parenthesized subpatterns.</p>
</div>
<div class="paragraph">
<p>The third use of backslash is for specifying generic character types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any decimal digit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any character that is not a decimal digit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any whitespace character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any character that is not a whitespace character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any <em>word</em> character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any <em>non-word</em> character</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each pair of escape sequences partitions the complete set of
characters into two disjoint sets. Any given character matches one,
and only one, of each pair.</p>
</div>
<div class="paragraph">
<p>For compatibility with Perl, <code>\s</code> does not match the VT character
(code 11).  This makes it different from the the POSIX "space"
class. The <code>\s</code> characters are HT (9), LF (10), FF (12), CR (13), and
space (32).</p>
</div>
<div class="paragraph">
<p>A <em>word</em> character is any letter or digit or the underscore character,
that is, any character which can be part of a Perl <em>word</em>. The
definition of letters and digits is controlled by PCRE&#8217;s character
tables, and may vary if locale-specific matching is taking place.  For
example, in the "fr" (French) locale, some character codes greater
than 128 are used for accented letters, and these are matched by <code>\w</code>.</p>
</div>
<div class="paragraph">
<p>These character type sequences can appear both inside and outside
character classes. They each match one character of the appropriate
type. If the current matching point is at the end of the subject
string, all of them fail, since there is no character to match.</p>
</div>
<div class="paragraph">
<p>The fourth use of backslash is for certain simple assertions. An
assertion specifies a condition that has to be met at a particular
point in a match, without consuming any characters from the subject
string. The use of subpatterns for more complicated assertions is
described below. The backslashed assertions are</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches at a word boundary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches when not at a word boundary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches at start of subject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\Z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches at end of subject or before newline at end</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches at end of subject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches at first matching position in subject</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These assertions may not appear in character classes (but note that
<code>\b</code> has a different meaning, namely the backspace character, inside a
character class).</p>
</div>
<div class="paragraph">
<p>A word boundary is a position in the subject string where the current
character and the previous character do not both match <code>\w</code>
or <code>\W</code> (i.e. one matches <code>\w</code> and the other matches
<code>\W</code>), or the start or end of the string if the first or last
character matches <code>\w</code>, respectively.</p>
</div>
<div class="paragraph">
<p>The <code>\A</code>, <code>\Z</code>, and <code>\z</code> assertions differ from the traditional
circumflex and dollar (described below) in that they only ever match
at the very start and end of the subject string, whatever options
are set. Thus, they are independent of multiline mode.</p>
</div>
<div class="paragraph">
<p>The backslash character has several uses. Firstly, if it is followed by
a non-alphameric character, it takes away any special meaning that
character may have. This use of backslash as an escape character applies
both inside and outside character classes.</p>
</div>
<div class="paragraph">
<p>For example, if you want to match a "*" character, you write "\\*"
in the pattern. This applies whether or not the following character
would otherwise be interpreted as a meta-character, so it is always
safe to precede a non-alphameric with &#8220;\&#8221; to specify that it stands
for itself. In particular, if you want to match a backslash, you write
&#8220;\\&#8221;.</p>
</div>
</div>
<div class="sect2">
<h3 id="_circumflex_and_dollar">5.2. Circumflex and Dollar</h3>
<div class="paragraph">
<p>Outside a character class, in the default matching mode, the
circumflex character is an assertion which is true only if the current
matching point is at the start of the subject string. Inside a
character class, circumflex has an entirely different meaning (see
below).</p>
</div>
<div class="paragraph">
<p>Circumflex need not be the first character of the pattern if a number
of alternatives are involved, but it should be the first thing in each
alternative in which it appears if the pattern is ever to match that
branch. If all possible alternatives start with a circumflex, that is,
if the pattern is constrained to match only at the start of the
subject, it is said to be an "anchored" pattern. (There are also other
constructs that can cause a pattern to be anchored.)</p>
</div>
<div class="paragraph">
<p>A dollar character is an assertion which is true only if the current
matching point is at the end of the subject string, or immediately
before a newline character that is the last character in the string
(by default). Dollar need not be the last character of the pattern if
a number of alternatives are involved, but it should be the last item
in any branch in which it appears.  Dollar has no special meaning in a
character class.</p>
</div>
<div class="paragraph">
<p>The meanings of the circumflex and dollar characters are changed if
the <em>multiline</em> option is set. When this is the case, they match
immediately after and immediately before an internal newline
character, respectively, in addition to matching at the start and end
of the subject string. For example, the pattern <code>^abc$</code> matches the
subject string <code>"def\nabc"</code> in multiline mode, but not otherwise.</p>
</div>
<div class="paragraph">
<p>Note that the sequences <code>\A</code>, <code>\Z</code>, and <code>\z</code> can be used to match the
start and end of the subject in both modes, and if all branches of a
pattern start with <code>\A</code> it is always anchored, whether
<em>multiline</em> is set or not.</p>
</div>
</div>
<div class="sect2">
<h3 id="_full_stop_period_dot">5.3. Full Stop (period, dot)</h3>
<div class="paragraph">
<p>Outside a character class, a dot in the pattern matches any
one character in the subject, including a non-printing character,
but not (by default) newline. If the <em>dotall</em> option is
set, dots match newlines as well. The handling of dot is entirely
independent of the handling of circumflex and dollar, the only
relationship being that they both involve newline characters. Dot
has no special meaning in a character class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_square_brackets">5.4. Square Brackets</h3>
<div class="paragraph">
<p>An opening square bracket introduces a character class,
terminated by a closing square bracket. A closing square bracket
on its own is not special. If a closing square bracket is
required as a member of the class, it should be the first data
character in the class (after an initial circumflex, if present)
or escaped with a backslash.</p>
</div>
<div class="paragraph">
<p>A character class matches a single character in the
subject. A matched character must be in the set of characters
defined by the class, unless the first character in the class
definition is a circumflex, in which case the subject character
must not be in the set defined by the class. If a circumflex is
actually required as a member of the class, ensure it is not the
first character, or escape it with a backslash.</p>
</div>
<div class="paragraph">
<p>For example, the character class <code>[aeiou]</code> matches any lower case
vowel, while <code>[^aeiou]</code> matches any character that is not a lower case
vowel. Note that a circumflex is just a convenient notation for
specifying the characters which are in the class by enumerating those
that are not. It is not an assertion: it still consumes a character
from the subject string, and fails if the current pointer is at the
end of the string.</p>
</div>
<div class="paragraph">
<p>When caseless matching is set, any letters in a class represent both
their upper case and lower case versions, so for example, a caseless
<code>[aeiou]</code> matches "A" as well as "a", and a caseless <code>[^aeiou]</code>
does not match "A", whereas a caseful version would.</p>
</div>
<div class="paragraph">
<p>The newline character is never treated in any special way in character classes,
whatever the setting of the <em>dotall</em> or <em>multiline</em> options is. A class
such as <code>[^a]</code> will always match a newline.</p>
</div>
<div class="paragraph">
<p>The minus (hyphen) character can be used to specify a range of characters in a
character class. For example, [d-m] matches any letter between d and m,
inclusive. If a minus character is required in a class, it must be escaped with
a backslash or appear in a position where it cannot be interpreted as
indicating a range, typically as the first or last character in the class.</p>
</div>
<div class="paragraph">
<p>It is not possible to have the literal character "]" as the end
character of a range. A pattern such as <code>[W-]46]</code> is interpreted as a
class of two characters ("W" and "-") followed by a literal string
"46]", so it would match "W46]" or "-46]". However, if the "]" is
escaped with a backslash it is interpreted as the end of range, so
<code>(W\]46)</code> is interpreted as a single class containing a range followed
by two separate characters. The octal or hexadecimal representation of
"]" can also be used to end a range.</p>
</div>
<div class="paragraph">
<p>Ranges operate in the collating sequence of character values. They can also be
used for characters specified numerically, for example <code>[\000-\037]</code>.</p>
</div>
<div class="paragraph">
<p>If a range that includes letters is used when caseless matching is set, it
matches the letters in either case. For example, <code>[W-c]</code> is equivalent to
<code>[][^_`wxyzabc]</code>, matched caselessly, and if character tables for the "fr"
locale are in use, <code>[\xc8-\xcb]</code> matches accented E characters in both cases.</p>
</div>
<div class="paragraph">
<p>The character types <code>\d</code>, <code>\D</code>, <code>\s</code>, <code>\S</code>, '\w`, and <code>\W</code> may also appear in a
character class, and add the characters that they match to the class. For
example, <code>[\dABCDEF]</code> matches any hexadecimal digit. A circumflex can
conveniently be used with the upper case character types to specify a more
restricted set of characters than the matching lower case type. For example,
the class <code>[^\W_]</code> matches any letter or digit, but not underscore.</p>
</div>
<div class="paragraph">
<p>All non-alphameric characters other than <code>\</code>, <code>-</code>, <code>^</code> (at the start) and the
terminating <code>]</code> are non-special in character classes, but it does no harm if they
are escaped.</p>
</div>
</div>
<div class="sect2">
<h3 id="_posix_character_classes">5.5. POSIX character classes</h3>
<div class="paragraph">
<p>Perl supports the POSIX notation for character classes, which
uses names enclosed by [: and :] within the enclosing square
brackets. <strong><em>STklos</em></strong> , thanks to PCRE, also supports this
notation. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[01[:alpha:]%]</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "0", "1", any alphabetic character, or "%". The supported
class names are</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alnum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">letters and digits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alpha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">letters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ascii</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">character codes 0 - 127</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">space or tab only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cntrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">control characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decimal digits (same as \d</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">graph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">printing characters, excluding space</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lower</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lower case letters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">printing characters, including space</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">punct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">printing characters, excluding letters and digits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">white space (not quite the same as \s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">upper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">upper case letters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">word"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>word</em> characters (same as \w)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xdigit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hexadecimal digits</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <em>space</em> characters are HT (9), LF (10), VT (11), FF (12), CR (13), and
space (32). Notice that this list includes the VT character (code 11). This
makes "space" different to $\backslash$s, which does not include VT (for Perl
compatibility).</p>
</div>
<div class="paragraph">
<p>The name <em>word</em> is a Perl extension, and <em>blank</em> is a GNU extension from Perl
5.8. Another Perl extension is negation, which is indicated by a <code>^</code> character
after the colon. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[12[:^digit:]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "1", "2", or any non-digit. <strong><em>STklos</em></strong> (and Perl) also
recognize the POSIX syntax <code>[.ch.]</code> and <code>[=ch=]</code> where "ch" is a
"collating element", but these are not supported, and an error is
given if they are encountered.</p>
</div>
</div>
<div class="sect2">
<h3 id="_vertical_bar">5.6. Vertical Bar</h3>
<div class="paragraph">
<p>Vertical bar characters are used to separate alternative patterns. For example,
the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>gilbert|sullivan</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches either "gilbert" or "sullivan". Any number of alternatives may appear,
and an empty alternative is permitted (matching the empty string).
The matching process tries each alternative in turn, from left to right,
and the first one that succeeds is used. If the alternatives are within a
subpattern (defined below), "succeeds" means matching the rest of the main
pattern as well as the alternative in the subpattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_internal_option_setting">5.7. Internal Option Setting</h3>
<div class="paragraph">
<p>The settings of the <em>caseless</em>, <em>multiline</em>, <em>dotall</em>, and
<em>EXTENDED</em> options can be changed from within the pattern by a sequence of
Perl option letters enclosed between "(?" and ")". The option letters are</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for <em>caseless</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for <em>multiline</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for <em>dotall</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for <em>extended</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, <code>(?im)</code> sets <em>caseless</em>, <em>multiline matching</em>. It is also possible to
unset these options by preceding the letter with a hyphen, and a combined
setting and unsetting such as <code>(?im-sx)</code>, which sets <em>caseless</em> and
<em>multiline</em> while unsetting <em>dotall</em> and <em>extended</em>, is also
permitted. If a letter appears both before and after the hyphen, the option is
unset.</p>
</div>
<div class="paragraph">
<p>When an option change occurs at top level (that is, not inside subpattern
parentheses), the change applies to the remainder of the pattern that follows.
If the change is placed right at the start of a pattern, PCRE extracts it into
the global options</p>
</div>
<div class="paragraph">
<p>An option change within a subpattern affects only that part of the current
pattern that follows it, so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(a(?i)b)c</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches <code>abc</code> and <code>aBc</code> and no other strings (assuming <em>caseless</em> is
not used).By this means, options can be made to have different
settings in different parts of the pattern. Any changes made in one
alternative do carry on into subsequent branches within the same
subpattern. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(a(?i)b|c)</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "ab", "aB", "c", and "C", even though when matching "C" the first
branch is abandoned before the option setting. This is because the effects of
option settings happen at compile time. There would be some very weird
behaviour otherwise.</p>
</div>
<div class="paragraph">
<p>The PCRE-specific options <em>ungreedy</em> and <em>extra</em> can be changed in
the same way as the Perl-compatible options by using the characters
<code>U</code> and <code>X</code> respectively. The <code>(?X)</code> flag setting is special in that
it must always occur earlier in the pattern than any of the additional
features it turns on, even when it is at top level. It is best put at
the start.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subpatterns">5.8. Subpatterns</h3>
<div class="paragraph">
<p>Subpatterns are delimited by parentheses (round brackets), which can be nested.
Marking part of a pattern as a subpattern does two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It localizes a set of alternatives. For example, the pattern\</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>cat(aract|erpillar|)</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches one of the words "cat", "cataract", or "caterpillar". Without the
parentheses, it would match "cataract", "erpillar" or the empty string.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It sets up the subpattern as a capturing subpattern (as
defined above).  When the whole pattern matches, that portion of
the subject string that matched the subpattern is set so that it
can be used in the regexp-replace or
regexp-replace-all functions. Opening parentheses
are counted from left to right (starting from 1) to obtain the
numbers of the capturing subpatterns.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if the string "the red king" is matched against the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>the ((red|white) (king|queen))</code></pre>
</div>
</div>
<div class="paragraph">
<p>the captured substrings are "red king", "red", and "king", and are numbered 1,
2, and 3, respectively.</p>
</div>
<div class="paragraph">
<p>The fact that plain parentheses fulfil two functions is not always helpful.
There are often times when a grouping subpattern is required without a
capturing requirement. If an opening parenthesis is followed by a question mark
and a colon, the subpattern does not do any capturing, and is not counted when
computing the number of any subsequent capturing subpatterns. For example, if
the string "the white queen" is matched against the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>the ((?:red|white) (king|queen))</code></pre>
</div>
</div>
<div class="paragraph">
<p>the captured substrings are "white queen" and "queen", and are
numbered 1 and 2. The maximum number of capturing subpatterns is
65535, and the maximum depth of nesting of all subpatterns, both
capturing and non-capturing, is 200.</p>
</div>
<div class="paragraph">
<p>As a convenient shorthand, if any option settings are required at the
start of a non-capturing subpattern, the option letters may appear
between the "?" and the ":".<br>
Thus the two patterns</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?i:saturday|sunday)</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?:(?i)saturday|sunday)</code></pre>
</div>
</div>
<div class="paragraph">
<p>match exactly the same set of strings. Because alternative branches are tried
from left to right, and options are not reset until the end of the subpattern
is reached, an option setting in one branch does affect subsequent branches, so
the above patterns match "SUNDAY" as well as "Saturday".</p>
</div>
</div>
<div class="sect2">
<h3 id="_named_subpatterns">5.9. Named Subpatterns</h3>
<div class="paragraph">
<p>Identifying capturing parentheses by number is simple, but it can be very hard
to keep track of the numbers in complicated regular expressions. Furthermore,
if an expression is modified, the numbers may change. To help with the
difficulty, PCRE supports the naming of subpatterns, something that Perl does
not provide. The Python syntax (?P&lt;name&gt;&#8230;&#8203;) is used. Names consist of
alphanumeric characters and underscores, and must be unique within a pattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_repetition">5.10. Repetition</h3>
<div class="paragraph">
<p>Repetition is specified by quantifiers, which can follow any of the following
items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a literal data character</p>
</li>
<li>
<p>the <code>.</code> metacharacter</p>
</li>
<li>
<p>the <code>\C</code> escape sequence</p>
</li>
<li>
<p>escapes such as <code>\d</code> that match single characters</p>
</li>
<li>
<p>a character class</p>
</li>
<li>
<p>a back reference (see next section)</p>
</li>
<li>
<p>a parenthesized subpattern (unless it is an assertion)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The general repetition quantifier specifies a minimum and maximum
number of permitted matches, by giving the two numbers in curly
brackets (braces), separated by a comma. The numbers must be less than
65536, and the first must be less than or equal to the second. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>z{2,4}</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "zz", "zzz", or "zzzz". A closing brace on its own is not a special
character. If the second number is omitted, but the comma is present, there is
no upper limit; if the second number and the comma are both omitted, the
quantifier specifies an exact number of required matches. Thus</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[aeiou]{3,}</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches at least 3 successive vowels, but may match many more, while</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\d{8}</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches exactly 8 digits. An opening curly bracket that appears in a position
where a quantifier is not allowed, or one that does not match the syntax of a
quantifier, is taken as a literal character. For example, {,6} is not a
quantifier, but a literal string of four characters.</p>
</div>
<div class="paragraph">
<p>The quantifier {0} is permitted, causing the expression to behave as if the
previous item and the quantifier were not present.</p>
</div>
<div class="paragraph">
<p>For convenience (and historical compatibility) the three most common
quantifiers have single-character abbreviations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>*</code>    is equivalent to {0,}</p>
</li>
<li>
<p><code>+</code>    is equivalent to {1,}</p>
</li>
<li>
<p><code>?</code>    is equivalent to {0,1}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to construct infinite loops by following a subpattern that can
match no characters with a quantifier that has no upper limit, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(a?)*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Earlier versions of Perl and PCRE used to give an error at compile time for
such patterns. However, because there are cases where this can be useful, such
patterns are now accepted, but if any repetition of the subpattern does in fact
match no characters, the loop is forcibly broken.</p>
</div>
<div class="paragraph">
<p>By default, the quantifiers are "greedy", that is, they match as much as
possible (up to the maximum number of permitted times), without causing the
rest of the pattern to fail. The classic example of where this gives problems
is in trying to match comments in C programs. These appear between the
sequences <code>/*</code> and <code>*/</code> and within the sequence, individual <code>*</code> and <code>/</code> characters may
appear. An attempt to match C comments by applying the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>/\*.*\*/</code></pre>
</div>
</div>
<div class="paragraph">
<p>to the string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>/* first command */  not comment  /* second comment */</code></pre>
</div>
</div>
<div class="paragraph">
<p>fails, because it matches the entire string owing to the greediness of the <code>.*</code>
item.</p>
</div>
<div class="paragraph">
<p>However, if a quantifier is followed by a question mark, it ceases to be
greedy, and instead matches the minimum number of times possible, so the
pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>/\*.*?*/</code></pre>
</div>
</div>
<div class="paragraph">
<p>does the right thing with the C comments. The meaning of the various
quantifiers is not otherwise changed, just the preferred number of matches.
Do not confuse this use of question mark with its use as a quantifier in its
own right. Because it has two uses, it can sometimes appear doubled, as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\d??\d</code></pre>
</div>
</div>
<div class="paragraph">
<p>which matches one digit by preference, but can match two if that is the only
way the rest of the pattern matches.</p>
</div>
<div class="paragraph">
<p>If the <em>ungreedy</em> option is set (an option which is not available in
Perl), the quantifiers are not greedy by default, but individual ones
can be made greedy by following them with a question mark. In other
words, it inverts the default behaviour.</p>
</div>
<div class="paragraph">
<p>When a parenthesized subpattern is quantified with a minimum repeat
count that is greater than 1 or with a limited maximum, more store is
required for the compiled pattern, in proportion to the size of the
minimum or maximum.</p>
</div>
<div class="paragraph">
<p>If a pattern starts with <code>.*</code> or <code>.{0,}</code> and the <em>dotall</em> option (equivalent
to Perl&#8217;s <code>/s</code>) is set, thus allowing the <code>.</code> to match newlines, the pattern is
implicitly anchored, because whatever follows will be tried against every
character position in the subject string, so there is no point in retrying the
overall match at any position after the first. PCRE normally treats such a
pattern as though it were preceded by <code>\A</code>.</p>
</div>
<div class="paragraph">
<p>In cases where it is known that the subject string contains no newlines, it is
worth setting <em>dotall</em> in order to obtain this optimization, or
alternatively using <code>^</code> to indicate anchoring explicitly.</p>
</div>
<div class="paragraph">
<p>However, there is one situation where the optimization cannot be used. When <code>.*</code>
is inside capturing parentheses that are the subject of a backreference
elsewhere in the pattern, a match at the start may fail, and a later one
succeed. Consider, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(.*)abc\1</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the subject is <code>"xyz123abc123"</code> the match point is the fourth character. For
this reason, such a pattern is not implicitly anchored.</p>
</div>
<div class="paragraph">
<p>When a capturing subpattern is repeated, the value captured is the substring
that matched the final iteration. For example, after</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(tweedle[dume]{3}\s*)+</code></pre>
</div>
</div>
<div class="paragraph">
<p>has matched "tweedledum tweedledee" the value of the captured substring is
"tweedledee". However, if there are nested capturing subpatterns, the
corresponding captured values may have been set in previous iterations. For
example, after</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(a|(b))+</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_atomic_grouping_and_possessive_quantifiers">5.11. Atomic Grouping And Possessive Quantifiers</h3>
<div class="paragraph">
<p>With both maximizing and minimizing repetition, failure of what follows
normally causes the repeated item to be re-evaluated to see if a different
number of repeats allows the rest of the pattern to match. Sometimes it is
useful to prevent this, either to change the nature of the match, or to cause
it fail earlier than it otherwise might, when the author of the pattern knows
there is no point in carrying on.</p>
</div>
<div class="paragraph">
<p>Consider, for example, the pattern <code>\d+foo</code> when applied to the subject line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>123456bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>After matching all 6 digits and then failing to match "foo", the normal
action of the matcher is to try again with only 5 digits matching the <code>\d+</code>
item, and then with 4, and so on, before ultimately failing. "Atomic grouping"
(a term taken from Jeffrey Friedl&#8217;s book) provides the means for specifying
that once a subpattern has matched, it is not to be re-evaluated in this way.</p>
</div>
<div class="paragraph">
<p>If we use atomic grouping for the previous example, the matcher would give up
immediately on failing to match "foo" the first time. The notation is a kind of
special parenthesis, starting with (<code>?&gt;</code> as in this example:)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&gt;\d+)foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>This kind of parenthesis "locks up" the  part of the pattern it contains once
it has matched, and a failure further into the pattern is prevented from
backtracking into it. Backtracking past it to previous items, however, works as
normal.</p>
</div>
<div class="paragraph">
<p>An alternative description is that a subpattern of this type matches the string
of characters that an identical standalone pattern would match, if anchored at
the current point in the subject string.</p>
</div>
<div class="paragraph">
<p>Atomic grouping subpatterns are not capturing subpatterns. Simple
cases such as the above example can be thought of as a maximizing
repeat that must swallow everything it can. So, while both
<code>\d+</code> and <code>\d+?</code> are prepared to adjust the number
of digits they match in order to make the rest of the pattern match,
<code>(?&gt;\d+)</code> can only match an entire sequence of digits.</p>
</div>
<div class="paragraph">
<p>Atomic groups in general can of course contain arbitrarily complicated
subpatterns, and can be nested. However, when the subpattern for an atomic
group is just a single repeated item, as in the example above, a simpler
notation, called a "possessive quantifier" can be used. This consists of an
additional <code>+</code> character following a quantifier. Using this notation, the
previous example can be rewritten as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\d++bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Possessive quantifiers are always greedy; the setting of the <em>ungreedy</em>
option is ignored. They are a convenient notation for the simpler forms of
atomic group. However, there is no difference in the meaning or processing of a
possessive quantifier and the equivalent atomic group.</p>
</div>
<div class="paragraph">
<p>The possessive quantifier syntax is an extension to the Perl syntax. It
originates in Sun&#8217;s Java package.</p>
</div>
<div class="paragraph">
<p>When a pattern contains an unlimited repeat inside a subpattern that can itself
be repeated an unlimited number of times, the use of an atomic group is the
only way to avoid some failing matches taking a very long time indeed. The
pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(\D+|&lt;\d+&gt;)*[!?]</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches an unlimited number of substrings that either consist of non-digits, or
digits enclosed in &lt;&gt;, followed by either ! or ?. When it matches, it runs
quickly. However, if it is applied to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code></pre>
</div>
</div>
<div class="paragraph">
<p>it takes a long time before reporting failure. This is because the string can
be divided between the two repeats in a large number of ways, and all have to
be tried. (The example used <code>[!?]</code> rather than a single character at the end,
because both PCRE and Perl have an optimization that allows for fast failure
when a single character is used. They remember the last single character that
is required for a match, and fail early if it is not present in the string.)
If the pattern is changed to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>((?&gt;\D+)|&lt;\d+&gt;)*[!?]</code></pre>
</div>
</div>
<div class="paragraph">
<p>sequences of non-digits cannot be broken, and failure happens quickly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_back_references">5.12. Back References</h3>
<div class="paragraph">
<p>Outside a character class, a backslash followed by a digit greater than 0 (and
possibly further digits) is a back reference to a capturing subpattern earlier
(that is, to its left) in the pattern, provided there have been that many
previous capturing left parentheses.</p>
</div>
<div class="paragraph">
<p>However, if the decimal number following the backslash is less than
10, it is always taken as a back reference, and causes an error only
if there are not that many capturing left parentheses in the entire
pattern. In other words, the parentheses that are referenced need not
be to the left of the reference for numbers less than 10. See the
section entitled "Backslash" above for further details of the handling
of digits following a backslash.</p>
</div>
<div class="paragraph">
<p>A back reference matches whatever actually matched the capturing
subpattern in the current subject string, rather than anything
matching the subpattern itself (see below for a way of doing that). So
the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(sens|respons)e and \1ibility</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "sense and sensibility" and "response and responsibility", but not
"sense and responsibility". If caseful matching is in force at the time of the
back reference, the case of letters is relevant. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>((?i)rah)\s+\1</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "rah rah" and "RAH RAH", but not "RAH rah", even though the original
capturing subpattern is matched caselessly.</p>
</div>
<div class="paragraph">
<p>Back references to named subpatterns use the Python syntax <code>(?P=name)</code>. We could
rewrite the above example as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;p1&gt;(?i)rah)\s+(?P=p1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There may be more than one back reference to the same subpattern. If a
subpattern has not actually been used in a particular match, any back
references to it always fail. For example, the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(a|(bc))\2</code></pre>
</div>
</div>
<div class="paragraph">
<p>always fails if it starts to match "a" rather than "bc". Because there may be
many capturing parentheses in a pattern, all digits following the backslash are
taken as part of a potential back reference number. If the pattern continues
with a digit character, some delimiter must be used to terminate the back
reference. If the <em>extended</em> option is set, this can be whitespace.
Otherwise an empty comment can be used.</p>
</div>
<div class="paragraph">
<p>A back reference that occurs inside the parentheses to which it refers fails
when the subpattern is first used, so, for example, (a\1) never matches.
However, such references can be useful inside repeated subpatterns. For
example, the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(a|b\1)+</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches any number of "a"s and also "aba", "ababbaa" etc. At each iteration of
the subpattern, the back reference matches the character string corresponding
to the previous iteration. In order for this to work, the pattern must be such
that the first iteration does not need to match the back reference. This can be
done using alternation, as in the example above, or by a quantifier with a
minimum of zero.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assertions">5.13. Assertions</h3>
<div class="paragraph">
<p>An assertion is a test on the characters following or preceding the current
matching point that does not actually consume any characters. The simple
assertions coded as <code>\b</code>, <code>\B</code>, <code>\A</code>, <code>\G</code>, <code>\Z</code>, <code>\z</code>, <code>^</code> and <code>$</code> are described above.
More complicated assertions are coded as subpatterns. There are two kinds:
those that look ahead of the current position in the subject string, and those
that look behind it.</p>
</div>
<div class="paragraph">
<p>An assertion subpattern is matched in the normal way, except that it does not
cause the current matching position to be changed. Lookahead assertions start
with <code>(?=</code> for positive assertions and <code>(?!</code> for negative assertions. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\w+(?=;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches a word followed by a semicolon, but does not include the
semicolon in the match, and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>foo(?!bar)</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches any occurrence of "foo" that is not followed by "bar". Note
that the apparently similar pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?!foo)bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>does not find an occurrence of "bar" that is preceded by something other than
"foo"; it finds any occurrence of "bar" whatsoever, because the assertion
<code>(?!foo)</code> is always true when the next three characters are "bar". A
lookbehind assertion is needed to achieve this effect.</p>
</div>
<div class="paragraph">
<p>If you want to force a matching failure at some point in a pattern, the most
convenient way to do it is with <code>(?!)</code> because an empty string always matches, so
an assertion that requires there not to be an empty string must always fail.</p>
</div>
<div class="paragraph">
<p>Lookbehind assertions start with <code>(?&#8656;</code> for positive assertions and <code>(?&lt;!</code> for
negative assertions. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;!foo)bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>does find an occurrence of "bar" that is not preceded by "foo". The contents of
a lookbehind assertion are restricted such that all the strings it matches must
have a fixed length. However, if there are several alternatives, they do not
all have to have the same fixed length. Thus</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=bullock|donkey)</code></pre>
</div>
</div>
<div class="paragraph">
<p>is permitted, but</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;!dogs?|cats?)</code></pre>
</div>
</div>
<div class="paragraph">
<p>causes an error at compile time. Branches that match different length strings
are permitted only at the top level of a lookbehind assertion. This is an
extension compared with Perl (at least for 5.8), which requires all branches to
match the same length of string. An assertion such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=ab(c|de))</code></pre>
</div>
</div>
<div class="paragraph">
<p>is not permitted, because its single top-level branch can match two different
lengths, but it is acceptable if rewritten to use two top-level branches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=abc|abde)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of lookbehind assertions is, for each alternative, to
temporarily move the current position back by the fixed width and then try to
match. If there are insufficient characters before the current position, the
match is deemed to fail.</p>
</div>
<div class="paragraph">
<p>Atomic groups can be used in conjunction with lookbehind assertions to specify
efficient matching at the end of the subject string. Consider a simple pattern
such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>abcd$</code></pre>
</div>
</div>
<div class="paragraph">
<p>when applied to a long string that does not match. Because matching proceeds
from left to right, PCRE will look for each "a" in the subject and then see if
what follows matches the rest of the pattern. If the pattern is specified as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>^.*abcd$</code></pre>
</div>
</div>
<div class="paragraph">
<p>the initial .* matches the entire string at first, but when this fails (because
there is no following "a"), it backtracks to match all but the last character,
then all but the last two characters, and so on. Once again the search for "a"
covers the entire string, from right to left, so we are no better off. However,
if the pattern is written as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>^(?&gt;.*)(?&lt;=abcd)</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, equivalently,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>^.*+(?&lt;=abcd)</code></pre>
</div>
</div>
<div class="paragraph">
<p>there can be no backtracking for the <code>.*</code> item; it can match only the entire
string. The subsequent lookbehind assertion does a single test on the last four
characters. If it fails, the match fails immediately. For long strings, this
approach makes a significant difference to the processing time.</p>
</div>
<div class="paragraph">
<p>Several assertions (of any sort) may occur in succession. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=\d{3})(?&lt;!999)foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "foo" preceded by three digits that are not "999". Notice that each of
the assertions is applied independently at the same point in the subject
string. First there is a check that the previous three characters are all
digits, and then there is a check that the same three characters are not "999".
This pattern does fInotfR match "foo" preceded by six characters, the first
of which are digits and the last three of which are not "999". For example, it
doesn&#8217;t match "123abcfoo". A pattern to do that is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=\d{3}...)(?&lt;!999)foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time the first assertion looks at the preceding six characters, checking
that the first three are digits, and then the second assertion checks that the
preceding three characters are not "999".</p>
</div>
<div class="paragraph">
<p>Assertions can be nested in any combination. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=(?&lt;!foo)bar)baz</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches an occurrence of "baz" that is preceded by "bar" which in turn is not
preceded by "foo", while</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?&lt;=\d{3}(?!999)...)foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>is another pattern which matches "foo" preceded by three digits and any three
characters that are not "999".</p>
</div>
<div class="paragraph">
<p>Assertion subpatterns are not capturing subpatterns, and may not be repeated,
because it makes no sense to assert the same thing several times. If any kind
of assertion contains capturing subpatterns within it, these are counted for
the purposes of numbering the capturing subpatterns in the whole pattern.
However, substring capturing is carried out only for positive assertions,
because it does not make sense for negative assertions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conditional_subpatterns">5.14. Conditional Subpatterns</h3>
<div class="paragraph">
<p>It is possible to cause the matching process to obey a subpattern
conditionally or to choose between two alternative subpatterns, depending on
the result of an assertion, or whether a previous capturing subpattern matched
or not. The two possible forms of conditional subpattern are</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?(condition)yes-pattern)
(?(condition)yes-pattern|no-pattern)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the condition is satisfied, the yes-pattern is used; otherwise the
no-pattern (if present) is used. If there are more than two
alternatives in the subpattern, a compile-time error occurs.</p>
</div>
<div class="paragraph">
<p>There are three kinds of condition. If the text between the parentheses
consists of a sequence of digits, the condition is satisfied if the capturing
subpattern of that number has previously matched. The number must be greater
than zero. Consider the following pattern, which contains non-significant white
space to make it more readable (assume the <em>extended</em> option) and to divide
it into three parts for ease of discussion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>( \( )?    [^()]+    (?(1) \) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first part matches an optional opening parenthesis, and if that
character is present, sets it as the first captured substring. The second part
matches one or more characters that are not parentheses. The third part is a
conditional subpattern that tests whether the first set of parentheses matched
or not. If they did, that is, if subject started with an opening parenthesis,
the condition is true, and so the yes-pattern is executed and a closing
parenthesis is required. Otherwise, since no-pattern is not present, the
subpattern matches nothing. In other words, this pattern matches a sequence of
non-parentheses, optionally enclosed in parentheses.</p>
</div>
<div class="paragraph">
<p>If the condition is the string <code>&#174;</code>, it is satisfied if a recursive call to the
pattern or subpattern has been made. At "top level", the condition is false.
This is a PCRE extension. See PCRE documentation for recursive patterns.</p>
</div>
<div class="paragraph">
<p>If the condition is not a sequence of digits or <code>&#174;</code>, it must be an assertion.
This may be a positive or negative lookahead or lookbehind assertion. Consider
this pattern, again containing non-significant white space, and with the two
alternatives on the second line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(?(?=`(^a-z)*`(a-z))
\d{2}-`(a-z){3}-\d{2}  |  \d{2}-\d{2}-\d{2} )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The condition is a positive lookahead assertion that matches an optional
sequence of non-letters followed by a letter. In other words, it tests for the
presence of at least one letter in the subject. If a letter is found, the
subject is matched against the first alternative; otherwise it is matched
against the second. This pattern matches strings in one of the two forms
dd-aaa-dd or dd-dd-dd, where aaa are letters and dd are digits.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comments_2">5.15. Comments</h3>
<div class="paragraph">
<p>The sequence <code>(?#</code> marks the start of a comment which continues up to the next
closing parenthesis. Nested parentheses are not permitted. The characters
that make up a comment play no part in the pattern matching at all.</p>
</div>
<div class="paragraph">
<p>If the <em>extended</em> option is set, an unescaped <code>&#35;</code> character outside a
character class introduces a comment that continues up to the next newline
character in the pattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subpatterns_as_subroutines">5.16. Subpatterns As Subroutines</h3>
<div class="paragraph">
<p>If the syntax for a recursive subpattern reference (either by number or by
name) is used outside the parentheses to which it refers, it operates like a
subroutine in a programming language. An earlier example pointed out that the
pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(sens|respons)e and \1ibility</code></pre>
</div>
</div>
<div class="paragraph">
<p>matches "sense and sensibility" and "response and responsibility", but not
"sense and responsibility". If instead the pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(sens|respons)e and (?1)ibility</code></pre>
</div>
</div>
<div class="paragraph">
<p>is used, it does match "sense and responsibility" as well as the other two
strings. Such references must, however, follow the subpattern to which they
refer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_regexp_procedures">5.17. Regexp Procedures</h3>
<div class="paragraph">
<p>This section lists the <strong><em>STklos</em></strong> functions that can use PCRE regexpr described
before</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(string&#8594;regexp string)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>String&#8594;regexp</code> takes a string representation of a regular
expression and compiles it into a regexp value. Other regular
expression procedures accept either a string or a regexp value as
the matching pattern. If a regular expression string is used
multiple times, it is faster to compile the string once to a regexp
value and use it for repeated matches instead of using the string
each time.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(regexp? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Regexp</code> returns <code>#t</code> if <code>obj</code> is a regexp value created by the <code>regexp</code>,
otherwise <code>regexp</code> returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(regexp-match pattern str)</code></strong><br>
<strong><code>(regexp-match-positions pattern str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These functions attempt to match <code>pattern</code> (a string or a regexp value)
to <code>str</code>. If the match fails, <code>#f</code> is returned. If the match succeeds,
a list (containing strings for <code>regexp-match</code> and positions for
<code>regexp-match-positions</code>) is returned. The first string (or positions) in
this list is the portion of string that matched pattern. If two portions
of string can match pattern, then the earliest and longest match is found,
by default.</p>
</div>
<div class="paragraph">
<p>Additional strings or positions are returned in the list if pattern contains
parenthesized sub-expressions; matches for the sub-expressions are provided
in the order of the opening parentheses in pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">regexp-match-positions</span> <span class="s">"ca"</span> <span class="s">"abracadabra"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">4</span> <span class="mi">6</span><span class="p">))</span>
<span class="p">(</span><span class="nf">regexp-match-positions</span> <span class="s">"CA"</span> <span class="s">"abracadabra"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">regexp-match-positions</span> <span class="s">"(?i)CA"</span> <span class="s">"abracadabra"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">4</span> <span class="mi">6</span><span class="p">))</span>
<span class="p">(</span><span class="nf">regexp-match</span> <span class="s">"(a*)(b*)(c*)"</span> <span class="s">"abc"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"abc"</span> <span class="s">"a"</span> <span class="s">"b"</span> <span class="s">"c"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">regexp-match-positions</span> <span class="s">"(a*)(b*)(c*)"</span> <span class="s">"abc"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="nf">regexp-match-positions</span> <span class="s">"(a*)(b*)(c*)"</span> <span class="s">"c"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">regexp-match-positions</span> <span class="s">"(?&lt;=\\d{3})(?&lt;!999)foo"</span>
                        <span class="s">"999foo and 123foo"</span><span class="p">)</span>
                 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">14</span> <span class="mi">17</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(regexp-replace pattern string substitution)</code></strong><br>
<strong><code>(regexp-replace-all pattern string substitution)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Regexp-replace</code> matches the regular expression <code>pattern</code> against
<code>string</code>. If there is a match, the portion of <code>string</code> which matches
<code>pattern</code> is replaced by the <code>substitution</code> string. If there is no
match, <code>regexp-replace</code> returns <code>string</code> unmodified. Note that the
given <code>pattern</code> could be here either a string or a regular expression.</p>
</div>
<div class="paragraph">
<p>If <code>pattern</code> contains <code>\n</code> where <strong>n</strong> is a digit between 1 and 9,
then it is replaced in the substitution with the portion of string that
matched the <strong>n</strong>-th parenthesized subexpression of <code>pattern</code>. If
<strong>n</strong> is equal to 0, then it is replaced in <code>substitution</code>
with the portion of <code>string</code> that matched <code>pattern</code>.</p>
</div>
<div class="paragraph">
<p><code>Regexp-replace</code> replaces the first occurrence of <code>pattern</code> in <code>string</code>.
To replace <em>all</em> the occurrences of <code>pattern</code>, use <code>regexp-replace-all</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">regexp-replace</span> <span class="s">"a*b"</span> <span class="s">"aaabbcccc"</span> <span class="s">"X"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"Xbcccc"</span>
<span class="p">(</span><span class="nf">regexp-replace</span> <span class="p">(</span><span class="nf">string-&gt;regexp</span> <span class="s">"a*b"</span><span class="p">)</span> <span class="s">"aaabbcccc"</span> <span class="s">"X"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"Xbcccc"</span>
<span class="p">(</span><span class="nf">regexp-replace</span> <span class="s">"(a*)b"</span> <span class="s">"aaabbcccc"</span> <span class="s">"X\\1Y"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"XaaaYbcccc"</span>
<span class="p">(</span><span class="nf">regexp-replace</span> <span class="s">"f(.*)r"</span> <span class="s">"foobar"</span> <span class="s">"\\1 \\1"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"ooba ooba"</span>
<span class="p">(</span><span class="nf">regexp-replace</span> <span class="s">"f(.*)r"</span> <span class="s">"foobar"</span> <span class="s">"\\0 \\0"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"foobar foobar"</span>

<span class="p">(</span><span class="nf">regexp-replace</span> <span class="s">"a*b"</span> <span class="s">"aaabbcccc"</span> <span class="s">"X"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"Xbcccc"</span>
<span class="p">(</span><span class="nf">regexp-replace-all</span> <span class="s">"a*b"</span> <span class="s">"aaabbcccc"</span> <span class="s">"X"</span><span class="p">)</span>
                   <span class="nv">=&gt;</span> <span class="s">"XXcccc"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(regexp-quote str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Takes an arbitrary string and returns a string where characters of
<code>str</code> that could serve as regexp metacharacters are escaped with a
backslash, so that they safely match only themselves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">regexp-quote</span> <span class="s">"cons"</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="s">"cons"</span>
<span class="p">(</span><span class="nf">regexp-quote</span> <span class="s">"list?"</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="s">"list\\?"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>regexp-quote</code> is useful when building a composite regexp from
a mix of regexp strings and verbatim strings.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pattern_matching">6. Pattern Matching</h2>
<div class="sectionbody">
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Pattern matching is a key feature of most modern functional
programming languages since it allows clean and secure code to be
written. Internally, "pattern-matching forms" should be translated
(compiled) into cascades of "elementary tests" where code is made as
efficient as possible, avoiding redundant tests; <strong><em>STklos</em></strong> "pattern
matching compiler" provides this :footnote[The "pattern matching
compiler" has been written by Jean-Marie Geffroy and is part of the
Manuel Serrano&#8217;s Bigloo compiler since several years <a href="#Bigloo">[Bigloo]</a>. The
code (and documentation) included in <strong><em>STklos</em></strong> has been stolen from
the Bigloo package v2.4 (the only difference between both package is
the pattern matching of structures which is absent in <strong><em>STklos</em></strong>.</p>
</div>
<div class="paragraph">
<p>The technique used is described in details in C. Queinnec and
J-M. Geffroy paper <a href="#QuG92">[QuG92]</a>, and the code generated can be considered
optimal</p>
</div>
<div class="paragraph">
<p>The "pattern language" allows the expression of a wide variety of patterns,
including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-linear patterns: pattern variables can appear more than
once, allowing comparison of subparts of the datum (through <code>eq?</code>)</p>
</li>
<li>
<p>Recursive patterns on lists: for example, checking that the
datum is a list of zero or more <code>a</code>s followed by zero or more <code>`b</code>s.</p>
</li>
<li>
<p>Pattern matching on lists as well as on vectors.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_pattern_language">6.1. The Pattern Language</h3>
<div class="paragraph">
<p>
The syntax for <code>&lt;pattern&gt;</code> is:</p>
</div>
<div class="paragraph">
<p>[:small]</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">&lt;pattern&gt;</th>
<th class="tableblock halign-left valign-top">Matches:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;atom&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the &lt;atom&gt;.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(kwote &lt;atom&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any expression eq? to &lt;atom&gt;.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(and &lt;pat<sub>1</sub>&gt; &#8230;&#8203; &lt;pat<sub>n</sub>&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if all of &lt;pati&gt; match.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(or &lt;pat<sub>1</sub>&gt; &#8230;&#8203; &#8230;&#8203;&lt;pat<sub>n</sub>&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if any of &lt;pat<sub>1</sub>&gt; through &lt;pat<sub>n</sub>&gt; matches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(not &lt;pat&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if &lt;pat&gt; doesn&#8217;t match.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(? &lt;predicate&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if &lt;predicate&gt; is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(&lt;pat<sub>1</sub>&gt; &#8230;&#8203; &lt;pat<sub>n</sub>&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a list of n elements. Here, &#8230;&#8203; is a
                                  meta-character denoting a finite repetition
                                  of patterns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;pat&gt; &#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a (possibly empty) repetition
                                  of &lt;pat&gt; in a list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">#(&lt;pat&gt; &#8230;&#8203; &lt;pat<sub>n</sub>&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a vector of n elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?&lt;id&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anything, and binds id as a variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anything.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">??-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any (possibly empty) repetition of anything in a list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">???-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any end of list.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Remark:</strong> <code>and</code>, <code>or</code>, <code>not</code> and <code>kwote</code> must be quoted in order to be treated
as literals. This is the only justification for having the <code>kwote</code> pattern
since, by convention, any atom which is not a keyword is quoted.</p>
</div>
<div class="paragraph">
<p><strong>Explanations Through Examples</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>?-</code> matches any s-expr.</p>
</li>
<li>
<p><code>a</code> matches the atom <code>'a</code>.</p>
</li>
<li>
<p><code>?a</code> matches any expression, and binds the variable <code>a</code> to
this expression.</p>
</li>
<li>
<p><code>(? integer?)</code> matches any integer.</p>
</li>
<li>
<p><code>(a (a b))</code> matches the only list <code>'(a (a b))</code>.</p>
</li>
<li>
<p><code>???-</code> can only appear at the end of a list, and always succeeds.
For instance, <code>(a ???-)</code> is equivalent to <code>(a . ?-)</code>.</p>
</li>
<li>
<p>when occurring in a list, <code>??-</code> matches any
sequence of anything: <code>(a ??- b)</code> matches any list whose
<code>car</code> is <code>a</code> and last <code>car</code> is <code>b</code>.</p>
</li>
<li>
<p><code>(a &#8230;&#8203;)</code> matches any list of `a&#8217;s, possibly empty.</p>
</li>
<li>
<p><code>(?x ?x)</code> matches any list of length 2 whose <code>car</code> is <strong><em>eq</em></strong> to its <code>cadr</code>.</p>
</li>
<li>
<p><code>((and (not a) ?x) ?x)</code> matches any list of length 2 whose <code>car</code> is
not <strong><em>eq</em></strong> to <code>'a</code> but is <strong><em>eq</em></strong> to its <code>cadr</code>.</p>
</li>
<li>
<p><code>#(?- ?- ???-)</code> matches any vector whose length is at least 2.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>??-</code> and <code>&#8230;&#8203;</code> patterns can not appear inside a vector, where you
should use <code>???-</code><br>
For example, <code>&#35;(a ??- b)</code> or <code>#(a&#8230;&#8203;)</code> are invalid
patterns, whereas <code>&#35;(a ???-)</code> is valid and matches any vector whose first
element is the atom <code>a</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_stklos_pattern_matching_facilities">6.2. <strong><em>STklos</em></strong> Pattern Matching Facilities</h3>
<div class="paragraph">
<p>Only two special forms are provided for this in <strong><em>STklos</em></strong>: <code>match-case</code> and
<code>match-lambda</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(match-case &lt;key&gt; &lt;clause&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The argument key may be any expression and each clause has the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">&lt;pattern&gt;</span> <span class="nv">&lt;expression&gt;</span> <span class="o">...</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A match-case expression is evaluated as follows: <code>&lt;key&gt;</code> is evaluated
and the result is compared with each successive pattern. If the <code>&lt;pattern&gt;</code>
in some clause yields a match, then the <code>&lt;expression&gt;</code>s in that clause are
evaluated from left to right in an environment where the pattern variables
are bound to the corresponding subparts of <code>&lt;key&gt;</code>, and the result of the
last expression in that clause is returned as the result of the
<code>match-case</code> expression. If no pattern in any clause matches the <code>&lt;key&gt;</code>,
then, if there is an <code>else</code> clause, its expressions are evaluated and
the result of the last is the result of the whole <code>match-case</code>
expression; otherwise the result of the <code>match-case</code> expression
is unspecified.</p>
</div>
<div class="paragraph">
<p>The equality predicate used for tests is <code>eq?</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">match-case</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">a</span><span class="p">)</span>
   <span class="p">((</span><span class="nf">?x</span> <span class="nv">?x</span><span class="p">)</span> <span class="ss">'foo</span><span class="p">)</span>
   <span class="p">((</span><span class="nf">?x</span> <span class="nv">?-</span> <span class="nv">?x</span><span class="p">)</span> <span class="ss">'bar</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="nv">bar</span>

<span class="p">(</span><span class="nf">match-case</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">d</span><span class="p">)</span>
   <span class="p">((</span><span class="nf">?x</span> <span class="nv">?y</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'length=2</span> <span class="nv">y</span> <span class="nv">x</span><span class="p">))</span>
   <span class="p">((</span><span class="nf">?x</span> <span class="nv">?y</span> <span class="nv">?z</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'length=3</span> <span class="nv">z</span> <span class="nv">y</span> <span class="nv">x</span><span class="p">)))</span>
                        <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">length=3</span> <span class="nv">d</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(match-lambda &lt;clause&gt; &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>match-lambda</code> expands into a lambda-expression expecting an argument
which, once applied to an expression, behaves exactly like a
<code>match-case</code> expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">((</span><span class="nf">match-lambda</span>
  <span class="p">((</span><span class="nf">?x</span> <span class="nv">?x</span><span class="p">)</span> <span class="ss">'foo</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">?x</span> <span class="nv">?-</span> <span class="nv">?x</span><span class="p">)</span> <span class="ss">'bar</span><span class="p">))</span>
 <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">a</span><span class="p">))</span>           <span class="nv">=&gt;</span> <span class="nv">bar</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions_and_conditions">7. Exceptions and Conditions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_exceptions">7.1. Exceptions</h3>
<div class="paragraph">
<p>
The following text is extracted from <strong><a href="http://srfi.schemers.org/srfi-34/srfi-34.html">SRFI-34</a></strong> (<em>Exception Handling for Programs</em>), from which
<strong><em>STklos</em></strong> exceptions are derived. Note that exceptions are now part of R<sup>7</sup>RS.</p>
</div>
<div class="paragraph">
<p>Exception handlers are one-argument procedures that determine the action the
program takes when an exceptional situation is signalled. The system
implicitly maintains a current exception handler.</p>
</div>
<div class="paragraph">
<p>The program raises an exception by invoking the current exception handler,
passing to it an object encapsulating information about the exception. Any
procedure accepting one argument may serve as an exception handler and any
object may be used to represent an exception.</p>
</div>
<div class="paragraph">
<p>The system maintains the current exception handler as part of the dynamic
environment of the program, akin to the current input or output port, or the
context for dynamic-wind. The dynamic environment can be thought of as that
part of a continuation that does not specify the destination of any returned
values. It includes the current input and output ports, the dynamic-wind
context, and this SRFI&#8217;s current exception handler.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-handler &lt;handler&gt; &lt;expr<sub>1</sub>&gt; &#8230;&#8203; &lt;expr<sub>n</sub>&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Evaluates the sequences of expressions <code>&lt;expr<sub>1</sub>&gt;</code> to <code>&lt;expr<sub>n</sub>&gt;</code>.
<code>&lt;handler&gt;</code> must be a procedure that accepts one argument. It is installed
as the current exception handler for the dynamic extent (as determined by
dynamic-wind) of the evaluations of the expressions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-handler</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">display</span> <span class="s">"Catch an error\\n"</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">display</span> <span class="s">"One ... "</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">+</span> <span class="s">"will yield"</span> <span class="s">"an error"</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">display</span> <span class="s">"... Two"</span><span class="p">))</span>
       <span class="nv">|-</span> <span class="s">"One ... Catch an error"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(with-exception-handler &lt;handler&gt; &lt;thunk&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This form is similar to <code>with-handler</code>. It uses a <strong><em>thunk</em></strong> instead of
a sequence of expressions. It is conform to <strong><a href="http://srfi.schemers.org/srfi-34/srfi-34.html">SRFI-34</a></strong> (<em>Exception Handling for Programs</em>).
In fact,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-handler</span> <span class="nv">&lt;handler&gt;</span> <span class="nv">&lt;expr1&gt;</span> <span class="o">...</span> <span class="nv">&lt;exprn&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-exception-handler</span> <span class="nv">&lt;handler&gt;</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="nv">&lt;expr1&gt;</span> <span class="o">...</span> <span class="nv">&lt;exprn&gt;</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(raise obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Invokes the current exception handler on <code>obj</code>. The handler is called in
the dynamic environment of the call to <code>raise</code>, except that the current
exception handler is that in place for the call to <code>with-handler</code>
that installed the handler being called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-handler</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">format</span> <span class="s">"value ~A was raised"</span> <span class="nv">c</span><span class="p">))</span>
   <span class="p">(</span><span class="nf">raise</span> <span class="ss">'foo</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">"never printed\\n"</span><span class="p">))</span>
          <span class="nv">=&gt;</span> <span class="s">"value foo was raised"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(raise-continuable obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Raises an exception by invoking the current exception handler on
<code>obj</code>. The handler is called with the same dynamic environment as the
call to <code>raise-continuable</code>, except that: (1) the current exception
handler is the one that was in place when the handler being called was
installed, and (2) if the handler being called returns, then it will again
become the current exception handler.  If the handler returns, the values
it returns become the values returned by the call to <code>raise-continuable</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">with-exception-handler</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">con</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond</span>
      <span class="p">((</span><span class="nb">string?</span> <span class="nv">con</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">display</span> <span class="nv">con</span><span class="p">))</span>
      <span class="p">(</span><span class="k">else</span>
       <span class="p">(</span><span class="nb">display</span> <span class="s">"a warning has been issued"</span><span class="p">)))</span>
    <span class="mi">42</span><span class="p">)</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nf">raise-continuable</span> <span class="s">"should be a number"</span><span class="p">)</span>
       <span class="mi">23</span><span class="p">)))</span>
  <span class="c1">;; prints should be a number</span>
                <span class="nv">=&gt;</span> <span class="mi">65</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>7</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(guard (&lt;var&gt; &lt;clause1 &gt; &lt;clause2 &gt; &#8230;&#8203;)  &lt;body&gt;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Evaluating a guard form evaluates <code>&lt;body&gt;</code> with an exception handler
that binds the raised object to <code>&lt;var&gt;</code> and within the scope of that
binding evaluates the clauses as if they were the clauses of a cond
expression. That implicit cond  expression is evaluated with the
continuation and dynamic environment of the <code>guard</code> expression.
If every <code>&lt;clause&gt;</code>s test evaluates to false and there is no <code>else</code>
clause, then <code>raise</code> is re-invoked on the raised object within the
dynamic environment of the original call to <code>raise</code> except that the
current exception handler is that of the <code>guard</code> expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">guard</span> <span class="p">(</span><span class="nf">condition</span>
         <span class="p">((</span><span class="nb">assq</span> <span class="ss">'a</span> <span class="nv">condition</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="nv">cdr</span><span class="p">)</span>
         <span class="p">((</span><span class="nb">assq</span> <span class="ss">'b</span> <span class="nv">condition</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">raise</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'a</span> <span class="mi">42</span><span class="p">))))</span>
         <span class="nv">=&gt;</span> <span class="mi">42</span>

<span class="p">(</span><span class="nf">guard</span> <span class="p">(</span><span class="nf">condition</span>
         <span class="p">((</span><span class="nb">assq</span> <span class="ss">'a</span> <span class="nv">condition</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="nv">cdr</span><span class="p">)</span>
         <span class="p">((</span><span class="nb">assq</span> <span class="ss">'b</span> <span class="nv">condition</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">raise</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'b</span> <span class="mi">23</span><span class="p">))))</span>
         <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">b</span> <span class="o">.</span> <span class="mi">23</span><span class="p">)</span>

<span class="p">(</span><span class="nf">with-handler</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">format</span> <span class="s">"value ~A was raised"</span> <span class="nv">c</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">guard</span> <span class="p">(</span><span class="nf">condition</span>
       <span class="p">((</span><span class="nb">assq</span> <span class="ss">'a</span> <span class="nv">condition</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="nv">cdr</span><span class="p">)</span>
       <span class="p">((</span><span class="nb">assq</span> <span class="ss">'b</span> <span class="nv">condition</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">raise</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'x</span> <span class="mi">0</span><span class="p">)))))</span>
         <span class="nv">=&gt;</span> <span class="s">"value ((x . 0)) was raised"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-exception-handler)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current exception handler. This procedure is defined in
,(link-srfi 18).</p>
</div>
</div>
<div class="sect2">
<h3 id="_conditions">7.2. Conditions</h3>
<div class="paragraph">
<p>
The following text is extracted from <strong><a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI-35</a></strong> (<em>Conditions</em>), from which
<strong><em>STklos</em></strong> conditions are derived.</p>
</div>
<div class="paragraph">
<p>Conditions are values that communicate information about exceptional
situations between parts of a program. Code that detects an exception may be
in a different part of the program than the code that handles
it. In fact, the former may have been written independently from the
latter. Consequently, to facilitate effective handling of exceptions,
conditions must communicate as much information as possible as
accurately as possible, and still allow effective handling by code
that did not precisely anticipate the nature of the exception that
occurred.</p>
</div>
<div class="paragraph">
<p>Conditions available in <strong><em>STklos</em></strong> are derived from <strong>SRFI-35</strong> and in this SRFI
two mechanisms to enable this kind of communication are provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>subtyping among condition types allows handling code to
determine the general nature of an exception even though it does
not anticipate its exact nature,</p>
</li>
<li>
<p>compound conditions allow an exceptional situation to be
described in multiple ways.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Conditions are structures with named slots. Each condition belongs to
one condition type (a condition type can be made from several
condition types). Each condition type specifies a set of
slot names. A condition belonging to a condition type includes a
value for each of the type&#8217;s slot names. These values can be
extracted from the condition by using the appropriate slot name.</p>
</div>
<div class="paragraph">
<p>
There is a tree of condition types with the distinguished <code>&amp;condition</code>
as its root. All other condition types have a parent condition type.</p>
</div>
<div class="paragraph">
<p>Conditions are implemented with <strong><em>STklos</em></strong> structures (with a special bit
indicating that there are conditions). Of course, condition types are
implemented with structure types. As a consequence, functions on
structures or structures types are available on conditions or
conditions types (the contrary is not true). For instance, if C is a
condition, the expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">struct-&gt;list</span> <span class="nv">C</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is a simple way to see it&#8217;s slots and their associated value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-condition-type id  parent  slot-names)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Make-condition-type</code> returns a new condition type. <code>Id</code> must be a symbol
that serves as a symbolic name for the condition type. <code>Parent</code> must itself
be a condition type. <code>Slot-names</code> must be a list of symbols. It identifies
the slots of the conditions associated with the condition type.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition-type? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a condition type, and <code>#f</code> otherwise</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-compound-condition-type id ct<sub>1</sub> &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Make-compound-condition-type</code> returns a new condition type, built
from the condition types <code>ct<sub>1</sub></code>, &#8230;&#8203;
<code>Id</code> must be a symbol that serves as a symbolic name for the
condition type. The slots names of the new condition type is the
union of the slots of conditions <code>ct<sub>1</sub></code> &#8230;&#8203;</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This function is not defined in <strong><a href="http://srfi.schemers.org/srfi-34/srfi-34.html">SRFI-34</a></strong> (<em>Exception Handling for Programs</em>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-condition type slot-name value  &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Make-condition</code> creates a condition value belonging condition type
<code>type</code>. The following arguments must be, in turn, a slot name and an
arbitrary value. There must be such a pair for each slot of <code>type</code> and
its direct and indirect supertypes. <code>Make-condition</code> returns the
condition value, with the argument values associated with their
respective slots.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">ct</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct1</span> <span class="nv">&amp;condition</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">c</span>  <span class="p">(</span><span class="nf">make-condition</span> <span class="nv">ct</span> <span class="ss">'b</span> <span class="mi">2</span> <span class="ss">'a</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">struct-&gt;list</span> <span class="nv">c</span><span class="p">))</span>
     <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">a</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a condition, and <code>#f</code> otherwise</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition-has-type? condition condition-type)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Condition-has-type?</code> tests if <code>condition</code> belongs to <code>condition-type</code>.
It returns <code>#t</code> if any of condition 's types includes <code>condition-type</code>
either directly or as an ancestor and <code>#f</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">ct1</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct1</span> <span class="nv">&amp;condition</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">ct2</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct2</span> <span class="nv">ct1</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">ct3</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct3</span> <span class="nv">&amp;condition</span> <span class="o">'</span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">c</span>   <span class="p">(</span><span class="nf">make-condition</span> <span class="nv">ct2</span> <span class="ss">'a</span> <span class="mi">1</span> <span class="ss">'b</span> <span class="mi">2</span> <span class="ss">'c</span> <span class="mi">3</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">condition-has-type?</span> <span class="nv">c</span> <span class="nv">ct1</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">condition-has-type?</span> <span class="nv">c</span> <span class="nv">ct2</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">condition-has-type?</span> <span class="nv">c</span> <span class="nv">ct3</span><span class="p">)))</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#t</span> <span class="no">#t</span> <span class="no">#f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition-ref condition slot-name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Condition</code> must be a condition, and <code>slot-name</code> a symbol. Moreover,
<code>condition</code> must belong to a condition type which has a slot name called
<code>slot-name</code>, or one of its (direct or indirect) supertypes must have the
slot. <code>Condition-ref</code> returns the value associated with <code>slot-name</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">ct</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct1</span> <span class="nv">&amp;condition</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">c</span>  <span class="p">(</span><span class="nf">make-condition</span> <span class="nv">ct</span> <span class="ss">'b</span> <span class="mi">2</span> <span class="ss">'a</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">condition-ref</span> <span class="nv">c</span> <span class="ss">'b</span><span class="p">))</span>
     <span class="nv">=&gt;</span> <span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition-set! condition slot-name obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Condition</code> must be a condition, and <code>slot-name</code> a symbol. Moreover,
<code>condition</code> must belong to a condition type which has a slot name called
<code>slot-name</code>, or one of its (direct or indirect) supertypes must have the
slot. <code>Condition-set!</code> change the value associated with <code>slot-name</code> to <code>obj</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whereas <code>condition-ref</code> is defined in ,(srfi 35),
<code>confition-set!</code> is not.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-compound-condition condition<sub>0</sub> condition<sub>1</sub> &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Make-compound-condition</code> returns a compound condition belonging to
all condition types that the <code>condition<sub>i</sub></code> belong to.</p>
</div>
<div class="paragraph">
<p><code>Condition-ref</code>, when applied to a compound condition will return
 the value from the first of the <code>conditioni</code> that has such a slot.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(extract-condition condition  condition-type)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Condition</code> must be a condition belonging to <code>condition-type</code>.
<code>Extract-condition</code> returns a condition of <code>condition-type</code>
with the slot values specified by <code>condition</code>. The new condition
is always allocated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nf">ct1</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct1</span> <span class="nv">&amp;condition</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">ct2</span> <span class="p">(</span><span class="nf">make-condition-type</span> <span class="ss">'ct2</span> <span class="nv">ct1</span> <span class="o">'</span><span class="p">(</span><span class="nf">c</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">c2</span>  <span class="p">(</span><span class="nf">make-condition</span> <span class="nv">ct2</span> <span class="ss">'a</span> <span class="mi">1</span> <span class="o">'</span> <span class="nv">b</span> <span class="mi">2</span> <span class="ss">'c</span> <span class="mi">3</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">c1</span>  <span class="p">(</span><span class="nf">extract-condition</span> <span class="nv">c2</span> <span class="nv">ct1</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">condition-has-type?</span> <span class="nv">c1</span> <span class="nv">ct2</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">condition-has-type?</span> <span class="nv">c1</span> <span class="nv">ct1</span><span class="p">)))</span>
      <span class="nv">=&gt;</span> <span class="p">(</span><span class="no">#f</span> <span class="no">#t</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_predefined_conditions">7.3. Predefined Conditions</h3>
<div class="paragraph">
<p>

<strong><em>STklos</em></strong> implements all the conditions types which are defined in
<strong><a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI-35</a></strong> (<em>Conditions</em>) and <strong><a href="http://srfi.schemers.org/srfi-36/srfi-36.html">SRFI-36</a></strong> (<em>I/O Conditions</em>).
However, the access functions which are (implicitely) defined
in those SRFIs are only available if the file <code>"conditions"</code> is
required. This can be done with the call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require</span> <span class="s">"conditions"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way to have access to the hierarchy of the <strong><a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI-35</a></strong> (<em>Conditions</em>)
and <strong><a href="http://srfi.schemers.org/srfi-36/srfi-36.html">SRFI-36</a></strong> (<em>I/O Conditions</em>) condition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-extension</span> <span class="nv">conditions</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following hierarchy of conditions is predefined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>&amp;condition
   &amp;message (has "message" slot)
   &amp;serious
   &amp;error
      &amp;error-message (has *message*, "location" and "backtrace" slots)
      &amp;i/o-error
         &amp;i/o-port-error (has a "port" slot)
            &amp;i/o-read-error
            &amp;i/o-write-error
            &amp;i/o-closed-error
        &amp;i/o-filename-error (has a "filename" slots)
            &amp;i/o-malformed-filename-error
            &amp;i/o-file-protection-error
                &amp;i/o-file-is-read-only-error
            &amp;i/o-file-already-exists-error
            &amp;i/o-no-such-file-error
     &amp;read-error (has the "line", "column", "position" and "span" slots)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stklos_object_system">8. STklos Object System</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2">8.1. Introduction</h3>
<div class="paragraph">
<p>The aim of this chapter is to present <strong><em>STklos</em></strong> object
system.  Briefly stated, <strong><em>STklos</em></strong> gives the  programmer
an extensive object system with meta-classes, multiple
inheritance, generic functions and multi-methods.  Furthermore,
its implementation relies on a MOP  (Meta Object Protocol
(MOP) <a href="#AMOP">[AMOP]</a>),
in the spirit of the one defined for
CLOS <a href="#CLtL2">[CLtL2]</a>.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> implementation is derived from the version 1.3 of <strong><em>Tiny CLOS</em></strong>, a
pure and clean CLOS-like MOP implementation in Scheme written by Gregor
Kickzales <a href="#Tiny-Clos">[Tiny-Clos]</a>. However, Tiny CLOS implementation was designed as a
pedagogical tool and consequently, completeness and efficiency were not the
author concern for it.  <strong><em>STklos</em></strong> extends the Tiny CLOS model to be efficient
and as close as possible to CLOS, the Common Lisp Object System <a href="#CLtL2">[CLtL2]</a>.
Some features of <strong><em>STklos</em></strong> are also issued from <a href="#Dylan">[Dylan]</a> or <a href="#SOS">[SOS]</a>.</p>
</div>
<div class="paragraph">
<p>This chapter is divided in three parts, which have a quite different audience
in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first part presents the <strong><em>STklos</em></strong> object system rather
informally; it is intended to be a tutorial of the language and is
for people who want to have an idea of the <strong><em>look and feel</em></strong> of
<strong><em>STklos</em></strong>.</p>
</li>
<li>
<p>The second part describes the <strong><em>STklos</em></strong> object system at
the <strong><em>external</em></strong> level (i.e.  without requiring the use of the
Meta Object Protocol).</p>
</li>
<li>
<p>The third and last part describes the <strong><em>STklos</em></strong> Meta
Object Protocol.  It is intended for people whio want to play with
meta programming.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_object_system_tutorial">8.2. Object System Tutorial</h3>
<div class="paragraph">
<p>The <strong><em>STklos</em></strong> object system relies on classes like most of the current OO
languages.  Furthermore, <strong><em>STklos</em></strong> provides meta-classes, multiple
inheritance, generic functions and multi-methods as in CLOS, the Common Lisp
Object System <a href="#CLtL2">[CLtL2]</a> or <a href="#Dylan">[Dylan]</a>.  This chapter presents <strong><em>STklos</em></strong> in
a rather informal manner.  Its intent is to give the reader an idea of the
"<strong><em>look and feel</em></strong>" of <strong><em>STklos</em></strong> programming.  However, we suppose here that
the reader has some basic notions of OO programming, and is familiar with
terms such as <strong><em>classes, instances</em></strong> or <strong><em>methods.</em></strong></p>
</div>
<div class="sect3">
<h4 id="_class_definition_and_instantiation">8.2.1. Class definition and instantiation</h4>
<div class="sect4">
<h5 id="_class_definition">Class definition</h5>
<div class="paragraph">
<p>


A new class is defined with the <code>define-class</code> form.
The syntax of <code>define-class</code> is close to CLOS <code>defclass</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">class</span> <span class="p">(</span><span class="nf">superclass~1~</span> <span class="nv">superclass~2~</span> <span class="o">...</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">slot-description1</span>
   <span class="nv">slot-description2</span>
   <span class="o">...</span><span class="p">)</span>
  <span class="nv">metaclass</span> <span class="nv">option</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong><em>metaclass option</em></strong> will not be discussed here.
The <strong><em>superclass</em></strong>es list specifies the super classes of
<strong><em>class</em></strong> (see <a href="#_inheritance">Section 8.2.2</a> for details).</p>
</div>
<div class="paragraph">
<p>
A <strong><em>slot description</em></strong> gives the name of a slot and,
eventually, some <em>properties</em> of this slot (such as its
initial value, the function which permit to access its value,
&#8230;&#8203;). Slot descriptions will be discussed in
,(index "slot-definition").</p>
</div>
<div class="paragraph">
<p>As an example, consider now that we want to define a point as an object. This
can be done with the following class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;point&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This definition binds the symbol <code>&lt;point&gt;</code> to a new class whose instances
contain two slots. These slots are called <code>x</code> an <code>y</code> and we suppose here that
they contain the coordinates of a 2D point.</p>
</div>
<div class="paragraph">
<p>Let us define now a circle, as a 2D point and a radius:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;circle&gt;</span> <span class="p">(</span><span class="nf">&lt;point&gt;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">radius</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see here, the class <code>&lt;circle&gt;</code> is constructed by inheriting from the
class <code>&lt;point&gt;</code> and adding a new slot (the <code>radius</code> slot).</p>
</div>
</div>
<div class="sect4">
<h5 id="_instance_creation_and_slot_access">Instance creation and slot access</h5>
<div class="paragraph">
<p>

Creation of an instance of a previously defined class can
be done with the <code>make</code> procedure. This procedure takes
one mandatory parameter which is the class of the instance which
must be created and a list of optional arguments. Optional
arguments are generally used to initialize some slots of the
newly created instance. For instance, the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span>  <span class="nv">c</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;circle&gt;</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>creates a new <code>&lt;circle&gt;</code> object and binds it to the <code>c</code> Scheme variable.</p>
</div>
<div class="paragraph">
<p>


Accessing the slots of the newly created circle can be done
with the <code>slot-ref</code> and the <code>slot-set!</code> primitives. The <code>slot-set!</code>
primitive permits to set the value of an object slot and <code>slot-ref</code>
permits to get its value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">c</span> <span class="ss">'x</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">c</span> <span class="ss">'y</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">c</span> <span class="ss">'x</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="mi">10</span>
<span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">c</span> <span class="ss">'y</span><span class="p">)</span>       <span class="nv">=&gt;</span>  <span class="mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>describe</code> function is a simple way to see all the slots of an
object at one time: this function prints all the slots of an object on the
standard output. For instance, the expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">describe</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>prints the following information on the standard output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>#[&lt;circle&gt; 81aa1f8] is an an instance of class &lt;circle&gt;.
Slots are:
     radius = #[unbound]
     x = 10
     y = 3</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_slot_definition">Slot Definition</h5>
<div class="paragraph">
<p>When specifying a slot, a set of options can be given to
the system.  Each option is specified with a keyword. For
instance,</p>
</div>
<div class="ulist">
<ul>
<li>
<p> <strong>:init-form</strong> can be used to supply a default value for the slot.</p>
</li>
<li>
<p><strong>:init-keyword</strong> can be used to specify the keyword used for initializing a slot.</p>
</li>
<li>
<p> <strong>:getter</strong> can be used to define the name of the slot getter</p>
</li>
<li>
<p> <strong>:setter</strong> can be used to define the name of the slot setter</p>
</li>
<li>
<p> <strong>:accessor</strong> can be used to define the name of the slot accessor
(see below)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate slot description, we redefine here the <code>&lt;point&gt;</code> class seen
before. A new definition of this class could be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;point&gt;</span> <span class="p">()</span>
  <span class="p">((</span><span class="nf">x</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:getter</span> <span class="nv">get-x</span> <span class="nv">:setter</span> <span class="nv">set-x!</span> <span class="nv">:init-keyword</span> <span class="nv">:x</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">y</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:getter</span> <span class="nv">get-y</span> <span class="nv">:setter</span> <span class="nv">set-y!</span> <span class="nv">:init-keyword</span> <span class="nv">:y</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the <code>x</code> and <code>y</code> slots are set to 0 by default.</p>
</li>
<li>
<p>The value of a slot can also be specified by calling <code>make</code> with the <code>:x</code> and <code>:y</code>
keywords.</p>
</li>
<li>
<p>Furthermore, the generic functions <code>get-x</code> and <code>set-x!</code> (resp.  <code>get-y</code> and
<code>set-y!</code>) are automatically defined by the system to read and write the <code>x</code>
(resp.  <code>y</code>) slot.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">p1</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;point&gt;</span> <span class="nv">:x</span> <span class="mi">1</span> <span class="nv">:y</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">get-x</span> <span class="nv">p1</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">set-x!</span> <span class="nv">p1</span>  <span class="mi">12</span><span class="p">)</span>
<span class="p">(</span><span class="nf">get-x</span> <span class="nv">p1</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">12</span>

<span class="p">(</span><span class="k">define</span>  <span class="nv">p2</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;point&gt;</span> <span class="nv">:x</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">get-x</span> <span class="nv">p2</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">get-y</span> <span class="nv">p2</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="mi">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
Accessors provide an uniform access for reading and writing an object slot.
Writing a slot is done with an extended form of <code>set!</code>  which is
close to the Common Lisp <code>setf</code> macro.  A slot accessor can be
defined with the <code>:accessor</code> option in the slot
description.  Hereafter, is another definition of our
<code>&lt;point&gt;</code> class, using an accessor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;point&gt;</span> <span class="p">()</span>
  <span class="p">((</span><span class="nf">x</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:accessor</span> <span class="nv">x-of</span> <span class="nv">:init-keyword</span> <span class="nv">:x</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">y</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:accessor</span> <span class="nv">y-of</span> <span class="nv">:init-keyword</span> <span class="nv">:y</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this class definition, reading the x coordinate of the <code>p</code> point can be
done with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">x-of</span> <span class="nv">p</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and setting it to 100 can be done using the extended <code>set!</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">x-of</span> <span class="nv">p</span><span class="p">)</span> <span class="mi">100</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong><em>STklos</em></strong> also define <code>slot-set!</code> as the <a href="#setter">setter function</a> of <code>slot-ref</code>.
As a consequence, we have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">'y</span><span class="p">)</span> <span class="mi">100</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">'y</span><span class="p">)</span>       <span class="nv">=&gt;</span> <span class="mi">100</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_virtual_slots">Virtual Slots</h5>
<div class="paragraph">
<p>

Suppose that we need slot named <code>area</code> in circle objects which contain the
area of the circle. One way to do this would be to add the new slot to the
class definition and have an initialisation form for this slot which takes
into account the radius of the circle. The problem with this approach is that
if the <code>radius</code> slot is changed, we need to change <code>area</code> (and
vice-versa). This is something which is hard to manage and if we don&#8217;t care,
it is easy to have a <code>area</code> and <code>radius</code> in an instance which are
"un-synchronized".  The virtual slot mechanism avoid this problem.</p>
</div>
<div class="paragraph">
<p>A virtual slot is a special slot whose value is calculated rather than stored
in an object.  The way to read and write such a slot must be given when the
slot is defined with the <code>:slot-ref</code> and <code>:slot-set!</code> slot options.</p>
</div>
<div class="paragraph">
<p>A complete definition of the <code>&lt;circle&gt;</code> class
using virtual slots could be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;circle&gt;</span> <span class="p">(</span><span class="nf">&lt;point&gt;</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">radius</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:accessor</span> <span class="nv">radius</span> <span class="nv">:init-keyword</span> <span class="nv">:radius</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">area</span> <span class="nv">:allocation</span> <span class="nv">:virtual</span> <span class="nv">:accessor</span> <span class="nv">area</span>
	     <span class="nv">:slot-ref</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">o</span><span class="p">)</span> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">r</span> <span class="p">(</span><span class="nf">radius</span> <span class="nv">o</span><span class="p">)))</span> <span class="p">(</span><span class="nb">*</span> <span class="mf">3.14</span> <span class="nv">r</span> <span class="nv">r</span><span class="p">)))</span>
	     <span class="nv">:slot-set!</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">o</span> <span class="nv">v</span><span class="p">)</span> <span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">radius</span> <span class="nv">o</span><span class="p">)</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">v</span> <span class="mf">3.14</span><span class="p">)))))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example using this definition of <code>&lt;circle&gt;</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;circle&gt;</span> <span class="nv">:radius</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">radius</span> <span class="nv">c</span><span class="p">)</span>                           <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">area</span> <span class="nv">c</span><span class="p">)</span>                             <span class="nv">=&gt;</span> <span class="mf">3.14</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">area</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">4</span> <span class="p">(</span><span class="nf">area</span> <span class="nv">x</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">area</span> <span class="nv">c</span><span class="p">)</span>                             <span class="nv">=&gt;</span> <span class="mf">12.56</span>   <span class="c1">;; (i.e. ⒋π)</span>
<span class="p">(</span><span class="nf">radius</span> <span class="nv">c</span><span class="p">)</span>                           <span class="nv">=&gt;</span> <span class="mf">2.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, we can also used the function <code>describe</code> to visualize
the slots of a given object. Applied to the prvious <code>c</code>, it prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>#[&lt;circle&gt; 81b2348] is an an instance of class &lt;circle&gt;.
Slots are:
     area = 12.56
     radius = 2.0
     x = 0
     y = 0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inheritance">8.2.2. Inheritance</h4>
<div class="sect4">
<h5 id="_class_hierarchy_and_inheritance_of_slots">Class hierarchy and inheritance of slots</h5>
<div class="paragraph">
<p>inheritance
Inheritance is specified upon class definition. As said in the introduction,
<strong><em>STklos</em></strong> supports multiple inheritance.  Hereafter are some classes
definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">A</span> <span class="p">()</span> <span class="p">(</span><span class="nf">a</span><span class="p">))</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">B</span> <span class="p">()</span> <span class="p">(</span><span class="nf">b</span><span class="p">))</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">C</span> <span class="p">()</span> <span class="p">(</span><span class="nf">c</span><span class="p">))</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">D</span> <span class="p">(</span><span class="nf">A</span> <span class="nv">B</span><span class="p">)</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">a</span><span class="p">))</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">E</span> <span class="p">(</span><span class="nf">A</span> <span class="nv">C</span><span class="p">)</span> <span class="p">(</span><span class="nf">e</span> <span class="nv">c</span><span class="p">))</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">F</span> <span class="p">(</span><span class="nf">D</span> <span class="nv">E</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here,</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>A</code>, <code>B</code>, <code>C</code> have a null list of super classes. In this case, the
system will replace it by the list which only contains <code>&lt;object&gt;</code>, the root of
all the classes defined by <code>define-class</code>.</p>
</li>
<li>
<p><code>D</code>, <code>E</code>, and <code>F</code> use multiple inheritance: each class inherits from two
previously defined classes.  Those class definitions define a hierarchy which
is shown in <a href="#class_hierarchy">Figure 1</a>.</p>
</li>
</ul>
</div>
<div id="class_hierarchy" class="imageblock text-center">
<div class="content">
<img src="images/hierarchy.png" alt="hierarchy">
</div>
<div class="title">Figure 1. A class hiearchy</div>
</div>
<div class="paragraph">
<p>In this figure, the class <code>&lt;top&gt;</code> is also shown; this class is the super class
of all Scheme objects. In particular, <code>&lt;top&gt;</code> is the super class of all
standard Scheme types.</p>
</div>
<div class="paragraph">
<p>The set of slots of a given class is calculated by "unioning" the slots of all
its super class. For instance, each instance of the class <code>D</code> defined before
will have three slots (<code>a</code>, <code>b</code> and <code>d</code>). The slots of a class can be obtained
by the <code>class-slots</code> primitive.  For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">class-slots</span> <span class="nv">A</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span>
<span class="p">(</span><span class="nf">class-slots</span> <span class="nv">E</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">e</span> <span class="nv">c</span><span class="p">)</span>
<span class="p">(</span><span class="nf">class-slots</span> <span class="nv">F</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">e</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">a</span> <span class="nv">f</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of slots is not significant.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_class_precedence_list">Class precedence list</h5>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>A class may have more than one superclass <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>With single inheritance (only one superclass), it is easy to order the super
classes from most to least specific.  This is the rule:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Rule 1: Each class is more specific than its superclasses.</strong></p>
</div>
</div>
</div>
<div class="paragraph">
<p>With multiple inheritance, ordering is harder.  Suppose we have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">X</span> <span class="p">()</span>
   <span class="p">((</span><span class="nf">x</span> <span class="nv">:init-form</span> <span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-class</span> <span class="nv">Y</span> <span class="p">()</span>
   <span class="p">((</span><span class="nf">x</span> <span class="nv">:init-form</span> <span class="mi">2</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-class</span> <span class="nv">Z</span> <span class="p">(</span><span class="nf">X</span> <span class="nv">Y</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">z</span> <span class="nv">:init-form</span> <span class="mi">3</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, given <strong>Rule 1</strong>, the <code>Z</code> class is more specific than the <code>X</code> or <code>Y</code>
class for instances of <code>Z</code>.  However, the <code>:init-form</code> specified in <code>X</code> and
<code>Y</code> leads to a problem: which one overrides the other?  Or, stated
differently, which is the default initial value of the <code>x</code> slot of a <code>Z</code>
instance.  The rule in <strong><em>STklos</em></strong>, as in CLOS, is that the superclasses listed
earlier are more specific than those listed later.  So:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Rule 2: For a given class, superclasses listed earlier are more specific than those listed later.</strong></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These rules are used to compute a linear order for a class and all its
superclasses, from most specific to least specific.  This order is called the
"<strong><em>class precedence list</em></strong>" of the class.  Given these two rules, we can claim
that the initial form for the <code>x</code> slot of previous example is 1 since the
class <code>X</code> is placed before <code>Y</code> in the super classes of <code>Z</code>.  These two rules
are not always sufficient to determine a unique order.  However, they give an
idea of how the things work. <strong><em>STklos</em></strong> algorithm for calculating the class
precedence list of a class is a little simpler than the CLOS one described in
<a href="#AMOP">[AMOP]</a> for breaking ties.  Consequently, the calculated class
precedence list by <strong><em>STklos</em></strong> algorithm can be different than the one given by
the CLOS one in some subtle situations.  Taking the <code>F</code> class shown in <a href="#class_hierarchy">Figure 1</a>,
the <strong><em>STklos</em></strong> calculated class precedence list is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">F</span> <span class="nv">D</span> <span class="nv">E</span> <span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> <span class="nv">&lt;object&gt;</span> <span class="nv">&lt;top&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>whereas it would be the following list with a CLOS-like algorithm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">F</span> <span class="nv">D</span> <span class="nv">E</span> <span class="nv">A</span> <span class="nv">C</span> <span class="nv">B</span> <span class="nv">&lt;object&gt;</span> <span class="nv">&lt;top&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> However, it is usually considered a bad idea for
programmers to rely on exactly what the order is.  If the order for some
superclasses is important, it can be expressed directly in the class
definition.  The precedence list of a class can be obtained by the function
<code>class-precedence-list</code>.  This function returns a ordered list whose first
element is the most specific class.  For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">class-precedence-list</span> <span class="nv">D</span><span class="p">)</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="o">#</span><span class="p">[</span><span class="nf">&lt;class&gt;</span> <span class="nv">D</span> <span class="mi">81</span><span class="nv">aebb8</span><span class="p">]</span> <span class="o">#</span><span class="p">[</span><span class="nf">&lt;class&gt;</span> <span class="nv">A</span> <span class="mi">81</span><span class="nv">aab88</span><span class="p">]</span>
        <span class="o">#</span><span class="p">[</span><span class="nf">&lt;class&gt;</span> <span class="nv">B</span> <span class="mi">81</span><span class="nv">aa720</span><span class="p">]</span> <span class="o">#</span><span class="p">[</span><span class="nf">&lt;class&gt;</span> <span class="nv">&lt;object&gt;</span> <span class="mi">80</span><span class="nv">eff90</span><span class="p">]</span>
        <span class="o">#</span><span class="p">[</span><span class="nf">&lt;class&gt;</span> <span class="nv">&lt;top&gt;</span> <span class="mi">80</span><span class="nv">effa8</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> However, this result is hard to read; using the function
<code>class-name</code> yields a clearer result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">map</span> <span class="nv">class-name</span> <span class="p">(</span><span class="nf">class-precedence-list</span> <span class="nv">D</span><span class="p">))</span>
  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">D</span> <span class="nv">A</span> <span class="nv">B</span> <span class="nv">&lt;object&gt;</span> <span class="nv">&lt;top&gt;</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generic_function">8.2.3. Generic function</h4>
<div class="sect4">
<h5 id="_generic_functions_and_methods">Generic functions and methods</h5>
<div class="paragraph">
<p>


Neither <strong><em>STklos</em></strong> nor CLOS use the message passing mechanism
for methods as most Object Oriented languages do.  Instead, they
use the notion of <strong><em>generic function</em></strong>.A generic function
can be seen as a "<strong><em>tanker</em></strong>" of methods.  When the
evaluator requests the application of a generic function, all the
applicable methods of this generic function will be grabbed and
the most specific among them will be applied.  We say that a
method <code>M</code> is <strong><em>more specific</em></strong> than a method <code>M'</code>
if the class of its parameters are more specific than the <code>M'</code>
ones.  To be more precise, when a generic function must be
"<strong><em>called</em></strong>" the system</p>
</div>
<div class="ulist">
<ul>
<li>
<p>searchs among all the generic function methods those which
are applicable (i.e.  the ones which filter on types which are
<strong><em>compatible</em></strong> with the actual argument list),</p>
</li>
<li>
<p>sorts the list of applicable methods in the "<strong><em>most specific</em></strong>"
order,</p>
</li>
<li>
<p>calls the most specific method of this list (i.e.  the
first of the list of sorted methods).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>

The definition of a generic function is done with the
<code>define-generic</code> macro. Definition of a new method is
done with the <code>define-method</code> macro.</p>
</div>
<div class="paragraph">
<p>Consider the following definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-generic</span> <span class="nv">M</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span><span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;integer&gt;</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span> <span class="ss">'integer</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span><span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;real&gt;</span><span class="p">)</span>    <span class="nv">b</span><span class="p">)</span> <span class="ss">'real</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span>             <span class="ss">'top</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>define-generic</code> call defines <code>M</code> as a
generic function.  Note that the signature of the generic
function is not given upon definition, contrarily to CLOS.  This
permits methods with different signatures for a given generic
function, as we shall see later.  The three next lines define
methods for the <code>M</code> generic function.  Each method uses a
sequence of <strong><em>parameter specializers</em></strong> that specify when
the given method is applicable.  A specializer permits to
indicate the class a parameter must belong (directly or
indirectly) to be applicable.  If no specializer is given, the
system defaults it to <code>&lt;top&gt;</code>&gt;.  Thus, the first method
definition is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span><span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;integer&gt;</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">&lt;top&gt;</span><span class="p">))</span> <span class="ss">'integer</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let us look at some possible calls to generic
function <code>M</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">M</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>      <span class="nv">=&gt;</span> <span class="nv">integer</span>
<span class="p">(</span><span class="nf">M</span> <span class="mi">2</span> <span class="no">#t</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="nv">integer</span>
<span class="p">(</span><span class="nf">M</span> <span class="mf">1.2</span> <span class="ss">'a</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="nv">real</span>
<span class="p">(</span><span class="nf">M</span> <span class="no">#t</span> <span class="no">#f</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="nv">top</span>
<span class="p">(</span><span class="nf">M</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="nv">error</span> <span class="p">(</span><span class="nf">no</span> <span class="nv">method</span> <span class="nv">with</span> <span class="mi">3</span> <span class="nv">parameters</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding methods use only one specializer per parameter
list. Of course, each parameter can use a specializer.  In this
case, the parameter list is scanned from left to right to
determine the applicability of a method.  Suppose we declare now</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">`</span><span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span> <span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;integer&gt;</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">&lt;number&gt;</span><span class="p">))</span>
    <span class="ss">'integer-number</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span> <span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;integer&gt;</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">&lt;real&gt;</span><span class="p">))</span>
    <span class="ss">'integer-real</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span> <span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">&lt;number&gt;</span><span class="p">))</span>
    <span class="ss">'top-number</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">M</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
    <span class="ss">'three-parameters</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, we have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">M</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="nv">integer-integer</span>
<span class="p">(</span><span class="nf">M</span> <span class="mi">1</span> <span class="mf">1.0</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="nv">integer-real</span>
<span class="p">(</span><span class="nf">M</span> <span class="ss">'a</span> <span class="mi">1</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="nv">top-number</span>
<span class="p">(</span><span class="nf">M</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="nv">three-parameters</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Before defining a new generic function <code>define-generic,</code> verifies if
the symbol given as parameter is already bound to a procedure in the
current environment.  If so, this procedure is added, as a method to
the newly created generic function.  For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-generic</span> <span class="nv">log</span><span class="p">)</span>  <span class="c1">; transform "log" in a generic function</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">log</span> <span class="p">((</span><span class="nf">s</span> <span class="nv">&lt;string&gt;</span><span class="p">)</span> <span class="o">.</span> <span class="nv">l</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">apply</span> <span class="nv">format</span>  <span class="p">(</span><span class="nf">current-error-port</span><span class="p">)</span> <span class="nv">s</span> <span class="nv">l</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">newline</span> <span class="p">(</span><span class="nf">current-error-port</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">log</span> <span class="s">"Hello, ~a"</span> <span class="s">"world"</span><span class="p">)</span>      <span class="nv">|-</span> <span class="nv">Hello,</span> <span class="nv">world</span>
<span class="p">(</span><span class="nb">log</span> <span class="mi">1</span><span class="p">)</span>                        <span class="nv">=&gt;</span> <span class="mi">0</span> <span class="c1">; standard "log" procedure</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>define-method</code> automatically defines the
generic function if it has not been defined before.
Consequently, most of the time, the <code>define-generic</code> is
not needed.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_next_method">Next-method</h5>
<div class="paragraph">
<p>

When a generic function is called, the list of applicable
methods is built.  As mentioned before, the most specific method
of this list is applied (see <a href="#_generic_function">Section 8.2.3</a>).</p>
</div>
<div class="paragraph">
<p>This method may call, if needed, the next method in the list of
applicable methods.  This is done by using the special form
<code>next-method</code>.  Consider the following definitions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-method</span> <span class="nv">Test</span><span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;integer&gt;</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">cons</span> <span class="ss">'integer</span> <span class="p">(</span><span class="nf">next-method</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">Test</span><span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;number&gt;</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">cons</span> <span class="ss">'number</span>  <span class="p">(</span><span class="nf">next-method</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="nv">Test</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">list</span> <span class="ss">'top</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With those definitions, we have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">Test</span> <span class="mi">1</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">integer</span> <span class="nv">number</span> <span class="nv">top</span><span class="p">)</span>
<span class="p">(</span><span class="nf">Test</span> <span class="mf">1.0</span><span class="p">)</span>   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">number</span> <span class="nv">top</span><span class="p">)</span>
<span class="p">(</span><span class="nf">Test</span> <span class="no">#t</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">top</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_standard_generic_functions">Standard  generic functions</h5>
<div class="paragraph">
<p>

<strong>Printing objects</strong></p>
</div>
<div class="paragraph">
<p>When the Scheme primitives <code>write</code> or <code>display</code> are called with a
parameter which is an object, the <code>write-object</code> or <code>display-object</code>
generic functions are called with this object and the port to which
the printing must be done as parameters.  This facility permits to
define a customized printing for a class of objects by simply defining
a new method for this class.  So, defining a new printing method
overloads the standard printing method (which just prints the class of
the object and its hexadecimal address).</p>
</div>
<div class="paragraph">
<p>For instance, we can define a customized printing for the <code>&lt;point&gt;</code>
used before as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-method</span> <span class="nv">display-object</span> <span class="p">((</span><span class="nf">p</span> <span class="nv">&lt;point&gt;</span><span class="p">)</span> <span class="nv">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">format</span> <span class="nv">port</span> <span class="s">"&lt;Point x=~S y=~S&gt;"</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">'x</span><span class="p">)</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">'y</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, we have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;point&gt;</span> <span class="nv">:x</span> <span class="mi">1</span> <span class="nv">:y</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nb">display</span> <span class="nv">p</span><span class="p">)</span>                         <span class="nv">|=</span> <span class="nv">&lt;Point</span> <span class="nv">x=1</span> <span class="nv">y=2&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Scheme primitive <code>write</code> tries to write objects, in such a way
that they are readable back with the <code>read</code> primitive.  Consequently,
we can define the writing of a <code>&lt;point&gt;</code> as a form which, when read,
will build back this point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-method</span> <span class="nv">write-object</span> <span class="p">((</span><span class="nf">p</span> <span class="nv">&lt;point&gt;</span><span class="p">)</span> <span class="nv">port</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">format</span> <span class="nv">port</span> <span class="s">"#,(make &lt;point&gt; :x ~S :y ~S)"</span>
              <span class="p">(</span><span class="nf">get-x</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">get-y</span> <span class="nv">p</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this method, writing the <code>p</code> point defined before
prints the following text on the output port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">#,</span><span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;point&gt;</span> <span class="nv">:x</span> <span class="mi">1</span> <span class="nv">:y</span> <span class="mi">2</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note here the usage of the <code>#,</code>  notation of <strong><a href="http://srfi.schemers.org/srfi-10/srfi-10.html">SRFI-10</a></strong> (<em>Sharp Comma External Form</em>) used here
to "evaluate" the form when reading it. We suppose here that we are in a context
where we already defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-reader-ctor</span> <span class="ss">'make</span> <span class="p">(</span><span class="k">lambda</span> <span class="nv">l</span> <span class="p">(</span><span class="nb">eval</span> <span class="o">`</span><span class="p">(</span><span class="nf">make</span> <span class="o">,@</span><span class="nv">l</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Comparing objects</strong><br>


When objects are compared with the <code>eqv?</code> or <code>equal?</code> Scheme standard
primitives, <strong><em>STklos</em></strong> calls the <code>object-eqv?</code> or <code>object-equal?</code>
generic functions.  This facility permits to define a customized
comparison function for a class of objects by simply defining a new
method for this class.  Defining a new comparison method overloads the
standard comparaison method (which always returns <code>#f</code>).  For instance
we could define the following method to compare points:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-method</span> <span class="nv">object-eqv?</span> <span class="p">((</span><span class="nf">a</span> <span class="nv">&lt;point&gt;</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">&lt;point&gt;</span><span class="p">))</span>
  <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nf">point-x</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-x</span> <span class="nv">b</span><span class="p">))</span>
       <span class="p">(</span><span class="nb">=</span> <span class="p">(</span><span class="nf">point-y</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-y</span> <span class="nv">b</span><span class="p">))))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_system_reference">8.3. Object System Reference</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This section needs to be written.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_main_functions_and_sytaxes">8.4. Main Functions and sytaxes</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-class name supers slots . options)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates a class whose name is <code>name</code>, and whose superclasses are in the
list <code>supers</code>, with the slots specified by the list <code>slots</code>.</p>
</div>
<div class="paragraph">
<p>As an example, this is the definition of a point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;point&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In another example, a class <code>&lt;circle&gt;</code> that inherits <code>&lt;point&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;circle&gt;</span> <span class="p">(</span><span class="nf">&lt;point&gt;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">radius</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options can be passed to slots:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:init-form</code> is the default value for the slot.</p>
</li>
<li>
<p><code>:init-keyword</code> is the keyword for initializing the slot.</p>
</li>
<li>
<p><code>:getter</code> is the name of the getter method.</p>
</li>
<li>
<p><code>:setter</code> is the name of the setter method.</p>
</li>
<li>
<p><code>:accessor</code> is the name of the accessor (setter and getter) method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;point&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">x</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:getter</span> <span class="nv">get-x</span> <span class="nv">:setter</span> <span class="nv">set-x!</span> <span class="nv">:init-keyword</span> <span class="nv">:x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">y</span> <span class="nv">:init-form</span> <span class="mi">0</span> <span class="nv">:getter</span> <span class="nv">get-y</span> <span class="nv">:setter</span> <span class="nv">set-y!</span> <span class="nv">:init-keyword</span> <span class="nv">:y</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> also defines setters for the specified getters, so the following
will work with the definition of <code>&lt;point&gt;</code> given above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">my-point</span> <span class="ss">'x</span><span class="p">)</span> <span class="mi">50</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Accessors, are methods which can be used as getter and setter, as shown bellow</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;circle&gt;</span> <span class="p">(</span><span class="nf">&lt;point&gt;</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">radius</span> <span class="nv">:accessor</span> <span class="nv">radius</span> <span class="nv">:init-keyword</span> <span class="nv">:radius</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;circle&gt;</span> <span class="nv">:radius</span> <span class="mi">100</span><span class="p">))</span>
<span class="p">(</span><span class="nf">radius</span> <span class="nv">x</span><span class="p">)</span>                             <span class="nv">=&gt;</span> <span class="mi">100</span>
<span class="p">(</span><span class="k">set!</span> <span class="p">(</span><span class="nf">radius</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">200</span><span class="p">)</span>
<span class="p">(</span><span class="nf">radius</span> <span class="nv">x</span><span class="p">)</span>                             <span class="nv">=&gt;</span> <span class="mi">200</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(find-class name)</code></strong><br>
<strong><code>(find-class name default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the class whose name is equal to symbol <code>name</code>. If <code>name</code> is not
a class instance, the <code>default</code> value is returned, if present.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(is-a? obj class)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an instance of <code>class</code>, and <code>#f</code> otherwise.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_threads_mutexes_and_condition_variables">9. Threads, Mutexes and Condition Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>



The thread system provides the following data types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Thread (a virtual processor which shares object
space with all other threads)</p>
</li>
<li>
<p>Mutex (a mutual exclusion device,
also known as a lock and binary semaphore)</p>
</li>
<li>
<p>Condition variable (a set of blocked threads)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong><em>STklos</em></strong> thread system is conform to <strong><a href="http://srfi.schemers.org/srfi-18/srfi-18.html">SRFI-18</a></strong> (<em>Multithreading support</em>), and implement
all the SRFI mechanisms. See this SRFI documentation for a more complete
description</p>
</div>
<div class="sect2">
<h3 id="_threads">9.1. Threads</h3>
<div id="make-thread" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-thread thunk)</code></strong><br>
<strong><code>(make-thread thunk name)</code></strong><br>
<strong><code>(make-thread thunk name stack-size)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new thread. This thread is not automatically made runnable
(the procedure <code>thread-start!</code> must be used for this). A thread has the
following fields:  name, specific, end-result, end-exception, and a list
of locked/owned mutexes it owns. The thread&#8217;s execution consists of a call
to thunk with the "initial continuation". This continuation causes the
(then) current thread to store the result in its end-result field, abandon
all mutexes it owns, and finally terminate. The dynamic-wind
stack of the initial continuation is empty. The optional name is an
arbitrary Scheme object which identifies the thread (useful for debugging);
it defaults to an unspecified value. The specific field is set to an
unspecified value.  The thread inherits the dynamic environment from the
current thread. Moreover, in this dynamic environment the exception handler
is bound to the "initial exception handler" which is a unary procedure
which causes the (then) current thread to store in its end-exception
field an "uncaught exception" object whose "reason" is the argument
of the handler, abandon all mutexes it owns, and finally terminate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The optional parameter <code>stack-size</code> permits to specify
the size (in words) reserved for the thread. This option does not exist
in <strong><a href="http://srfi.schemers.org/srfi-18/srfi-18.html">SRFI-18</a></strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(current-thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the current thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nf">current-thread</span><span class="p">)</span> <span class="p">(</span><span class="nf">current-thread</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-start! thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Makes <code>thread</code> runnable. The <code>thread</code> must be a new thread.
<code>Thread-start!</code> returns the thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">thread-start!</span> <span class="p">(</span><span class="nf">make-thread</span>
                           <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">write</span> <span class="ss">'a</span><span class="p">))))))</span>
   <span class="p">(</span><span class="nb">write</span> <span class="ss">'b</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">thread-join!</span> <span class="nv">t</span><span class="p">))</span>       <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
                               <span class="nv">after</span> <span class="nv">writing</span> <span class="nv">ab</span> <span class="nv">or</span> <span class="nv">ba</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-yield!)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The current thread exits the running state as if its quantum had
expired. <code>Thread-yield!</code> returns an unspecified value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-terminate! thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Causes an abnormal termination of the <code>thread</code>. If the <code>thread</code> is not
already terminated, all mutexes owned by the <code>thread</code> become
unlocked/abandoned and a "terminated thread exception" object is stored
in the thread&#8217;s end-exception field. If <code>thread</code> is the current thread,
<code>thread-terminate!</code> does not return. Otherwise, <code>thread-terminate!</code>
returns an unspecified value; the termination of the thread will occur
before <code>thread-terminate!</code> returns.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>This operation must be used carefully because it terminates a thread
abruptly and it is impossible for that thread to perform any kind of
cleanup. This may be a problem if the thread is in the middle of a
critical section where some structure has been put in an inconsistent
state. However, another thread attempting to enter this critical section
will raise an "abandoned mutex exception" because the mutex is
unlocked/abandoned.</p>
</li>
<li>
<p>On <em>Android</em>, <code>thread-terminate!</code> can be used only to terminate the
current thread.  Trying to kill another thread produces an error.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-sleep! timeout)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The current thread waits until the <code>timeout</code> is reached. This blocks the
thread only if timeout represents a point in the future. It is an error
for timeout to be <code>#f</code>. <code>Thread-sleep!</code> returns an unspecified value.</p>
</div>
<div id="thread-join" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-join! thread)</code></strong><br>
<strong><code>(thread-join! thread timeout)</code></strong><br>
<strong><code>(thread-join! thread timeout timeout-val)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The current thread waits until the <code>thread</code> terminates (normally or not)
or until the timeout is reached if <code>timeout</code> is supplied.
If the timeout is reached, <code>thread-join!</code> returns <code>timeout-val</code> if it is
supplied, otherwise a "join timeout exception" is raised.
If the <code>thread</code> terminated normally, the content of the end-result
field is returned, otherwise the content of the end-exception field
is raised.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">thread-start!</span> <span class="p">(</span><span class="nf">make-thread</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                                       <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">100</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">thread-sleep!</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">thread-join!</span> <span class="nv">t</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">1267650600228229401496703205376</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a thread, otherwise returns <code>#f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">thread?</span> <span class="p">(</span><span class="nf">current-thread</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">thread?</span> <span class="ss">'foo</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-name thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name of the <code>thread</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">thread-name</span> <span class="p">(</span><span class="nf">make-thread</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="no">#f</span><span class="p">)</span> <span class="ss">'foo</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="nv">foo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-stack-size thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the allocated stack size for <code>thread</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">thread-stack-size</span> <span class="p">(</span><span class="nf">make-thread</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="no">#f</span><span class="p">)</span> <span class="ss">'foo</span> <span class="mi">2000</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">2000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this procedure is not present in <strong><a href="http://srfi.schemers.org/srfi-18/srfi-18.html">SRFI-18</a></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-specific thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the content of the `thread&#8217;s specific field.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-specific-set! thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>obj</code> into the <code>thread&#8217;s specific field. `Thread-specific-set!</code>
returns an unspecified value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">thread-specific-set!</span> <span class="p">(</span><span class="nf">current-thread</span><span class="p">)</span> <span class="s">"hello"</span><span class="p">)</span>
           <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nf">thread-specific</span> <span class="p">(</span><span class="nf">current-thread</span><span class="p">))</span>
           <span class="nv">=&gt;</span>  <span class="s">"hello"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mutexes">9.2. Mutexes</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-mutex)</code></strong><br>
<strong><code>(make-mutex name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new mutex in the unlocked/not-abandoned state. The optional <code>name</code>
is an arbitrary Scheme object which identifies the mutex
(useful for debugging); it defaults to an unspecified value.
The mutex&#8217;s specific field is set to an unspecified value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if obj is a mutex, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex-name mutex)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name of the <code>mutex</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">mutex-name</span> <span class="p">(</span><span class="nf">make-mutex</span> <span class="ss">'foo</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="nv">foo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex-specific mutex)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the content of the `mutex&#8217;s specific field.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex-specific! mutex obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>obj</code> into the `mutex&#8217;s specific field and eturns an unspecified value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">m</span> <span class="p">(</span><span class="nf">make-mutex</span><span class="p">))</span>
<span class="p">(</span><span class="nf">mutex-specific-set!</span> <span class="nv">m</span> <span class="s">"hello"</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="nv">unspecified</span>
<span class="p">(</span><span class="nf">mutex-specific</span> <span class="nv">m</span><span class="p">)</span>               <span class="nv">=&gt;</span>  <span class="s">"hello"</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">mutex-lock-recursively!</span> <span class="nv">mutex</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nf">mutex-state</span> <span class="nv">mutex</span><span class="p">)</span> <span class="p">(</span><span class="nf">current-thread</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">n</span> <span class="p">(</span><span class="nf">mutex-specific</span> <span class="nv">mutex</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">mutex-specific-set!</span> <span class="nv">mutex</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">begin</span>
        <span class="p">(</span><span class="nf">mutex-lock!</span> <span class="nv">mutex</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">mutex-specific-set!</span> <span class="nv">mutex</span> <span class="mi">0</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">mutex-unlock-recursively!</span> <span class="nv">mutex</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">n</span> <span class="p">(</span><span class="nf">mutex-specific</span> <span class="nv">mutex</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">mutex-unlock!</span> <span class="nv">mutex</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">mutex-specific-set!</span> <span class="nv">mutex</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex-state mutex)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns information about the state of the <code>mutex</code>. The possible results
are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a thread <strong>T</strong>: the mutex is in the locked/owned state and
thread <strong>T</strong> is the owner of the mutex</p>
</li>
<li>
<p>the symbol <strong>not-owned</strong>: the mutex is in the locked/not-owned
state</p>
</li>
<li>
<p>the symbol <strong>abandoned</strong>: the mutex is in the unlocked/abandoned
state</p>
</li>
<li>
<p>the symbol <strong>not-abandoned</strong>: the mutex is in the
unlocked/not-abandoned state</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">mutex-state</span> <span class="p">(</span><span class="nf">make-mutex</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="nv">not-abandoned</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">thread-alive?</span> <span class="nv">thread</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">mutex</span> <span class="p">(</span><span class="nf">make-mutex</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">mutex-lock!</span> <span class="nv">mutex</span> <span class="no">#f</span> <span class="nv">thread</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">state</span> <span class="p">(</span><span class="nf">mutex-state</span> <span class="nv">mutex</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">mutex-unlock!</span> <span class="nv">mutex</span><span class="p">)</span> <span class="c1">; avoid space leak</span>
      <span class="p">(</span><span class="nb">eq?</span> <span class="nv">state</span> <span class="nv">thread</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex-lock! mutex)</code></strong><br>
<strong><code>(mutex-lock! mutex timeout)</code></strong><br>
<strong><code>(mutex-lock! mutex timeout thread)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>mutex</code> is currently locked, the current thread waits until the
<code>mutex</code> is unlocked, or until the timeout is reached if <code>timeout</code> is supplied.
If the <code>timeout</code> is reached, <code>mutex-lock!</code> returns <code>#f</code>.
Otherwise, the state of the mutex is changed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if thread is <code>#f</code> the mutex becomes <em>locked/not-owned</em>,</p>
</li>
<li>
<p>otherwise, let T be thread (or the current thread if thread
is not supplied),</p>
<div class="ulist">
<ul>
<li>
<p>if T is terminated the mutex becomes <em>unlocked/abandoned</em>,</p>
</li>
<li>
<p>otherwise mutex becomes <em>locked/owned</em> with T as the owner.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After changing the state of the mutex, an "abandoned mutex exception" is
raised if the mutex was unlocked/abandoned before the state change,
otherwise <code>mutex-lock!</code> returns <code>#t</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">sleep!</span> <span class="nv">timeout</span><span class="p">)</span>
  <span class="c1">;; an alternate implementation of thread-sleep!</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">m</span> <span class="p">(</span><span class="nf">make-mutex</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">mutex-lock!</span> <span class="nv">m</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">mutex-lock!</span> <span class="nv">m</span> <span class="nv">timeout</span> <span class="no">#f</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(mutex-unlock! mutex)</code></strong><br>
<strong><code>(mutex-unlock! mutex condition-variable)</code></strong><br>
<strong><code>(mutex-unlock! mutex condition-variable timeout)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Unlocks the <code>mutex</code> by making it unlocked/not-abandoned. It is not an error
to unlock an unlocked mutex and a mutex that is owned by any thread.
If <code>condition-variable</code> is supplied, the current thread is blocked and
added to the <code>condition-variable</code> before unlocking <code>mutex</code>; the thread
can unblock at any time but no later than when an appropriate call to
<code>condition-variable-signal!</code> or <code>condition-variable-broadcast!</code> is
performed (see below), and no later than the timeout (if timeout is
supplied). If there are threads waiting to lock this mutex, the scheduler
selects a thread, the <code>mutex</code> becomes locked/owned or locked/not-owned,
and the thread is unblocked. <code>mutex-unlock!</code> returns <code>#f</code> when the
<code>timeout</code> is reached, otherwise it returns <code>#t</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_condition_variables">9.3. Condition Variables</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-conditon-variable)</code></strong><br>
<strong><code>(make-conditon-variable name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new empty condition variable. The optional <code>name</code> is an arbitrary
Scheme object which identifies the condition variable (useful for debugging);
it defaults to an unspecified value. The condition variable&#8217;s specific
field is set to an unspecified value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(conditon-variable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a condition variable, otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(conditon-variable-name conditon-variable)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the name of the <code>condition-variable</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(conditon-variable-specific conditon-variable)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the content of the `condition-variable&#8217;s specific field.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(conditon-variable-specific-set! conditon-variable obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Stores <code>obj</code> into the `condition-variable&#8217;s specific field.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition-variable-signal! condition-variable)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If there are threads blocked on the <code>condition-variable</code>, the scheduler
selects a thread and unblocks it. <code>Condition-variable-signal!</code>  returns
an unspecified value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(condition-variable-broadcast! condition-variable)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Unblocks all the threads blocked on the <code>condition-variable</code>.
<code>Condition-variable-broadcast!</code> returns an unspecified value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conditions_2">9.4. Conditions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(join-timeout-exception? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a <em>join timeout exception</em> object,
otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>A <em>join timeout exception</em> is raised when thread-join! is called, the timeout
is reached and no timeout-val is supplied.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(abandoned-mutex-exception? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an <em>abandoned mutex exception</em> object,
otherwise returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>An <em>abandoned mutex exception</em> is raised when the current thread locks
a mutex that was owned by a thread which terminated ,(see <code>mutex-lock!</code>).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(terminated-thread-exception? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is a <em>terminated thread exception</em> object, otherwise
returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>A <em>terminated thread exception</em> is raised when thread-join! is
called and the target thread has terminated as a result of a call to
<code>thread-terminate!</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(uncaught-exception? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>obj</code> is an <em>uncaught exception</em> object, otherwise
returns <code>#f</code>.</p>
</div>
<div class="paragraph">
<p>An <em>uncaught exception</em> is raised when <code>thread-join!</code> is called and the
target thread has terminated because it raised an exception that called
the initial exception handler of that thread.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(uncaught-exception-reason exc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the object which was passed to the initial exception handler
of that thread (<code>exc</code> must be an <em>uncaught exception</em> object).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stklos_customization">10. STklos Customization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_parameter_objects_2">10.1. Parameter Objects</h3>
<div class="paragraph">
<p><strong><em>STklos</em></strong> environement can be customized using Parameter Objects. These
parmaters are listed below.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(real-precision)</code></strong><br>
<strong><code>(real-precision value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This parameter object permits to change the default precision used
to print real numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">real-precision</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="mi">15</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">f</span> <span class="mf">0.123456789</span><span class="p">)</span>
<span class="p">(</span><span class="nb">display</span> <span class="nv">f</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="mf">0.123456789</span>
<span class="p">(</span><span class="nf">real-precision</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nb">display</span> <span class="nv">f</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="mf">0.123</span></code></pre>
</div>
</div>
<div id="srfi169" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(accept-srfi-169-numbers)</code></strong><br>
<strong><code>(accept-srfi-169-numbers value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This parameter object permits to change the behavior of the reader
with underscores in numbers. Numbers with underscores are defined
in ,(link-srfi 169). By default, this variable is true, meaning that
underscores are accepted in numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">accept-srfi-169-numbers</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nb">symbol?</span> <span class="ss">'1_000_000</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nb">number?</span> <span class="ss">'1_000_000</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">accept-srfi-169-numbers</span> <span class="no">#f</span><span class="p">)</span>
<span class="p">(</span><span class="nb">symbol?</span> <span class="ss">'1_000_000</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nb">number?</span> <span class="ss">'1_000_000</span><span class="p">)</span>             <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(read-case-sensitive)</code></strong><br>
<strong><code>(read-case-sensitive value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This parameter object permits to change the default behaviour of
the <code>read</code> primitive when reading a symbol. If this parameter has
a true value a symbol is not converted to a default case when interned.
Since R<sup>7</sup>RS requires that symbol are case insignificant, the default
value  of this parameter is <code>#t</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">read-case-sensitive</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="o">`</span><span class="no">#t</span><span class="o">`</span>
<span class="p">(</span><span class="nf">read-from-string</span> <span class="s">"ABC"</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="nv">ABC</span>
<span class="p">(</span><span class="nf">read-case-sensitive</span> <span class="no">#f</span><span class="p">)</span>
<span class="p">(</span><span class="nf">read-from-string</span> <span class="s">"ABC"</span><span class="p">)</span>     <span class="nv">=&gt;</span> <span class="nv">abc</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Default behaviour can be changed for a whole execution
with the <code>--case-sensitive</code> or <code>case-insensitive</code> options.</p>
</li>
<li>
<p>See also syntax for <em><a href="#_symbols">special characters</a></em> in symbols.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(write-pretty-quotes)</code></strong><br>
<strong><code>(write-pretty-quotes value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This parameter object permits to change the default behaviour of
the <code>display</code> or <code>write</code> primitives when they write a list which starts with
 the symbol quote,  quasiquote, unquote or unquote-splicing. If this parameter
has a false value, the writer uses the list notation instead of a
more human-readable value.
By default, this parameter value is set to <code>#t</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">x</span> <span class="o">'</span><span class="ss">'a</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">display</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display</span> <span class="s">" "</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">write-pretty-quotes</span> <span class="no">#f</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display</span> <span class="nv">x</span><span class="p">))</span>               <span class="nv">|-</span> <span class="ss">'a</span> <span class="p">(</span><span class="k">quote</span> <span class="nv">a</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div id="loadpath" class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(load-path)</code></strong><br>
<strong><code>(load-path value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>load-path</code> is a parameter object. It
returns the current load path. The load path is a list of strings
which correspond to the directories in which a file must be searched for
loading. Directories of the load path are ,(emph "prepended") (in
their apparition
order) to the file name given to <code>load</code> or <code>try-load</code> until the file
can be loaded.</p>
</div>
<div class="paragraph">
<p>The initial value of the current load path can be set from the shell, by
setting the <code>STKLOS_LOAD_PATH</code> shell variable.</p>
</div>
<div class="paragraph">
<p>Giving a <code>value</code> to the parameter <code>load-path</code> permits to change the
current list of paths.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(load-suffixes)</code></strong><br>
<strong><code>(load-suffixes value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>load-suffixes</code> is a parameter object. It
returns the list of possible suffixes for a Scheme file. Each suffix,
must be a string. Suffixes are appended (in their apparition order)
to a file name  is appended to a file name given to <code>load</code> or <code>try-load</code>
until the file can be loaded.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(load-verbose)</code></strong><br>
<strong><code>(load-verbose value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>load-verbose</code> is a parameter object. It permits to display the
path name of the files which are loaded by <code>load</code> or <code>try-load</code> on
the current error port, when set to a true value. If <code>load-verbose</code>
is set to <code>#f</code>, no message is printed.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(thread-handler-error-show)</code></strong><br>
<strong><code>(thread-handler-error-show value)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When an untrapped error occurs in a thread, it produces an
<a href="#make-thread"><em>uncaught exception</em></a> which can finally be
trapped when the thread is <a href="#thread-join"><em>joined</em></a>.
Setting the <code>thread-handler-error-show</code> parameter permits to see
error message as soon as possible, even without joining the thread.
This makes debugging easier. By default, this parameter is set to
<code>#t</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(stklos-debug-level)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>stklos-debug-level</code> is a parameter objet. It permits to know the current
debugging level. The default value of this parameter is 0 (meaning "no debug").
Note that the debugging level can also be set by the <code>--debug</code> option of the
<code>stklos(1)</code> command.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(repl-theme)</code></strong><br>
<strong><code>(repl-theme plist)</code></strong><br>
<strong><code>(repl-theme name)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <strong><em>STklos</em></strong> REPL colors can be customized using a property list (or a theme
name) using the <code>repl-theme</code> parameter. The properties that can be used in this
property list are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>#:error</code> for the color of error messages</p>
</li>
<li>
<p><code>#:prompt</code> for the color of the prompt</p>
</li>
<li>
<p><code>#:help-prompt</code> for the color of the help prompt</p>
</li>
<li>
<p><code>#:help</code> for the color of the help messages</p>
</li>
<li>
<p><code>#:repl-depth</code> for the color of the depth indicator for recursive REPLs</p>
</li>
<li>
<p><code>#:info</code> for the color of information messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are three default themes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>classic</strong> which is the (colorful) default theme.</p>
</li>
<li>
<p><strong>monochrome</strong> which doesn&#8217;t use colors</p>
</li>
<li>
<p><strong>minimal</strong> where only the prompt and errors are colored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Colors are expressed using the conventions of
<a href="#ansicolor">the <code>ansi-color</code> primitive</a>. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">key-set!</span> <span class="p">(</span><span class="nf">repl-theme</span><span class="p">)</span> <span class="nv">:prompt</span> <span class="o">'</span><span class="p">(</span><span class="nf">bold</span> <span class="nv">green</span><span class="p">))</span> <span class="c1">;; set the prompt to bold green</span>

<span class="p">(</span><span class="nf">repl-theme</span> <span class="ss">'minimal</span><span class="p">)</span>                         <span class="c1">;; to use a sober prompt</span>

<span class="p">(</span><span class="nf">repl-theme</span> <span class="o">'</span><span class="p">(</span><span class="o">#</span><span class="nv">:error</span> <span class="p">(</span><span class="nf">bold</span> <span class="nv">red</span><span class="p">)</span>              <span class="c1">;; explicitly defined theme</span>
              <span class="o">#</span><span class="nv">:prompt</span> <span class="p">(</span><span class="nf">bold</span> <span class="nv">bg-red</span> <span class="nv">white</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A good place to change your theme is the <code>.stklosrc</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables">10.2. Environment variables</h3>
<div class="paragraph">
<p>The following variables can be used to customize <strong><em>STklos</em></strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>STKLOS_LOAD_PATH</strong>: This is a colon-separated list
of directories in which stklos looks for loading files. It is used by
primitives such as <code><a href="#load">load</a></code> or <code><a href="#tryload">try-load</a></code>.  See also the
<code><a href="#loadpath">load-path</a></code> parameter.</p>
</li>
<li>
<p><strong>STKLOS-FRAME</strong>: This variable must contains an integer
which indicates the number of frames printed on an error. Use
the value 0 for an unlimited backtrace.</p>
</li>
<li>
<p><strong>STKLOS-CONFDIR</strong>: This variable can be used to
designate the directory used by <strong><em>STklos</em></strong> to store its configuration or
packages files. It not set, the default <strong><em>STklos</em></strong> configuration directory
is by default <code>~/.stklos</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_scmpkg_package_system">11. The ScmPkg Package System</h2>
<div class="sectionbody">
<div class="paragraph">
<p>
<em>ScmPkg</em> is a package distribution system for Scheme. It is
currently supported by Bigloo and <strong><em>STklos</em></strong>. This package system
provides new APIs to Scheme (e.g., network programming,
cryptography, encoding, &#8230;&#8203;) and it manages automatic package
installation, deinstallation and testing.</p>
</div>
<div class="sect2">
<h3 id="_scmpkg_tutorial">11.1. <em>ScmPkg</em> "tutorial"</h3>
<div class="paragraph">
<p><code>stklos-pkg</code> is the command which gives access to <em>ScmPkg</em> in <strong><em>STklos</em></strong>.
This is the only command necessary to manage <em>ScmPkg</em> packages. For
instance, this command manages a local cache of the <em>ScmPkg</em> server, permits
(de)installation of <em>ScmPkg</em> packages, the test of packages, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>To start, we can synchronize our local repository with the <em>ScmPkg</em>
servers. This can be done by the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ stklos-pkg --sync</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will download a description of the <em>ScmPkg</em> packages
which are available. The list of these packages can be displayed with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ stklos-pkg --list
_bigloo-1.0.1 (tuning)
_bigloo-regexp-0.0.1
_bigloo-stdlib-0.0.1 (tuning)
_chicken-0.0.1 (tuning)
_chicken-net-0.0.1 (tuning)
_chicken-os-0.0.1
rfc3339-0.2.0
srfi1-0.0.1 (tuning)
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Packages whose name start by an underscore are packages needed for
alien language support (e.g. the package "<em>bigloo" is necessary to
run a package written in the Bigloo Scheme dialect, or the package
"_chicken-net" is necessary for the packages using the network
primitives of the Chicken Scheme dialect). Some packages may offer
a tuning. A tuned package is a package which has been specially
tuned for <strong>_STklos</em></strong> (e.g. the generic "srfi1" package which
implement SRFI-1 has been tuned to be more efficient in STklos)</p>
</div>
<div class="paragraph">
<p>To download a new package (and all its dependencies), one can simply
issue the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ stklos-pkg --extract PKG --directory /tmp/Test</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command downloads the package <em>PKG</em>, its dependencies
and (eventually) its tuning. It also creates a <code>Makefile</code>
for compiling the package.  The <code>--directory</code> option
specifies where the files must be extracted in the <code>/tmp/Test</code>
directory (instaed of the current directory). The generated <code>Makefile</code>
offers the following main targets</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>all</strong> : the default target</p>
</li>
<li>
<p><strong>test:</strong> to launch the package tests</p>
</li>
<li>
<p><strong>install:</strong> to install the package for the user</p>
</li>
<li>
<p><strong>system-install:</strong> to install the package system wide (privilegied access
rights are probably needed)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To test a package, one can also use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\type{$} stklos-pkg --test PKG</code></pre>
</div>
</div>
<div class="paragraph">
<p>This downloads the necessary files in a temporary directory,
and launches the tests of the package <em>PKG</em></p>
</div>
<div class="paragraph">
<p>To install a package, one can also use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>$ stklos-pkg --install PKG</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command downloads the necessary files in a temporary directory,
and installs the package <em>PKG</em>.</p>
</div>
<div class="paragraph">
<p>This completes the basis <em>ScmPkg</em> tutorial. See below for
the list of all stklos-pkg options</p>
</div>
</div>
<div class="sect2">
<h3 id="_stklos_pkg_options">11.2. stklos-pkg options</h3>
<div class="paragraph">
<p>Here are the options supported by the stklos-pkg command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Usage: stklos-pkg [options] [parameter ...]
Actions
  --extract=&lt;pkg&gt;, -e &lt;pkg&gt;    Extract &lt;pkg&gt;. Don't install it
  --test=&lt;pkg&gt;, -t &lt;pkg&gt;       Test &lt;pkg&gt;.
  --install=&lt;pkg&gt;, -i &lt;pkg&gt;    Extract, compile, Install &lt;pkg&gt;.
  --uninstall=&lt;pkg&gt;            un-install package &lt;pkg&gt;
Repository administration
  --sync, -s                   synchronize with remote server servers
  --add=&lt;sb&gt;, -a &lt;sb&gt;          Add &lt;sb&gt; pkgball to the local repository
  --download=&lt;pkg&gt;             download &lt;pkg&gt;
  --fill-cache                 fill cache with available distant packages
  --clear-cache                delete packages present in cache
  --reset                      reset stklos-pkg repository. USE WITH CAUTION
  --build-sync-file=&lt;dir&gt;      Build a synchronization file from &lt;dir&gt;
Informations
  --list, -l                   list available packages
  --depends=&lt;pkg&gt;              Show all the dependencies of &lt;pkg&gt;
  --installed                  Show installed packages
Misc
  --conf-dir=&lt;dir&gt;, -D &lt;dir&gt;   Use &lt;dir&gt; as stklos main configuration directory
  --directory=&lt;dir&gt;, -C &lt;dir&gt;  Change to directory &lt;dir&gt; (extract/download)
  --verbose, -v                be verbose (can be cumulated)
  --system-wide, -S            do a system wide (de)installation
  --version, -V                print the version and exit
  --help, -h                   display this help
  --options                    display program options
  --cp                         INTERNAL USE ONLY. Do not use this option</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_foreign_function_interface">12. Foreign Function Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>The <strong><em>STklos</em></strong> Foreign Function Interface (FFI for short) has been
defined to allow an easy access to functions written in C without
needing to build C-wrappers and, consequently, without any need to
write C code.  FFI is very machine dependent and <strong><em>STklos</em></strong> uses the
<a href="https://sourceware.org/libffi/"><strong>libffi library</strong></a>, a portable Foreign Function
Interface library, to give access to C written code.
This library supports a large set of architectures/OS that are
described on its Home Page.</p>
</div>
<div class="paragraph">
<p>Moreover, since FFI allows very low level access, it is easy to crash
the <strong><em>STklos</em></strong> VM when using an external C function.</p>
</div>
<div class="paragraph">
<p><strong>Note that the support for FFI is still minimal and that it will
evolve in future versions.</strong></p>
</div>
<div class="sect2">
<h3 id="_external_functions">12.1. External functions</h3>
<div class="paragraph">
<p>The definition of an external function is done with the
<code>define-external</code> special form.  This form takes as arguments
a typed list of parameters and accepts several options to define the
name of the function in the C world, the library which defines this
function, &#8230;&#8203; The type of the function result and the type of its
arguments are defined in <a href="#ffi_types">Table 1</a>. This table lists
the various keywords reserved for denoting types and their equivalence
between the C and the Scheme worlds.</p>
</div>
<table id="ffi_types" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. FFI types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Corresponding C type</th>
<th class="tableblock halign-left valign-top">Corresponding Scheme type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:void</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:char</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:short</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:ushort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:int</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:uint</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:long</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:ulong</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned long int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:float</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme real number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:double</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme real number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:boolean</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:pointer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme pointer object or Scheme string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:string</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheme string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>:obj</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any Scheme object passed as is</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> syntax</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(define-external name parameters option)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The form <code>define-external</code> binds a new procedure to <code>name</code>.
The arity of this new procedure is defined by the typed list of
parameters given by <code>parameters</code>. This parameters list is a list
of keywords (as defined in the previous table) or couples whose first
element is the name of the parameter, and the second one is a type
keyword.  All the types defined in the above table, except
<code>:void</code>, are allowed for the parameters of a foreign function.</p>
</div>
<div class="paragraph">
<p><code>Define-external</code> accepts several options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:return-type</code> is used to define the type of the value returned
by the foreign function. The type returned must be chosen in the types specified
in the table. For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-external</span> <span class="nv">maximum</span><span class="p">(</span><span class="nf">:int</span> <span class="nv">:int</span><span class="p">)</span>
   <span class="nv">:return-type</span> <span class="nv">:int</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>defines the foreign function maximum which takes two C integers and
returns an integer result. Omitting this option default to a result
type equal to <code>:void</code> (i.e. the returned value is <em>undefined</em>).</p>
</div>
</li>
<li>
<p><code>:entry-name</code> is used to specify the name of the foreign
function in the C world. If this option is omitted, the entry-name is
supposed to be <code>name</code>. For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-external</span> <span class="nv">minimum</span><span class="p">((</span><span class="nf">a</span> <span class="nv">:int</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">:int</span><span class="p">))</span>
   <span class="nv">:return-type</span> <span class="nv">:int</span>
   <span class="nv">:entry-name</span>  <span class="s">"min"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>defines the Scheme function <code>minimum</code> whose application
executes the C function called <code>min</code>.</p>
</div>
</li>
<li>
<p><code>:library-name</code> is used to specify the library which contains the
foreign-function. If necessary, the library is loaded before calling the
C function. So,</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-external</span> <span class="nv">minimum</span><span class="p">((</span><span class="nf">a</span> <span class="nv">:int</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">:int</span><span class="p">))</span>
   <span class="nv">:return-type</span>  <span class="nv">:int</span>
   <span class="nv">:entry-name</span>   <span class="s">"min"</span>
   <span class="nv">:library-name</span> <span class="s">"libminmax"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>defines a function which will execute the function <code>min</code>
located in the library <code>libminmax.xx</code> (where <code>xx</code> is the suffix used
for shared libraries on the running system (generally <code>so</code>)).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hereafter, are some commented definitions of external functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="nf">define-external</span> <span class="nv">isatty</span> <span class="p">((</span><span class="nf">fd</span> <span class="nv">:int</span><span class="p">))</span>
     <span class="nv">:return-type</span> <span class="nv">:boolean</span><span class="p">)</span>

  <span class="p">(</span><span class="nf">define-external</span> <span class="nv">system</span> <span class="p">((</span><span class="nf">cmd</span> <span class="nv">:string</span><span class="p">))</span>
    <span class="nv">:return-type</span> <span class="nv">:int</span><span class="p">)</span>

  <span class="p">(</span><span class="nf">define-external</span> <span class="nv">ttyname</span> <span class="p">(</span><span class="nf">:int</span><span class="p">)</span>
    <span class="nv">:return-type</span> <span class="nv">:string</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All these functions are defined in the C standard library, hence it is not
necessary to specify the <code>:library-name</code> option.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>istty</em></strong> is declared here as a function which takes an
integer and returns a boolean (in fact, the value returned by the
C function <strong><em>isatty</em></strong> is an <strong><em>int</em></strong>, but we ask here to the FFI
system to translate this result as a boolean value in the Scheme
world).</p>
</li>
<li>
<p><strong><em>system</em></strong> is a function which takes a string as parameter
and returns an <strong><em>int</em></strong>.</p>
</li>
<li>
<p><strong><em>ttyname</em></strong> is a function whih takes an int and returns a string.
Note that in this function the name of the parameter has been omitted
as within C prototypes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an external function receives an <code>:int</code> argument and is passed a
Scheme bignum, which then doesn&#8217;t fit a <strong><em>long int</em></strong> in C, the
external function will signal an error. When a <code>:float</code> or <code>:double</code>
argument is declared and is passed a Scheme real that requires so many
bits so as to not be representable in that type, that argument will be
silently taken as infinity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="nf">define-external</span> <span class="nv">c-abs</span> <span class="p">((</span><span class="nf">fd</span> <span class="nv">:int</span><span class="p">))</span>
     <span class="nv">:entry-name</span> <span class="s">"abs"</span>
     <span class="nv">:return-type</span> <span class="nv">:int</span><span class="p">)</span>

 <span class="p">(</span><span class="nf">define-external</span> <span class="nv">c-fabs</span> <span class="p">((</span><span class="nf">fd</span> <span class="nv">:double</span><span class="p">))</span>
     <span class="nv">:entry-name</span> <span class="s">"fabs"</span>
     <span class="nv">:return-type</span> <span class="nv">:double</span><span class="p">)</span>

 <span class="p">(</span><span class="nf">define-external</span> <span class="nv">c-fabsf</span> <span class="p">((</span><span class="nf">fd</span> <span class="nv">:float</span><span class="p">))</span>
     <span class="nv">:entry-name</span> <span class="s">"fabsf"</span>
     <span class="nv">:return-type</span> <span class="nv">:float</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use the function we have just defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">c-abs</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">70</span><span class="p">)))</span>    <span class="nv">=&gt;</span> <span class="nv">Error</span>
<span class="p">(</span><span class="nf">c-fabs</span> <span class="mf">-1.0</span><span class="nv">e+250</span><span class="p">)</span>         <span class="nv">=&gt;</span> <span class="mi">1</span><span class="nv">e+250</span>
<span class="p">(</span><span class="nf">c-fabsf</span> <span class="mf">-1.0</span><span class="nv">e+250</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="m">+inf.0</span>
<span class="p">(</span><span class="nf">c-fabs</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">10</span> <span class="mi">300</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="mi">1</span><span class="nv">e+300</span>
<span class="p">(</span><span class="nf">c-fabs</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">10</span> <span class="mi">600</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="m">+inf.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following example we use the <code>:string</code> type. C functions accepting
pointers to null-terminated strings are directly translated to this type.</p>
</div>
<div class="paragraph">
<p>The POSIX function <code>strpbrk</code> accepts two string arguments (in C, two
pointers to <code>char</code>). The C call <code>strpbrk(str1, str2)</code> returns a
pointer to the first occurrence in the string <code>str1</code> of one of the
bytes in the string <code>str2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-external</span> <span class="nv">c-strpbrk</span> <span class="p">((</span><span class="nf">str</span> <span class="nv">:string</span><span class="p">)</span> <span class="p">(</span><span class="nf">accept</span> <span class="nv">:string</span><span class="p">))</span>
    <span class="nv">:entry-name</span> <span class="s">"strpbrk"</span>
    <span class="nv">:return-type</span> <span class="nv">:string</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">c-strpbrk</span> <span class="s">"a string"</span> <span class="s">"rz"</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"ring"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it would be possible to use a <code>:pointer</code> type instead for the return
value, although in this case it would be more cumbersome (but does help understand
the FFI better!):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-external</span> <span class="nv">c-strpbrk</span> <span class="p">((</span><span class="nf">str</span> <span class="nv">:string</span><span class="p">)</span> <span class="p">(</span><span class="nf">accept</span> <span class="nv">:string</span><span class="p">))</span>
    <span class="nv">:entry-name</span> <span class="s">"strpbrk"</span>
    <span class="nv">:return-type</span> <span class="nv">:pointer</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">c-strpbrk</span> <span class="s">"a string"</span> <span class="s">"rz"</span><span class="p">)</span>
                            <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">[</span><span class="nf">C-pointer</span> <span class="mi">7</span><span class="nv">f17baf94d06</span> <span class="nv">@</span> <span class="mi">7</span><span class="nv">f17bafb4360</span><span class="p">]</span>
<span class="p">(</span><span class="nf">cpointer-&gt;string</span> <span class="p">(</span><span class="nf">c-strpbrk</span> <span class="s">"a string"</span> <span class="s">"rz"</span><span class="p">))</span>
                            <span class="nv">=&gt;</span> <span class="s">"ring"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Functions on C pointers are described in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_c_pointers">12.2. C pointers</h3>
<div class="paragraph">
<p>It is very common that external functions return pointers, serving as
handles on internal structures. This pointers, called hereafter
<strong>cpointers</strong>, are then boxed in a Scheme objects. This section presents
the functions that can be used to deal with C pointers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Note that by using <strong>cpointers</strong> objects, one gives up the safety of
the Scheme environment, and care must be taken to avoid memory corruptions,
errors, crashes&#8230;&#8203;
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cpointer? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is a cpointer (a Scheme object which encapsulate
a pointer to a C object), and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cpointer-null? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is a cpointer and its value is the C NULL value.
Returnd <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cpointer-data obj)</code></strong><br>
<strong><code>(cpointer-data-set! obj adr)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>cpointer-data</code> returns the value associated to cpointer <code>obj</code>
(that is the value of the pointer itself: an address).</p>
</div>
<div class="paragraph">
<p><code>cpointer-data-set!</code> permits to change the pointer stored in the <code>obj</code>
cpointer to <code>adr</code>. This is of course very dangerous and could lead to
fatal errors.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cpointer-type obj)</code></strong><br>
<strong><code>(cpointer-type-set! obj tag)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>cpointer-type</code> returns the tag type associated to a cpointer. The C
runtime or an extension can associate * a tag to a cpointer to make
 some controls  (for instance, verify that <code>obj</code> is a cpointer  on a
<code>widget</code> structure). This function returns <strong>void</strong> if a type has not
been set before. The semantic associated to this tag is completely
left to the extension writer.</p>
</div>
<div class="paragraph">
<p><code>cpointer-type-set!</code> permits to set the tag of the <code>obj</code> cpointer to
<code>tag</code> (which can be of any type).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(cpointer&#8594;string str)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the C (null terminated) string <code>str</code> as a Scheme string.
If <code>str</code> doesn&#8217;t contain a C string, the result will probably result
in a fatal error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">define-external</span> <span class="nv">c-ghn</span> <span class="p">((</span><span class="nf">s</span> <span class="nv">:pointer</span><span class="p">)</span> <span class="p">(</span><span class="nf">size</span> <span class="nv">:int</span><span class="p">))</span>
                 <span class="nv">:entry-name</span> <span class="s">"gethostname"</span>
                 <span class="nv">:return-type</span> <span class="nv">:int</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">name</span> <span class="p">(</span><span class="nf">allocate-bytes</span> <span class="mi">10</span><span class="p">))</span>

<span class="nv">name</span>                    <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">[</span><span class="nf">C-pointer</span> <span class="mi">7</span><span class="nv">fd830820f80</span> <span class="nv">@</span> <span class="mi">7</span><span class="nv">fd8305bee40</span><span class="p">]</span>
<span class="p">(</span><span class="nf">c-ghn</span> <span class="nv">name</span> <span class="mi">9</span><span class="p">)</span>          <span class="nv">=&gt;</span> <span class="mi">0</span>
<span class="p">(</span><span class="nf">cpointer-&gt;string</span> <span class="nv">name</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">"socrates"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(allocate-bytes n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Allocate-bytes</code> will allocate <code>n</code> consecutive bytes using
the standard STklos allocation function (which uses the
Boehm–Demers–Weiser garbage collector <a href="#BoehmGC">[BoehmGC]</a>).
It returns a <code>cpointer</code> Scheme object that points to the first byte
allocated. This pointer is managed by the  standard GC and doesn&#8217;t need
to be freed.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(free-bytes obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Obj</code> must be a <code>cpointer</code> to allocated data. When <code>Free-bytes</code> is called
on <code>obj</code>, it will deallocate its data calling
- the C function <code>free</code> (if it  was allocated by the standard C <code>malloc</code>
  function), or
- the Boehm GC free  function (if the pointer was allocated using
  <code>allocate-bytes</code> primitive).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">allocate-bytes</span> <span class="mi">10</span><span class="p">))</span>
<span class="nv">a</span>   <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">[</span><span class="nf">C-pointer</span> <span class="mi">7</span><span class="nv">fd91e8e0f80</span> <span class="nv">@</span> <span class="mi">7</span><span class="nv">fd91e897b70</span><span class="p">]</span>
<span class="p">(</span><span class="nf">cpointer-type-set!</span> <span class="nv">a</span> <span class="ss">'myadress</span><span class="p">)</span>
<span class="nv">a</span>   <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">[</span><span class="nf">myadress-pointer</span> <span class="mi">7</span><span class="nv">fd91e8e0f80</span> <span class="nv">@</span> <span class="mi">7</span><span class="nv">fd91e897b70</span><span class="p">]</span>
<span class="p">(</span><span class="nf">free-bytes</span> <span class="nv">a</span><span class="p">)</span>
<span class="nv">a</span>   <span class="nv">=&gt;</span> <span class="o">#</span><span class="p">[</span><span class="nf">myadress-pointer</span> <span class="mi">0</span> <span class="nv">@</span> <span class="mi">7</span><span class="nv">fd91e897b70</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the call to <code>free-bytes</code>, when <code>a</code> is printed, the first number
shown is zero, indicating that its data pointer does not point to
allocated memory (a NULL value for C).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_slib_package">13. Using the SLIB package</h2>
<div class="sectionbody">
<div class="paragraph">
<p>

<strong><em>SLIB</em></strong> is a library for the programming language Scheme, written by
Aubrey Jaffer <a href="#SLIB">[SLIB]</a>.   It provides a platform independent framework for
using packages of Scheme procedures and syntax. It uses only standard Scheme
syntax and thus works on many different Scheme implementations.</p>
</div>
<div class="paragraph">
<p>To  use this package, you have just to type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require</span> <span class="s">"slib"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or use the <strong><a href="http://srfi.schemers.org/srfi-96/srfi-96.html">SRFI-96</a></strong> (<em>SLIB Prerequisites</em>) with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">import</span> <span class="p">(</span><span class="nf">srfi</span> <span class="mi">96</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and follow the instructions given in the <strong><em>SLIB</em></strong> library manual to
use a particular package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong><em>SLIB</em></strong> uses also the <em>require</em> and <em>provide</em> mechanism to load
components of the library. Once <strong><em>SLIB</em></strong> has been loaded, the standard
<strong><em>STklos</em></strong> <code>require</code> and <code>provide</code> are overloaded such as if their
parameter is a string this is the old <strong><em>STklos</em></strong> procedure which is
called, and if their parameter is a symbol, this is the <strong><em>SLIB</em></strong> one
which is called.</p>
</div>
<div class="paragraph">
<p><strong><em>SLIB</em></strong> needs to create a catalog of the file that must be loaded to
implement a given feature. This catalog is stored in a file named
<code>slibcat</code> This file is, by default located in the
<code>~/.stklos/slib</code> directory.  It is possible to change this
directory with the <code>STKLOS_IMPLEMENTATION_PATH</code> shell variable.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> searches the <strong><em>SLIB</em></strong> implementation directory in some standard
places. If not found, you can fix it with the <code>SCHEME_LIBRARY_PATH</code> shell
variable.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_srfis">14. SRFIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>
Scheme Request For Implementation (<a href="http://srfi.schemers.org">SRFI</a>)
process grew out of the Scheme Workshop held
in Baltimore, MD, on September 26, 1998, where the attendees considered a
number of proposals for standardized feature sets for inclusion in Scheme
implementations. Many of the proposals received overwhelming support in a
series of straw votes. Along with this there was concern that the next Revised
Report would not be produced for several years and this would prevent the
timely implementation of standardized approaches to several important problems
and needs in the Scheme community.</p>
</div>
<div class="paragraph">
<p>Only the implemented SRFIs are (briefly) presented here. For further
information on each SRFI, please look at the official
SRFI <a href="http://srfi.schemers.org">site</a>.</p>
</div>
<div class="sect2">
<h3 id="_supported_srfis">14.1. Supported SRFIs</h3>
<div class="paragraph">
<p><strong><em>STklos</em></strong> supports <strong>117</strong> finalized SRFIS.
Some of these SRFIS are <em>embedded</em> and some are <em>external</em>.</p>
</div>
<div class="paragraph">
<p>An <em>embedded</em> SRFI can be directly used without any particular action,
whereas an <em>external</em> needs to be loaded before use.</p>
</div>
<div class="paragraph">
<p>The following SRFIS are implemented:</p>
</div>
<div class="paragraph small">
<p>-  <strong><a href="http://srfi.schemers.org/srfi-0/srfi-0.html">SRFI-0</a></strong>&#8201;&#8212;&#8201;<em>Feature-based conditional expansion construct</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-1/srfi-1.html">SRFI-1</a></strong>&#8201;&#8212;&#8201;<em>List Library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-2/srfi-2.html">SRFI-2</a></strong>&#8201;&#8212;&#8201;<em>AND-LET*: an AND with local bindings, a guarded LET* special form</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-4/srfi-4.html">SRFI-4</a></strong>&#8201;&#8212;&#8201;<em>Homogeneous numeric vector datatypes</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-5/srfi-5.html">SRFI-5</a></strong>&#8201;&#8212;&#8201;<em>A compatible let form with signatures and rest arguments</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-6/srfi-6.html">SRFI-6</a></strong>&#8201;&#8212;&#8201;<em>Basic String Ports</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-7/srfi-7.html">SRFI-7</a></strong>&#8201;&#8212;&#8201;<em>Feature-based program configuration language</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-8/srfi-8.html">SRFI-8</a></strong>&#8201;&#8212;&#8201;<em>Receive: Binding to multiple values</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-9/srfi-9.html">SRFI-9</a></strong>&#8201;&#8212;&#8201;<em>Defining Record Types</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-10/srfi-10.html">SRFI-10</a></strong>&#8201;&#8212;&#8201;<em>Sharp Comma External Form</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-11/srfi-11.html">SRFI-11</a></strong>&#8201;&#8212;&#8201;<em>Syntax for receiving multiple values</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-13/srfi-13.html">SRFI-13</a></strong>&#8201;&#8212;&#8201;<em>String Library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-14/srfi-14.html">SRFI-14</a></strong>&#8201;&#8212;&#8201;<em>Character-Set Library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-15/srfi-15.html">SRFI-15</a></strong>&#8201;&#8212;&#8201;<em>Syntax for dynamic scoping (withdrawn)</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-16/srfi-16.html">SRFI-16</a></strong>&#8201;&#8212;&#8201;<em>Syntax for procedures of variable arity</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-17/srfi-17.html">SRFI-17</a></strong>&#8201;&#8212;&#8201;<em>Generalized set!</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-18/srfi-18.html">SRFI-18</a></strong>&#8201;&#8212;&#8201;<em>Multithreading support</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-19/srfi-19.html">SRFI-19</a></strong>&#8201;&#8212;&#8201;<em>Time Data Types and Procedures</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-22/srfi-22.html">SRFI-22</a></strong>&#8201;&#8212;&#8201;<em>Running Scheme Scripts on Unix</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-23/srfi-23.html">SRFI-23</a></strong>&#8201;&#8212;&#8201;<em>Error reporting mechanism</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-25/srfi-25.html">SRFI-25</a></strong>&#8201;&#8212;&#8201;<em>Multi-dimensional Arrays</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-26/srfi-26.html">SRFI-26</a></strong>&#8201;&#8212;&#8201;<em>Notation for Specializing Parameters without Currying</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-27/srfi-27.html">SRFI-27</a></strong>&#8201;&#8212;&#8201;<em>Source of random bits</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-28/srfi-28.html">SRFI-28</a></strong>&#8201;&#8212;&#8201;<em>Basic Format Strings</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-29/srfi-29.html">SRFI-29</a></strong>&#8201;&#8212;&#8201;<em>Localization</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-30/srfi-30.html">SRFI-30</a></strong>&#8201;&#8212;&#8201;<em>Nested Multi-line Comments</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-31/srfi-31.html">SRFI-31</a></strong>&#8201;&#8212;&#8201;<em>A special form for recursive evaluation</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-34/srfi-34.html">SRFI-34</a></strong>&#8201;&#8212;&#8201;<em>Exception Handling for Programs</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI-35</a></strong>&#8201;&#8212;&#8201;<em>Conditions</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-36/srfi-36.html">SRFI-36</a></strong>&#8201;&#8212;&#8201;<em>I/O Conditions</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-37/srfi-37.html">SRFI-37</a></strong>&#8201;&#8212;&#8201;<em>args-fold: a program argument processor</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-38/srfi-38.html">SRFI-38</a></strong>&#8201;&#8212;&#8201;<em>External representation of shared structures</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-39/srfi-39.html">SRFI-39</a></strong>&#8201;&#8212;&#8201;<em>Parameters objects</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI-41</a></strong>&#8201;&#8212;&#8201;<em>Streams</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-43/srfi-43.html">SRFI-43</a></strong>&#8201;&#8212;&#8201;<em>Vector library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-45/srfi-45.html">SRFI-45</a></strong>&#8201;&#8212;&#8201;<em>Primitives for Expressing Iterative Lazy Algorithms</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-48/srfi-48.html">SRFI-48</a></strong>&#8201;&#8212;&#8201;<em>Intermediate Format Strings</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-51/srfi-51.html">SRFI-51</a></strong>&#8201;&#8212;&#8201;<em>Handling rest list</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-54/srfi-54.html">SRFI-54</a></strong>&#8201;&#8212;&#8201;<em>Formatting</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-55/srfi-55.html">SRFI-55</a></strong>&#8201;&#8212;&#8201;<em>Require-extension</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-59/srfi-59.html">SRFI-59</a></strong>&#8201;&#8212;&#8201;<em>Vicinity</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-60/srfi-60.html">SRFI-60</a></strong>&#8201;&#8212;&#8201;<em>Integers as bits</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-61/srfi-61.html">SRFI-61</a></strong>&#8201;&#8212;&#8201;<em>A more general COND clause</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-62/srfi-62.html">SRFI-62</a></strong>&#8201;&#8212;&#8201;<em>S-expression comments</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-64/srfi-64.html">SRFI-64</a></strong>&#8201;&#8212;&#8201;<em>A Scheme API for test suites</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-66/srfi-66.html">SRFI-66</a></strong>&#8201;&#8212;&#8201;<em>Octet Vectors</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI-69</a></strong>&#8201;&#8212;&#8201;<em>Basic Hash Tables</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-70/srfi-70.html">SRFI-70</a></strong>&#8201;&#8212;&#8201;<em>Numbers</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-74/srfi-74.html">SRFI-74</a></strong>&#8201;&#8212;&#8201;<em>Octet-Addressed Binary Blocks</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-87/srfi-87.html">SRFI-87</a></strong>&#8201;&#8212;&#8201;<em>&#8658; in case clauses</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-88/srfi-88.html">SRFI-88</a></strong>&#8201;&#8212;&#8201;<em>Keyword Objects</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-89/srfi-89.html">SRFI-89</a></strong>&#8201;&#8212;&#8201;<em>Optional Positional and Named Parameters</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-94/srfi-94.html">SRFI-94</a></strong>&#8201;&#8212;&#8201;<em>Type-Restricted Numerical Functions</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-95/srfi-95.html">SRFI-95</a></strong>&#8201;&#8212;&#8201;<em>Sorting and Merging</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-96/srfi-96.html">SRFI-96</a></strong>&#8201;&#8212;&#8201;<em>SLIB Prerequisites</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-98/srfi-98.html">SRFI-98</a></strong>&#8201;&#8212;&#8201;<em>Interface to access environment variables</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-100/srfi-100.html">SRFI-100</a></strong>&#8201;&#8212;&#8201;<em>define-lambda-object</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-111/srfi-111.html">SRFI-111</a></strong>&#8201;&#8212;&#8201;<em>Boxes</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-112/srfi-112.html">SRFI-112</a></strong>&#8201;&#8212;&#8201;<em>Environment Inquiry</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-113/srfi-113.html">SRFI-113</a></strong>&#8201;&#8212;&#8201;<em>Sets and Bags</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-116/srfi-116.html">SRFI-116</a></strong>&#8201;&#8212;&#8201;<em>Immutable List Library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-117/srfi-117.html">SRFI-117</a></strong>&#8201;&#8212;&#8201;<em>Queues based on lists</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-118/srfi-118.html">SRFI-118</a></strong>&#8201;&#8212;&#8201;<em>Simple adjustable-size strings</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-125/srfi-125.html">SRFI-125</a></strong>&#8201;&#8212;&#8201;<em>Intermediate hash tables</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-127/srfi-127.html">SRFI-127</a></strong>&#8201;&#8212;&#8201;<em>Lazy Sequences</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-128/srfi-128.html">SRFI-128</a></strong>&#8201;&#8212;&#8201;<em>Comparators (reduced)</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-129/srfi-129.html">SRFI-129</a></strong>&#8201;&#8212;&#8201;<em>Titlecase procedures</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-130/srfi-130.html">SRFI-130</a></strong>&#8201;&#8212;&#8201;<em>Cursor-based string library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-132/srfi-132.html">SRFI-132</a></strong>&#8201;&#8212;&#8201;<em>Sort Libraries</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-133/srfi-133.html">SRFI-133</a></strong>&#8201;&#8212;&#8201;<em>Vector Library (R7RS-compatible)</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-134/srfi-134.html">SRFI-134</a></strong>&#8201;&#8212;&#8201;<em>Immutable Deques</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-135/srfi-135.html">SRFI-135</a></strong>&#8201;&#8212;&#8201;<em>Immutable Texts</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-137/srfi-137.html">SRFI-137</a></strong>&#8201;&#8212;&#8201;<em>Minimal Unique Types</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-138/srfi-138.html">SRFI-138</a></strong>&#8201;&#8212;&#8201;<em>Compiling Scheme programs to executables</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-141/srfi-141.html">SRFI-141</a></strong>&#8201;&#8212;&#8201;<em>Integer Division</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-143/srfi-143.html">SRFI-143</a></strong>&#8201;&#8212;&#8201;<em>Fixnums</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-144/srfi-144.html">SRFI-144</a></strong>&#8201;&#8212;&#8201;<em>Flonums</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-145/srfi-145.html">SRFI-145</a></strong>&#8201;&#8212;&#8201;<em>Assumptions</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-151/srfi-151.html">SRFI-151</a></strong>&#8201;&#8212;&#8201;<em>Bitwise Operations</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-152/srfi-152.html">SRFI-152</a></strong>&#8201;&#8212;&#8201;<em>String Library (reduced)</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-154/srfi-154.html">SRFI-154</a></strong>&#8201;&#8212;&#8201;<em>First-class dynamic extents</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-156/srfi-156.html">SRFI-156</a></strong>&#8201;&#8212;&#8201;<em>Syntactic combiners for binary predicates</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-158/srfi-158.html">SRFI-158</a></strong>&#8201;&#8212;&#8201;<em>Generators and Accumulators</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-160/srfi-160.html">SRFI-160</a></strong>&#8201;&#8212;&#8201;<em>Homogeneous numeric vector libraries</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-161/srfi-161.html">SRFI-161</a></strong>&#8201;&#8212;&#8201;<em>Unifiable Boxes</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-162/srfi-162.html">SRFI-162</a></strong>&#8201;&#8212;&#8201;<em>Comparators sublibrary</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-169/srfi-169.html">SRFI-169</a></strong>&#8201;&#8212;&#8201;<em>Underscores in numbers</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-170/srfi-170.html">SRFI-170</a></strong>&#8201;&#8212;&#8201;<em>POSIX API</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-171/srfi-171.html">SRFI-171</a></strong>&#8201;&#8212;&#8201;<em>Transducers</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-173/srfi-173.html">SRFI-173</a></strong>&#8201;&#8212;&#8201;<em>Hooks</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-174/srfi-174.html">SRFI-174</a></strong>&#8201;&#8212;&#8201;<em>POSIX Timespecs</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-175/srfi-175.html">SRFI-175</a></strong>&#8201;&#8212;&#8201;<em>ASCII character library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-176/srfi-176.html">SRFI-176</a></strong>&#8201;&#8212;&#8201;<em>Version flag</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-180/srfi-180.html">SRFI-180</a></strong>&#8201;&#8212;&#8201;<em>JSON</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-185/srfi-185.html">SRFI-185</a></strong>&#8201;&#8212;&#8201;<em>Linear adjustable-length strings</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-189/srfi-189.html">SRFI-189</a></strong>&#8201;&#8212;&#8201;<em>Maybe and Either: optional container types</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-190/srfi-190.html">SRFI-190</a></strong>&#8201;&#8212;&#8201;<em>Coroutines Generators</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-192/srfi-192.html">SRFI-192</a></strong>&#8201;&#8212;&#8201;<em>Port Positioning</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-193/srfi-193.html">SRFI-193</a></strong>&#8201;&#8212;&#8201;<em>Command line</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-195/srfi-195.html">SRFI-195</a></strong>&#8201;&#8212;&#8201;<em>Multiple-value boxes</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-196/srfi-196.html">SRFI-196</a></strong>&#8201;&#8212;&#8201;<em>Range Objects</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-207/srfi-207.html">SRFI-207</a></strong>&#8201;&#8212;&#8201;<em>String-notated bytevectors</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-208/srfi-208.html">SRFI-208</a></strong>&#8201;&#8212;&#8201;<em>NaN procedures</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-214/srfi-214.html">SRFI-214</a></strong>&#8201;&#8212;&#8201;<em>Flexvectors</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-215/srfi-215.html">SRFI-215</a></strong>&#8201;&#8212;&#8201;<em>Central Log Exchange</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-216/srfi-216.html">SRFI-216</a></strong>&#8201;&#8212;&#8201;<em>SICP Prerequisites (Portable)</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-217/srfi-217.html">SRFI-217</a></strong>&#8201;&#8212;&#8201;<em>Integer Sets</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-219/srfi-219.html">SRFI-219</a></strong>&#8201;&#8212;&#8201;<em>Define higher-order lambda</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-221/srfi-221.html">SRFI-221</a></strong>&#8201;&#8212;&#8201;<em>Generator/accumulator sub-library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-223/srfi-223.html">SRFI-223</a></strong>&#8201;&#8212;&#8201;<em>Generalized binary search procedures</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-224/srfi-224.html">SRFI-224</a></strong>&#8201;&#8212;&#8201;<em>Integer Mappings</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-228/srfi-228.html">SRFI-228</a></strong>&#8201;&#8212;&#8201;<em>A further comparator library</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-229/srfi-229.html">SRFI-229</a></strong>&#8201;&#8212;&#8201;<em>Tagged Procedures</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-230/srfi-230.html">SRFI-230</a></strong>&#8201;&#8212;&#8201;<em>Atomic Operations</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-233/srfi-233.html">SRFI-233</a></strong>&#8201;&#8212;&#8201;<em>INI files</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-236/srfi-236.html">SRFI-236</a></strong>&#8201;&#8212;&#8201;<em>Evaluating expressions in an unspecified order</em><br>
-  <strong><a href="http://srfi.schemers.org/srfi-238/srfi-238.html">SRFI-238</a></strong>&#8201;&#8212;&#8201;<em>Codesets</em><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_srfi">14.2. Using a SRFI</h3>
<div class="paragraph">
<p>Using a particular SRFI can be done with the special form
<code>cond-expand</code> defined in <strong><a href="http://srfi.schemers.org/srfi-0/srfi-0.html">SRFI-0</a></strong> which is fully supported
by <strong><em>STklos</em></strong>. This form accepts features identifiers which are of the
form <strong><em>srfi-n</em></strong> where <strong><em>n</em></strong> represents the number of the SRFI
supported by the implementation (for instance <strong><em>srfi-1</em></strong> or
<strong><em>srfi-30</em></strong>).</p>
</div>
<div class="paragraph">
<p>For instance, to use <strong><em>srfi-n</em></strong>, you can use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">cond-expand</span>
 <span class="p">(</span><span class="nf">srfi-n</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This forms does nothing if <strong><em>srfi-n</em></strong> is an embedded SRFI and ensures that all
the files needed by this SRFI will be properly loaded if it is an external
SRFI.</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> also offers the primitive <strong>require-feature</strong> which ensures
(eventually) the loading of files needed to use a given SRFI. This primitive
accepts several forms to ensure that the SRFI can be used.  For instance, to
use <strong><a href="http://srfi.schemers.org/srfi-1/srfi-1.html">SRFI-1</a></strong> (<em>List Library</em>), the following forms are possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">require-feature</span> <span class="ss">'srfi-1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require-feature</span> <span class="s">"srfi-1"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require-feature</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require-feature</span> <span class="ss">'lists</span><span class="p">)</span>   <span class="c1">;; Since this feature name is an alias for SRFI-1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of the aliases defined for the supported SRFIs is given in
<a href="#feature_identifiers">Table 2</a>.</p>
</div>
<div class="sect3">
<h4 id="_embedded_srfis">14.2.1. Embedded SRFIs</h4>
<div class="paragraph">
<p>As said before, an <em>embedded</em> SRFI can be used directly without loading a
support file. (Note that using <strong>require-feature</strong> works too
and permits to ignore if the SRFI is embedded).</p>
</div>
<div class="paragraph">
<p><strong>List of embedded SRFIs:</strong>
 <code>srfi-0</code> <code>srfi-6</code> <code>srfi-8</code> <code>srfi-10</code> <code>srfi-11</code> <code>srfi-15</code> <code>srfi-16</code> <code>srfi-18</code> <code>srfi-22</code> <code>srfi-23</code> <code>srfi-28</code> <code>srfi-30</code> <code>srfi-31</code> <code>srfi-34</code> <code>srfi-38</code> <code>srfi-39</code> <code>srfi-45</code> <code>srfi-55</code> <code>srfi-62</code> <code>srfi-70</code> <code>srfi-87</code> <code>srfi-88</code> <code>srfi-98</code> <code>srfi-111</code> <code>srfi-112</code> <code>srfi-118</code> <code>srfi-138</code> <code>srfi-143</code> <code>srfi-145</code> <code>srfi-169</code> <code>srfi-176</code> <code>srfi-192</code> <code>srfi-193</code> <code>srfi-195</code> <code>srfi-208</code> <code>srfi-219</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_external_srfis">14.2.2. External SRFIs</h4>
<div class="paragraph">
<p>An external SRFI needs to load at least one external file. This can be done
with <strong>require</strong> or <strong>require-feature</strong>. As with embedded SRFIS, using
<strong>require-feature</strong> permits to ignore if the SRFI is external.</p>
</div>
<div class="paragraph">
<p><strong>List of external SRFIs:</strong>
<code>srfi-1</code> <code>srfi-2</code> <code>srfi-4</code> <code>srfi-5</code> <code>srfi-7</code> <code>srfi-9</code> <code>srfi-13</code> <code>srfi-14</code> <code>srfi-17</code> <code>srfi-19</code> <code>srfi-25</code> <code>srfi-26</code> <code>srfi-27</code> <code>srfi-29</code> <code>srfi-35</code> <code>srfi-36</code> <code>srfi-37</code> <code>srfi-41</code> <code>srfi-43</code> <code>srfi-48</code> <code>srfi-51</code> <code>srfi-54</code> <code>srfi-59</code> <code>srfi-60</code> <code>srfi-61</code> <code>srfi-64</code> <code>srfi-66</code> <code>srfi-69</code> <code>srfi-74</code> <code>srfi-89</code> <code>srfi-94</code> <code>srfi-95</code> <code>srfi-96</code> <code>srfi-100</code> <code>srfi-113</code> <code>srfi-116</code> <code>srfi-117</code> <code>srfi-125</code> <code>srfi-127</code> <code>srfi-128</code> <code>srfi-129</code> <code>srfi-130</code> <code>srfi-132</code> <code>srfi-133</code> <code>srfi-134</code> <code>srfi-135</code> <code>srfi-137</code> <code>srfi-141</code> <code>srfi-144</code> <code>srfi-151</code> <code>srfi-152</code> <code>srfi-154</code> <code>srfi-156</code> <code>srfi-158</code> <code>srfi-160</code> <code>srfi-161</code> <code>srfi-162</code> <code>srfi-170</code> <code>srfi-171</code> <code>srfi-173</code> <code>srfi-174</code> <code>srfi-175</code> <code>srfi-180</code> <code>srfi-185</code> <code>srfi-189</code> <code>srfi-190</code> <code>srfi-196</code> <code>srfi-207</code> <code>srfi-214</code> <code>srfi-215</code> <code>srfi-216</code> <code>srfi-217</code> <code>srfi-221</code> <code>srfi-223</code> <code>srfi-224</code> <code>srfi-228</code> <code>srfi-229</code> <code>srfi-230</code> <code>srfi-233</code> <code>srfi-236</code> <code>srfi-238</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_features">14.2.3. SRFI features</h4>
<div class="paragraph">
<p>For some SRFIs, <strong><em>STklos</em></strong> accepts that uses them with a name. This names
are given <a href="#feature_identifiers">Table 2</a>.</p>
</div>
<table id="feature_identifiers" class="tableblock frame-all grid-all stretch small">
<caption class="title">Table 2. Feature identifiers</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">symbol</th>
<th class="tableblock halign-left valign-top">require SRFI(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">and-let*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hvectors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">program</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">records</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">case-lambda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-23</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-27</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args-fold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-37</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-39</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-41</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest-list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-51</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formatting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-54</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hash-tables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-69</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boxes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-111</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets-bags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-113</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">immutable-lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-116</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queues-as-lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-117</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adjustable-strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-118</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hash-table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-125</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lazy-sequences</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-127</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comparators-reduced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-128</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">titlecase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-129</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-132</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-133</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">immutable-deques</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-134</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">immutable-texts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-135</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer-division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-141</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitwise-ops</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-151</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">posix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-170</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transducers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-171</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hooks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-173</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">posix-timespecs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-174</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ascii</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-175</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-180</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maybe-either</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-189</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini-files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-233</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-35 srfi-36</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generators</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srfi-158 srfi-190</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_misc_information">14.3. Misc. Information</h3>
<div class="paragraph">
<p>Previous section described the general way to use the SRFIS implemented in
<strong><em>STklos</em></strong>.  This section concentrates on information not given above.</p>
</div>
<div class="sect3">
<h4 id="_srfi_0feature_based_conditional_expansion_construct">srfi-0&#8201;&#8212;&#8201;Feature-based conditional expansion construct</h4>
<div class="paragraph">
<p>
<strong><a href="http://srfi.schemers.org/srfi-0/srfi-0.html">SRFI-0</a></strong> defines the <code>cond-expand</code> special form. It is fully
supported by <strong><em>STklos</em></strong>. <strong><em>STklos</em></strong> defines several features identifiers which
are of the form <em>srfi-n</em> where <em>n</em> represents the number of the SRFI
supported by the implementation (for instance <em>srfi-1</em> or <em>srfi-30</em>).</p>
</div>
<div class="paragraph">
<p><strong><em>STklos</em></strong> <code>cond-expand</code> accepts also some feature identifiers which are the
same that the ones defined in <a href="#feature_identifiers">Table 2</a>, such as
<em>case_lambda</em> or <em>generators</em>.</p>
</div>
<div class="paragraph">
<p>Furthermore, the feature identifier <strong><em>stklos</em></strong> and <strong><em>STklos</em></strong> are defined for
applications which need to know on which Scheme implementation they are
running on.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_4homogeneous_numeric_vector_datatypes">srfi-4&#8201;&#8212;&#8201;Homogeneous numeric vector datatypes</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-4/srfi-4.html">SRFI-4</a></strong> is fully supported and is extended to provide the
additional <strong>c64vector</strong> and <strong>c128vector</strong> types of <strong><a href="http://srfi.schemers.org/srfi-160/srfi-160.html">SRFI-160</a></strong> (<em>Homogeneous numeric vector libraries</em>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_10sharp_comma_external_form">srfi-10&#8201;&#8212;&#8201;Sharp Comma External Form</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-10/srfi-10.html">SRFI-10</a></strong> is fully supported. This SRFI extends the
STklos reader with the <code>#,</code> notation which is fully described in
this document (see <em><a href="#readerctor">primitive <code>define-reader-ctor</code></a></em>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_16syntax_for_procedures_of_variable_arity">srfi-16&#8201;&#8212;&#8201;Syntax for procedures of variable arity</h4>
<div class="paragraph">
<p>


<strong><a href="http://srfi.schemers.org/srfi-16/srfi-16.html">SRFI-16</a></strong> is fully supported. Note that <code>case-lambda</code> is now defined in R<sup>7</sup>RS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_17generalized_set">srfi-17&#8201;&#8212;&#8201;Generalized set!</h4>
<div class="paragraph">
<p></p>
</div>
<div id="setter" class="paragraph">
<p>


<strong><a href="http://srfi.schemers.org/srfi-17/srfi-17.html">SRFI-17</a></strong> is fully supported. See the documentation of procedures <code>set!</code>
and <code>setter</code>. However, requiring explicitly <code>srfi-17</code> permits
to define the setters for the (numerous) <code>cXXXXr</code> list procedures.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_22running_scheme_scripts_on_unix">srfi-22&#8201;&#8212;&#8201;Running Scheme Scripts on Unix</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-22/srfi-22.html">SRFI-22</a></strong> describes basic prerequisites for running Scheme
programs as Unix scripts in a uniform way. Specifically, it describes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the syntax of Unix scripts written in Scheme,</p>
</li>
<li>
<p>a uniform convention for calling the Scheme script interpreter, and</p>
</li>
<li>
<p>a method for accessing the Unix command line arguments from within the
Scheme script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><a href="http://srfi.schemers.org/srfi-22/srfi-22.html">SRFI-22</a></strong> (<em>Running Scheme Scripts on Unix</em>)  recommends to invoke the Scheme script interpreter from the
script via a /usr/bin/env trampoline, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>#!/usr/bin/env stklos</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of the classical <code>echo</code> command (without option) in Scheme:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">stklos</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">main</span> <span class="nv">arguments</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="sc">#\space</span><span class="p">))</span>
            <span class="p">(</span><span class="nb">cdr</span> <span class="nv">arguments</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
  <span class="mi">0</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_23error_reporting_mechanism">srfi-23&#8201;&#8212;&#8201;Error reporting mechanism</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-23/srfi-23.html">SRFI-23</a></strong> is fully supported.  Note that the <strong><em>STklos</em></strong> <strong>error</strong>
is more general than the one defined in SRFI-23.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_25multi_dimensional_arrays">srfi-25&#8201;&#8212;&#8201;Multi-dimensional Arrays</h4>
<div class="paragraph">
<p>

<strong><em>STklos</em></strong> implements the arrays of <strong><a href="http://srfi.schemers.org/srfi-25/srfi-25.html">SRFI-25</a></strong>. All the
forms defined in the SRFI are implemented in <strong><em>STklos</em></strong>, but some other
functions, not present in the SRFI, are documented here.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(shape? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Checks if <code>obj</code> is an array shape. SRFI-25 dictates that a
shape is an ordinary array, with rank two and shape <code>(0 r 0 2)</code>,
where <code>r</code> is the rank of the array that the shape describes.
So, any array of shape <code>(0 r 0 2</code> is a shape, for any non-negative
integer <code>r</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(shared-array? array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Will return <code>#t</code> when the array has its data shared with other
arrays, and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(shape-for-each shape proc [index-object])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure will apply proc to all valid sequences of
indices in <code>shape</code>, in row-major order.</p>
</div>
<div class="paragraph">
<p>If <code>index-object</code> is not provided, then <code>proc</code> must accept
as many arguments as the number of dimensions that the shape
describes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">shape-for-each</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">10</span> <span class="mi">12</span><span class="p">)</span>
                <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">"[~a ~a]~%"</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
        <span class="nv">|-</span> <span class="p">[</span><span class="nf">1</span> <span class="mi">10</span><span class="p">]</span>
           <span class="p">[</span><span class="nf">1</span> <span class="mi">11</span><span class="p">]</span>
           <span class="p">[</span><span class="nf">2</span> <span class="mi">10</span><span class="p">]</span>
           <span class="p">[</span><span class="nf">2</span> <span class="mi">11</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>index-object</code> is provided, it is used as a place to store the
indices, so proc must accept either a vector or an array (this is to
avoid pushing and popping too many values when calling <code>proc</code>).
<code>index-object</code>, when present, must be aither a vector or array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">2</span> <span class="no">#f</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">shape-for-each</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">10</span> <span class="mi">12</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">o</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">"[~a ~a]~%"</span>
                    <span class="p">(</span><span class="nb">vector-ref</span> <span class="nv">o</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">(</span><span class="nb">vector-ref</span> <span class="nv">o</span> <span class="mi">1</span><span class="p">)))</span>
                  <span class="nv">vec</span><span class="p">))</span>
        <span class="nv">|-</span> <span class="p">[</span><span class="nf">1</span> <span class="mi">10</span><span class="p">]</span>
           <span class="p">[</span><span class="nf">1</span> <span class="mi">11</span><span class="p">]</span>
           <span class="p">[</span><span class="nf">2</span> <span class="mi">10</span><span class="p">]</span>
           <span class="p">[</span><span class="nf">2</span> <span class="mi">11</span><span class="p">]</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">arr</span> <span class="p">(</span><span class="nf">make-array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">shape-for-each</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">10</span> <span class="mi">12</span><span class="p">)</span>
                  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">o</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">"[~a ~a]~%"</span>
                    <span class="p">(</span><span class="nf">array-ref</span> <span class="nv">o</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">array-ref</span> <span class="nv">o</span> <span class="mi">1</span><span class="p">)))</span>
                  <span class="nv">arr</span><span class="p">))</span>
         <span class="nv">|-</span> <span class="p">[</span><span class="nf">1</span> <span class="mi">10</span><span class="p">]</span>
            <span class="p">[</span><span class="nf">1</span> <span class="mi">11</span><span class="p">]</span>
            <span class="p">[</span><span class="nf">2</span> <span class="mi">10</span><span class="p">]</span>
            <span class="p">[</span><span class="nf">2</span> <span class="mi">11</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(share-nths a d n)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Share-nths</code> takes every <code>n`th slice along dimension `d</code> into a shared array.
This preserves the origin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">)</span>
                 <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-3</span> <span class="mi">-4</span>
                 <span class="mi">-5</span> <span class="mi">-6</span> <span class="mi">-7</span> <span class="mi">-8</span>
                 <span class="mi">-9</span> <span class="mi">-10</span> <span class="mi">-11</span> <span class="mi">-12</span>
                 <span class="mi">-13</span> <span class="mi">-14</span> <span class="mi">-15</span> <span class="mi">-16</span><span class="p">))</span>

<span class="p">(</span><span class="nf">share-nths</span> <span class="nv">a</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span>
 <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">-1</span>  <span class="mi">-2</span>  <span class="mi">-3</span>  <span class="mi">-4</span>
                         <span class="mi">-9</span> <span class="mi">-10</span> <span class="mi">-11</span> <span class="mi">-12</span><span class="p">)</span>

<span class="p">(</span><span class="nf">share-nths</span> <span class="nv">a</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
 <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-1</span>  <span class="mi">-3</span>  <span class="mi">-5</span>  <span class="mi">-7</span>
                         <span class="mi">-9</span> <span class="mi">-11</span> <span class="mi">-13</span> <span class="mi">-15</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(share-column arr k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Shares whatever the second index is about. The result has one dimension less.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-3</span> <span class="mi">-4</span> <span class="mi">-5</span> <span class="mi">-6</span> <span class="mi">-7</span> <span class="mi">-8</span><span class="p">))</span>

<span class="p">(</span><span class="nf">share-column</span> <span class="nv">a</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-3</span> <span class="mi">-4</span> <span class="mi">-7</span> <span class="mi">-8</span><span class="p">)</span>
<span class="p">(</span><span class="nf">share-column</span> <span class="nv">a</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-5</span> <span class="mi">-6</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(share-row arr k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Shares whatever the first index is about. The result has one dimension less.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-3</span> <span class="mi">-4</span> <span class="mi">-5</span> <span class="mi">-6</span> <span class="mi">-7</span> <span class="mi">-8</span><span class="p">))</span>

<span class="p">(</span><span class="nf">share-row</span> <span class="nv">a</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-3</span> <span class="mi">-4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">share-row</span> <span class="nv">a</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">-5</span> <span class="mi">-6</span> <span class="mi">-7</span> <span class="mi">-8</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(share-array/origin arr k &#8230;&#8203;)</code></strong><br>
<strong><code>(share-array/origin arr index)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>change the origin of <code>arr</code> to <code>k</code> &#8230;&#8203;, with <code>index</code> a vector or zero-based
one-dimensional array that contains k &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span> <span class="p">)</span> <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-3</span> <span class="mi">-4</span><span class="p">))</span>

<span class="p">(</span><span class="nf">share-array/origin</span>  <span class="nv">a</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">-1</span> <span class="mi">-2</span> <span class="mi">-3</span> <span class="mi">-4</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-copy+share array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a copy of <code>array</code>.
If array does not have its own internal data, but was built using
share-array, then the new array will be similar&#8201;&#8212;&#8201;it will be a copy of
array, sharing the elements in the same way.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-size array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of elements in <code>array</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-shape array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the shape of <code>array</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array&#8594;list array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a list that contains a copy of the elements of <code>array</code>,
in row-major order.
This is not recursive, and will not flatten the array.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array&#8594;vector array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a vector that contains a copy of the elements of <code>array</code>,
in row-major order. The new vector does not share elements with
the original array (it is a fresh copy).
This is not recursive, and will not flatten the array.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-length array dim)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the length of dimension <code>dim</code> in array <code>array</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-map [shape] proc arr<sub>0</sub> arr<sub>1</sub> &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This procedure is similar to <code>map</code> for lists:
it will run <code>proc</code> on an element of each of the
<code>arr<sub>0</sub></code>, <code>arr<sub>1</sub></code>, &#8230;&#8203; arguments, storing the result in
the equivalent position of a newly created array.</p>
</div>
<div class="paragraph">
<p>The shapes of the arrays must be the same.</p>
</div>
<div class="paragraph">
<p>The procedure will create a new array with shape <code>shape</code>
(or <code>arr<sub>0</sub></code>'s shape, if <code>shape</code> was not specified).</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-map! array [shape] proc arr<sub>0</sub> arr<sub>1</sub> &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>For each valid index <code>idx</code>, applies proc to the corresponding
position in <code>arr<sub>0</sub></code>, <code>arr<sub>1</sub></code>, &#8230;&#8203;  and then sets the same
place in <code>array</code> to the result.</p>
</div>
<div class="paragraph">
<p>If <code>shape</code> is specified, it should specify a subarray of
<code>array</code>, and only that section will be mapped.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-append dim arr<sub>1</sub> arr<sub>2</sub> &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Appends arrays <code>arr<sub>1</sub></code>, <code>arr<sub>2</sub></code>, &#8230;&#8203; along the specified dimension <code>dim</code>.
The arrays must have equally many dimensions and all other dimensions
equally long.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">11</span> <span class="mi">22</span> <span class="mi">33</span> <span class="mi">44</span> <span class="mi">55</span> <span class="mi">66</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">-11</span> <span class="mi">-22</span> <span class="mi">-33</span> <span class="mi">-44</span> <span class="mi">-55</span> <span class="mi">-66</span> <span class="mi">-77</span> <span class="mi">-88</span> <span class="mi">-99</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">)</span> <span class="ss">'a</span> <span class="ss">'b</span> <span class="ss">'c</span><span class="p">))</span>

<span class="p">(</span><span class="nf">array-append</span> <span class="mi">0</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">=&gt;</span>  <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">6</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">)</span>
                                      <span class="mi">11</span>  <span class="mi">22</span>  <span class="mi">33</span>
                                      <span class="mi">44</span>  <span class="mi">55</span>  <span class="mi">66</span>
                                     <span class="mi">-11</span> <span class="mi">-22</span> <span class="mi">-33</span>
                                     <span class="mi">-44</span> <span class="mi">-55</span> <span class="mi">-66</span>
                                     <span class="mi">-77</span> <span class="mi">-88</span> <span class="mi">-99</span>
                                       <span class="nv">a</span>   <span class="nv">b</span>   <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-share-count array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of arrays that were built sharing <code>array</code>'s
elements through <code>(share-array array shape proc)</code>, and that were not
yet garbage collected.
Note that it may take a long time for an object to be garbage
collected automatically. It is possible to force a garbage
collection pass by calling <code>(gc)</code>, but even that does not guarantee that
a specific object will be collected.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-copy array)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a copy of <code>array</code>.
The new copy will have no data shared with any other array, even if the
argument <code>array</code> did.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-for-each-index arr proc [index-object])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Will loop through all valid indices of <code>array</code>, applying <code>proc</code>
to those indices.</p>
</div>
<div class="paragraph">
<p>If <code>index-object</code> is not provided, then <code>proc</code> must accept
as many arguments as the number of dimensions that the shape
describes.</p>
</div>
<div class="paragraph">
<p>If <code>index-object</code> is provided, it is used as a place to store the
indices, so <code>proc</code> must accept a vector or an array (this is to avoid
pushing and popping too many values when calling proc).
<code>index-object</code>, when present, must be aither a vector or array.</p>
</div>
<div class="paragraph">
<p>See the documentation of <code>shape-for-each</code> for more information
on <code>index-object</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(tabulate-array shape proc)</code></strong><br>
<strong><code>(tabulate-array shape proc idx)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a new array of shape <code>shape</code>, populated according
to <code>proc</code>. Each valid index in <code>shape</code> is passed to <code>proc</code>,
and the result is place in the according array position.</p>
</div>
<div class="paragraph">
<p><code>idx</code> is an object that may be used to store the indices, and
it may be either a vector or an array. If it is not present, or
if it is <code>#f</code>, then an index vector will be created internally.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(array-retabulate! arr shp proc [index-object])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sets the elements of <code>arr</code> in <code>shape</code> to the value of <code>proc</code> at that
index, using <code>index-object</code> if provided. This is similar to
<code>tabulate-array!</code>, except that the array is given by the user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">arr</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="ss">'a</span> <span class="ss">'b</span> <span class="ss">'c</span> <span class="ss">'d</span><span class="p">))</span>
<span class="p">(</span><span class="nf">array-retabulate!</span> <span class="nv">arr</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="nv">arr</span> <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(transpose arr k &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Shares <code>arr</code> with permuted dimensions. Each dimension from 0
inclusive to rank exclusive must appear once in <code>k</code> &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>This is a generalized transpose. It can permute the dimensions any which
way. The permutation is provided by a permutation matrix: a square matrix
of zeros and ones, with exactly one one in each row and column, or a
permutation of the rows of an identity matrix; the size of the matrix
must match the number of dimensions of the array.</p>
</div>
<div class="paragraph">
<p>The default permutation is <code>[ 0 1 , 1 0 ]</code> of course, but any permutation
array can be specified, and the shape array of the original array is then
multiplied with it, and index column vectors of the new array with its
inverse, from left, to permute the rows appropriately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">transpose</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">)</span>
                  <span class="mi">-1</span>  <span class="mi">-2</span>   <span class="mi">-3</span>  <span class="mi">-4</span>
                  <span class="mi">-5</span>  <span class="mi">-6</span>   <span class="mi">-7</span>  <span class="mi">-8</span>
                  <span class="mi">-9</span>  <span class="mi">-10</span> <span class="mi">-11</span> <span class="mi">-12</span>
                  <span class="mi">-13</span> <span class="mi">-14</span> <span class="mi">-15</span> <span class="mi">-16</span><span class="p">))</span>
 <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">)</span>
              <span class="mi">-1</span> <span class="mi">-5</span>  <span class="mi">-9</span> <span class="mi">-13</span>
              <span class="mi">-2</span> <span class="mi">-6</span> <span class="mi">-10</span> <span class="mi">-14</span>
              <span class="mi">-3</span> <span class="mi">-7</span> <span class="mi">-11</span> <span class="mi">-15</span>
              <span class="mi">-4</span> <span class="mi">-8</span> <span class="mi">-12</span> <span class="mi">-16</span><span class="p">)</span>

<span class="p">(</span><span class="nf">transpose</span> <span class="p">(</span><span class="nf">array</span> <span class="p">(</span><span class="nf">shape</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span>
                  <span class="mi">-1</span> <span class="mi">-2</span>
                  <span class="mi">-3</span> <span class="mi">-4</span>
                  <span class="mi">-5</span> <span class="mi">-6</span>

                  <span class="mi">-7</span> <span class="mi">-8</span>
                  <span class="mi">-9</span> <span class="mi">-10</span>
                  <span class="mi">-11</span> <span class="mi">-12</span>

                  <span class="mi">-13</span> <span class="mi">-14</span>
                  <span class="mi">-15</span> <span class="mi">-16</span>
                  <span class="mi">-17</span> <span class="mi">-18</span><span class="p">))</span>
 <span class="nv">=&gt;</span> <span class="o">#,</span><span class="p">(</span><span class="nf">&lt;array&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">)</span>
               <span class="mi">-1</span>  <span class="mi">-7</span> <span class="mi">-13</span>
               <span class="mi">-3</span>  <span class="mi">-9</span> <span class="mi">-15</span>
               <span class="mi">-5</span> <span class="mi">-11</span> <span class="mi">-17</span>

               <span class="mi">-2</span>  <span class="mi">-8</span> <span class="mi">-14</span>
               <span class="mi">-4</span> <span class="mi">-10</span> <span class="mi">-16</span>
               <span class="mi">-6</span> <span class="mi">-12</span> <span class="mi">-18</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_27source_of_random_bits">srfi-27&#8201;&#8212;&#8201;Source of random bits</h4>
<div class="paragraph">
<p>


<strong><a href="http://srfi.schemers.org/srfi-27/srfi-27.html">SRFI-27</a></strong> is fully supported. Using primitives
<code>random-integer</code> or <code>random-real</code> automatically load this SRFI.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_28basic_format_strings">srfi-28&#8201;&#8212;&#8201;Basic Format Strings</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-28/srfi-28.html">SRFI-28</a></strong> is fully supported. Note that <strong><em>STklos</em></strong> <code>format</code>
is more general than the one defined this SRFI.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_35conditions">srfi-35&#8201;&#8212;&#8201;Conditions</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI-35</a></strong> is fully supported.
See <em><a href="#_predefined_conditions">Section 7.3</a></em> for the predefined conditions
and when it is required to load this file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_36io_conditions">srfi-36&#8201;&#8212;&#8201;I/O Conditions</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-36/srfi-36.html">SRFI-36</a></strong> is fully supported.  See <em><a href="#_predefined_conditions">Section 7.3</a></em>
Conditions) for the predefined conditions and when it is required to
load this file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_55require_extension">srfi-55&#8201;&#8212;&#8201;Require-extension</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-55/srfi-55.html">SRFI-55</a></strong> is fully supported. Furthermore, <strong><em>STklos</em></strong>
also accepts the symbols defined in <a href="#feature_identifiers">Table 2</a>
in a <em>require-extension</em> clause.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_69basic_hash_tables">srfi-69&#8201;&#8212;&#8201;Basic Hash Tables</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI-69</a></strong> is fully supported. Note that the default
comparison function in <strong><em>STklos</em></strong> is <code>eq?</code> whereas it is <code>equal?</code> for
the SRFI. Furthermore the hash functions defined in the SRFI are not
defined by default in <strong><em>STklos</em></strong>. To have a fully compliant SRFI-69
behaviour, you need use a <code>require-feature</code> in your code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_88keyword_objects">srfi-88&#8201;&#8212;&#8201;Keyword Objects</h4>
<div class="paragraph">
<p>
<strong><a href="http://srfi.schemers.org/srfi-88/srfi-88.html">SRFI-88</a></strong> is fully
supported. The only difference between the keywords defined in the
SRFI document and the <strong><em>STklos</em></strong> keywords is on the zero-length
keyword: For <strong><em>STklos</em></strong>, <code>:</code> is equivalent to the keyword <code>#:||</code>,
whereas the SRFI considers that <code>:</code> is not a keyword but a symbol.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To obtain the symbol <code>:</code> in <strong><em>STklos</em></strong>, you must use <code>|:|</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_116immutable_list_library">srfi-116&#8201;&#8212;&#8201;Immutable List Library</h4>
<div class="paragraph">
<p>

<strong><em>STklos</em></strong> implements the arrays of <strong><a href="http://srfi.schemers.org/srfi-116/srfi-116.html">SRFI-116</a></strong>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipair a d)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated <code>ipair</code> whose <code>icar</code> is <code>a</code> and whose <code>icdr</code> is <code>d</code>.
The ipair is guaranteed to be different (in the sense of <code>eqv?</code>)
from every existing object.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilist obj &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated ilist of its arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nf">ilist</span> <span class="ss">'a</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="ss">'c</span><span class="p">)</span>            <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="mi">7</span> <span class="nv">c</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">ilist</span><span class="p">)</span>                          <span class="nv">=&gt;</span>  <span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Being an ilist, its CAR, CDR and all sublists are immutable.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(xipair d a)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The same as <code>(lambda (d a) (ipair a d))</code></p>
</div>
<div class="paragraph">
<p>Of utility only as a value to be conveniently passed to
higher-order procedures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">xipair</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="ss">'a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The name stands for "eXchanged Immutable PAIR."</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipair</strong> obj &#8230;&#8203;)</code>*<br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>ipair*</code> is like <code>ilist</code> except that the last argument to <code>ipair*</code> is
used as the ,(emph "cdr") of the last pair constructed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">   <span class="p">(</span><span class="nf">ipair*</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>        <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">ipair*</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="o">'</span><span class="p">(</span><span class="nf">4</span> <span class="mi">5</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">ipair*</span><span class="p">)</span>              <span class="nv">=&gt;</span> <span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-ilist n [fill])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an n-element ilist, whose elements are all the value
fill. If the fill argument is not given, the elements of the
ilist may be arbitrary values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">make-ilist</span> <span class="mi">4</span> <span class="ss">'c</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">c</span> <span class="nv">c</span> <span class="nv">c</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilist-tabulate n init-proc)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an n-element ilist. Element i of the ilist,
where 0 &#8656; i &lt; n, is produced by <code>(init-proc i)</code>.
No guarantee is made about the dynamic order in which
<code>init-proc</code> is applied to these indices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ilist-tabulate</span> <span class="mi">4</span> <span class="nv">values</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilist-copy lst)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Copies the spine of the argument, including the ilist tail.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iiota count [ start step ]</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an ilist containing the elements</p>
</div>
<div class="paragraph">
<p><code>(start start+step &#8230;&#8203; start+(count-1)*step)</code></p>
</div>
<div class="paragraph">
<p>The <code>start</code> and <code>step</code> parameters default to 0 and 1,
respectively. This procedure takes its name from the APL
primitive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iiota</span> <span class="mi">5</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iiota</span> <span class="mi">5</span> <span class="mi">0</span> <span class="mf">-0.1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mf">-0.1</span> <span class="mf">-0.2</span> <span class="mf">-0.3</span> <span class="mf">-0.4</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(icar ipair)</code></strong><br>
<strong><code>(icdr ipair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the contents of the icar and icdr
field of their argument, respectively. Note that it is an
error to apply them to the empty ilist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">icar</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>       <span class="nv">=&gt;</span>  <span class="nv">a</span>          <span class="p">(</span><span class="nf">icdr</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span>
<span class="p">(</span><span class="nf">icar</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>   <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span><span class="p">)</span>        <span class="p">(</span><span class="nf">icdr</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
<span class="p">(</span><span class="nf">icar</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>      <span class="nv">=&gt;</span>  <span class="mi">1</span>          <span class="p">(</span><span class="nf">icdr</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="mi">2</span>
<span class="p">(</span><span class="nf">icar</span> <span class="o">'</span><span class="p">())</span>              <span class="nv">=&gt;</span>  <span class="nv">*error*</span>    <span class="p">(</span><span class="nf">icdr</span> <span class="o">'</span><span class="p">())</span>            <span class="nv">=&gt;</span>  <span class="nv">*error*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipair? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns true and only if <code>x</code> is a proper ilist — that is,
a ()-terminated ilist.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(proper-ilist? x)</code></strong><br>
<strong><code>(ilist? x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These identifiers are bound either to the same procedure.
In either case, true is returned iff <code>x</code> is a proper ilist
— a ()-terminated ilist.</p>
</div>
<div class="paragraph">
<p>More carefully: The empty list is a proper ilist. An ipair
whose icdr is a proper ilist is also a proper ilist. Everything
else is a dotted ilist. This includes non-ipair, non-() values
(e.g. symbols, numbers, mutable pairs), which are considered to
be dotted ilists of length 0.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(dotted-ilist? x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns true if <code>x</code> is a finite, non-nil-terminated ilist. That is,
there exists an n &gt;= 0 such that <code>icdrn(x)</code> is neither an ipair nor
<code>()</code>. This includes non-ipair, non-() values (e.g. symbols, numbers),
which are considered to be dotted ilists of length 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">dotted-ilist?</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">=</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nf">proper-ilist?</span> <span class="nv">x</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(not-ipair? x)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the same as <code>(lambda (x) (not (ipair? x)))</code></p>
</div>
<div class="paragraph">
<p>Provided as a procedure as it can be useful as the termination
condition for ilist-processing procedures that wish to handle
all ilists, both proper and dotted.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(null-ilist? lst)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Ilist is a proper ilist. This procedure returns true if the argument
is the empty list <code>()</code>, and false otherwise. It is an error to pass this
procedure a value which is not a proper ilist. This procedure is
recommended as the termination condition for ilist-processing
procedures that are not defined on dotted ilists.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilist= elt= ilist1 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Determines ilist equality, given an element-equality procedure. Proper
ilist A equals proper ilist B if they are of the same length, and
their corresponding elements are equal, as determined by <code>elt=</code>. If the
element-comparison procedure&#8217;s first argument is from ilisti, then
its second argument is from ilisti+1, i.e. it is always called as
<code>(elt= a b)</code> for <code>a</code> an element of ilist A, and <code>b</code> an element of ilist B.</p>
</div>
<div class="paragraph">
<p>In the n-ary case, every ilisti is compared to ilisti+1 (as opposed,
for example, to comparing ilist1 to ilisti, for i&gt;1). If there are no
ilist arguments at all, <code>ilist=</code> simply returns true.</p>
</div>
<div class="paragraph">
<p>It is an error to apply ilist= to anything except proper ilists. It
cannot reasonably be extended to dotted ilists, as it provides no way
to specify an equality procedure for comparing the ilist terminators.</p>
</div>
<div class="paragraph">
<p>Note that the dynamic order in which the elt= procedure is applied to
pairs of elements is not specified. For example, if ilist= is applied
to three ilists, A, B, and C, it may first completely compare A to B,
then compare B to C, or it may compare the first elements of A and B,
then the first elements of B and C, then the second elements of A and
B, and so forth.</p>
</div>
<div class="paragraph">
<p>The equality procedure must be consistent with <code>eq?</code>. That is, it must
be the case that</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">eq?</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">elt=</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this implies that two ilists which are <code>eq?</code> are always ilist=,
as well; implementations may exploit this fact to "short-cut" the
element-by-element comparisons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ilist=</span> <span class="nv">eq?</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#t</span>       <span class="c1">; Trivial cases</span>
<span class="p">(</span><span class="nf">ilist=</span> <span class="nv">eq?</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list-immutable+! lst)</code></strong><br>
<strong><code>(list-immutable! lst)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Destructive versions of <code>list&#8594;ilist</code>: both procedures change their
argument so it will become an immutable list.
<code>List-immutable+!</code> returns the list, while <code>list-immutable!</code> returns <code>#void</code>.</p>
</div>
<div class="paragraph">
<p>








</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifirst   ipair)</code></strong><br>
<strong><code>(isecond  ipair)</code></strong><br>
<strong><code>(ithird   ipair)</code></strong><br>
<strong><code>(ifourth  ipair)</code></strong><br>
<strong><code>(ififth   ipair)</code></strong><br>
<strong><code>(isixth   ipair)</code></strong><br>
<strong><code>(iseventh ipair)</code></strong><br>
<strong><code>(ieighth  ipair)</code></strong><br>
<strong><code>(ininth   ipair)</code></strong><br>
<strong><code>(itenth   ipair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Synonyms for car, cadr, caddr, &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ithird</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="nv">c</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(icar+icdr ip)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The fundamental ipair deconstructor. Returns two values:
the icar and the icdrif <code>ip</code>.</p>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(itake x i)</code></strong><br>
<strong><code>(idrop x i)</code></strong><br>
<strong><code>(ilist-tail x i)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>itake</code> returns the first i elements of ilist <code>x</code>.
<code>idrop</code> returns all but the first i elements of ilist <code>x</code>.
<code>ilist-tail</code> is either the same procedure as idrop or else a procedure
with the same behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="nf">itake</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>  <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">idrop</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span>  <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>x</code> may be any value — a proper or dotted ilist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">itake</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span>    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">idrop</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">3</span> <span class="o">.</span> <span class="nv">d</span><span class="p">)</span>
<span class="p">(</span><span class="nf">itake</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">idrop</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="nv">d</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a legal <code>i</code>, itake and idrop partition the ilist in a manner
which can be inverted with iappend:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iappend</span> <span class="p">(</span><span class="nf">itake</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">idrop</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>idrop is exactly equivalent to performing i icdr operations on <code>x</code>;
the returned value shares a common tail with <code>x</code>.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(itake-right dilist i)</code></strong><br>
<strong><code>(idrop-right dilist i)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Itake-right</code> returns the last <code>i</code> elements of <code>dilist</code>.
<code>Idrop-right</code> returns all but the last <code>i</code> elements of <code>dilist</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">itake-right</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">)</span>
<span class="p">(</span><span class="nf">idrop-right</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned ilist may share a common tail with the argument <code>ilist</code>.</p>
</div>
<div class="paragraph">
<p><code>dilist</code> may be any ilist, either proper or dotted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">itake-right</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="o">.</span> <span class="nv">d</span><span class="p">)</span>
<span class="p">(</span><span class="nf">idrop-right</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">2</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">itake-right</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">0</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="nv">d</span>
<span class="p">(</span><span class="nf">idrop-right</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">ipair</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span> <span class="mi">0</span><span class="p">)</span>    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a legal <code>i</code>, <code>itake-right</code> and <code>idrop-right</code> partition the ilist
in a manner which can be inverted with <code>iappend</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>(iappend (itake dilist i) (idrop dilist i)) = dilist</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Itake-right</code>'s return value is guaranteed to share a common tail
with <code>dilist</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(isplit-at  x i)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Isplit-at</code> splits the ilist <code>x</code> at index <code>i</code>, returning an
ilist of the first <code>i</code> elements, and the remaining tail. It is
equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nf">itake</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">idrop</span> <span class="nv">x</span> <span class="nv">i</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilast ipair)</code></strong><br>
<strong><code>(last-ipair ipair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Ilast</code> returns the last element of the non-empty, possibly
dotted, ilist ipair.
<code>Last-ipair</code> returns the last ipair in the non-empty ilist pair.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ilast</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>      <span class="nv">=&gt;</span> <span class="nv">c</span>
<span class="p">(</span><span class="nf">last-ipair</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilength  ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the length of its argument. It is an error to pass a value
to <code>ilength</code> which is not a proper ilist (()-terminated).</p>
</div>
<div class="paragraph">
<p>The length of a proper ilist is a non-negative integer n such that
<code>icdr</code> applied n times to the ilist produces the empty list.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iappend ilist1 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns an ilist consisting of the elements of ilist1 followed by the elements of the other ilist parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iappend</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">y</span><span class="p">))</span>        <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iappend</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iappend</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">))</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">c</span><span class="p">)))</span>  <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="p">(</span><span class="nf">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting ilist is always newly allocated, except that it
shares structure with the final ilisti argument. This last argument
may be any value at all; an improper ilist results if it is not a
proper ilist. All other arguments must be proper ilists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iappend</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">ipair</span> <span class="ss">'c</span> <span class="ss">'d</span><span class="p">))</span>  <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="o">.</span> <span class="nv">d</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iappend</span> <span class="o">'</span><span class="p">()</span> <span class="ss">'a</span><span class="p">)</span>           <span class="nv">=&gt;</span>  <span class="nv">a</span>
<span class="p">(</span><span class="nf">iappend</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>         <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iappend</span><span class="p">)</span>                  <span class="nv">=&gt;</span>  <span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iconcatenate  ilist-of-ilists)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Appends the elements of its argument together. That is, <code>iconcatenate</code>
returns the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iapply</span> <span class="nv">iappend</span> <span class="nv">ilist-of-ilists</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or, equivalently,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ireduce-right</span> <span class="nv">iappend</span> <span class="o">'</span><span class="p">()</span> <span class="nv">ilist-of-ilists</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>iappend</code>, the last element of the input list may be any
value at all.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ireverse  ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated ilist consisting of the elements of <code>ilist</code>
in reverse order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ireverse</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>              <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">c</span> <span class="nv">b</span> <span class="nv">a</span><span class="p">)</span>
<span class="p">(</span><span class="nf">ireverse</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">d</span> <span class="p">(</span><span class="nf">e</span> <span class="p">(</span><span class="nf">f</span><span class="p">))))</span>  <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">e</span> <span class="p">(</span><span class="nf">f</span><span class="p">))</span> <span class="nv">d</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iappend-reverse  rev-head tail)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Iappend-reverse</code> returns <code>(iappend (ireverse rev-head) tail)</code>.
It is provided because it is a common operation — a common list-processing
style calls for this exact operation to transfer values accumulated in
reverse order onto the front of another ilist, and because the
implementation is significantly more efficient than the simple
composition it replaces. (But note that this pattern of iterative
computation followed by a reverse can frequently be rewritten as a
recursion, dispensing with the reverse and iappend-reverse steps, and
shifting temporary, intermediate storage from the heap to the stack,
which is typically a win for reasons of cache locality and eager
storage reclamation.)</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(izip ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the same as <code>(lambda ilists (iapply imap ilist ilists))</code></p>
</div>
<div class="paragraph">
<p>If <code>izip</code> is passed n ilists, it returns an ilist as long as the shortest
of these ilists, each element of which is an n-element ilist comprised of
the corresponding elements from the parameter ilists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">izip</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">one</span> <span class="nv">two</span> <span class="nv">three</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">iq</span> <span class="nv">odd</span> <span class="nv">even</span> <span class="nv">odd</span> <span class="nv">even</span> <span class="nv">odd</span> <span class="nv">even</span> <span class="nv">odd</span> <span class="nv">even</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">one</span> <span class="mi">1</span> <span class="nv">odd</span><span class="p">)</span> <span class="p">(</span><span class="nf">two</span> <span class="mi">2</span> <span class="nv">even</span><span class="p">)</span> <span class="p">(</span><span class="nf">three</span> <span class="mi">3</span> <span class="nv">odd</span><span class="p">))</span>

<span class="p">(</span><span class="nf">izip</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">3</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iunzip1 ilist)</code></strong><br>
<strong><code>(iunzip2 ilist)</code></strong><br>
<strong><code>(iunzip3 ilist)</code></strong><br>
<strong><code>(iunzip4 ilist)</code></strong><br>
<strong><code>(iunzip5 ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Iunzip1</code> takes an ilist of ilists, where every ilist must
contain at least one element, and returns an ilist containing
the initial element of each such ilist. That is, it returns
<code>(imap icar ilists)</code>. <code>Iunzip2</code> takes an ilist of ilists, where
every ilist must contain at least two elements, and returns two
values: an ilist of the first elements, and an ilist of the second
elements. <code>Iunzip3</code> does the same for the first three elements of
the ilists, and so forth.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iunzip2</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">1</span> <span class="nv">one</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="nv">two</span><span class="p">)</span> <span class="p">(</span><span class="nf">3</span> <span class="nv">three</span><span class="p">)))</span> <span class="nv">=&gt;</span>
    <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">one</span> <span class="nv">two</span> <span class="nv">three</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(icount pred ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Pred</code> is a procedure taking as many arguments as there are ilists and
returning a single value. It is applied element-wise to the elements
of the ilists, and a count is tallied of the number of elements that
produce a true value. This count is returned. count is "iterative" in
that it is guaranteed to apply pred to the ilist elements in a
left-to-right order. The counting stops when the shortest ilist
expires.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">icount</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>            <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="p">(</span><span class="nf">icount</span> <span class="nv">&lt;</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">10</span> <span class="mi">12</span> <span class="mi">14</span> <span class="mi">16</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(imap proc ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>proc is a procedure taking as many arguments as there are ilist
arguments and returning a single value. imap applies proc element-wise
to the elements of the ilists and returns an ilist of the results, in
order. The dynamic order in which proc is applied to the elements of
the ilists is unspecified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">imap</span> <span class="nv">icadr</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">)</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">h</span><span class="p">)))</span> <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">e</span> <span class="nv">h</span><span class="p">)</span>

<span class="p">(</span><span class="nf">imap</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">expt</span> <span class="nv">n</span> <span class="nv">n</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">1</span> <span class="mi">4</span> <span class="mi">27</span> <span class="mi">256</span> <span class="mi">3125</span><span class="p">)</span>

<span class="p">(</span><span class="nf">imap</span> <span class="nv">+</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span> <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span> <span class="mi">9</span><span class="p">)</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">count</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">imap</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">ignored</span><span class="p">)</span>
         <span class="p">(</span><span class="k">set!</span> <span class="nv">count</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">count</span> <span class="mi">1</span><span class="p">))</span>
         <span class="nv">count</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span> <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">or</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifor-each proc ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The arguments to <code>ifor-each</code> are like the arguments to <code>imap</code>, but
<code>ifor-each</code> calls <code>proc</code> for its side effects rather than for its
values. Unlike <code>imap</code>, <code>ifor-each</code> is guaranteed to call proc on the
elements of the ilists in order from the first element(s) to the last,
and the value returned by <code>ifor-each</code> is unspecified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">v</span> <span class="p">(</span><span class="nb">make-vector</span> <span class="mi">5</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">ifor-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">i</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">vector-set!</span> <span class="nv">v</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">i</span> <span class="nv">i</span><span class="p">)))</span>
            <span class="p">(</span><span class="nf">iq</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
  <span class="nv">v</span><span class="p">)</span>  <span class="nv">=&gt;</span>  <span class="o">#</span><span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifold kons knil ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The fundamental ilist iterator.</p>
</div>
<div class="paragraph">
<p>First, consider the single ilist-parameter case. If
<code>ilist1</code> = <code>(e1 e2 &#8230;&#8203; en)</code>, then this procedure returns</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nf">kons</span> <span class="nv">en</span> <span class="o">...</span> <span class="p">(</span><span class="nf">kons</span> <span class="nv">e2</span> <span class="p">(</span><span class="nf">kons</span> <span class="nv">e1</span> <span class="nv">knil</span><span class="p">))</span> <span class="o">...</span> <span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is, it obeys the (tail) recursion</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="nv">lis</span><span class="p">)</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">ifold</span> <span class="nv">kons</span> <span class="p">(</span><span class="nf">kons</span> <span class="p">(</span><span class="nf">icar</span> <span class="nv">lis</span><span class="p">)</span> <span class="nv">knil</span><span class="p">)</span> <span class="p">(</span><span class="nf">icdr</span> <span class="nv">lis</span><span class="p">))</span>
<span class="p">(</span><span class="nf">ifold</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="o">'</span><span class="p">())</span> <span class="nv">=</span> <span class="nv">knil</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme">  <span class="p">(</span><span class="nf">ifold</span> <span class="nv">+</span> <span class="mi">0</span> <span class="nv">lis</span><span class="p">)</span>                    <span class="c1">; Add up the elements of LIS.</span>
  <span class="p">(</span><span class="nf">ifold</span> <span class="nv">ipair</span> <span class="o">'</span><span class="p">()</span> <span class="nv">lis</span><span class="p">)</span>              <span class="c1">; Reverse LIS.</span>
  <span class="p">(</span><span class="nf">ifold</span> <span class="nv">ipair</span> <span class="nv">tail</span> <span class="nv">rev-head</span><span class="p">)</span>        <span class="c1">; See APPEND-REVERSE.</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; How many symbols in LIS?</span>
<span class="p">(</span><span class="nf">ifold</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">count</span><span class="p">)</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">symbol?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">count</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">count</span><span class="p">))</span>
      <span class="mi">0</span>
      <span class="nv">lis</span><span class="p">)</span>

<span class="c1">;; Length of the longest string in LIS:</span>
<span class="p">(</span><span class="nf">ifold</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">s</span> <span class="nv">max-len</span><span class="p">)</span> <span class="p">(</span><span class="nb">max</span> <span class="nv">max-len</span> <span class="p">(</span><span class="nb">string-length</span> <span class="nv">s</span><span class="p">)))</span>
      <span class="mi">0</span>
      <span class="nv">lis</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If n <code>ilist</code> arguments are provided, then the <code>kons</code> function must take
n+1 parameters: one element from each ilist, and the "seed" or fold
state, which is initially knil. The fold operation terminates when the
shortest ilist runs out of values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold</span> <span class="nv">ipair*</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">c</span> <span class="mi">3</span> <span class="nv">b</span> <span class="mi">2</span> <span class="nv">a</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iunfold p f g seed [tail-gen])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Iunfold</code> is best described by its basic recursion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iunfold</span> <span class="nv">p</span> <span class="nv">f</span> <span class="nv">g</span> <span class="nv">seed</span><span class="p">)</span> <span class="nv">=</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">p</span> <span class="nv">seed</span><span class="p">)</span> <span class="p">(</span><span class="nf">tail-gen</span> <span class="nv">seed</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">ipair</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">seed</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">iunfold</span> <span class="nv">p</span> <span class="nv">f</span> <span class="nv">g</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">seed</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>p        Determines when to stop unfolding.
f        Maps each seed value to the corresponding ilist element.
g        Maps each seed value to next seed value.
seed     The "state" value for the unfold.
tail-gen Creates the tail of the ilist; defaults to (lambda (x) '())</pre>
</div>
</div>
<div class="paragraph">
<p>In other words, we use g to generate a sequence of seed values
 seed, g(seed), g2(seed), g3(seed), &#8230;&#8203;
 These seed values are mapped to ilist elements by f, producing
the elements of the result ilist in a left-to-right order. P says when
to stop.</p>
</div>
<div class="paragraph">
<p><code>Iunfold</code> is the fundamental recursive ilist constructor, just as
<code>ifold-right</code> is the fundamental recursive ilist consumer. While
<code>iunfold</code> may seem a bit abstract to novice functional programmers,
it can be used in a number of ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; Ilist of squares: 1^2 ... 10^2</span>
<span class="p">(</span><span class="nf">iunfold</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">10</span><span class="p">))</span>
         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span>
         <span class="mi">1</span><span class="p">)</span>

<span class="p">(</span><span class="nf">iunfold</span> <span class="nv">null-ilist?</span> <span class="nv">icar</span> <span class="nv">icdr</span> <span class="nv">lis</span><span class="p">)</span> <span class="c1">; Copy a proper ilist.</span>

<span class="c1">;; Read current input port into an ilist of values.</span>
<span class="p">(</span><span class="nf">iunfold</span> <span class="nv">eof-object?</span> <span class="nv">values</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">read</span><span class="p">))</span> <span class="p">(</span><span class="nb">read</span><span class="p">))</span>

<span class="c1">;; Copy a possibly non-proper ilist:</span>
<span class="p">(</span><span class="nf">iunfold</span> <span class="nv">not-ipair?</span> <span class="nv">icar</span> <span class="nv">icdr</span> <span class="nv">lis</span>
         <span class="nv">values</span><span class="p">)</span>

<span class="c1">;; Append HEAD onto TAIL:</span>
<span class="p">(</span><span class="nf">iunfold</span> <span class="nv">null-ilist?</span> <span class="nv">icar</span> <span class="nv">icdr</span> <span class="nv">head</span>
        <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">tail</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Interested functional programmers may enjoy noting that ifold-right and
iunfold are in some sense inverses. That is, given operations <code>knull?</code>,
<code>kar</code>, <code>kdr</code>, <code>kons</code>, and <code>knil</code> satisfying</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">kons</span> <span class="p">(</span><span class="nf">kar</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">kdr</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span> <span class="nv">and</span> <span class="p">(</span><span class="nf">knull?</span> <span class="nv">knil</span><span class="p">)</span> <span class="nv">=</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="p">(</span><span class="nf">iunfold</span> <span class="nv">knull?</span> <span class="nv">kar</span> <span class="nv">kdr</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iunfold</span> <span class="nv">knull?</span> <span class="nv">kar</span> <span class="nv">kdr</span> <span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span><span class="o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This combinator sometimes is called an "anamorphism;" when an explicit
tail-gen procedure is supplied, it is called an "apomorphism."</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipair-fold kons knil ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Analogous to fold, but kons is applied to successive sub-ilists of the
ilists, rather than successive elements — that is, kons is applied to
the ipairs making up the lists, giving this (tail) recursion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ipair-fold</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="nv">lis</span><span class="p">)</span> <span class="nv">=</span> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">tail</span> <span class="p">(</span><span class="nf">icdr</span> <span class="nv">lis</span><span class="p">)))</span>
                              <span class="p">(</span><span class="nf">ipair-fold</span> <span class="nv">kons</span> <span class="p">(</span><span class="nf">kons</span> <span class="nv">lis</span> <span class="nv">knil</span><span class="p">)</span> <span class="nv">tail</span><span class="p">))</span>
<span class="p">(</span><span class="nf">ipair-fold</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="o">'</span><span class="p">())</span> <span class="nv">=</span> <span class="nv">knil</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ipair-fold</span> <span class="nv">ipair</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ireduce f ridentity ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Ireduce</code> is a variant of <code>ifold</code>.</p>
</div>
<div class="paragraph">
<p><code>Ridentity</code> should be a "right identity" of the procedure <code>f</code>
— that is, for any value <code>x</code> acceptable to <code>f</code>,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span> <span class="nv">ridentity</span><span class="p">)</span> <span class="nv">=</span> <span class="nv">x</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Ireduce</code> has the following definition:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>If ilist = (), return ridentity;
Otherwise, return (ifold f (icar ilist) (icdr ilist)).</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;in other words, we compute <code>(ifold f ridentity ilist)</code>.</p>
</div>
<div class="paragraph">
<p>Note that ridentity is used only in the empty-list case. You typically
use ireduce when applying <code>f</code> is expensive and you&#8217;d like to avoid the
extra application incurred when ifold applies <code>f</code> to the head of <code>ilist</code>
and the identity value, redundantly producing the same value passed in
to <code>f</code>. For example, if <code>f</code> involves searching a file directory or
performing a database query, this can be significant. In general,
however, <code>ifold</code> is useful in many contexts where <code>ireduce</code> is
not (consider the examples given in the ifold definition — only one of
the five folds uses a function with a right identity. The other four
may not be performed with ireduce).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; take the max of an ilist of non-negative integers.</span>
<span class="p">(</span><span class="nf">ireduce</span> <span class="nv">max</span> <span class="mi">0</span> <span class="nv">nums</span><span class="p">)</span> <span class="c1">; i.e., (iapply max 0 nums)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifold-right kons knil ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The fundamental ilist recursion operator.</p>
</div>
<div class="paragraph">
<p>First, consider the single ilist-parameter case. If
<code>ilist1 = (e1 e2 &#8230;&#8203; en)</code>, then this procedure returns
<code>(kons e1 (kons e2 &#8230;&#8203; (kons en knil)))</code></p>
</div>
<div class="paragraph">
<p>That is, it obeys the recursion</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="nv">lis</span><span class="p">)</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">kons</span> <span class="p">(</span><span class="nf">icar</span> <span class="nv">lis</span><span class="p">)</span> <span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="p">(</span><span class="nf">icdr</span> <span class="nv">lis</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="o">'</span><span class="p">())</span> <span class="nv">=</span> <span class="nv">knil</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">ipair</span> <span class="o">'</span><span class="p">()</span> <span class="nv">lis</span><span class="p">)</span>          <span class="c1">; Copy LIS.</span>

<span class="c1">;; Filter the even numbers out of LIS.</span>
<span class="p">(</span><span class="nf">ifold-right</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">even?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">ipair</span> <span class="nv">x</span> <span class="nv">l</span><span class="p">)</span> <span class="nv">l</span><span class="p">))</span> <span class="o">'</span><span class="p">()</span> <span class="nv">lis</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If n ilist arguments are provided, then the <code>kons</code> procedure must take
n+1 parameters: one element from each ilist, and the "seed" or fold
state, which is initially <code>knil</code>. The fold operation terminates when the
shortest ilist runs out of values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold-right</span> <span class="nv">ipair*</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="mi">1</span> <span class="nv">b</span> <span class="mi">2</span> <span class="nv">c</span> <span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iunfold-right p f g seed [tail])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Iunfold-right</code> constructs an ilist with the following loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="nv">lp</span> <span class="p">((</span><span class="nf">seed</span> <span class="nv">seed</span><span class="p">)</span> <span class="p">(</span><span class="nf">lis</span> <span class="nv">tail</span><span class="p">))</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">p</span> <span class="nv">seed</span><span class="p">)</span> <span class="nv">lis</span>
      <span class="p">(</span><span class="nf">lp</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">seed</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ipair</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">seed</span><span class="p">)</span> <span class="nv">lis</span><span class="p">))))</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>p         Determines when to stop unfolding.
f         Maps each seed value to the corresponding ilist element.
g         Maps each seed value to next seed value.
seed      The "state" value for the unfold.
tail      ilist terminator; defaults to '().</pre>
</div>
</div>
<div class="paragraph">
<p>In other words, we use g to generate a sequence of seed values</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">seed,</span> <span class="nv">g</span><span class="p">(</span><span class="nf">seed</span><span class="p">)</span><span class="o">,</span> <span class="nv">g2</span><span class="p">(</span><span class="nf">seed</span><span class="p">)</span><span class="o">,</span> <span class="nv">g3</span><span class="p">(</span><span class="nf">seed</span><span class="p">)</span><span class="o">,</span> <span class="o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These seed values are mapped to ilist elements by <code>f</code>, producing the
elements of the result ilist in a right-to-left order. P says when to
stop.</p>
</div>
<div class="paragraph">
<p><code>Iunfold-right</code> is the fundamental iterative ilist constructor, just as
<code>ifold</code> is the fundamental iterative ilist consumer. While <code>iunfold-right</code>
may seem a bit abstract to novice functional programmers, it can be
used in a number of ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; Ilist of squares: 1^2 ... 10^2</span>
<span class="p">(</span><span class="nf">iunfold-right</span> <span class="nv">zero?</span>
              <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
              <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span>
              <span class="mi">10</span><span class="p">)</span>

<span class="c1">;; Reverse a proper ilist.</span>
<span class="p">(</span><span class="nf">iunfold-right</span> <span class="nv">null-ilist?</span> <span class="nv">icar</span> <span class="nv">icdr</span> <span class="nv">lis</span><span class="p">)</span>

<span class="c1">;; Read current input port into an ilist of values.</span>
<span class="p">(</span><span class="nf">iunfold-right</span> <span class="nv">eof-object?</span> <span class="nv">values</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">read</span><span class="p">))</span> <span class="p">(</span><span class="nb">read</span><span class="p">))</span>

<span class="c1">;; (iappend-reverse rev-head tail)</span>
<span class="p">(</span><span class="nf">iunfold-right</span> <span class="nv">null-ilist?</span> <span class="nv">icar</span> <span class="nv">icdr</span> <span class="nv">rev-head</span> <span class="nv">tail</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Interested functional programmers may enjoy noting that ifold and
<code>iunfold-right</code> are in some sense inverses. That is, given operations
<code>knull?</code>, <code>kar</code>, <code>kdr</code>, <code>kons</code>, and <code>knil</code> satisfying</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">kons</span> <span class="p">(</span><span class="nf">kar</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">kdr</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span> <span class="nv">and</span> <span class="p">(</span><span class="nf">knull?</span> <span class="nv">knil</span><span class="p">)</span> <span class="nv">=</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifold</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="p">(</span><span class="nf">iunfold-right</span> <span class="nv">knull?</span> <span class="nv">kar</span> <span class="nv">kdr</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iunfold-right</span> <span class="nv">knull?</span> <span class="nv">kar</span> <span class="nv">kdr</span> <span class="p">(</span><span class="nf">ifold</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">=</span> <span class="nv">x</span><span class="o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipair-fold-right kons knil ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Holds the same relationship with <code>ifold-right</code> that <code>ipair-fold</code>
holds with <code>ifold</code>. Obeys the recursion</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"> <span class="p">(</span><span class="nf">ipair-fold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="nv">lis</span><span class="p">)</span> <span class="nv">=</span>
     <span class="p">(</span><span class="nf">kons</span> <span class="nv">lis</span> <span class="p">(</span><span class="nf">ipair-fold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="p">(</span><span class="nf">icdr</span> <span class="nv">lis</span><span class="p">)))</span>
 <span class="p">(</span><span class="nf">ipair-fold-right</span> <span class="nv">kons</span> <span class="nv">knil</span> <span class="o">'</span><span class="p">())</span> <span class="nv">=</span> <span class="nv">knil</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ipair-fold-right</span> <span class="nv">ipair</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ireduce-right f ridentity ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Ireduce-right</code> is the <code>fold-right</code> variant of <code>ireduce</code>. It obeys the
following definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ireduce-right</span> <span class="nv">f</span> <span class="nv">ridentity</span> <span class="o">'</span><span class="p">())</span> <span class="nv">=</span> <span class="nv">ridentity</span>
<span class="p">(</span><span class="nf">ireduce-right</span> <span class="nv">f</span> <span class="nv">ridentity</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">e1</span><span class="p">))</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">e1</span> <span class="nv">ridentity</span><span class="p">)</span> <span class="nv">=</span> <span class="nv">e1</span>
<span class="p">(</span><span class="nf">ireduce-right</span> <span class="nv">f</span> <span class="nv">ridentity</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">e1</span> <span class="nv">e2</span> <span class="o">...</span><span class="p">))</span> <span class="nv">=</span>
    <span class="p">(</span><span class="nf">f</span> <span class="nv">e1</span> <span class="p">(</span><span class="nf">ireduce</span> <span class="nv">f</span> <span class="nv">ridentity</span> <span class="p">(</span><span class="nf">e2</span> <span class="o">...</span><span class="p">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;in other words, we compute <code>(ifold-right f ridentity ilist)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; Append a bunch of ilists together.</span>
<span class="c1">;; I.e., (iapply iappend ilist-of-ilists)</span>
<span class="p">(</span><span class="nf">ireduce-right</span> <span class="nv">iappend</span> <span class="o">'</span><span class="p">()</span> <span class="nv">ilist-of-ilists</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iappend-map  f ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iapply</span> <span class="nv">iappend</span> <span class="p">(</span><span class="nf">imap</span> <span class="nv">f</span> <span class="nv">ilist1</span> <span class="nv">ilist2</span> <span class="o">...</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iapply</span> <span class="nv">iappend</span> <span class="p">(</span><span class="nf">imap</span> <span class="nv">f</span> <span class="nv">ilist1</span> <span class="nv">ilist2</span> <span class="o">...</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Map f over the elements of the ilists, just as in the <code>imap</code>
function. However, the results of the applications are appended
together (using <code>iappend</code>) to make the final result.</p>
</div>
<div class="paragraph">
<p>The dynamic order in which the various applications of <code>f</code> are made is
not specified.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iappend-map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">ilist</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span><span class="p">)))</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">8</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">-1</span> <span class="mi">3</span> <span class="mi">-3</span> <span class="mi">8</span> <span class="mi">-8</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipair-for-each f ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Like <code>ifor-each</code>, but <code>f</code> is applied to successive sub-ilists of the
argument <code>ilists</code>. That is, <code>f</code> is applied to the cells of the ilists,
rather than the ilists' elements. These applications occur in
left-to-right order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ipair-for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">ipair</span><span class="p">)</span> <span class="p">(</span><span class="nb">display</span> <span class="nv">ipair</span><span class="p">)</span> <span class="p">(</span><span class="nb">newline</span><span class="p">))</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span> <span class="nv">==&gt;</span>
    <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">c</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifilter-map f ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Like <code>imap</code>, but only true values are saved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifilter-map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nb">number?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)))</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="mi">1</span> <span class="nv">b</span> <span class="mi">3</span> <span class="nv">c</span> <span class="mi">7</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">9</span> <span class="mi">49</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic order in which the various applications of <code>f</code> are made is
not specified.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(imap-in-order f ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A variant of the <code>imap</code> procedure that guarantees to apply <code>f</code> across the
elements of the <code>ilisti</code> arguments in a left-to-right order. This is
useful for mapping procedures that both have side effects and return
useful values.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifilter pred ilist )</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return all the elements of <code>ilist</code> that satisfy predicate <code>pred</code>. The
ilist is not disordered — elements that appear in the result ilist
occur in the same order as they occur in the argument <code>ilist</code>. The
returned ilist may share a common tail with the argument ilist. The
dynamic order in which the various applications of pred are made is
not specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifilter</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">0</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">43</span> <span class="mi">-4</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">-4</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ipartition pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Partitions the elements of <code>ilist</code> with predicate <code>pred</code>, and returns two
values: the ilist of in-elements and the ilist of out-elements. The
ilist is not disordered — elements occur in the result ilists in the
same order as they occur in the argument ilist. The dynamic order in
which the various applications of <code>pred</code> are made is not specified. One
of the returned ilists may share a common tail with the argument
ilist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ipartition</span> <span class="nv">symbol?</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">one</span> <span class="mi">2</span> <span class="mi">3</span> <span class="nv">four</span> <span class="nv">five</span> <span class="mi">6</span><span class="p">))</span> <span class="nv">=&gt;</span>
    <span class="p">(</span><span class="nf">one</span> <span class="nv">four</span> <span class="nv">five</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">6</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iremove pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns ilist without the elements that satisfy predicate pred,
similar to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">pred</span> <span class="nv">ilist</span><span class="p">)</span> <span class="p">(</span><span class="nf">ifilter</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nf">pred</span> <span class="nv">x</span><span class="p">)))</span> <span class="nv">ilist</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ilist is not disordered — elements that appear in the result
ilist occur in the same order as they occur in the argument ilist. The
returned ilist may share a common tail with the argument ilist. The
dynamic order in which the various applications of <code>pred</code> are made is
not specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iremove</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">0</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">43</span> <span class="mi">-4</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">7</span> <span class="mi">43</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(imember x ilist [=])</code></strong><br>
<strong><code>(imemq x ilist)</code></strong><br>
<strong><code>(imemv x ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return the first sub-ilist of <code>ilis`t whose icar is `x</code>,
where the sub-ilists of ilist are the non-empty ilists returned
by <code>(idrop ilist i)</code> for <code>i</code> less than the length of ilist. If <code>x</code> does not
occur in <code>ilist</code>, then false is returned. <code>Imemq</code> uses <code>eq?</code> to compare <code>x</code> with
the elements of <code>ilist</code>, while <code>imemv</code> uses <code>eqv?</code>, and <code>imember</code> uses <code>equal?</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">imemq</span> <span class="ss">'a</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>           <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
<span class="p">(</span><span class="nf">imemq</span> <span class="ss">'b</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>           <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="nv">c</span><span class="p">)</span>
<span class="p">(</span><span class="nf">imemq</span> <span class="ss">'a</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>           <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nf">imemq</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">ilist</span> <span class="ss">'b</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="ss">'c</span><span class="p">))</span>     <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nf">imember</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'a</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">ilist</span> <span class="ss">'b</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="ss">'c</span><span class="p">)))</span>    <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span>
<span class="p">(</span><span class="nf">imemq</span> <span class="mi">101</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">100</span> <span class="mi">101</span> <span class="mi">102</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="nv">*unspecified*</span>
<span class="p">(</span><span class="nf">imemv</span> <span class="mi">101</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">100</span> <span class="mi">101</span> <span class="mi">102</span><span class="p">))</span>    <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">101</span> <span class="mi">102</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The comparison procedure is used to compare the elements <code>ei</code> of <code>ilist</code>
to the key <code>x</code> in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">=</span> <span class="nv">x</span> <span class="nv">ei</span><span class="p">)</span> <span class="c1">; ilist is (E1 ... En)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is, the first argument is always <code>x</code>, and the second argument is
one of the ilist elements. Thus one can reliably find the first
element of ilist that is greater than five with <code>(imember 5 ilist &lt;)</code></p>
</div>
<div class="paragraph">
<p>Note that fully general ilist searching may be performed with the
<code>ifind-tail</code> and <code>ifind</code> procedures, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifind-tail</span> <span class="nv">even?</span> <span class="nv">ilist</span><span class="p">)</span> <span class="c1">; Find the first elt with an even key.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifind pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the first element of ilist that satisfies predicate <code>pred</code>;
false if no element does.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifind</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that ifind has an ambiguity in its lookup semantics — if ifind
returns false, you cannot tell (in general) if it found a false element
that satisfied <code>pred</code>, or if it did not find any element at all. In many
situations, this ambiguity cannot arise — either the ilist being
searched is known not to contain any false elements, or the ilist is
guaranteed to have an element satisfying pred. However, in cases where
this ambiguity can arise, you should use <code>ifind-tail</code> instead of <code>ifind</code>,
since <code>ifind-tail</code> has no such ambiguity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nf">ifind-tail</span> <span class="nv">pred</span> <span class="nv">lis</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">ipair</span><span class="p">)</span> <span class="o">...</span><span class="p">))</span> <span class="c1">; Handle (icar ipair)</span>
      <span class="p">(</span><span class="k">else</span> <span class="o">...</span><span class="p">))</span> <span class="c1">; Search failed.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ifind-tail pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return the first ipair of ilist whose icar satisfies <code>pred</code>. If no
ipair does, return false.</p>
</div>
<div class="paragraph">
<p><code>Ifind-tail</code> can be viewed as a general-predicate variant of the
<code>imember</code> function.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">ifind-tail</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">37</span> <span class="mi">-8</span> <span class="mi">-5</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">-8</span> <span class="mi">-5</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nf">ifind-tail</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">37</span> <span class="mi">-5</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#f</span>

<span class="c1">;; IMEMBER X LIS:</span>
<span class="p">(</span><span class="nf">ifind-tail</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">elt</span><span class="p">)</span> <span class="p">(</span><span class="nb">equal?</span> <span class="nv">x</span> <span class="nv">elt</span><span class="p">))</span> <span class="nv">lis</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Ifind-tail</code> is essentially <code>idrop-while</code>, where the sense of the
predicate is inverted: <code>Ifind-tail</code> searches until it finds an element
satisfying the predicate; <code>idrop-while</code> searches until it finds an
element that doesn&#8217;t satisfy the predicate.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iany pred ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Applies the predicate across the ilists, returning true if the
predicate returns true on any application.</p>
</div>
<div class="paragraph">
<p>If there are n ilist arguments <code>ilist1 &#8230;&#8203; ilistn</code>, then <code>pred</code> must
be a procedure taking n arguments and returning a boolean result.</p>
</div>
<div class="paragraph">
<p><code>Iany</code> applies <code>pred</code> to the first elements of the <code>ilisti</code>
parameters. If this application returns a true value, iany immediately
returns that value. Otherwise, it iterates, applying pred to the
second elements of the <code>ilisti</code> parameters, then the third, and so
forth. The iteration stops when a true value is produced or one of the
ilists runs out of values; in the latter case, iany returns false. The
application of <code>pred</code> to the last element of the ilists is a tail call.</p>
</div>
<div class="paragraph">
<p>Note the difference between <code>ifind</code> and <code>iany</code> — <code>ifind</code> returns the
element that satisfied the predicate; iany returns the true value that
the predicate produced.</p>
</div>
<div class="paragraph">
<p>Like <code>ievery</code>, `iany&#8217;s name does not end with a question mark — this
is to indicate that it does not return a simple boolean (true or false),
but a general value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iany</span> <span class="nv">integer?</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="mi">3</span> <span class="nv">b</span> <span class="mf">2.7</span><span class="p">))</span>   <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">iany</span> <span class="nv">integer?</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="mf">3.1</span> <span class="nv">b</span> <span class="mf">2.7</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#f</span>
<span class="p">(</span><span class="nf">iany</span> <span class="nv">&lt;</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ievery pred ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Applies the predicate across the ilists, returning true if the
predicate returns true on every application.</p>
</div>
<div class="paragraph">
<p>If there are n ilist arguments <code>ilist1 &#8230;&#8203; ilistn</code>, then <code>pred</code> must be a
procedure taking n arguments and returning a boolean result.</p>
</div>
<div class="paragraph">
<p><code>Ievery</code> applies <code>pred</code> to the first elements of the <code>ilisti</code> parameters. If
this application returns false, ievery immediately returns
false. Otherwise, it iterates, applying pred to the second elements of
the ilisti parameters, then the third, and so forth. The iteration
stops when a false value is produced or one of the ilists runs out of
values. In the latter case, ievery returns the true value produced by
its final application of <code>pred</code>. The application of pred to the last
element of the ilists is a tail call.</p>
</div>
<div class="paragraph">
<p>If one of the <code>ilisti</code> has no elements, ievery simply returns true.</p>
</div>
<div class="paragraph">
<p>Like <code>iany</code>, `ievery&#8217;s name does not end with a question mark — this is
to indicate that it does not return a simple boolean (true or false), but a
general value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small">R<sup>5</sup>RS procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ilist-index pred ilist1 ilist2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the index of the leftmost element that satisfies <code>pred</code>.</p>
</div>
<div class="paragraph">
<p>If there are n ilist arguments <code>ilist1 &#8230;&#8203; ilistn</code>, then <code>pred</code> must be a
function taking n arguments and returning a boolean result.</p>
</div>
<div class="paragraph">
<p><code>Ilist-index</code> applies <code>pred</code> to the first elements of the <code>ilisti</code>
parameters. If this application returns true, <code>ilist-index</code> immediately
returns zero. Otherwise, it iterates, applying <code>pred</code> to the second
elements of the <code>ilisti</code> parameters, then the third, and so forth. When
it finds a tuple of ilist elements that cause <code>pred</code> to return true, it
stops and returns the zero-based index of that position in the ilists.</p>
</div>
<div class="paragraph">
<p>The iteration stops when one of the ilists runs out of values; in this
case, <code>ilist-index</code> returns false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="nv">ilist-index</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="nv">ilist-index</span> <span class="nv">&lt;</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="nv">ilist-index</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(itake-while  pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the longest initial prefix of ilist whose elements all
satisfy the predicate <code>pred</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">itake-while</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">18</span> <span class="mi">3</span> <span class="mi">10</span> <span class="mi">22</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">18</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(idrop-while pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Drops the longest initial prefix of <code>ilist</code> whose elements all
satisfy the predicate <code>pred</code>, and returns the rest of the ilist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">idrop-while</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">18</span> <span class="mi">3</span> <span class="mi">10</span> <span class="mi">22</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">10</span> <span class="mi">22</span> <span class="mi">9</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ispan   pred ilist)</code></strong><br>
<strong><code>(ibreak  pred ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Ispan</code> splits the ilist into the longest initial prefix whose
elements all satisfy <code>pred</code>, and the remaining tail. <code>Ibreak</code> inverts the
sense of the predicate: the tail commences with the first element of
the input ilist that satisfies the predicate.</p>
</div>
<div class="paragraph">
<p>In other words: <code>ispan</code> finds the initial span of elements
satisfying <code>pred</code>, and <code>ibreak</code> breaks the ilist at the first element
satisfying <code>pred</code>.</p>
</div>
<div class="paragraph">
<p><code>Ispan</code> is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nf">itake-while</span> <span class="nv">pred</span> <span class="nv">ilist</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">idrop-while</span> <span class="nv">pred</span> <span class="nv">ilist</span><span class="p">))</span>

<span class="p">(</span><span class="nf">ispan</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">2</span> <span class="mi">18</span> <span class="mi">3</span> <span class="mi">10</span> <span class="mi">22</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=&gt;</span>
  <span class="p">(</span><span class="nf">2</span> <span class="mi">18</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">3</span> <span class="mi">10</span> <span class="mi">22</span> <span class="mi">9</span><span class="p">)</span>

<span class="p">(</span><span class="nf">ibreak</span> <span class="nv">even?</span> <span class="p">(</span><span class="nf">iq</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span><span class="p">))</span> <span class="nv">=&gt;</span>
  <span class="p">(</span><span class="nf">3</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">4</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">9</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(idelete  x ilist [=])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Idelete</code> uses the comparison procedure <code>=</code>, which defaults to <code>equal?</code>,
to find all elements of ilist that are equal to <code>x</code>, and deletes them from
<code>ilist</code>. The dynamic order in which the various applications of = are
made is not specified.</p>
</div>
<div class="paragraph">
<p>The ilist is not disordered — elements that appear in the result
ilist occur in the same order as they occur in the argument ilist. The
result may share a common tail with the argument ilist.</p>
</div>
<div class="paragraph">
<p>Note that fully general element deletion can be performed with the
iremove procedures, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; idelete all the even elements from LIS:</span>
<span class="p">(</span><span class="nf">iremove</span> <span class="nv">even?</span> <span class="nv">lis</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The comparison procedure is used in this way: <code>(= x ei)</code>. That is, <code>x</code>
is always the first argument, and an ilist element is always the
second argument. The comparison procedure will be used to compare each
element of ilist exactly once; the order in which it is applied to the
various ei is not specified. Thus, one can reliably remove all the
numbers greater than five from an ilist with <code>(idelete 5 ilist &lt;)</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ialist-cons key datum ialist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Constructs a new ialist entry mapping key &#8594; datum onto ialist.
This is the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">key</span> <span class="nv">datum</span> <span class="nv">ialist</span><span class="p">)</span> <span class="p">(</span><span class="nf">ipair</span> <span class="p">(</span><span class="nf">ipair</span> <span class="nv">key</span> <span class="nv">datum</span><span class="p">)</span> <span class="nv">ialist</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(idelete-duplicates  ilist [=])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Idelete-duplicates</code> removes duplicate elements from the <code>ilist</code>
argument. If there are multiple equal elements in the argument <code>ilist</code>,
the result ilist only contains the first or leftmost of these elements
in the result. The order of these surviving elements is the same as in
the original ilist — <code>idelete-duplicates</code> does not disorder the
ilist (hence it is useful for "cleaning up" immutable association
lists).</p>
</div>
<div class="paragraph">
<p>The <code>=</code> parameter is used to compare the elements of the ilist; it
defaults to equal?. If x comes before y in ilist, then the comparison
is performed <code>(= x y)</code>. The comparison procedure will be used to compare
each pair of elements in ilist no more than once; the order in which
it is applied to the various pairs is not specified.</p>
</div>
<div class="paragraph">
<p>Although  <code>idelete-duplicates</code> can be implemented so it runs in time
O(n2) for n-element ilists, the STklos implementation runs in linear
expected time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">idelete-duplicates</span> <span class="p">(</span><span class="nf">iq</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">a</span> <span class="nv">c</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">z</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">z</span><span class="p">)</span>

<span class="c1">;; Clean up an ialist:</span>
<span class="p">(</span><span class="nf">idelete-duplicates</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">a</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="o">.</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="nf">a</span> <span class="o">.</span> <span class="mi">9</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span> <span class="o">.</span> <span class="mi">1</span><span class="p">))</span>
                   <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq?</span> <span class="p">(</span><span class="nf">icar</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">icar</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">a</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="o">.</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span> <span class="o">.</span> <span class="mi">1</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iassoc key ialist [=] &#8594; ipair or #f</code></strong><br>
<strong><code>(iassq key ialist &#8594; ipair or #f</code></strong><br>
<strong><code>(iassv key ialist &#8594; ipair or #f</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Ialist</code> must be an immutable association list — an ilist of
ipairs. These procedures find the first ipair in ialist whose icar
field is key, and returns that ipair. If no ipair in ialist has key as
its icar, then false is returned. <code>Iassq</code> uses <code>eq?</code> to compare key with the
icar fields of the ipairs in ialist, while <code>iassv</code> uses <code>eqv?</code> and <code>iassoc</code>
uses <code>equal?</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">e</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span> <span class="mi">3</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">iassq</span> <span class="ss">'a</span> <span class="nv">e</span><span class="p">)</span>                               <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">a</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iassq</span> <span class="ss">'b</span> <span class="nv">e</span><span class="p">)</span>                               <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">b</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iassq</span> <span class="ss">'d</span> <span class="nv">e</span><span class="p">)</span>                               <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nf">iassq</span> <span class="p">(</span><span class="nf">ilist</span> <span class="ss">'a</span><span class="p">)</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">((</span><span class="nf">a</span><span class="p">))</span> <span class="p">((</span><span class="nf">b</span><span class="p">))</span> <span class="p">((</span><span class="nf">c</span><span class="p">))))</span>  <span class="nv">=&gt;</span>  <span class="no">#f</span>
<span class="p">(</span><span class="nf">iassoc</span> <span class="o">'</span><span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">ilist</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span><span class="p">))</span> <span class="o">'</span><span class="p">((</span><span class="nf">b</span><span class="p">))</span> <span class="o">'</span><span class="p">((</span><span class="nf">c</span><span class="p">))))</span> <span class="nv">=&gt;</span>  <span class="p">((</span><span class="nf">a</span><span class="p">))</span>
<span class="p">(</span><span class="nf">iassq</span> <span class="mi">5</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="nf">11</span> <span class="mi">13</span><span class="p">)))</span>         <span class="nv">=&gt;</span>  <span class="nv">*unspecified*</span>
<span class="p">(</span><span class="nf">iassv</span> <span class="mi">5</span> <span class="p">(</span><span class="nf">iq</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="nf">11</span> <span class="mi">13</span><span class="p">)))</span>         <span class="nv">=&gt;</span>  <span class="p">(</span><span class="nf">5</span> <span class="mi">7</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The comparison procedure is used to compare the elements <code>ei</code> of ilist
to the key parameter in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">=</span> <span class="nv">key</span> <span class="p">(</span><span class="nf">icar</span> <span class="nv">ei</span><span class="p">))</span> <span class="c1">; ilist is (E1 ... En)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is, the first argument is always key, and the second argument
is one of the ilist elements. Thus one can reliably find the first
entry of ialist whose key is greater than five with
<code>(iassoc 5 ialist &lt;)</code>.</p>
</div>
<div class="paragraph">
<p>Note that fully general ialist searching may be performed with the
ifind-tail and ifind procedures, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="c1">;; Look up the first association in ialist with an even key:</span>
<span class="p">(</span><span class="nf">ifind</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">even?</span> <span class="p">(</span><span class="nf">icar</span> <span class="nv">a</span><span class="p">)))</span> <span class="nv">ialist</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(ialist-delete  key ialist [=])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Ialist-delete</code> deletes all associations from ialist with the given
key, using key-comparison procedure <code>=</code>, which defaults to <code>equal?</code>. The
dynamic order in which the various applications of <code>=</code> are made is not
specified.</p>
</div>
<div class="paragraph">
<p>Return values may share common tails with the ialist argument. The
ialist is not disordered — elements that appear in the result ialist
occur in the same order as they occur in the argument ialist.</p>
</div>
<div class="paragraph">
<p>The comparison procedure is used to compare the element keys ki of
ialist&#8217;s entries to the key parameter in this way: <code>(= key ki)</code>. Thus,
one can reliably remove all entries of ialist whose key is greater
than five with <code>(ialist-delete 5 ialist &lt;)</code></p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(replace-icar ipair object)</code></strong><br>
<strong><code>(replace-icdr ipair object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Replace-icar</code> returns an ipair with object in the icar field and
the icdr of ipair in the icdr field.</p>
</div>
<div class="paragraph">
<p><code>Replace-icdr</code> returns an ipair with object in the icdr field and
the icar of ipair in the icar field.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list&#8594;ilist lst)</code></strong><br>
<strong><code>(ilist&#8594;list lst)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return an ilist and a list respectively that have
the same elements as the argument. The tails of dotted (i)lists are
preserved in the result, which makes the procedures not inverses
when the tail of a dotted ilist is a list or vice versa. The empty
list is converted to itself.</p>
</div>
<div class="paragraph">
<p>It is an error to apply list&#8594;ilist to a circular list.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(pair&#8594;ipair pair)</code></strong><br>
<strong><code>(ipair&#8594;pair ipair)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures, which are inverses, return an ipair and
a pair respectively that have the same (i)car and (i)cdr
fields as the argument.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(tree&#8594;itree object)</code></strong><br>
<strong><code>(itree&#8594;tree object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures walk a tree of pairs or ipairs respectively and
make a deep copy of it, returning an isomorphic tree containing
ipairs or pairs respectively. The result may share structure with
the argument. If the argument is not of the expected type, it is
returned.</p>
</div>
<div class="paragraph">
<p>These procedures are not inverses in the general case. For example,
a pair of ipairs would be converted by <code>tree&#8594;itree</code> to an ipair of
ipairs, which if converted by <code>itree&#8594;tree</code> would produce a pair of
pairs.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(gtree&#8594;itree object)</code></strong><br>
<strong><code>(gtree&#8594;tree object)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures walk a generalized tree consisting of pairs,
ipairs, or a combination of both, and make a deep copy of it,
returning an isomorphic tree containing only ipairs or pairs
respectively. The result may share structure with the argument.
If the argument is neither a pair nor an ipair, it is returned.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iapply procedure object &#8230;&#8203; ilist)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>iapply</code> procedure is an analogue of <code>apply</code> whose last argument
is an ilist rather than a list. It is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nb">apply</span> <span class="nv">procedure</span> <span class="nv">object</span> <span class="o">...</span> <span class="p">(</span><span class="nf">ilist-&gt;list</span> <span class="nv">ilist</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_138compiling_scheme_programs_to_executables">srfi-138&#8201;&#8212;&#8201;Compiling Scheme programs to executables</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-138/srfi-138.html">SRFI-138</a></strong> is fully supported.  The <code>stklos-compile</code>
program conforms to SRFI 138, accepting all the required command line
options.</p>
</div>
<div class="paragraph">
<p>The -D x flag of <code>stklos-compile</code> will define a feature named <code>x</code> for
use with <code>cond-expand</code> in the compiled code only. It will not include
<code>x</code> in the features list of the runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_145assumptions">srfi-145&#8201;&#8212;&#8201;Assumptions</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-145/srfi-145.html">SRFI-145</a></strong> is fully supported. See the
<em><a href="#assume"><code>assume</code> special form</a></em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_169underscores_in_numbers">srfi-169&#8201;&#8212;&#8201;Underscores in numbers</h4>
<div class="paragraph">
<p>



<strong><a href="http://srfi.schemers.org/srfi-169/srfi-169.html">SRFI-169</a></strong> is fully supported. See <em><a href="#srfi169">parameter <code>accept-srfi-169-numbers</code></a></em> to eventually forbid the usage of
underscores in numbers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_srfi_216sicp_prerequisites_portable">srfi-216&#8201;&#8212;&#8201;SICP Prerequisites (Portable)</h4>
<div class="paragraph">
<p>

<strong><a href="http://srfi.schemers.org/srfi-216/srfi-216.html">SRFI-216</a></strong> is fully supported. However, it defines the constant <code>stream-null</code> and the predicate
<code>stream-null?</code> which are incompatible with the ones defined in the <code>(stream primitive)</code> library used by
<strong><a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI-41</a></strong> or <strong><a href="http://srfi.schemers.org/srfi-221/srfi-221.html">SRFI-221</a></strong>. Prefix the imported symbols of this SRFI, if you plan to
use it with one of the previous libraries.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliography">Bibliography</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="AMOP"></a>[AMOP] Gregor Kickzales, Jim de Rivières and Daniel G. Bobrow&#8201;&#8212;&#8201;<strong>The Art of Meta Object Protocol</strong>&#8201;&#8212;&#8201;MIT Press, 1991.</p>
</li>
<li>
<p><a id="Bigloo"></a>[Bigloo] Manuel Serrano&#8201;&#8212;&#8201;<a href="http://www-sop.inria.fr/mimosa/fp/Bigloo/"><strong>Bigloo</strong></a> Home Page.</p>
</li>
<li>
<p><a id="BoehmGC"></a>[BoehmGC] Hans Boehm&#8201;&#8212;&#8201;<a href="https://www.hboehm.info/gc/">A garbage collector for C and C++ </a> Home Page.</p>
</li>
<li>
<p><a id="CLtL2"></a>[CLtL2] Guy L. Steele Jr.&#8201;&#8212;&#8201;<strong>Common Lisp: the Language, 2nd Edition</strong>&#8201;&#8212;&#8201;Digital Press, 12 Crosby Drive, Bedford, MA 01730, USA, 1990.</p>
</li>
<li>
<p><a id="DSSSL"></a>[DSSSL] ISO/IEC&#8201;&#8212;&#8201;<strong>Information technology, Processing Languages, Document Style Semantics and
Specification Languages (DSSSL)</strong>&#8201;&#8212;&#8201;10179:1996(E), ISO, , 1996.</p>
</li>
<li>
<p><a id="Dylan"></a>[Dylan] Apple Computer&#8201;&#8212;&#8201;<strong>Dylan: an Object Oriented Dynamic Language</strong>&#8201;&#8212;&#8201;Apple, April, 1992.</p>
</li>
<li>
<p><a id="GTK"></a>[GTK] <a href="http://gtk.org/"><strong>The GTK+ Toolkit Home Page</strong></a></p>
</li>
<li>
<p><a id="PCRE"></a>[PCRE] Philip Hazel&#8201;&#8212;&#8201;<a href="http://pcre.org/"><strong>PCRE (Perl Compatible Regular Expressions)</strong></a>
Home page.</p>
</li>
<li>
<p><a id="POSIX"></a>[POSIX] POSIX Committee&#8201;&#8212;&#8201;<strong>System Application Program Interface (API) [C Language]</strong>&#8201;&#8212;&#8201;2017.</p>
</li>
<li>
<p><a id="QuG92"></a>[QuG92] C. Queinnec and J-M. Geffroy&#8201;&#8212;&#8201;<strong>Partial Evaluation Applied to Symbolic Pattern Matching
with Intelligent Backtrack</strong>&#8201;&#8212;&#8201;Workshop in Static Analysis, Bigre, (81&#8212;&#8203;82), Bordeaux (France), September, 1992.</p>
</li>
<li>
<p><a id="R5RS"></a>[R5RS] Kelsey, R. and Clinger, W. and Rees, J.&#8201;&#8212;&#8201;<a href="https://www.schemers.org/Documents/Standards/R5RS/HTML"><strong>The Revised5 Report on the Algorithmic Language Scheme</strong></a>&#8201;&#8212;&#8201;Higher-Order and Symbolic Computation, 11(1), Sep, 1998.</p>
</li>
<li>
<p><a id="R7RS"></a>[R7RS] Alex S. Shinn, John Cowan and Arthur A. Gleckler&#8201;&#8212;&#8201;<a href="https://small.r7rs.org/attachment/r7rs.pdf"><strong>The Revised7 Report on the Algorithmic Language Scheme&#8201;&#8212;&#8201;R7RS small</strong></a>&#8201;&#8212;&#8201;July, 2013.</p>
</li>
<li>
<p><a id="SLIB"></a>[SLIB] Aubrey Jaffer &#8201;&#8212;&#8201;<a href="https://people.csail.mit.edu/jaffer/SLIB"><strong>The SLIB Portable Scheme Library Home Page</strong></a></p>
</li>
<li>
<p><a id="SOS"></a>[SOS] Chris Hanson&#8201;&#8212;&#8201;<a href="https://www.gnu.org/software/mit-scheme/documentation/stable/mit-scheme-sos.pdf">The SOS Reference Manual, version 1.9</a>&#8201;&#8212;&#8201;November, 2011.</p>
</li>
<li>
<p><a id="STk"></a>[STk] Erick Gallesio&#8201;&#8212;&#8201;<a href="https://www.stklos.net/Doc/STk.pdf"><strong>STk Reference Manual</strong></a>&#8201;&#8212;&#8201;RT 95-31a,
I3S CNRS / Université de Nice - Sophia Antipolis, juillet, 1995.</p>
</li>
<li>
<p><a id="Tiny-Clos"></a>[Tiny-Clos] Gregor Kickzales&#8201;&#8212;&#8201;<a href="http://community.schemewiki.org/?Tiny-CLOS"><strong>Tiny-Clos</strong></a>&#8201;&#8212;&#8201;December, 1992.</p>
</li>
<li>
<p><a id="Tk"></a>[Tk] John K. Ousterhout&#8201;&#8212;&#8201;<strong>An X11 toolkit based on the Tcl Language</strong>&#8201;&#8212;&#8201;USENIX Winter Conference, January, 1991, pp. 105&#8212;&#8203;115.</p>
</li>
<li>
<p><a id="TuD96"></a>[TuD96] Sho-Huan Simon Tung and R. Kent Dybvig&#8201;&#8212;&#8201;<strong>Reliable Interactive Programming
with Modules</strong>&#8201;&#8212;&#8201;LISP and Symbolic Computation, 91996, pp. 343&#8212;&#8203;358.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_libraries">Appendix A: STklos Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the standard libraries provided by <strong><em>STklos</em></strong>.</p>
</div>
<div class="sect2">
<h3 id="_the_scheme_libraries">A.1. The (scheme &#8230;&#8203;) Libraries</h3>
<div class="sect3">
<h4 id="_r7rs_small_libraries">A.1.1. R<sup>7</sup>RS Small Libraries</h4>
<div class="paragraph">
<p><strong><em>STklos</em></strong> offers all the libraries defined by R<sup>7</sup>RS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>base</p>
</li>
<li>
<p>case-lambda</p>
</li>
<li>
<p>char</p>
</li>
<li>
<p>complex</p>
</li>
<li>
<p>cxr</p>
</li>
<li>
<p>eval</p>
</li>
<li>
<p>file</p>
</li>
<li>
<p>inexact</p>
</li>
<li>
<p>lazy</p>
</li>
<li>
<p>load</p>
</li>
<li>
<p>process-context</p>
</li>
<li>
<p>r5rs</p>
</li>
<li>
<p>read</p>
</li>
<li>
<p>repl</p>
</li>
<li>
<p>time</p>
</li>
<li>
<p>write</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="#R7RS">[R7RS]</a> document for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_r7rs_large_libraries">A.1.2. R<sup>7</sup>RS Large Libraries</h4>
<div class="paragraph">
<p><strong><em>STklos</em></strong> supports some libraries of the (under development) R<sup>7</sup>RS Large editions.</p>
</div>
<div class="paragraph">
<p>For now, supported libraries of the <strong>Red edition</strong> are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>box <em>(srfi 111)</em></p>
</li>
<li>
<p>charset <em>(srfi 14)</em></p>
</li>
<li>
<p>comparator <em>(srfi 128)</em></p>
</li>
<li>
<p>hash-table <em>(srfi 125)</em></p>
</li>
<li>
<p>ideque <em>(srfi 134)</em></p>
</li>
<li>
<p>ilist <em>(srfi 116)</em></p>
</li>
<li>
<p>list <em>(srfi 1)</em></p>
</li>
<li>
<p>list-queue <em>(srfi 117)</em></p>
</li>
<li>
<p>lseq <em>(srfi 127)</em></p>
</li>
<li>
<p>set <em>(srfi 113)</em></p>
</li>
<li>
<p>sort <em>(srfi 132)</em></p>
</li>
<li>
<p>stream <em>(srfi 41)</em></p>
</li>
<li>
<p>text <em>(srfi 135)</em></p>
</li>
<li>
<p>vector <em>(srfi 133)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For now, supported libraries of the <strong>Tangerine edition</strong> are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bitwise <em>(srfi 151)</em></p>
</li>
<li>
<p>division <em>(srfi 141)</em></p>
</li>
<li>
<p>flonum <em>(srfi 144)</em></p>
</li>
<li>
<p>generator <em>(srfi 158)</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_srfi_libraries">A.2. The (srfi &#8230;&#8203;) Libraries</h3>
<div class="paragraph">
<p>All the SRFI supported by <strong><em>STklos</em></strong> are placed under
the <code>srfi</code> meta library and their name is SRFI number. Hence, to use
the exported symbols of <strong><a href="http://srfi.schemers.org/srfi-1/srfi-1.html">SRFI-1</a></strong>, you&#8217;ll have to import the
<code>(srfi 1)</code> library.</p>
</div>
<div class="paragraph">
<p>See  <em><a href="#_srfis">Chapter 14</a></em> for more information</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_stklos_libraries">A.3. The (stklos &#8230;&#8203;) Libraries</h3>
<div class="paragraph">
<p>This section describes the standard libraries which are placed under
the <code>stklos</code> meta library. Note that <strong><em>STklos</em></strong> extensions can add
some libraries in the <code>stklos</code> meta library; they will be described in
the extension documentation.</p>
</div>
<div class="sect3">
<h4 id="_stklos_itrie_library">A.3.1. (stklos itrie) Library</h4>
<div class="paragraph">
<p>This library was designed by Jerônimo Pellegrini
(<a href="https://github.com/jpellegrini">@jpellegrini</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Small description needed
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The symbols exported by <code>(stklos itrie)</code> are described below:</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(alist&#8594;fxmapping alist) → fxmapping</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated fxmapping containing the associations of
alist. It is an error if the car of any pair in alist is not a
fixnum. If an integer k appears as the key of multiple associations in
alist (i.e. as the car of multiple pairs), then the first association
for k is preferred.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmapping-&gt;alist</span>
  <span class="p">(</span><span class="nf">alist-&gt;fxmapping</span> <span class="o">'</span><span class="p">((</span><span class="nf">1</span> <span class="o">.</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="o">.</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="nv">c</span><span class="p">))))</span>
 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="o">.</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="nv">c</span><span class="p">))</span>

<span class="p">(</span><span class="nf">fxmapping-&gt;alist</span>
  <span class="p">(</span><span class="nf">alist-&gt;fxmapping</span> <span class="o">'</span><span class="p">((</span><span class="nf">-10</span> <span class="o">.</span> <span class="s">"yar"</span><span class="p">)</span> <span class="p">(</span><span class="nf">-10</span> <span class="o">.</span> <span class="s">"worf"</span><span class="p">))))</span>
 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">-10</span> <span class="o">.</span> <span class="s">"yar"</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping k1 v1 k2 v2 &#8230;&#8203; kn vn)</code></strong><br>
<strong><code>(constant-fxmapping k1 v1 k2 v2 &#8230;&#8203; kn vn)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Builds a fixnum map containing the integer keys <code>k1</code>, <code>k2</code>, &#8230;&#8203;, <code>kn</code>
with respective associated values <code>v1</code>, <code>v2</code>, &#8230;&#8203; <code>vn</code>.</p>
</div>
<div class="paragraph">
<p>It is an error if any of the keys is not an integer, or if the
number of arguments is not even.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset n1 n2 &#8230;&#8203; nk)</code></strong><br>
<strong><code>(constant-iset n1 n2 &#8230;&#8203; nk)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Builds a fixnum set containing the fixnums  <code>n1</code>, <code>n2</code>, &#8230;&#8203;, <code>nk</code>.</p>
</div>
<div class="paragraph">
<p>It is an error if any of the keys is not an integer.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-adjoin fxmap k1 obj1 k2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a fxmapping containing all of the associations of <code>fxmap</code> as
well as the associations <code>(k1, obj1)</code>, <code>(k2, obj2)</code>, &#8230;&#8203; The number of
key/value arguments must be even.</p>
</div>
<div class="paragraph">
<p>If any of the keys already have associations in <code>fxmap</code>, the old
associations are preserved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmapping-&gt;alist</span> <span class="p">(</span><span class="nf">fxmapping-adjoin</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">1</span> <span class="ss">'b</span><span class="p">)</span> <span class="mi">0</span> <span class="ss">'a</span><span class="p">))</span>
 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="o">.</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="nv">b</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-contains? map element)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns true if <code>map</code> contains an association for <code>element</code>, and false otherwise.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-empty? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is an empty fxmapping and <code>#f</code> if it
is an fxmapping containing at least one key.
If <code>obj</code> is not an fxmapping object, an error is sginaled.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-height trie)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the height of the internal trie of an fxmap. The
expected running time of searches and insertions is
proportional to this value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-keys fxmap)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the keys of <code>fxmap</code> as a list in ascending numerical order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmapping-keys</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">137</span> <span class="ss">'a</span> <span class="mi">-24</span> <span class="ss">'b</span> <span class="mi">-5072</span> <span class="ss">'c</span><span class="p">))</span>
 <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">-5072</span> <span class="mi">-24</span> <span class="mi">137</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-mutable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is a mutable fxmapping and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-ref/default map k obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If an association <code>(k, v)</code> occurs in <code>map</code>, returns <code>v</code>. Otherwise, returns <code>obj</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmapping-ref/default</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">36864</span> <span class="ss">'zap</span><span class="p">)</span> <span class="mi">36864</span> <span class="no">#f</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="nv">zap</span>
<span class="p">(</span><span class="nf">fxmapping-ref/default</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">0</span> <span class="ss">'a</span><span class="p">)</span> <span class="mi">36864</span> <span class="no">#f</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-size trie)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of key/value pairs in an fxmap.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-values fxmap)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the values of <code>fxmap</code> as a list in ascending numerical order of
key. That is, if <code>(k1, v1), &#8230;&#8203;, (kn, vn)</code> are the associations of <code>fxmap</code>
ordered so that <code>k1 &#8656; … &#8656; kn</code>, then <code>(fxmapping-values fxmap)</code> produces
the list <code>(v1 &#8230;&#8203; vn)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmapping-values</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">0</span> <span class="s">"picard"</span> <span class="mi">1</span> <span class="s">"riker"</span> <span class="mi">2</span> <span class="s">"troi"</span><span class="p">))</span>
 <span class="nv">=&gt;</span> <span class="p">(</span><span class="s">"picard"</span> <span class="s">"riker"</span> <span class="s">"troi"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping-union fxmap1 fxmap2 fxmap3 &#8230;&#8203;)</code></strong><br>
<strong><code>(fxmapping-intersection fxmap1 fxmap2 fxmap3 &#8230;&#8203;)</code></strong><br>
<strong><code>(fxmapping-difference fxmap1 fxmap2 fxmap3 &#8230;&#8203;)</code></strong><br>
<strong><code>(fxmapping-xor fxmap1 fxmap2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a fxmapping whose set of associations is the union,
intersection, asymmetric difference, or symmetric difference of the
sets of associations of the fxmaps. Asymmetric difference is extended
to more than two fxmappings by taking the difference between the first
fxmapping and the union of the others. Symmetric difference is not
extended beyond two fxmappings. When comparing associations, only the
keys are compared. In case of duplicate keys, associations in the
result fxmapping are drawn from the first fxmapping in which they
appear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">fxmapping-&gt;alist</span> <span class="p">(</span><span class="nf">fxmapping-union</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">0</span> <span class="ss">'a</span> <span class="mi">2</span> <span class="ss">'c</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">1</span> <span class="ss">'b</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)))</span>
   <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="o">.</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="o">.</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span> <span class="o">.</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">3</span> <span class="o">.</span> <span class="nv">d</span><span class="p">))</span>

 <span class="p">(</span><span class="nf">fxmapping-&gt;alist</span>
  <span class="p">(</span><span class="nf">fxmapping-intersection</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">0</span> <span class="ss">'a</span> <span class="mi">2</span> <span class="ss">'c</span><span class="p">)</span>
                          <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">1</span> <span class="ss">'b</span> <span class="mi">2</span> <span class="ss">'c</span> <span class="mi">3</span> <span class="ss">'d</span><span class="p">)</span>
                          <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">2</span> <span class="ss">'c</span> <span class="mi">4</span> <span class="ss">'e</span><span class="p">)))</span>
    <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">2</span> <span class="o">.</span> <span class="nv">c</span><span class="p">))</span>

<span class="p">(</span><span class="nf">fxmapping-&gt;alist</span>
 <span class="p">(</span><span class="nf">fxmapping-difference</span> <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">0</span> <span class="ss">'a</span> <span class="mi">1</span> <span class="ss">'b</span> <span class="mi">2</span> <span class="ss">'c</span><span class="p">)</span>
                       <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">2</span> <span class="s">"worf"</span><span class="p">)</span>
                       <span class="p">(</span><span class="nf">fxmapping</span> <span class="mi">1</span> <span class="s">"data"</span><span class="p">)))</span>
    <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">0</span> <span class="o">.</span> <span class="nv">a</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(fxmapping? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is an fxmapping object and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset=? iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset&lt;? iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset&gt;? iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset&#8656;? iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset&gt;=? iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These procedures return true when each set is
equal (<code>iset=?</code>) or a proper subset (<code>iset&lt;?</code>), a proper
superset (<code>iset&gt;?</code>), a subset (<code>iset&#8656;?</code>) or a superset
(<code>iset&gt;=?</code>) of the next one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset=?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>           <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">iset&lt;?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">))</span>         <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">iset&gt;=?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset&#8594;list set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated list containing the members of
<code>set</code> in increasing numerical order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-adjoin set element1 element2 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-adjoin! set element1 element2 &#8230;&#8203;)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>iset-adjoin</code> procedure returns a newly allocated iset that contains
all the values of <code>set</code>, and in addition each element unless it is
already equal to one of the existing or newly added members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-adjoin</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>iset-adjoin!</code> procedure is the linear update version of
<code>iset-adjoin</code>. In STklos, it is an alias to <code>iset-adjoin</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-any? pred? set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns true if at least one of the elements of <code>set</code> satisfies
<code>pred?</code>. Note that this differs from the SRFI 1 analogue because
it does not return an element of the iset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-any</span> <span class="nv">odd?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">10</span> <span class="mi">2</span> <span class="mi">-3</span> <span class="mi">4</span><span class="p">))</span>    <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">iset-any</span> <span class="nv">odd?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">10</span> <span class="mi">2</span> <span class="mi">-8</span> <span class="mi">4</span> <span class="mi">0</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-open-interval set low high)</code></strong><br>
<strong><code>(iset-closed-interval set low high)</code></strong><br>
<strong><code>(iset-open-closed-interval set low high)</code></strong><br>
<strong><code>(iset-closed-open-interval set low high)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Procedures that return a subset of <code>set</code> contained in the interval from
<code>low</code> to <code>high</code>. The interval may be open, closed, open below and closed
above, or open above and closed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-open-interval</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">2</span> <span class="mi">7</span><span class="p">))</span>        <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-closed-interval</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">2</span> <span class="mi">7</span><span class="p">))</span>      <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-open-closed-interval</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">2</span> <span class="mi">7</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-closed-open-interval</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">2</span> <span class="mi">7</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-contains? set element)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns true if <code>set</code> contains <code>element</code>, and false otherwise.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-copy set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated iset containing the elements of <code>set</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-count pred? set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of elements of <code>set</code> that satisfy
<code>pred?</code> as an exact integer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-count</span> <span class="nv">odd?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">10</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">-3</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">3</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="mi">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-delete set element1 element2 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-delete! set element1 element2 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-delete-all set element-list)</code></strong><br>
<strong><code>(iset-delete-all! set element-list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>iset-delete</code> procedure returns a newly allocated iset containing
all the values of <code>set</code> except for any that are equal to one or more of
the elements. Any element that is not equal to some member of the <code>set</code>
is ignored.</p>
</div>
<div class="paragraph">
<p>The <code>iset-delete!</code> procedure is the same as <code>iset-delete</code>.
is permitted to mutate and return the iset argument rather than
allocating a new iset&#8201;&#8212;&#8201;but in STklos, it doesn&#8217;t.</p>
</div>
<div class="paragraph">
<p>The <code>iset-delete-all</code> and <code>iset-delete-all!</code> procedures are the same as
<code>iset-delete</code> and <code>iset-delete!</code>, except that they accept a single
argument which is a list of elements to be deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-delete</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">3</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-delete-all</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span>
                             <span class="o">'</span><span class="p">(</span><span class="nf">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)))</span>   <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>


</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-delete-min set)</code></strong><br>
<strong><code>(iset-delete-min! set)</code></strong><br>
<strong><code>(iset-delete-max set)</code></strong><br>
<strong><code>(iset-delete-max! set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns two values: the smallest/largest integer n in <code>set</code> and a
newly-allocated iset that contains all elements of <code>set</code> except for
n. It is an error if iset is empty.</p>
</div>
<div class="paragraph">
<p>The <code>iset-delete-min!</code> and <code>iset-delete-max!</code> procedures are the same as
<code>iset-delete-min</code> and <code>iset-delete-max</code>, respectively, except that they
are permitted to mutate and return the <code>set</code> argument instead of
allocating a new iset. In STklos, they do not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let-values</span> <span class="p">(((</span><span class="nf">n</span> <span class="nv">set</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset-delete-min</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="nv">set</span><span class="p">)))</span>
  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="p">(</span><span class="nf">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span>
<span class="p">(</span><span class="nf">let-values</span> <span class="p">(((</span><span class="nf">n</span> <span class="nv">set</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset-delete-max</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="nv">set</span><span class="p">)))</span>
  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">11</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-disjoint? iset1 iset2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if <code>iset1</code> and <code>iset2</code> have no elements in common and <code>#f</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-disjoint?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">iset-disjoint?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-empty? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is an empty iset and <code>#f</code> if it
is an iset containing at least one key.
If <code>obj</code> is not an iset object, an error is sginaled.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-every? predicate iset)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> if every element of <code>set</code> satisfies <code>predicate</code>, or <code>#f</code>
otherwise. Note that this differs from the SRFI 1 analogue because it
does not return an element of the iset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-every?</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">x</span> <span class="mi">5</span><span class="p">))</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">-2</span> <span class="mi">-1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="no">#t</span>
<span class="p">(</span><span class="nf">iset-every?</span> <span class="nv">positive?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">-2</span> <span class="mi">-1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>            <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-filter predicate set)</code></strong><br>
<strong><code>(iset-filter! predicate set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated iset containing just the elements
of <code>set</code> that satisfy <code>predicate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">x</span> <span class="mi">6</span><span class="p">))</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)))</span>
 <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>iset-filter!</code> is allowed to modify <code>set</code>, but in STklos it does not.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-find predicate set failure)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the smallest element of <code>set</code> that satisfies predicate, or
the result of invoking <code>failure</code> with no arguments if there is none.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-find</span> <span class="nv">positive?</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">-1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="no">#f</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="mi">1</span>
<span class="p">(</span><span class="nf">iset-find</span> <span class="nv">zero?</span>     <span class="p">(</span><span class="nf">iset</span> <span class="mi">-1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="no">#f</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-fold proc nil set)</code></strong><br>
<strong><code>(iset-fold-right proc nil set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Invokes <code>proc</code> on each member of <code>set</code> in increasing/decreasing numerical
order, passing the result of the previous invocation as a second
argument. For the first invocation, <code>nil</code> is used as the second
argument. Returns the result of the last invocation, or <code>nil</code> if there
was no invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-fold</span> <span class="nv">+</span> <span class="mi">0</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span>            <span class="nv">=&gt;</span> <span class="mi">28</span>
<span class="p">(</span><span class="nf">iset-fold</span> <span class="nv">cons</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span>       <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">11</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-fold-right</span> <span class="nv">cons</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-for-each proc set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Applies <code>proc</code> to <code>set</code> in increasing numerical order, discarding the
returned values. Returns an unspecified result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">sum</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">iset-for-each</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="k">set!</span> <span class="nv">sum</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">sum</span> <span class="nv">x</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span>
  <span class="nv">sum</span><span class="p">)</span>
<span class="nv">=&gt;</span> <span class="mi">28</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-height trie)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the height of the internal trie of an iset. The
expected running time of searches and insertions is
proportional to this value.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-map proc set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Applies <code>proc</code> to each element of <code>set</code> in arbitrary order and returns a
newly allocated iset, created as if by iset, which contains the
results of the applications. It is an error if <code>proc</code> returns a value
that is not an exact integer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">10</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">11</span> <span class="mi">21</span><span class="p">))</span>
     <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">10</span> <span class="mi">110</span> <span class="mi">210</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">quotient</span> <span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">iset</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
 <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-min set)</code></strong><br>
<strong><code>(iset-max set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the smallest or largest integer in <code>set</code>, or <code>#f</code> if there is none.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-min</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">2</span>
<span class="p">(</span><span class="nf">iset-max</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="mi">11</span>
<span class="p">(</span><span class="nf">iset-max</span> <span class="p">(</span><span class="nf">iset</span><span class="p">))</span>            <span class="nv">=&gt;</span> <span class="no">#f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-member element set default)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the element of <code>set</code> that is equal to <code>element</code>. If <code>element</code> is not a member
of <code>set</code>, then <code>default</code> is returned.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-mutable? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is a mutable iset and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-partition predicate set)</code></strong><br>
<strong><code>(iset-partition! predicate set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns two values: a newly allocated iset that contains just the
elements of <code>set</code> that satisfy <code>predicate</code> and another newly allocated
iset that contains just the elements of <code>set</code> that do not satisfy
<code>predicate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">let-values</span> <span class="p">(((</span><span class="nf">low</span> <span class="nv">high</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset-partition</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">x</span> <span class="mi">6</span><span class="p">))</span>
                                         <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="nv">high</span><span class="p">)))</span>
 <span class="nv">=&gt;</span> <span class="p">((</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">7</span> <span class="mi">11</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-remove predicate set)</code></strong><br>
<strong><code>(iset-remove! predicate set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated <code>set</code> containing just the elements of <code>set</code>
that do not satisfy <code>predicate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-remove</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">x</span> <span class="mi">6</span><span class="p">))</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)))</span>
 <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">7</span> <span class="mi">11</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Iset-remove!</code> is allowed to modify <code>set</code>, but in STklos it does not.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-search set element failure success)</code></strong><br>
<strong><code>(iset-search! iset element failure success)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>Set</code> is searched from lowest to highest value for <code>element</code>. If it
is not found, then the <code>failure</code> procedure is tail-called with two
continuation arguments, <code>insert</code> and <code>ignore</code>, and is expected to
tail-call one of them. If <code>element</code> is found, then the <code>success</code> procedure
is tail-called with the matching element of <code>set</code> and two
continuations, <code>update</code> and <code>remove</code>, and is expected to tail-call one of
them.</p>
</div>
<div class="paragraph">
<p>The effects of the continuations are as follows (where <code>obj</code> is any
Scheme object):</p>
</div>
<div class="paragraph">
<p>Invoking <code>(insert obj)</code> causes <code>element</code> to be inserted into iset.</p>
</div>
<div class="paragraph">
<p>Invoking <code>(ignore obj)</code> causes <code>set</code> to remain unchanged.</p>
</div>
<div class="paragraph">
<p>Invoking <code>(update new-element obj)</code> causes <code>new-element</code> to be
inserted into <code>set</code> in place of <code>element</code>.</p>
</div>
<div class="paragraph">
<p>Invoking <code>(remove obj)</code> causes the matching element of <code>set</code> to
be removed from it.</p>
</div>
<div class="paragraph">
<p>In all cases, two values are returned: an iset and <code>obj</code>.</p>
</div>
<div class="paragraph">
<p>The <code>iset-search!</code> procedure is the same as <code>iset-search</code>, except that it
is permitted to mutate and return the iset argument rather than
allocating a new iset. In STklos, it does not.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-size set)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns the number of fixnums in <code>set</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-unfold stop? mapper successor seed)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Create a newly allocated iset as if by iset. If the result of
applying the predicate <code>stop?</code> to <code>seed</code> is true, return the
iset. Otherwise, apply the procedure <code>mapper</code> to <code>seed</code>. The
value that <code>mapper</code> returns is added to the iset. Then get a
new seed by applying the procedure <code>successor</code> to <code>seed</code>, and
repeat this algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-unfold</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">n</span> <span class="mi">64</span><span class="p">))</span>
                         <span class="nv">values</span>
                         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
                         <span class="mi">2</span><span class="p">))</span>
<span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">16</span> <span class="mi">32</span> <span class="mi">64</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>






</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset-union iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-intersection iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-difference iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-xor iset1 iset2)</code></strong><br>
<strong><code>(iset-union! iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-intersection! iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-difference! iset1 iset2 iset3 &#8230;&#8203;)</code></strong><br>
<strong><code>(iset-xor! iset1 iset2)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Return a newly allocated iset that is the union, intersection,
asymmetric difference, or symmetric difference of the
isets. Asymmetric difference is extended to more than two isets by
taking the difference between the first iset and the union of the
others. Symmetric difference is not extended beyond two
isets. Elements in the result iset are drawn from the first iset in
which they appear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-union</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-intersection</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-difference</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">iset-xor</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The procedures whose name end in <code>!</code> are linear update procedures.
The specification says they may or may not alter their argument. In
STklos they do not: in fact, they are aliases to the pure functional
versions.</p>
</div>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(iset? obj)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns <code>#t</code> is <code>obj</code> is an iset and <code>#f</code> otherwise.</p>
</div>
<div class="paragraph">
<p>



</p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(isubset= set k)</code></strong><br>
<strong><code>(isubset&lt; set k)</code></strong><br>
<strong><code>(isubset&#8656; set k)</code></strong><br>
<strong><code>(isubset&gt; set k)</code></strong><br>
<strong><code>(isubset&gt;= set k)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Procedures that return an integer set containing the elements of <code>set</code>
that are equal to, less than, less than or equal to, greater than, or
greater than or equal to <code>k</code>. Note that the result of <code>isubset=</code> contains
at most one element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">isubset=</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">7</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">7</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">isubset&lt;</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">7</span><span class="p">))</span>  <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">isubset&gt;=</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">11</span><span class="p">)</span> <span class="mi">7</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">7</span> <span class="mi">11</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(list&#8594;iset list)</code></strong><br>
<strong><code>(list&#8594;iset! set list)</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated iset, created as if by iset, that contains
the elements of <code>list</code>. Duplicate elements are omitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">list-&gt;iset</span> <span class="o">'</span><span class="p">(</span><span class="nf">-3</span> <span class="mi">-1</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">-3</span> <span class="mi">-1</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>list&#8594;iset!</code> may mutate <code>set</code> rather than allocating a new iset,
but in STklos it does not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">list-&gt;iset!</span> <span class="p">(</span><span class="nf">iset</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="nf">-3</span> <span class="mi">-1</span> <span class="mi">0</span><span class="p">)))</span> <span class="err">⇒</span> <span class="p">(</span><span class="nf">-3</span> <span class="mi">-1</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph text-right">
<p><span class="rmargin small"><em>STklos</em> procedure</span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph small">
<p><strong><code>(make-range-iset start end [step])</code></strong><br></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Returns a newly allocated iset specified by an inclusive lower bound
<code>start</code>, an exclusive upper bound `e`nd, and a step value (default 1), all
of which are exact integers. This constructor produces an iset
containing the sequence</p>
</div>
<div class="paragraph">
<p><code>start, (+ start step), (+ start (* 2 step)), &#8230;&#8203;, (+ start (* n step))</code>,</p>
</div>
<div class="paragraph">
<p>where <code>n</code> is the greatest integer such that <code>(+ start (* n step)) &lt; end</code>
if <code>step</code> is positive, or such that <code>(+ start (* n step)) &gt; end</code> if <code>step</code>
is negative. It is an error if <code>step</code> is zero.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scheme"><span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">make-range-iset</span> <span class="mi">25</span> <span class="mi">30</span><span class="p">))</span>    <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">25</span> <span class="mi">26</span> <span class="mi">27</span> <span class="mi">28</span> <span class="mi">29</span><span class="p">)</span>
<span class="p">(</span><span class="nf">iset-&gt;list</span> <span class="p">(</span><span class="nf">make-range-iset</span> <span class="mi">-10</span> <span class="mi">10</span> <span class="mi">6</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">-10</span> <span class="mi">-4</span> <span class="mi">2</span> <span class="mi">8</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stklos_preproc_library">A.3.2. (stklos preproc) Library</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This library  must be described
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="FDL">Appendix B: GNU Free Documentation License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Version 1.3, 3 November 2008</p>
</div>
<div class="paragraph">
<p>Copyright &#169; 2000, 2001, 2002, 2007, 2008 Free Software Foundation,
Inc. <a href="https://fsf.org/" class="bare">https://fsf.org/</a></p>
</div>
<div class="paragraph">
<p>Everyone is permitted to copy and distribute verbatim copies of this
license document, but changing it is not allowed.</p>
</div>
<div class="sect2">
<h3 id="_preamble">B.1. PREAMBLE</h3>
<div class="paragraph">
<p>The purpose of this License is to make a manual, textbook, or other
functional and useful document ``free" in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it, with
or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible for
modifications made by others.</p>
</div>
<div class="paragraph">
<p>This License is a kind of ``copyleft", which means that derivative
works of the document must themselves be free in the same sense. It
complements the GNU General Public License, which is a copyleft license
designed for free software.</p>
</div>
<div class="paragraph">
<p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free program
should come with manuals providing the same freedoms that the software
does. But this License is not limited to software manuals; it can be
used for any textual work, regardless of subject matter or whether it is
published as a printed book. We recommend this License principally for
works whose purpose is instruction or reference.</p>
</div>
</div>
<div class="sect2">
<h3 id="_applicability_and_definitions">B.2. APPLICABILITY AND DEFINITIONS</h3>
<div class="paragraph">
<p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License. Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein. The ``Document", below, refers
to any such manual or work. Any member of the public is a licensee, and
is addressed as "you". You accept the license if you copy, modify or
distribute the work in a way requiring permission under copyright law.</p>
</div>
<div class="paragraph">
<p>A "Modified Version" of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.</p>
</div>
<div class="paragraph">
<p>A "Secondary Section" is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document’s overall subject
(or to related matters) and contains nothing that could fall directly
within that overall subject. (Thus, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any
mathematics.) The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding them.</p>
</div>
<div class="paragraph">
<p>The "Invariant Sections" are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice that
says that the Document is released under this License. If a section does
not fit the above definition of Secondary then it is not allowed to be
designated as Invariant. The Document may contain zero Invariant
Sections. If the Document does not identify any Invariant Sections then
there are none.</p>
</div>
<div class="paragraph">
<p>The "Cover Texts" are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License. A Front-Cover Text may be
at most 5 words, and a Back-Cover Text may be at most 25 words.</p>
</div>
<div class="paragraph">
<p>A "Transparent" copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the general
public, that is suitable for revising the document straightforwardly
with generic text editors or (for images composed of pixels) generic
paint programs or (for drawings) some widely available drawing editor,
and that is suitable for input to text formatters or for automatic
translation to a variety of formats suitable for input to text
formatters. A copy made in an otherwise Transparent file format whose
markup, or absence of markup, has been arranged to thwart or discourage
subsequent modification by readers is not Transparent. An image format
is not Transparent if used for any substantial amount of text. A copy
that is not "Transparent" is called "Opaque".</p>
</div>
<div class="paragraph">
<p>Examples of suitable formats for Transparent copies include plain ASCII
without markup, Texinfo input format, LaTeX input format, SGML or XML
using a publicly available DTD, and standard-conforming simple HTML,
PostScript or PDF designed for human modification. Examples of
transparent image formats include PNG, XCF and JPG. Opaque formats
include proprietary formats that can be read and edited only by
proprietary word processors, SGML or XML for which the DTD and/or
processing tools are not generally available, and the machine-generated
HTML, PostScript or PDF produced by some word processors for output
purposes only.</p>
</div>
<div class="paragraph">
<p>The "Title Page" means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page. For works in formats
which do not have any title page as such, "Title Page" means the text
near the most prominent appearance of the work’s title, preceding the
beginning of the body of the text.</p>
</div>
<div class="paragraph">
<p>The "publisher" means any person or entity that distributes copies of
the Document to the public.</p>
</div>
<div class="paragraph">
<p>A section "Entitled XYZ" means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language. (Here XYZ stands for a
specific section name mentioned below, such as "Acknowledgements",
"Dedications", "Endorsements", or "History".) To "Preserve the
Title" of such a section when you modify the Document means that it
remains a section "Entitled XYZ" according to this definition.</p>
</div>
<div class="paragraph">
<p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document. These Warranty
Disclaimers are considered to be included by reference in this License,
but only as regards disclaiming warranties: any other implication that
these Warranty Disclaimers may have is void and has no effect on the
meaning of this License.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verbatim_copying">B.3. VERBATIM COPYING</h3>
<div class="paragraph">
<p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies to
the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License. You may not use
technical measures to obstruct or control the reading or further copying
of the copies you make or distribute. However, you may accept
compensation in exchange for copies. If you distribute a large enough
number of copies you must also follow the conditions in section 3.</p>
</div>
<div class="paragraph">
<p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_copying_in_quantity">B.4. COPYING IN QUANTITY</h3>
<div class="paragraph">
<p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document’s license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover Texts:
Front-Cover Texts on the front cover, and Back-Cover Texts on the back
cover. Both covers must also clearly and legibly identify you as the
publisher of these copies. The front cover must present the full title
with all words of the title equally prominent and visible. You may add
other material on the covers in addition. Copying with changes limited
to the covers, as long as they preserve the title of the Document and
satisfy these conditions, can be treated as verbatim copying in other
respects.</p>
</div>
<div class="paragraph">
<p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.</p>
</div>
<div class="paragraph">
<p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy a
computer-network location from which the general network-using public
has access to download using public-standard network protocols a
complete Transparent copy of the Document, free of added material. If
you use the latter option, you must take reasonably prudent steps, when
you begin distribution of Opaque copies in quantity, to ensure that this
Transparent copy will remain thus accessible at the stated location
until at least one year after the last time you distribute an Opaque
copy (directly or through your agents or retailers) of that edition to
the public.</p>
</div>
<div class="paragraph">
<p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modifications">B.5. MODIFICATIONS</h3>
<div class="paragraph">
<p>You may copy and distribute a Modified Version of the Document under the
conditions of sections 2 and 3 above, provided that you release the
Modified Version under precisely this License, with the Modified Version
filling the role of the Document, thus licensing distribution and
modification of the Modified Version to whoever possesses a copy of it.
In addition, you must do these things in the Modified Version:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A. Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions (which
should, if there were any, be listed in the History section of the
Document). You may use the same title as a previous version if the
original publisher of that version gives permission.</p>
</li>
<li>
<p>B. List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified Version,
together with at least five of the principal authors of the Document
(all of its principal authors, if it has fewer than five), unless they
release you from this requirement.</p>
</li>
<li>
<p>C. State on the Title page the name of the publisher of the Modified
Version, as the publisher.</p>
</li>
<li>
<p>D. Preserve all the copyright notices of the Document.</p>
</li>
<li>
<p>E. Add an appropriate copyright notice for your modifications adjacent
to the other copyright notices.</p>
</li>
<li>
<p>F. Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the terms
of this License, in the form shown in the Addendum below.</p>
</li>
<li>
<p>G. Preserve in that license notice the full lists of Invariant
Sections and required Cover Texts given in the Document’s license
notice.</p>
</li>
<li>
<p>H. Include an unaltered copy of this License.</p>
</li>
<li>
<p>I. Preserve the section Entitled "History", Preserve its Title, and
add to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page. If there
is no section Entitled "History" in the Document, create one stating
the title, year, authors, and publisher of the Document as given on its
Title Page, then add an item describing the Modified Version as stated
in the previous sentence.</p>
</li>
<li>
<p>J. Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise the
network locations given in the Document for previous versions it was
based on. These may be placed in the "History" section. You may omit a
network location for a work that was published at least four years
before the Document itself, or if the original publisher of the version
it refers to gives permission.</p>
</li>
<li>
<p>K. For any section Entitled "Acknowledgements" or "Dedications",
Preserve the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.</p>
</li>
<li>
<p>L. Preserve all the Invariant Sections of the Document, unaltered in
their text and in their titles. Section numbers or the equivalent are
not considered part of the section titles.</p>
</li>
<li>
<p>M. Delete any section Entitled "Endorsements". Such a section may
not be included in the Modified Version.</p>
</li>
<li>
<p>N. Do not retitle any existing section to be Entitled "Endorsements"
or to conflict in title with any Invariant Section.</p>
</li>
<li>
<p>O. Preserve any Warranty Disclaimers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the Modified Version includes new front-matter sections or appendices
that qualify as Secondary Sections and contain no material copied from
the Document, you may at your option designate some or all of these
sections as invariant. To do this, add their titles to the list of
Invariant Sections in the Modified Version’s license notice. These
titles must be distinct from any other section titles.</p>
</div>
<div class="paragraph">
<p>You may add a section Entitled "Endorsements", provided it contains
nothing but endorsements of your Modified Version by various parties—for
example, statements of peer review or that the text has been approved by
an organization as the authoritative definition of a standard.</p>
</div>
<div class="paragraph">
<p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version. Only one passage of Front-Cover
Text and one of Back-Cover Text may be added by (or through arrangements
made by) any one entity. If the Document already includes a cover text
for the same cover, previously added by you or by arrangement made by
the same entity you are acting on behalf of, you may not add another;
but you may replace the old one, on explicit permission from the
previous publisher that added the old one.</p>
</div>
<div class="paragraph">
<p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_combining_documents">B.6. COMBINING DOCUMENTS</h3>
<div class="paragraph">
<p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its license
notice, and that you preserve all their Warranty Disclaimers.</p>
</div>
<div class="paragraph">
<p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy. If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by adding
at the end of it, in parentheses, the name of the original author or
publisher of that section if known, or else a unique number. Make the
same adjustment to the section titles in the list of Invariant Sections
in the license notice of the combined work.</p>
</div>
<div class="paragraph">
<p>In the combination, you must combine any sections Entitled "History"
in the various original documents, forming one section Entitled
"History"; likewise combine any sections Entitled
"Acknowledgements", and any sections Entitled "Dedications". You
must delete all sections Entitled "Endorsements".</p>
</div>
</div>
<div class="sect2">
<h3 id="_collections_of_documents">B.7. COLLECTIONS OF DOCUMENTS</h3>
<div class="paragraph">
<p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.</p>
</div>
<div class="paragraph">
<p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aggregation_with_independent_works">B.8. AGGREGATION WITH INDEPENDENT WORKS</h3>
<div class="paragraph">
<p>A compilation of the Document or its derivatives with other separate and
independent documents or works, in or on a volume of a storage or
distribution medium, is called an "aggregate" if the copyright
resulting from the compilation is not used to limit the legal rights of
the compilation’s users beyond what the individual works permit. When
the Document is included in an aggregate, this License does not apply to
the other works in the aggregate which are not themselves derivative
works of the Document.</p>
</div>
<div class="paragraph">
<p>If the Cover Text requirement of section 3 is applicable to these copies
of the Document, then if the Document is less than one half of the
entire aggregate, the Document’s Cover Texts may be placed on covers
that bracket the Document within the aggregate, or the electronic
equivalent of covers if the Document is in electronic form. Otherwise
they must appear on printed covers that bracket the whole aggregate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_translation">B.9. TRANSLATION</h3>
<div class="paragraph">
<p>Translation is considered a kind of modification, so you may distribute
translations of the Document under the terms of section 4. Replacing
Invariant Sections with translations requires special permission from
their copyright holders, but you may include translations of some or all
Invariant Sections in addition to the original versions of these
Invariant Sections. You may include a translation of this License, and
all the license notices in the Document, and any Warranty Disclaimers,
provided that you also include the original English version of this
License and the original versions of those notices and disclaimers. In
case of a disagreement between the translation and the original version
of this License or a notice or disclaimer, the original version will
prevail.</p>
</div>
<div class="paragraph">
<p>If a section in the Document is Entitled "Acknowledgements",
"Dedications", or "History", the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual title.</p>
</div>
</div>
<div class="sect2">
<h3 id="_termination">B.10. TERMINATION</h3>
<div class="paragraph">
<p>You may not copy, modify, sublicense, or distribute the Document except
as expressly provided under this License. Any attempt otherwise to copy,
modify, sublicense, or distribute it is void, and will automatically
terminate your rights under this License.</p>
</div>
<div class="paragraph">
<p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally terminates
your license, and (b) permanently, if the copyright holder fails to
notify you of the violation by some reasonable means prior to 60 days
after the cessation.</p>
</div>
<div class="paragraph">
<p>Moreover, your license from a particular copyright holder is reinstated
permanently if the copyright holder notifies you of the violation by
some reasonable means, this is the first time you have received notice
of violation of this License (for any work) from that copyright holder,
and you cure the violation prior to 30 days after your receipt of the
notice.</p>
</div>
<div class="paragraph">
<p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License. If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_future_revisions_of_this_license">B.11. FUTURE REVISIONS OF THIS LICENSE</h3>
<div class="paragraph">
<p>The Free Software Foundation may publish new, revised versions of the
GNU Free Documentation License from time to time. Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns. See <a href="https://www.gnu.org/licenses/" class="bare">https://www.gnu.org/licenses/</a>.</p>
</div>
<div class="paragraph">
<p>Each version of the License is given a distinguishing version number. If
the Document specifies that a particular numbered version of this
License "or any later version" applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation. If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation. If the Document specifies
that a proxy can decide which future versions of this License can be
used, that proxy’s public statement of acceptance of a version
permanently authorizes you to choose that version for the Document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relicensing">B.12. RELICENSING</h3>
<div class="paragraph">
<p>"Massive Multiauthor Collaboration Site" (or "MMC Site") means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works. A public
wiki that anybody can edit is an example of such a server. A "Massive
Multiauthor Collaboration" (or "MMC") contained in the site means any
set of copyrightable works thus published on the MMC site.</p>
</div>
<div class="paragraph">
<p>"CC-BY-SA" means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.</p>
</div>
<div class="paragraph">
<p>"Incorporate" means to publish or republish a Document, in whole or in
part, as part of another Document.</p>
</div>
<div class="paragraph">
<p>An MMC is "eligible for relicensing" if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole or
in part into the MMC, (1) had no cover texts or invariant sections, and
(2) were thus incorporated prior to November 1, 2008.</p>
</div>
<div class="paragraph">
<p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_addendum_how_to_use_this_license_for_your_documents">B.13. ADDENDUM: How to use this License for your documents</h3>
<div class="paragraph">
<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and license
notices just after the title page:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    Copyright (C)  YEAR  YOUR NAME.
    Permission is granted to copy, distribute and/or modify this document
    under the terms of the GNU Free Documentation License, Version 1.3
    or any later version published by the Free Software Foundation;
    with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
    A copy of the license is included in the section entitled "GNU
    Free Documentation License".</pre>
</div>
</div>
<div class="paragraph">
<p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the "with … Texts." line with this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    with the Invariant Sections being LIST THEIR TITLES, with the
    Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre>
</div>
</div>
<div class="paragraph">
<p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.</p>
</div>
<div class="paragraph">
<p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of free
software license, such as the GNU General Public License, to permit
their use in free software.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Documentation about hygienic macros has been stolen in the SLIB manual
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. In fact <code>define-module</code> on a given name defines a new module only the first time it is invoked on this name. By this way, interactively reloading a module does not define a new entity, and the other modules which use it are not altered.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. This transcript uses the default toplevel loop             which displays the name of the current module in the evaluator             prompt.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Under Unix, you can simply connect to a listening socket with the <code>telnet</code> of <code>netcat</code> command. For the given example, this can be achieved with <code>netcat localhost 12345</code>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. Port 13, if open, can be used for testing: making a connection to it permits to know the distant system&#8217;s idea of the time of day.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. This section is an adaptation of Jeff Dalton&#8217;s (<a href="mailto:J.Dalton@ed.ac.uk">J.Dalton@ed.ac.uk</a>) "<strong><em>Brief introduction to CLOS</em></strong>" which can be found at <a href="http://www.aiai.ed.ac.uk/~jeff/clos-guide.html" class="bare">http://www.aiai.ed.ac.uk/~jeff/clos-guide.html</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-01-26 18:18:11 +0100
</div>
</div>
</body>
</html>